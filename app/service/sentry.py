#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IGpzb24KaW1wb3J0IHRocmVhZGluZwppbXBvcnQgcmVxdWVzdHMKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSB0aW1lIGltcG9ydCBzbGVlcAoKZnJvbSBhcHAyLmNsaWVudC5lbmdzZWwgaW1wb3J0IHNlbmRfYXBpX3JlcXVlc3QKZnJvbSBhcHAuc2VydmljZS5hdXRoIGltcG9ydCBBdXRoSW5zdGFuY2UKCgpkZWYgZW50ZXJfc2VudHJ5X21vZGUoKToKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgYWN0aXZlX3VzZXIgPSBBdXRoSW5zdGFuY2UuZ2V0X2FjdGl2ZV91c2VyKCkKICAgIGlmIGFjdGl2ZV91c2VyIGlzIE5vbmU6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICB0b2tlbnMgPSBhY3RpdmVfdXNlclsidG9rZW5zIl0KCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoInNlbnRyeSIpOgogICAgICAgIG9zLm1ha2VkaXJzKCJzZW50cnkiKQoKICAgIGZpbGVfbmFtZSA9IG9zLnBhdGguam9pbigKICAgICAgICAic2VudHJ5IiwKICAgICAgICBmInNlbnRyeV9sb2dfe2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWSVtJWRfJUglTSVTJyl9Lmpzb25sIgogICAgKQoKICAgIHN0b3BfZmxhZyA9IHsic3RvcCI6IEZhbHNlfQoKICAgICMgQmFja2dyb3VuZCBsaXN0ZW5lciBmb3IgInEiCiAgICBkZWYgbGlzdGVuX2Zvcl9xdWl0KCk6CiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdXNlcl9pbnB1dCA9IHN5cy5zdGRpbi5yZWFkbGluZSgpCiAgICAgICAgICAgIGlmIG5vdCB1c2VyX2lucHV0OgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgdXNlcl9pbnB1dC5zdHJpcCgpLmxvd2VyKCkgPT0gInEiOgogICAgICAgICAgICAgICAgc3RvcF9mbGFnWyJzdG9wIl0gPSBUcnVlCiAgICAgICAgICAgICAgICBicmVhawoKICAgIGxpc3RlbmVyX3RocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWxpc3Rlbl9mb3JfcXVpdCwgZGFlbW9uPVRydWUpCiAgICBsaXN0ZW5lcl90aHJlYWQuc3RhcnQoKQoKICAgIGlkX3Rva2VuID0gdG9rZW5zLmdldCgiaWRfdG9rZW4iKQogICAgcGF0aCA9ICJhcGkvdjgvcGFja2FnZXMvcXVvdGEtZGV0YWlscyIKICAgIHBheWxvYWQgPSB7ImlzX2VudGVycHJpc2UiOiBGYWxzZSwgImxhbmciOiAiZW4iLCAiZmFtaWx5X21lbWJlcl9pZCI6ICIifQoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oZmlsZV9uYW1lLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIHdoaWxlIG5vdCBzdG9wX2ZsYWdbInN0b3AiXToKICAgICAgICAgICAgICAgIHNsZWVwKDEpCiAgICAgICAgICAgICAgICB0aW1lc3RhbXAgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWQgJUg6JU06JVMiKQoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICAgICAgICAgICAgICBxdW90YXMgPSByZXNbImRhdGEiXVsicXVvdGFzIl0KICAgICAgICAgICAgICAgICAgICBkYXRhX3BvaW50ID0geyJ0aW1lIjogdGltZXN0YW1wLCAicXVvdGFzIjogcXVvdGFzfQoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGpzb24uZHVtcHMoZGF0YV9wb2ludCkgKyAiXG4iKQogICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQoKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgcGFzcwoKICAgIHJldHVybiBmaWxlX25hbWUK').decode())
