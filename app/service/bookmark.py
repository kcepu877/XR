#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBqc29uCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0LCBEaWN0CgoKY2xhc3MgQm9va21hcms6CiAgICBfaW5zdGFuY2UgPSBOb25lCiAgICBfaW5pdGlhbGl6ZWQgPSBGYWxzZQoKICAgIGRlZiBfX25ld19fKGNscywgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICBpZiBub3QgY2xzLl9pbnN0YW5jZToKICAgICAgICAgICAgY2xzLl9pbnN0YW5jZSA9IHN1cGVyKCkuX19uZXdfXyhjbHMpCiAgICAgICAgcmV0dXJuIGNscy5faW5zdGFuY2UKCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgaWYgbm90IHNlbGYuX2luaXRpYWxpemVkOgogICAgICAgICAgICBzZWxmLnBhY2thZ2VzOiBMaXN0W0RpY3RdID0gW10KICAgICAgICAgICAgc2VsZi5maWxlcGF0aCA9ICJib29rbWFyay5qc29uIgoKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc2VsZi5maWxlcGF0aCk6CiAgICAgICAgICAgICAgICBzZWxmLmxvYWRfYm9va21hcmsoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5fc2F2ZShbXSkgICMgY3JlYXRlIGVtcHR5IGZpbGUKCiAgICAgICAgICAgIHNlbGYuX2luaXRpYWxpemVkID0gVHJ1ZQoKICAgIGRlZiBfc2F2ZShzZWxmLCBkYXRhOiBMaXN0W0RpY3RdKToKICAgICAgICAiIiJIZWxwZXIgdG8gd3JpdGUgSlNPTiBzYWZlbHkuIiIiCiAgICAgICAgd2l0aCBvcGVuKHNlbGYuZmlsZXBhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAganNvbi5kdW1wKGRhdGEsIGYsIGluZGVudD00KQoKICAgIGRlZiBfZW5zdXJlX3NjaGVtYShzZWxmKToKICAgICAgICAiIiJFbnN1cmUgYWxsIGJvb2ttYXJrcyBoYXZlIHRoZSBsYXRlc3Qgc2NoZW1hIGZpZWxkcy4iIiIKICAgICAgICB1cGRhdGVkID0gRmFsc2UKICAgICAgICBmb3IgcCBpbiBzZWxmLnBhY2thZ2VzOgogICAgICAgICAgICBpZiAiZmFtaWx5X25hbWUiIG5vdCBpbiBwOgogICAgICAgICAgICAgICAgcFsiZmFtaWx5X25hbWUiXSA9ICIiCiAgICAgICAgICAgICAgICB1cGRhdGVkID0gVHJ1ZQogICAgICAgICAgICBpZiAib3JkZXIiIG5vdCBpbiBwOgogICAgICAgICAgICAgICAgcFsib3JkZXIiXSA9IDAKICAgICAgICAgICAgICAgIHVwZGF0ZWQgPSBUcnVlCiAgICAgICAgaWYgdXBkYXRlZDoKICAgICAgICAgICAgc2VsZi5zYXZlX2Jvb2ttYXJrKCkKCiAgICBkZWYgbG9hZF9ib29rbWFyayhzZWxmKToKICAgICAgICAiIiJMb2FkIGJvb2ttYXJrcyBmcm9tIEpTT04gZmlsZSBhbmQgZW5zdXJlIHNjaGVtYSBjb25zaXN0ZW5jeS4iIiIKICAgICAgICB3aXRoIG9wZW4oc2VsZi5maWxlcGF0aCwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBzZWxmLnBhY2thZ2VzID0ganNvbi5sb2FkKGYpCiAgICAgICAgc2VsZi5fZW5zdXJlX3NjaGVtYSgpCgogICAgZGVmIHNhdmVfYm9va21hcmsoc2VsZik6CiAgICAgICAgIiIiU2F2ZSBjdXJyZW50IGJvb2ttYXJrcyB0byBKU09OIGZpbGUuIiIiCiAgICAgICAgc2VsZi5fc2F2ZShzZWxmLnBhY2thZ2VzKQoKICAgIGRlZiBhZGRfYm9va21hcmsoCiAgICAgICAgc2VsZiwKICAgICAgICBmYW1pbHlfY29kZTogc3RyLAogICAgICAgIGZhbWlseV9uYW1lOiBzdHIsCiAgICAgICAgaXNfZW50ZXJwcmlzZTogYm9vbCwKICAgICAgICB2YXJpYW50X25hbWU6IHN0ciwKICAgICAgICBvcHRpb25fbmFtZTogc3RyLAogICAgICAgIG9yZGVyOiBpbnQsCiAgICApIC0+IGJvb2w6CiAgICAgICAgIiIiQWRkIGEgYm9va21hcmsgaWYgaXQgZG9lcyBub3QgYWxyZWFkeSBleGlzdC4iIiIKICAgICAgICBrZXkgPSAoZmFtaWx5X2NvZGUsIHZhcmlhbnRfbmFtZSwgb3JkZXIpCgogICAgICAgIGlmIGFueSgKICAgICAgICAgICAgKHBbImZhbWlseV9jb2RlIl0sIHBbInZhcmlhbnRfbmFtZSJdLCBwWyJvcmRlciJdKSA9PSBrZXkKICAgICAgICAgICAgZm9yIHAgaW4gc2VsZi5wYWNrYWdlcwogICAgICAgICk6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBzZWxmLnBhY2thZ2VzLmFwcGVuZCgKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgImZhbWlseV9uYW1lIjogZmFtaWx5X25hbWUsCiAgICAgICAgICAgICAgICAiZmFtaWx5X2NvZGUiOiBmYW1pbHlfY29kZSwKICAgICAgICAgICAgICAgICJpc19lbnRlcnByaXNlIjogaXNfZW50ZXJwcmlzZSwKICAgICAgICAgICAgICAgICJ2YXJpYW50X25hbWUiOiB2YXJpYW50X25hbWUsCiAgICAgICAgICAgICAgICAib3B0aW9uX25hbWUiOiBvcHRpb25fbmFtZSwKICAgICAgICAgICAgICAgICJvcmRlciI6IG9yZGVyLAogICAgICAgICAgICB9CiAgICAgICAgKQogICAgICAgIHNlbGYuc2F2ZV9ib29rbWFyaygpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgcmVtb3ZlX2Jvb2ttYXJrKAogICAgICAgIHNlbGYsCiAgICAgICAgZmFtaWx5X2NvZGU6IHN0ciwKICAgICAgICBpc19lbnRlcnByaXNlOiBib29sLAogICAgICAgIHZhcmlhbnRfbmFtZTogc3RyLAogICAgICAgIG9yZGVyOiBpbnQsCiAgICApIC0+IGJvb2w6CiAgICAgICAgIiIiUmVtb3ZlIGEgYm9va21hcmsgaWYgaXQgZXhpc3RzLiBSZXR1cm5zIFRydWUgaWYgcmVtb3ZlZC4iIiIKICAgICAgICBmb3IgaSwgcCBpbiBlbnVtZXJhdGUoc2VsZi5wYWNrYWdlcyk6CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHBbImZhbWlseV9jb2RlIl0gPT0gZmFtaWx5X2NvZGUKICAgICAgICAgICAgICAgIGFuZCBwWyJpc19lbnRlcnByaXNlIl0gPT0gaXNfZW50ZXJwcmlzZQogICAgICAgICAgICAgICAgYW5kIHBbInZhcmlhbnRfbmFtZSJdID09IHZhcmlhbnRfbmFtZQogICAgICAgICAgICAgICAgYW5kIHBbIm9yZGVyIl0gPT0gb3JkZXIKICAgICAgICAgICAgKToKICAgICAgICAgICAgICAgIGRlbCBzZWxmLnBhY2thZ2VzW2ldCiAgICAgICAgICAgICAgICBzZWxmLnNhdmVfYm9va21hcmsoKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZ2V0X2Jvb2ttYXJrcyhzZWxmKSAtPiBMaXN0W0RpY3RdOgogICAgICAgICIiIlJldHVybiBhbGwgYm9va21hcmtzLiIiIgogICAgICAgIHJldHVybiBzZWxmLnBhY2thZ2VzLmNvcHkoKQoKCkJvb2ttYXJrSW5zdGFuY2UgPSBCb29rbWFyaygpCg==').decode())
