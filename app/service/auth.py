#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmZyb20gYXBwMi5jbGllbnQuY2lhbSBpbXBvcnQgZ2V0X25ld190b2tlbgpmcm9tIGFwcDIuY2xpZW50LmVuZ3NlbCBpbXBvcnQgZ2V0X3Byb2ZpbGUKZnJvbSBhcHAudXRpbCBpbXBvcnQgZW5zdXJlX2FwaV9rZXkKCgpjbGFzcyBBdXRoOgogICAgX2luc3RhbmNlXyA9IE5vbmUKICAgIF9pbml0aWFsaXplZF8gPSBGYWxzZQoKICAgIGFwaV9rZXkgPSAiIgogICAgcmVmcmVzaF90b2tlbnMgPSBbXQogICAgYWN0aXZlX3VzZXIgPSBOb25lCiAgICBsYXN0X3JlZnJlc2hfdGltZSA9IE5vbmUKCiAgICBkZWYgX19uZXdfXyhjbHMsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgaWYgbm90IGNscy5faW5zdGFuY2VfOgogICAgICAgICAgICBjbHMuX2luc3RhbmNlXyA9IHN1cGVyKCkuX19uZXdfXyhjbHMpCiAgICAgICAgcmV0dXJuIGNscy5faW5zdGFuY2VfCgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIGlmIG5vdCBzZWxmLl9pbml0aWFsaXplZF86CiAgICAgICAgICAgIHNlbGYuYXBpX2tleSA9IGVuc3VyZV9hcGlfa2V5KCkKCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCJyZWZyZXNoLXRva2Vucy5qc29uIik6CiAgICAgICAgICAgICAgICBzZWxmLmxvYWRfdG9rZW5zKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHdpdGggb3BlbigicmVmcmVzaC10b2tlbnMuanNvbiIsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgICAgICBqc29uLmR1bXAoW10sIGYsIGluZGVudD00KQoKICAgICAgICAgICAgc2VsZi5sb2FkX2FjdGl2ZV9udW1iZXIoKQogICAgICAgICAgICBzZWxmLmxhc3RfcmVmcmVzaF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICBzZWxmLl9pbml0aWFsaXplZF8gPSBUcnVlCgogICAgZGVmIGxvYWRfdG9rZW5zKHNlbGYpOgogICAgICAgIHdpdGggb3BlbigicmVmcmVzaC10b2tlbnMuanNvbiIsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgcmVmcmVzaF90b2tlbnMgPSBqc29uLmxvYWQoZikKCiAgICAgICAgICAgIGlmIGxlbihyZWZyZXNoX3Rva2VucykgIT0gMDoKICAgICAgICAgICAgICAgIHNlbGYucmVmcmVzaF90b2tlbnMgPSBbXQoKICAgICAgICAgICAgZm9yIHJ0IGluIHJlZnJlc2hfdG9rZW5zOgogICAgICAgICAgICAgICAgaWYgIm51bWJlciIgaW4gcnQgYW5kICJyZWZyZXNoX3Rva2VuIiBpbiBydDoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlZnJlc2hfdG9rZW5zLmFwcGVuZChydCkKCiAgICBkZWYgYWRkX3JlZnJlc2hfdG9rZW4oc2VsZiwgbnVtYmVyOiBpbnQsIHJlZnJlc2hfdG9rZW46IHN0cik6CiAgICAgICAgZXhpc3RpbmcgPSBuZXh0KChydCBmb3IgcnQgaW4gc2VsZi5yZWZyZXNoX3Rva2VucyBpZiBydFsibnVtYmVyIl0gPT0gbnVtYmVyKSwgTm9uZSkKICAgICAgICBpZiBleGlzdGluZzoKICAgICAgICAgICAgZXhpc3RpbmdbInJlZnJlc2hfdG9rZW4iXSA9IHJlZnJlc2hfdG9rZW4KICAgICAgICBlbHNlOgogICAgICAgICAgICB0b2tlbnMgPSBnZXRfbmV3X3Rva2VuKHNlbGYuYXBpX2tleSwgcmVmcmVzaF90b2tlbiwgIiIpCiAgICAgICAgICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgcHJvZmlsZV9kYXRhID0gZ2V0X3Byb2ZpbGUoc2VsZi5hcGlfa2V5LCB0b2tlbnNbImFjY2Vzc190b2tlbiJdLCB0b2tlbnNbImlkX3Rva2VuIl0pCiAgICAgICAgICAgIHN1Yl9pZCA9IHByb2ZpbGVfZGF0YVsicHJvZmlsZSJdWyJzdWJzY3JpYmVyX2lkIl0KICAgICAgICAgICAgc3ViX3R5cGUgPSBwcm9maWxlX2RhdGFbInByb2ZpbGUiXVsic3Vic2NyaXB0aW9uX3R5cGUiXQoKICAgICAgICAgICAgc2VsZi5yZWZyZXNoX3Rva2Vucy5hcHBlbmQoewogICAgICAgICAgICAgICAgIm51bWJlciI6IGludChudW1iZXIpLAogICAgICAgICAgICAgICAgInN1YnNjcmliZXJfaWQiOiBzdWJfaWQsCiAgICAgICAgICAgICAgICAic3Vic2NyaXB0aW9uX3R5cGUiOiBzdWJfdHlwZSwKICAgICAgICAgICAgICAgICJyZWZyZXNoX3Rva2VuIjogcmVmcmVzaF90b2tlbgogICAgICAgICAgICB9KQoKICAgICAgICBzZWxmLndyaXRlX3Rva2Vuc190b19maWxlKCkKICAgICAgICBzZWxmLnNldF9hY3RpdmVfdXNlcihudW1iZXIpCgogICAgZGVmIHJlbW92ZV9yZWZyZXNoX3Rva2VuKHNlbGYsIG51bWJlcjogaW50KToKICAgICAgICBzZWxmLnJlZnJlc2hfdG9rZW5zID0gW3J0IGZvciBydCBpbiBzZWxmLnJlZnJlc2hfdG9rZW5zIGlmIHJ0WyJudW1iZXIiXSAhPSBudW1iZXJdCiAgICAgICAgc2VsZi53cml0ZV90b2tlbnNfdG9fZmlsZSgpCgogICAgICAgIGlmIHNlbGYuYWN0aXZlX3VzZXIgYW5kIHNlbGYuYWN0aXZlX3VzZXJbIm51bWJlciJdID09IG51bWJlcjoKICAgICAgICAgICAgaWYgbGVuKHNlbGYucmVmcmVzaF90b2tlbnMpICE9IDA6CiAgICAgICAgICAgICAgICBmaXJzdF9ydCA9IHNlbGYucmVmcmVzaF90b2tlbnNbMF0KICAgICAgICAgICAgICAgIHRva2VucyA9IGdldF9uZXdfdG9rZW4oc2VsZi5hcGlfa2V5LCBmaXJzdF9ydFsicmVmcmVzaF90b2tlbiJdLCBmaXJzdF9ydC5nZXQoInN1YnNjcmliZXJfaWQiLCAiIikpCiAgICAgICAgICAgICAgICBpZiB0b2tlbnM6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRfYWN0aXZlX3VzZXIoZmlyc3RfcnRbIm51bWJlciJdKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5hY3RpdmVfdXNlciA9IE5vbmUKCiAgICBkZWYgc2V0X2FjdGl2ZV91c2VyKHNlbGYsIG51bWJlcjogaW50KToKICAgICAgICBydF9lbnRyeSA9IG5leHQoKHJ0IGZvciBydCBpbiBzZWxmLnJlZnJlc2hfdG9rZW5zIGlmIHJ0WyJudW1iZXIiXSA9PSBudW1iZXIpLCBOb25lKQogICAgICAgIGlmIG5vdCBydF9lbnRyeToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIHRva2VucyA9IGdldF9uZXdfdG9rZW4oc2VsZi5hcGlfa2V5LCBydF9lbnRyeVsicmVmcmVzaF90b2tlbiJdLCBydF9lbnRyeS5nZXQoInN1YnNjcmliZXJfaWQiLCAiIikpCiAgICAgICAgaWYgbm90IHRva2VuczoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIHByb2ZpbGVfZGF0YSA9IGdldF9wcm9maWxlKHNlbGYuYXBpX2tleSwgdG9rZW5zWyJhY2Nlc3NfdG9rZW4iXSwgdG9rZW5zWyJpZF90b2tlbiJdKQogICAgICAgIHN1YnNjcmliZXJfaWQgPSBwcm9maWxlX2RhdGFbInByb2ZpbGUiXVsic3Vic2NyaWJlcl9pZCJdCiAgICAgICAgc3Vic2NyaXB0aW9uX3R5cGUgPSBwcm9maWxlX2RhdGFbInByb2ZpbGUiXVsic3Vic2NyaXB0aW9uX3R5cGUiXQoKICAgICAgICBzZWxmLmFjdGl2ZV91c2VyID0gewogICAgICAgICAgICAibnVtYmVyIjogaW50KG51bWJlciksCiAgICAgICAgICAgICJzdWJzY3JpYmVyX2lkIjogc3Vic2NyaWJlcl9pZCwKICAgICAgICAgICAgInN1YnNjcmlwdGlvbl90eXBlIjogc3Vic2NyaXB0aW9uX3R5cGUsCiAgICAgICAgICAgICJ0b2tlbnMiOiB0b2tlbnMKICAgICAgICB9CgogICAgICAgIHJ0X2VudHJ5WyJzdWJzY3JpYmVyX2lkIl0gPSBzdWJzY3JpYmVyX2lkCiAgICAgICAgcnRfZW50cnlbInN1YnNjcmlwdGlvbl90eXBlIl0gPSBzdWJzY3JpcHRpb25fdHlwZQogICAgICAgIHJ0X2VudHJ5WyJyZWZyZXNoX3Rva2VuIl0gPSB0b2tlbnNbInJlZnJlc2hfdG9rZW4iXQoKICAgICAgICBzZWxmLndyaXRlX3Rva2Vuc190b19maWxlKCkKICAgICAgICBzZWxmLmxhc3RfcmVmcmVzaF90aW1lID0gaW50KHRpbWUudGltZSgpKQogICAgICAgIHNlbGYud3JpdGVfYWN0aXZlX251bWJlcigpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgcmVuZXdfYWN0aXZlX3VzZXJfdG9rZW4oc2VsZik6CiAgICAgICAgaWYgc2VsZi5hY3RpdmVfdXNlcjoKICAgICAgICAgICAgdG9rZW5zID0gZ2V0X25ld190b2tlbihzZWxmLmFwaV9rZXksIHNlbGYuYWN0aXZlX3VzZXJbInRva2VucyJdWyJyZWZyZXNoX3Rva2VuIl0sIHNlbGYuYWN0aXZlX3VzZXJbInN1YnNjcmliZXJfaWQiXSkKICAgICAgICAgICAgaWYgdG9rZW5zOgogICAgICAgICAgICAgICAgc2VsZi5hY3RpdmVfdXNlclsidG9rZW5zIl0gPSB0b2tlbnMKICAgICAgICAgICAgICAgIHNlbGYubGFzdF9yZWZyZXNoX3RpbWUgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgICAgICBzZWxmLmFkZF9yZWZyZXNoX3Rva2VuKHNlbGYuYWN0aXZlX3VzZXJbIm51bWJlciJdLCBzZWxmLmFjdGl2ZV91c2VyWyJ0b2tlbnMiXVsicmVmcmVzaF90b2tlbiJdKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZ2V0X2FjdGl2ZV91c2VyKHNlbGYpOgogICAgICAgIGlmIG5vdCBzZWxmLmFjdGl2ZV91c2VyOgogICAgICAgICAgICBpZiBsZW4oc2VsZi5yZWZyZXNoX3Rva2VucykgIT0gMDoKICAgICAgICAgICAgICAgIGZpcnN0X3J0ID0gc2VsZi5yZWZyZXNoX3Rva2Vuc1swXQogICAgICAgICAgICAgICAgdG9rZW5zID0gZ2V0X25ld190b2tlbihzZWxmLmFwaV9rZXksIGZpcnN0X3J0WyJyZWZyZXNoX3Rva2VuIl0sIGZpcnN0X3J0LmdldCgic3Vic2NyaWJlcl9pZCIsICIiKSkKICAgICAgICAgICAgICAgIGlmIHRva2VuczoKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldF9hY3RpdmVfdXNlcihmaXJzdF9ydFsibnVtYmVyIl0pCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGlmIHNlbGYubGFzdF9yZWZyZXNoX3RpbWUgaXMgTm9uZSBvciAoaW50KHRpbWUudGltZSgpKSAtIHNlbGYubGFzdF9yZWZyZXNoX3RpbWUpID4gMzAwOgogICAgICAgICAgICBzZWxmLnJlbmV3X2FjdGl2ZV91c2VyX3Rva2VuKCkKICAgICAgICAgICAgc2VsZi5sYXN0X3JlZnJlc2hfdGltZSA9IHRpbWUudGltZSgpCgogICAgICAgIHJldHVybiBzZWxmLmFjdGl2ZV91c2VyCgogICAgZGVmIGdldF9hY3RpdmVfdG9rZW5zKHNlbGYpIC0+IGRpY3QgfCBOb25lOgogICAgICAgIGFjdGl2ZV91c2VyID0gc2VsZi5nZXRfYWN0aXZlX3VzZXIoKQogICAgICAgIHJldHVybiBhY3RpdmVfdXNlclsidG9rZW5zIl0gaWYgYWN0aXZlX3VzZXIgZWxzZSBOb25lCgogICAgZGVmIHdyaXRlX3Rva2Vuc190b19maWxlKHNlbGYpOgogICAgICAgIHdpdGggb3BlbigicmVmcmVzaC10b2tlbnMuanNvbiIsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAganNvbi5kdW1wKHNlbGYucmVmcmVzaF90b2tlbnMsIGYsIGluZGVudD00KQoKICAgIGRlZiB3cml0ZV9hY3RpdmVfbnVtYmVyKHNlbGYpOgogICAgICAgIGlmIHNlbGYuYWN0aXZlX3VzZXI6CiAgICAgICAgICAgIHdpdGggb3BlbigiYWN0aXZlLm51bWJlciIsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoc3RyKHNlbGYuYWN0aXZlX3VzZXJbIm51bWJlciJdKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cygiYWN0aXZlLm51bWJlciIpOgogICAgICAgICAgICAgICAgb3MucmVtb3ZlKCJhY3RpdmUubnVtYmVyIikKCiAgICBkZWYgbG9hZF9hY3RpdmVfbnVtYmVyKHNlbGYpOgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCJhY3RpdmUubnVtYmVyIik6CiAgICAgICAgICAgIHdpdGggb3BlbigiYWN0aXZlLm51bWJlciIsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIG51bWJlcl9zdHIgPSBmLnJlYWQoKS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiBudW1iZXJfc3RyLmlzZGlnaXQoKToKICAgICAgICAgICAgICAgICAgICBudW1iZXIgPSBpbnQobnVtYmVyX3N0cikKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldF9hY3RpdmVfdXNlcihudW1iZXIpCgogICAgZGVmIGVkaXRfYWNjb3VudF9uYW1lKHNlbGYsIG51bWJlcjogaW50LCBuZXdfbmFtZTogc3RyKToKICAgICAgICBmb3IgdXNlciBpbiBzZWxmLnJlZnJlc2hfdG9rZW5zOgogICAgICAgICAgICBpZiB1c2VyWyJudW1iZXIiXSA9PSBudW1iZXI6CiAgICAgICAgICAgICAgICB1c2VyWyJuYW1lIl0gPSBuZXdfbmFtZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBzZWxmLndyaXRlX3Rva2Vuc190b19maWxlKCkKCgpBdXRoSW5zdGFuY2UgPSBBdXRoKCkK').decode())
