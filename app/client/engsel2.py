#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KZnJvbSBhcHAuY2xpZW50LmVuZ3NlbCBpbXBvcnQgc2VuZF9hcGlfcmVxdWVzdApmcm9tIGFwcC5tZW51cy51dGlsIGltcG9ydCBmb3JtYXRfcXVvdGFfYnl0ZQpmcm9tIGFwcC5tZW51cy51dGlsX2hlbHBlciBpbXBvcnQgbGl2ZV9sb2FkaW5nCmZyb20gYXBwLmNvbmZpZy50aGVtZV9jb25maWcgaW1wb3J0IGdldF90aGVtZQoKZGVmIHVuc3Vic2NyaWJlKAogICAgYXBpX2tleTogc3RyLAogICAgdG9rZW5zOiBkaWN0LAogICAgcXVvdGFfY29kZTogc3RyLAogICAgcHJvZHVjdF9kb21haW46IHN0ciwKICAgIHByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGU6IHN0ciwKKSAtPiBib29sOgogICAgcGF0aCA9ICJhcGkvdjgvcGFja2FnZXMvdW5zdWJzY3JpYmUiCgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgInByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGUiOiBwcm9kdWN0X3N1YnNjcmlwdGlvbl90eXBlLAogICAgICAgICJxdW90YV9jb2RlIjogcXVvdGFfY29kZSwKICAgICAgICAicHJvZHVjdF9kb21haW4iOiBwcm9kdWN0X2RvbWFpbiwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJ1bnN1YnNjcmliZV9yZWFzb25fY29kZSI6ICIiLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAiZmFtaWx5X21lbWJlcl9pZCI6ICIiCiAgICB9CiAgICAKICAgICMgcHJpbnQoZiJQYXlsb2FkOiB7anNvbi5kdW1wcyhyYXdfcGF5bG9hZCwgaW5kZW50PTQpfSIpCgogICAgdHJ5OgogICAgICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgICAgIHByaW50KGpzb24uZHVtcHMocmVzLCBpbmRlbnQ9NCkpCgogICAgICAgIGlmIHJlcyBhbmQgcmVzLmdldCgiY29kZSIpID09ICIwMDAiOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHJldHVybiBGYWxzZQoKZGVmIGdldF9wZW5kaW5nX3RyYW5zYWN0aW9uKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0KSAtPiBkaWN0OgogICAgcGF0aCA9ICJhcGkvdjgvcHJvZmlsZSIKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgImxhbmciOiAiZW4iCiAgICB9CgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQogICAgd2l0aCBsaXZlX2xvYWRpbmcoIk1lbmdhbWJpbCB0cmFuc2Frc2kgdGVydHVuZGEuLi4iLCB0aGVtZSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgcmV0dXJuIHJlcy5nZXQoImRhdGEiKQoKZGVmIGdldF90cmFuc2FjdGlvbl9oaXN0b3J5KGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0KSAtPiBkaWN0OgogICAgcGF0aCA9ICJwYXltZW50cy9hcGkvdjgvdHJhbnNhY3Rpb24taGlzdG9yeSIKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgImxhbmciOiAiZW4iCiAgICB9CgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQogICAgd2l0aCBsaXZlX2xvYWRpbmcoIk1lbmdhbWJpbCByaXdheWF0IHRyYW5zYWtzaS4uLiIsIHRoZW1lKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICByZXR1cm4gcmVzLmdldCgiZGF0YSIpCgpkZWYgZ2V0X3RpZXJpbmdfaW5mbyhhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCkgLT4gZGljdDoKICAgIHBhdGggPSAiZ2FtaWZpY2F0aW9uL2FwaS92OC9sb3lhbHRpZXMvdGllcmluZy9pbmZvIgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIKICAgIH0KCiAgICB0aGVtZSA9IGdldF90aGVtZSgpCiAgICB3aXRoIGxpdmVfbG9hZGluZygiTWVuZ2FtYmlsIGluZm8gdGllcmluZy4uLiIsIHRoZW1lKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICBpZiByZXM6CiAgICAgICAgcmV0dXJuIHJlcy5nZXQoImRhdGEiLCB7fSkKICAgIHJldHVybiB7fQoKZGVmIHNlZ21lbnRzKGFwaV9rZXk6IHN0ciwgaWRfdG9rZW46IHN0ciwgYWNjZXNzX3Rva2VuOiBzdHIsIGJhbGFuY2U6IGludCA9IDApIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJkYXNoYm9hcmQvYXBpL3Y4L3NlZ21lbnRzIgogICAgcGF5bG9hZCA9IHsKICAgICAgICAiYWNjZXNzX3Rva2VuIjogYWNjZXNzX3Rva2VuLAogICAgICAgICJhcHBfdmVyc2lvbiI6ICI4LjguMCIsCiAgICAgICAgImN1cnJlbnRfYmFsYW5jZSI6IGJhbGFuY2UsCiAgICAgICAgImZhbWlseV9wbGFuX3JvbGUiOiAiTk9fUk9MRSIsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJpZCIsCiAgICAgICAgIm1hbnVmYWN0dXJlcl9uYW1lIjogInNhbXN1bmciLAogICAgICAgICJtb2RlbF9uYW1lIjogIlNNLU45MzVGIgogICAgfQoKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIHdpdGggbGl2ZV9sb2FkaW5nKCJNZW5nYW1iaWwgZGF0YSBzZWdtZW4gcGVuZ2d1bmEuLi4iLCB0aGVtZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIuKdjCBHYWdhbCBraXJpbSByZXF1ZXN0IHNlZ21lbnRzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIGlmIG5vdCAoaXNpbnN0YW5jZShyZXMsIGRpY3QpIGFuZCAiZGF0YSIgaW4gcmVzKToKICAgICAgICBlcnIgPSByZXMuZ2V0KCJlcnJvciIsICJVbmtub3duIGVycm9yIikgaWYgaXNpbnN0YW5jZShyZXMsIGRpY3QpIGVsc2UgcmVzCiAgICAgICAgcHJpbnQoZiLinYwgRXJyb3IgcmVzcG9ucyBzZWdtZW50czoge2Vycn0iKQogICAgICAgIHJldHVybiBOb25lCgogICAgZGF0YSA9IHJlc1siZGF0YSJdCgogICAgbG95YWx0eV9kYXRhID0gZGF0YS5nZXQoImxveWFsdHkiLCB7fSkuZ2V0KCJkYXRhIiwge30pCiAgICBsb3lhbHR5X2luZm8gPSB7CiAgICAgICAgImN1cnJlbnRfcG9pbnQiOiBsb3lhbHR5X2RhdGEuZ2V0KCJjdXJyZW50X3BvaW50IiwgMCksCiAgICAgICAgInRpZXJfbmFtZSI6IGxveWFsdHlfZGF0YS5nZXQoImRldGFpbF90aWVyIiwge30pLmdldCgibmFtZSIsICIiKQogICAgfQoKICAgIG5vdGlmaWNhdGlvbnMgPSBkYXRhLmdldCgibm90aWZpY2F0aW9uIiwge30pLmdldCgiZGF0YSIsIFtdKQoKICAgIHNmeV9kYXRhID0gZGF0YS5nZXQoInNwZWNpYWxfZm9yX3lvdSIsIHt9KS5nZXQoImRhdGEiLCB7fSkKICAgIHNmeV9iYW5uZXJzID0gc2Z5X2RhdGEuZ2V0KCJiYW5uZXJzIiwgW10pCiAgICBzcGVjaWFsX3BhY2thZ2VzID0gW10KCiAgICBmb3IgcGtnIGluIHNmeV9iYW5uZXJzOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHBrZy5nZXQoImFjdGlvbl9wYXJhbSIpOgogICAgICAgICAgICAgICAgY29udGludWUgICMgc2tpcCBqaWthIHRpZGFrIGFkYSBrb2RlIHBha2V0CgogICAgICAgICAgICBrdW90YV90b3RhbCA9IHN1bSgKICAgICAgICAgICAgICAgIGludChiZW5lZml0LmdldCgidG90YWwiLCAwKSkKICAgICAgICAgICAgICAgIGZvciBiZW5lZml0IGluIHBrZy5nZXQoImJlbmVmaXRzIiwgW10pCiAgICAgICAgICAgICAgICBpZiBiZW5lZml0LmdldCgiZGF0YV90eXBlIikgPT0gIkRBVEEiCiAgICAgICAgICAgICkKICAgICAgICAgICAga3VvdGFfZ2IgPSBrdW90YV90b3RhbCAvICgxMDI0ICoqIDMpCgogICAgICAgICAgICBvcmlnaW5hbF9wcmljZSA9IGludChwa2cuZ2V0KCJvcmlnaW5hbF9wcmljZSIsIDApKQogICAgICAgICAgICBkaXNjb3VudGVkX3ByaWNlID0gaW50KHBrZy5nZXQoImRpc2NvdW50ZWRfcHJpY2UiLCBvcmlnaW5hbF9wcmljZSkpCiAgICAgICAgICAgIGRpc2tvbl9wZXJjZW50ID0gaW50KHJvdW5kKChvcmlnaW5hbF9wcmljZSAtIGRpc2NvdW50ZWRfcHJpY2UpIC8gb3JpZ2luYWxfcHJpY2UgKiAxMDApKSBpZiBvcmlnaW5hbF9wcmljZSBlbHNlIDAKCiAgICAgICAgICAgIGZvcm1hdHRlZF9wa2cgPSB7CiAgICAgICAgICAgICAgICAibmFtZSI6IGYie3BrZy5nZXQoJ2ZhbWlseV9uYW1lJywgJycpfSAoe3BrZy5nZXQoJ3RpdGxlJywgJycpfSkge3BrZy5nZXQoJ3ZhbGlkaXR5JywgJycpfSIsCiAgICAgICAgICAgICAgICAia29kZV9wYWtldCI6IHBrZy5nZXQoImFjdGlvbl9wYXJhbSIsICIiKSwKICAgICAgICAgICAgICAgICJvcmlnaW5hbF9wcmljZSI6IG9yaWdpbmFsX3ByaWNlLAogICAgICAgICAgICAgICAgImRpc2tvbl9wcmljZSI6IGRpc2NvdW50ZWRfcHJpY2UsCiAgICAgICAgICAgICAgICAiZGlza29uX3BlcmNlbnQiOiBkaXNrb25fcGVyY2VudCwKICAgICAgICAgICAgICAgICJrdW90YV9nYiI6IGt1b3RhX2diCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3BlY2lhbF9wYWNrYWdlcy5hcHBlbmQoZm9ybWF0dGVkX3BrZykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi4pqg77iPIEdhZ2FsIHBhcnNlIHBha2V0IFNGWToge2V9IikKICAgICAgICAgICAgY29udGludWUKCiAgICByZXR1cm4gewogICAgICAgICJsb3lhbHR5IjogbG95YWx0eV9pbmZvLAogICAgICAgICJub3RpZmljYXRpb24iOiBub3RpZmljYXRpb25zLAogICAgICAgICJzcGVjaWFsX3BhY2thZ2VzIjogc3BlY2lhbF9wYWNrYWdlcwogICAgfQoKCmRlZiBnZXRfZmFtaWx5X2RhdGEoCiAgICBhcGlfa2V5OiBzdHIsCiAgICB0b2tlbnM6IGRpY3QsCikgLT4gZGljdDoKICAgIHBhdGggPSAic2hhcmluZ3MvYXBpL3Y4L2ZhbWlseS1wbGFuL21lbWJlci1pbmZvIgoKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJncm91cF9pZCI6IDAsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIKICAgIH0KCiAgICBwcmludCgiRmV0Y2hpbmcgZmFtaWx5IGRhdGEuLi4iKQogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgcmV0dXJuIHJlcwoKZGVmIHZhbGlkYXRlX21zaXNkbigKICAgIGFwaV9rZXk6IHN0ciwKICAgIHRva2VuczogZGljdCwKICAgIG1zaXNkbjogc3RyLAopIC0+IGRpY3Q6CiAgICBwYXRoID0gImFwaS92OC9hdXRoL3ZhbGlkYXRlLW1zaXNkbiIKCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAid2l0aF9iaXpvbiI6IEZhbHNlLAogICAgICAgICJ3aXRoX2ZhbWlseV9wbGFuIjogVHJ1ZSwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJ3aXRoX29wdGltdXMiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgIm1zaXNkbiI6IG1zaXNkbiwKICAgICAgICAid2l0aF9yZWdpc3Rfc3RhdHVzIjogRmFsc2UsCiAgICAgICAgIndpdGhfZW50ZXJwcmlzZSI6IEZhbHNlCiAgICB9CgogICAgcHJpbnQoZiJWYWxpZGF0aW5nIG1zaXNkbiB7bXNpc2RufS4uLiIpCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICByZXR1cm4gcmVzCgpkZWYgY2hhbmdlX21lbWJlcigKICAgIGFwaV9rZXk6IHN0ciwKICAgIHRva2VuczogZGljdCwKICAgIHBhcmVudF9hbGlhczogc3RyLAogICAgYWxpYXM6IHN0ciwKICAgIHNsb3RfaWQ6IGludCwKICAgIGZhbWlseV9tZW1iZXJfaWQ6IHN0ciwKICAgIG5ld19tc2lzZG46IHN0ciwKKSAtPiBkaWN0OgogICAgcGF0aCA9ICJzaGFyaW5ncy9hcGkvdjgvZmFtaWx5LXBsYW4vY2hhbmdlLW1lbWJlciIKCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAicGFyZW50X2FsaWFzIjogcGFyZW50X2FsaWFzLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgInNsb3RfaWQiOiBzbG90X2lkLAogICAgICAgICJhbGlhcyI6IGFsaWFzLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAibXNpc2RuIjogbmV3X21zaXNkbiwKICAgICAgICAiZmFtaWx5X21lbWJlcl9pZCI6IGZhbWlseV9tZW1iZXJfaWQKICAgIH0KICAgIAogICAgcHJpbnQoZiJBc3NpZ25pbmcgc2xvdCB7c2xvdF9pZH0gdG8ge25ld19tc2lzZG59Li4uIikKICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQoKICAgIHJldHVybiByZXMKCmRlZiByZW1vdmVfbWVtYmVyKAogICAgYXBpX2tleTogc3RyLAogICAgdG9rZW5zOiBkaWN0LAogICAgZmFtaWx5X21lbWJlcl9pZDogc3RyLAopIC0+IGRpY3Q6CiAgICBwYXRoID0gInNoYXJpbmdzL2FwaS92OC9mYW1pbHktcGxhbi9yZW1vdmUtbWVtYmVyIgoKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgImZhbWlseV9tZW1iZXJfaWQiOiBmYW1pbHlfbWVtYmVyX2lkLAogICAgICAgICJsYW5nIjogImVuIgogICAgfQoKICAgIHByaW50KGYiUmVtb3ZpbmcgZmFtaWx5IG1lbWJlciB7ZmFtaWx5X21lbWJlcl9pZH0uLi4iKQogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgcmV0dXJuIHJlcwoKZGVmIHNldF9xdW90YV9saW1pdCgKICAgIGFwaV9rZXk6IHN0ciwKICAgIHRva2VuczogZGljdCwKICAgIG9yaWdpbmFsX2FsbG9jYXRpb246IGludCwKICAgIG5ld19hbGxvY2F0aW9uOiBpbnQsCiAgICBmYW1pbHlfbWVtYmVyX2lkOiBzdHIsCikgLT4gZGljdDoKICAgIHBhdGggPSAic2hhcmluZ3MvYXBpL3Y4L2ZhbWlseS1wbGFuL2FsbG9jYXRlLXF1b3RhIgoKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgIm1lbWJlcl9hbGxvY2F0aW9ucyI6IFt7CiAgICAgICAgICAgICJuZXdfdGV4dF9hbGxvY2F0aW9uIjogMCwKICAgICAgICAgICAgIm9yaWdpbmFsX3RleHRfYWxsb2NhdGlvbiI6IDAsCiAgICAgICAgICAgICJvcmlnaW5hbF92b2ljZV9hbGxvY2F0aW9uIjogMCwKICAgICAgICAgICAgIm9yaWdpbmFsX2FsbG9jYXRpb24iOiBvcmlnaW5hbF9hbGxvY2F0aW9uLAogICAgICAgICAgICAibmV3X3ZvaWNlX2FsbG9jYXRpb24iOiAwLAogICAgICAgICAgICAibWVzc2FnZSI6ICIiLAogICAgICAgICAgICAibmV3X2FsbG9jYXRpb24iOiBuZXdfYWxsb2NhdGlvbiwKICAgICAgICAgICAgImZhbWlseV9tZW1iZXJfaWQiOiBmYW1pbHlfbWVtYmVyX2lkLAogICAgICAgICAgICAic3RhdHVzIjogIiIKICAgICAgICB9XSwKICAgICAgICAibGFuZyI6ICJlbiIKICAgIH0KICAgIAogICAgZm9ybWF0dGVkX25ld19hbGxvY2F0aW9uID0gZm9ybWF0X3F1b3RhX2J5dGUobmV3X2FsbG9jYXRpb24pCgogICAgcHJpbnQoZiJTZXR0aW5nIHF1b3RhIGxpbWl0IGZvciBmYW1pbHkgbWVtYmVyIHtmYW1pbHlfbWVtYmVyX2lkfSB0byB7Zm9ybWF0dGVkX25ld19hbGxvY2F0aW9ufSBNQi4uLiIpCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICByZXR1cm4gcmVzCg==').decode())
