#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGJhc2U2NAppbXBvcnQgdGltZQoKaW1wb3J0IHFyY29kZQoKZnJvbSBhcHAuY2xpZW50LmVuY3J5cHQgaW1wb3J0IEFQSV9LRVksIGRlY3J5cHRfeGRhdGEsIGVuY3J5cHRzaWduX3hkYXRhLCBqYXZhX2xpa2VfdGltZXN0YW1wLCBnZXRfeF9zaWduYXR1cmVfcGF5bWVudApmcm9tIGFwcC5jbGllbnQuZW5nc2VsIGltcG9ydCAqCmZyb20gYXBwLnR5cGVfZGljdCBpbXBvcnQgUGF5bWVudEl0ZW0KCgpkZWYgc2V0dGxlbWVudF9xcmlzKAogICAgICAgIGFwaV9rZXk6IHN0ciwKICAgICAgICB0b2tlbnM6IGRpY3QsCiAgICAgICAgaXRlbXM6IGxpc3RbUGF5bWVudEl0ZW1dLAogICAgICAgIHBheW1lbnRfZm9yOiBzdHIsCiAgICAgICAgYXNrX292ZXJ3cml0ZTogYm9vbCwKICAgICAgICBvdmVyd3JpdGVfYW1vdW50OiBpbnQgPSAtMSwKICAgICAgICB0b2tlbl9jb25maXJtYXRpb25faWR4OiBpbnQgPSAwLAogICAgICAgIGFtb3VudF9pZHg6IGludCA9IC0xLAopOgogICAgIyBTYW5pdHkgY2hlY2sKICAgIGlmIG92ZXJ3cml0ZV9hbW91bnQgPT0gLTEgYW5kIG5vdCBhc2tfb3ZlcndyaXRlOgogICAgICAgIHByaW50KCJFaXRoZXIgYXNrX292ZXJ3cml0ZSBtdXN0IGJlIFRydWUgb3Igb3ZlcndyaXRlX2Ftb3VudCBtdXN0IGJlIHNldC4iKQogICAgICAgIHJldHVybiBOb25lCgogICAgdG9rZW5fY29uZmlybWF0aW9uID0gaXRlbXNbdG9rZW5fY29uZmlybWF0aW9uX2lkeF1bInRva2VuX2NvbmZpcm1hdGlvbiJdCiAgICBwYXltZW50X3RhcmdldHMgPSAiIgogICAgZm9yIGl0ZW0gaW4gaXRlbXM6CiAgICAgICAgaWYgcGF5bWVudF90YXJnZXRzICE9ICIiOgogICAgICAgICAgICBwYXltZW50X3RhcmdldHMgKz0gIjsiCiAgICAgICAgcGF5bWVudF90YXJnZXRzICs9IGl0ZW1bIml0ZW1fY29kZSJdCgogICAgYW1vdW50X2ludCA9IDAKCiAgICAjIERldGVybWluZSBhbW91bnQgdG8gdXNlCiAgICBpZiBvdmVyd3JpdGVfYW1vdW50ICE9IC0xOgogICAgICAgIGFtb3VudF9pbnQgPSBvdmVyd3JpdGVfYW1vdW50CiAgICBlbGlmIGFtb3VudF9pZHggPT0gLTE6CiAgICAgICAgYW1vdW50X2ludCA9IGl0ZW1zW2Ftb3VudF9pZHhdWyJpdGVtX3ByaWNlIl0KCiAgICAjIElmIE92ZXJ3cml0ZQogICAgaWYgYXNrX292ZXJ3cml0ZToKICAgICAgICBwcmludChmIlRvdGFsIGFtb3VudCBpcyB7YW1vdW50X2ludH0uXG5FbnRlciBuZXcgYW1vdW50IGlmIHlvdSBuZWVkIHRvIG92ZXJ3cml0ZS4iKQogICAgICAgIGFtb3VudF9zdHIgPSBpbnB1dCgiUHJlc3MgZW50ZXIgdG8gaWdub3JlICYgdXNlIGRlZmF1bHQgYW1vdW50OiAiKQogICAgICAgIGlmIGFtb3VudF9zdHIgIT0gIiI6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFtb3VudF9pbnQgPSBpbnQoYW1vdW50X3N0cikKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludCgiSW52YWxpZCBvdmVyd3JpdGUgaW5wdXQsIHVzaW5nIG9yaWdpbmFsIHByaWNlLiIpCiAgICAgICAgICAgICAgICAjIHJldHVybiBOb25lCgogICAgaW50ZXJjZXB0X3BhZ2UoYXBpX2tleSwgdG9rZW5zLCBpdGVtc1swXVsiaXRlbV9jb2RlIl0sIEZhbHNlKQoKICAgICMgR2V0IHBheW1lbnQgbWV0aG9kcwogICAgcGF5bWVudF9wYXRoID0gInBheW1lbnRzL2FwaS92OC9wYXltZW50LW1ldGhvZHMtb3B0aW9uIgogICAgcGF5bWVudF9wYXlsb2FkID0gewogICAgICAgICJwYXltZW50X3R5cGUiOiAiUFVSQ0hBU0UiLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgInBheW1lbnRfdGFyZ2V0IjogaXRlbXNbdG9rZW5fY29uZmlybWF0aW9uX2lkeF1bIml0ZW1fY29kZSJdLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAiaXNfcmVmZXJyYWwiOiBGYWxzZSwKICAgICAgICAidG9rZW5fY29uZmlybWF0aW9uIjogdG9rZW5fY29uZmlybWF0aW9uCiAgICB9CgogICAgcHJpbnQoIkdldHRpbmcgcGF5bWVudCBtZXRob2RzLi4uIikKICAgIHBheW1lbnRfcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXltZW50X3BhdGgsIHBheW1lbnRfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICBpZiBwYXltZW50X3Jlc1sic3RhdHVzIl0gIT0gIlNVQ0NFU1MiOgogICAgICAgIHByaW50KCJGYWlsZWQgdG8gZmV0Y2ggcGF5bWVudCBtZXRob2RzLiIpCiAgICAgICAgcHJpbnQoZiJFcnJvcjoge3BheW1lbnRfcmVzfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICB0b2tlbl9wYXltZW50ID0gcGF5bWVudF9yZXNbImRhdGEiXVsidG9rZW5fcGF5bWVudCJdCiAgICB0c190b19zaWduID0gcGF5bWVudF9yZXNbImRhdGEiXVsidGltZXN0YW1wIl0KCiAgICAjIFNldHRsZW1lbnQgcmVxdWVzdAogICAgcGF0aCA9ICJwYXltZW50cy9hcGkvdjgvc2V0dGxlbWVudC1tdWx0aXBheW1lbnQvcXJpcyIKICAgIHNldHRsZW1lbnRfcGF5bG9hZCA9IHsKICAgICAgICAiYWtyYWIiOiB7CiAgICAgICAgICAgICJha3JhYl9tZW1iZXJzIjogW10sCiAgICAgICAgICAgICJha3JhYl9wYXJlbnRfYWxpYXMiOiAiIiwKICAgICAgICAgICAgIm1lbWJlcnMiOiBbXQogICAgICAgIH0sCiAgICAgICAgImNhbl90cmlnZ2VyX3JhdGluZyI6IEZhbHNlLAogICAgICAgICJ0b3RhbF9kaXNjb3VudCI6IDAsCiAgICAgICAgImNvdXBvbiI6ICIiLAogICAgICAgICJwYXltZW50X2ZvciI6IHBheW1lbnRfZm9yLAogICAgICAgICJ0b3B1cF9udW1iZXIiOiAiIiwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJhdXRvYnV5IjogewogICAgICAgICAgICAiaXNfdXNpbmdfYXV0b2J1eSI6IEZhbHNlLAogICAgICAgICAgICAiYWN0aXZhdGVkX2F1dG9idXlfY29kZSI6ICIiLAogICAgICAgICAgICAiYXV0b2J1eV90aHJlc2hvbGRfc2V0dGluZyI6IHsKICAgICAgICAgICAgICAgICJsYWJlbCI6ICIiLAogICAgICAgICAgICAgICAgInR5cGUiOiAiIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IDAKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgImFjY2Vzc190b2tlbiI6IHRva2Vuc1siYWNjZXNzX3Rva2VuIl0sCiAgICAgICAgImlzX215eGxfd2FsbGV0IjogRmFsc2UsCiAgICAgICAgImFkZGl0aW9uYWxfZGF0YSI6IHsKICAgICAgICAgICAgIm9yaWdpbmFsX3ByaWNlIjogaXRlbXNbMF1bIml0ZW1fcHJpY2UiXSwKICAgICAgICAgICAgImlzX3NwZW5kX2xpbWl0X3RlbXBvcmFyeSI6IEZhbHNlLAogICAgICAgICAgICAibWlncmF0aW9uX3R5cGUiOiAiIiwKICAgICAgICAgICAgInNwZW5kX2xpbWl0X2Ftb3VudCI6IDAsCiAgICAgICAgICAgICJpc19zcGVuZF9saW1pdCI6IEZhbHNlLAogICAgICAgICAgICAidGF4IjogMCwKICAgICAgICAgICAgImJlbmVmaXRfdHlwZSI6ICIiLAogICAgICAgICAgICAicXVvdGFfYm9udXMiOiAwLAogICAgICAgICAgICAiY2FzaHRhZyI6ICIiLAogICAgICAgICAgICAiaXNfZmFtaWx5X3BsYW4iOiBGYWxzZSwKICAgICAgICAgICAgImNvbWJvX2RldGFpbHMiOiBbXSwKICAgICAgICAgICAgImlzX3N3aXRjaF9wbGFuIjogRmFsc2UsCiAgICAgICAgICAgICJkaXNjb3VudF9yZWN1cnJpbmciOiAwLAogICAgICAgICAgICAiaGFzX2JvbnVzIjogRmFsc2UsCiAgICAgICAgICAgICJkaXNjb3VudF9wcm9tbyI6IDAKICAgICAgICB9LAogICAgICAgICJ0b3RhbF9hbW91bnQiOiBhbW91bnRfaW50LAogICAgICAgICJ0b3RhbF9mZWUiOiAwLAogICAgICAgICJpc191c2VfcG9pbnQiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgIml0ZW1zIjogaXRlbXMsCiAgICAgICAgInZlcmlmaWNhdGlvbl90b2tlbiI6IHRva2VuX3BheW1lbnQsCiAgICAgICAgInBheW1lbnRfbWV0aG9kIjogIlFSSVMiLAogICAgICAgICJ0aW1lc3RhbXAiOiBpbnQodGltZS50aW1lKCkpLAogICAgfQoKICAgIGVuY3J5cHRlZF9wYXlsb2FkID0gZW5jcnlwdHNpZ25feGRhdGEoCiAgICAgICAgYXBpX2tleT1hcGlfa2V5LAogICAgICAgIG1ldGhvZD0iUE9TVCIsCiAgICAgICAgcGF0aD1wYXRoLAogICAgICAgIGlkX3Rva2VuPXRva2Vuc1siaWRfdG9rZW4iXSwKICAgICAgICBwYXlsb2FkPXNldHRsZW1lbnRfcGF5bG9hZAogICAgKQoKICAgIHh0aW1lID0gaW50KGVuY3J5cHRlZF9wYXlsb2FkWyJlbmNyeXB0ZWRfYm9keSJdWyJ4dGltZSJdKQogICAgc2lnX3RpbWVfc2VjID0gKHh0aW1lIC8vIDEwMDApCiAgICB4X3JlcXVlc3RlZF9hdCA9IGRhdGV0aW1lLmZyb210aW1lc3RhbXAoc2lnX3RpbWVfc2VjLCB0ej10aW1lem9uZS51dGMpLmFzdGltZXpvbmUoKQogICAgc2V0dGxlbWVudF9wYXlsb2FkWyJ0aW1lc3RhbXAiXSA9IHRzX3RvX3NpZ24KCiAgICBib2R5ID0gZW5jcnlwdGVkX3BheWxvYWRbImVuY3J5cHRlZF9ib2R5Il0KICAgIHhfc2lnID0gZ2V0X3hfc2lnbmF0dXJlX3BheW1lbnQoCiAgICAgICAgYXBpX2tleSwKICAgICAgICB0b2tlbnNbImFjY2Vzc190b2tlbiJdLAogICAgICAgIHRzX3RvX3NpZ24sCiAgICAgICAgcGF5bWVudF90YXJnZXRzLAogICAgICAgIHRva2VuX3BheW1lbnQsCiAgICAgICAgIlFSSVMiLAogICAgICAgIHBheW1lbnRfZm9yLAogICAgICAgIHBhdGgKICAgICkKCiAgICBoZWFkZXJzID0gewogICAgICAgICJob3N0IjogQkFTRV9BUElfVVJMLnJlcGxhY2UoImh0dHBzOi8vIiwgIiIpLAogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIsCiAgICAgICAgInVzZXItYWdlbnQiOiBVQSwKICAgICAgICAieC1hcGkta2V5IjogQVBJX0tFWSwKICAgICAgICAiYXV0aG9yaXphdGlvbiI6IGYiQmVhcmVyIHt0b2tlbnNbJ2lkX3Rva2VuJ119IiwKICAgICAgICAieC1odiI6ICJ2MyIsCiAgICAgICAgIngtc2lnbmF0dXJlLXRpbWUiOiBzdHIoc2lnX3RpbWVfc2VjKSwKICAgICAgICAieC1zaWduYXR1cmUiOiB4X3NpZywKICAgICAgICAieC1yZXF1ZXN0LWlkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgIngtcmVxdWVzdC1hdCI6IGphdmFfbGlrZV90aW1lc3RhbXAoeF9yZXF1ZXN0ZWRfYXQpLAogICAgICAgICJ4LXZlcnNpb24tYXBwIjogIjguOC4wIiwKICAgIH0KCiAgICB1cmwgPSBmIntCQVNFX0FQSV9VUkx9L3twYXRofSIKICAgIHByaW50KCJTZW5kaW5nIHNldHRsZW1lbnQgcmVxdWVzdC4uLiIpCiAgICByZXNwID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKGJvZHkpLCB0aW1lb3V0PTMwKQoKICAgIHRyeToKICAgICAgICBkZWNyeXB0ZWRfYm9keSA9IGRlY3J5cHRfeGRhdGEoYXBpX2tleSwganNvbi5sb2FkcyhyZXNwLnRleHQpKQogICAgICAgIGlmIGRlY3J5cHRlZF9ib2R5WyJzdGF0dXMiXSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIHByaW50KCJGYWlsZWQgdG8gaW5pdGlhdGUgc2V0dGxlbWVudC4iKQogICAgICAgICAgICBwcmludChmIkVycm9yOiB7ZGVjcnlwdGVkX2JvZHl9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgdHJhbnNhY3Rpb25faWQgPSBkZWNyeXB0ZWRfYm9keVsiZGF0YSJdWyJ0cmFuc2FjdGlvbl9jb2RlIl0KCiAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uX2lkCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoIltkZWNyeXB0IGVycl0iLCBlKQogICAgICAgIHJldHVybiByZXNwLnRleHQKCgpkZWYgZ2V0X3FyaXNfY29kZSgKICAgICAgICBhcGlfa2V5OiBzdHIsCiAgICAgICAgdG9rZW5zOiBkaWN0LAogICAgICAgIHRyYW5zYWN0aW9uX2lkOiBzdHIKKToKICAgIHBhdGggPSAicGF5bWVudHMvYXBpL3Y4L3BlbmRpbmctZGV0YWlsIgogICAgcGF5bG9hZCA9IHsKICAgICAgICAidHJhbnNhY3Rpb25faWQiOiB0cmFuc2FjdGlvbl9pZCwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAic3RhdHVzIjogIiIKICAgIH0KCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgaWYgcmVzWyJzdGF0dXMiXSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgcHJpbnQoIkZhaWxlZCB0byBmZXRjaCBRUklTIGNvZGUuIikKICAgICAgICBwcmludChmIkVycm9yOiB7cmVzfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICByZXR1cm4gcmVzWyJkYXRhIl1bInFyX2NvZGUiXQoKCmRlZiBzaG93X3FyaXNfcGF5bWVudCgKICAgICAgICBhcGlfa2V5OiBzdHIsCiAgICAgICAgdG9rZW5zOiBkaWN0LAogICAgICAgIGl0ZW1zOiBsaXN0W1BheW1lbnRJdGVtXSwKICAgICAgICBwYXltZW50X2Zvcjogc3RyLAogICAgICAgIGFza19vdmVyd3JpdGU6IGJvb2wsCiAgICAgICAgb3ZlcndyaXRlX2Ftb3VudDogaW50ID0gLTEsCiAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uX2lkeDogaW50ID0gMCwKICAgICAgICBhbW91bnRfaWR4OiBpbnQgPSAtMSwKKToKICAgIHRyYW5zYWN0aW9uX2lkID0gc2V0dGxlbWVudF9xcmlzKAogICAgICAgIGFwaV9rZXksCiAgICAgICAgdG9rZW5zLAogICAgICAgIGl0ZW1zLAogICAgICAgIHBheW1lbnRfZm9yLAogICAgICAgIGFza19vdmVyd3JpdGUsCiAgICAgICAgb3ZlcndyaXRlX2Ftb3VudCwKICAgICAgICB0b2tlbl9jb25maXJtYXRpb25faWR4LAogICAgICAgIGFtb3VudF9pZHgKICAgICkKCiAgICBpZiBub3QgdHJhbnNhY3Rpb25faWQ6CiAgICAgICAgcHJpbnQoIkZhaWxlZCB0byBjcmVhdGUgUVJJUyB0cmFuc2FjdGlvbi4iKQogICAgICAgIHJldHVybgoKICAgIHByaW50KCJGZXRjaGluZyBRUklTIGNvZGUuLi4iKQogICAgcXJpc19jb2RlID0gZ2V0X3FyaXNfY29kZShhcGlfa2V5LCB0b2tlbnMsIHRyYW5zYWN0aW9uX2lkKQogICAgaWYgbm90IHFyaXNfY29kZToKICAgICAgICBwcmludCgiRmFpbGVkIHRvIGdldCBRUklTIGNvZGUuIikKICAgICAgICByZXR1cm4KICAgIHByaW50KGYiUVJJUyBkYXRhOlxue3FyaXNfY29kZX0iKQoKICAgIHFyID0gcXJjb2RlLlFSQ29kZSgKICAgICAgICB2ZXJzaW9uPTEsCiAgICAgICAgZXJyb3JfY29ycmVjdGlvbj1xcmNvZGUuY29uc3RhbnRzLkVSUk9SX0NPUlJFQ1RfTCwKICAgICAgICBib3hfc2l6ZT0xLAogICAgICAgIGJvcmRlcj0xLAogICAgKQogICAgcXIuYWRkX2RhdGEocXJpc19jb2RlKQogICAgcXIubWFrZShmaXQ9VHJ1ZSkKICAgIHFyLnByaW50X2FzY2lpKGludmVydD1UcnVlKQoKICAgIHFyaXNfYjY0ID0gYmFzZTY0LnVybHNhZmVfYjY0ZW5jb2RlKHFyaXNfY29kZS5lbmNvZGUoKSkuZGVjb2RlKCkKICAgIHFyaXNfdXJsID0gZiJodHRwczovL2tpLWFyLWtvZC5uZXRsaWZ5LmFwcC8/ZGF0YT17cXJpc19iNjR9IgoKICAgIHByaW50KGYiQXRhdSBidWthIGxpbmsgYmVyaWt1dCB1bnR1ayBtZWxpaGF0IFFSSVM6XG57cXJpc191cmx9IikKCiAgICByZXR1cm4K').decode())
