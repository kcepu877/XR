#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KZnJvbSBhcHAuY2xpZW50LmVuZ3NlbCBpbXBvcnQgc2VuZF9hcGlfcmVxdWVzdApmcm9tIGFwcC5tZW51cy51dGlsIGltcG9ydCBmb3JtYXRfcXVvdGFfYnl0ZQoKZGVmIGdldF9mYW1pbHlfZGF0YSgKICAgIGFwaV9rZXk6IHN0ciwKICAgIHRva2VuczogZGljdCwKKSAtPiBkaWN0OgogICAgcGF0aCA9ICJzaGFyaW5ncy9hcGkvdjgvZmFtaWx5LXBsYW4vbWVtYmVyLWluZm8iCgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgImdyb3VwX2lkIjogMCwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIgogICAgfQoKICAgIHByaW50KCJGZXRjaGluZyBmYW1pbHkgZGF0YS4uLiIpCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICByZXR1cm4gcmVzCgpkZWYgdmFsaWRhdGVfbXNpc2RuKAogICAgYXBpX2tleTogc3RyLAogICAgdG9rZW5zOiBkaWN0LAogICAgbXNpc2RuOiBzdHIsCikgLT4gZGljdDoKICAgICMgcGF0aCA9ICJhcGkvdjgvYXV0aC92YWxpZGF0ZS1tc2lzZG4iCiAgICBwYXRoID0gImFwaS92OC9hdXRoL2NoZWNrLWR1a2NhcGlsIgoKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJ3aXRoX2Jpem9uIjogVHJ1ZSwKICAgICAgICAid2l0aF9mYW1pbHlfcGxhbiI6IFRydWUsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAid2l0aF9vcHRpbXVzIjogVHJ1ZSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgIm1zaXNkbiI6IG1zaXNkbiwKICAgICAgICAid2l0aF9yZWdpc3Rfc3RhdHVzIjogVHJ1ZSwKICAgICAgICAid2l0aF9lbnRlcnByaXNlIjogVHJ1ZQogICAgfQoKICAgIHByaW50KGYiVmFsaWRhdGluZyBtc2lzZG4ge21zaXNkbn0uLi4iKQogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgcmV0dXJuIHJlcwoKZGVmIGNoYW5nZV9tZW1iZXIoCiAgICBhcGlfa2V5OiBzdHIsCiAgICB0b2tlbnM6IGRpY3QsCiAgICBwYXJlbnRfYWxpYXM6IHN0ciwKICAgIGFsaWFzOiBzdHIsCiAgICBzbG90X2lkOiBpbnQsCiAgICBmYW1pbHlfbWVtYmVyX2lkOiBzdHIsCiAgICBuZXdfbXNpc2RuOiBzdHIsCikgLT4gZGljdDoKICAgIHBhdGggPSAic2hhcmluZ3MvYXBpL3Y4L2ZhbWlseS1wbGFuL2NoYW5nZS1tZW1iZXIiCgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgInBhcmVudF9hbGlhcyI6IHBhcmVudF9hbGlhcywKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJzbG90X2lkIjogc2xvdF9pZCwKICAgICAgICAiYWxpYXMiOiBhbGlhcywKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgIm1zaXNkbiI6IG5ld19tc2lzZG4sCiAgICAgICAgImZhbWlseV9tZW1iZXJfaWQiOiBmYW1pbHlfbWVtYmVyX2lkCiAgICB9CiAgICAKICAgIHByaW50KGYiQXNzaWduaW5nIHNsb3Qge3Nsb3RfaWR9IHRvIHtuZXdfbXNpc2RufS4uLiIpCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICByZXR1cm4gcmVzCgpkZWYgcmVtb3ZlX21lbWJlcigKICAgIGFwaV9rZXk6IHN0ciwKICAgIHRva2VuczogZGljdCwKICAgIGZhbWlseV9tZW1iZXJfaWQ6IHN0ciwKKSAtPiBkaWN0OgogICAgcGF0aCA9ICJzaGFyaW5ncy9hcGkvdjgvZmFtaWx5LXBsYW4vcmVtb3ZlLW1lbWJlciIKCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJmYW1pbHlfbWVtYmVyX2lkIjogZmFtaWx5X21lbWJlcl9pZCwKICAgICAgICAibGFuZyI6ICJlbiIKICAgIH0KCiAgICBwcmludChmIlJlbW92aW5nIGZhbWlseSBtZW1iZXIge2ZhbWlseV9tZW1iZXJfaWR9Li4uIikKICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQoKICAgIHJldHVybiByZXMKCmRlZiBzZXRfcXVvdGFfbGltaXQoCiAgICBhcGlfa2V5OiBzdHIsCiAgICB0b2tlbnM6IGRpY3QsCiAgICBvcmlnaW5hbF9hbGxvY2F0aW9uOiBpbnQsCiAgICBuZXdfYWxsb2NhdGlvbjogaW50LAogICAgZmFtaWx5X21lbWJlcl9pZDogc3RyLAopIC0+IGRpY3Q6CiAgICBwYXRoID0gInNoYXJpbmdzL2FwaS92OC9mYW1pbHktcGxhbi9hbGxvY2F0ZS1xdW90YSIKCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJtZW1iZXJfYWxsb2NhdGlvbnMiOiBbewogICAgICAgICAgICAibmV3X3RleHRfYWxsb2NhdGlvbiI6IDAsCiAgICAgICAgICAgICJvcmlnaW5hbF90ZXh0X2FsbG9jYXRpb24iOiAwLAogICAgICAgICAgICAib3JpZ2luYWxfdm9pY2VfYWxsb2NhdGlvbiI6IDAsCiAgICAgICAgICAgICJvcmlnaW5hbF9hbGxvY2F0aW9uIjogb3JpZ2luYWxfYWxsb2NhdGlvbiwKICAgICAgICAgICAgIm5ld192b2ljZV9hbGxvY2F0aW9uIjogMCwKICAgICAgICAgICAgIm1lc3NhZ2UiOiAiIiwKICAgICAgICAgICAgIm5ld19hbGxvY2F0aW9uIjogbmV3X2FsbG9jYXRpb24sCiAgICAgICAgICAgICJmYW1pbHlfbWVtYmVyX2lkIjogZmFtaWx5X21lbWJlcl9pZCwKICAgICAgICAgICAgInN0YXR1cyI6ICIiCiAgICAgICAgfV0sCiAgICAgICAgImxhbmciOiAiZW4iCiAgICB9CiAgICAKICAgIGZvcm1hdHRlZF9uZXdfYWxsb2NhdGlvbiA9IGZvcm1hdF9xdW90YV9ieXRlKG5ld19hbGxvY2F0aW9uKQoKICAgIHByaW50KGYiU2V0dGluZyBxdW90YSBsaW1pdCBmb3IgZmFtaWx5IG1lbWJlciB7ZmFtaWx5X21lbWJlcl9pZH0gdG8ge2Zvcm1hdHRlZF9uZXdfYWxsb2NhdGlvbn0gTUIuLi4iKQogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgcmV0dXJuIHJlcwo=').decode())
