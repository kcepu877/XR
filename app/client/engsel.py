#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCB1dWlkCmltcG9ydCByZXF1ZXN0cwoKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCgpmcm9tIGFwcC5jbGllbnQuZW5jcnlwdCBpbXBvcnQgKAogICAgZW5jcnlwdHNpZ25feGRhdGEsCiAgICBqYXZhX2xpa2VfdGltZXN0YW1wLAogICAgZGVjcnlwdF94ZGF0YSwKICAgIEFQSV9LRVksCikKCkJBU0VfQVBJX1VSTCA9IG9zLmdldGVudigiQkFTRV9BUElfVVJMIikKaWYgbm90IEJBU0VfQVBJX1VSTDoKICAgIHJhaXNlIFZhbHVlRXJyb3IoIkJBU0VfQVBJX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZSBub3Qgc2V0IikKVUEgPSBvcy5nZXRlbnYoIlVBIikKCmRlZiBzZW5kX2FwaV9yZXF1ZXN0KAogICAgYXBpX2tleTogc3RyLAogICAgcGF0aDogc3RyLAogICAgcGF5bG9hZF9kaWN0OiBkaWN0LAogICAgaWRfdG9rZW46IHN0ciwKICAgIG1ldGhvZDogc3RyID0gIlBPU1QiLAopOgogICAgZW5jcnlwdGVkX3BheWxvYWQgPSBlbmNyeXB0c2lnbl94ZGF0YSgKICAgICAgICBhcGlfa2V5PWFwaV9rZXksCiAgICAgICAgbWV0aG9kPW1ldGhvZCwKICAgICAgICBwYXRoPXBhdGgsCiAgICAgICAgaWRfdG9rZW49aWRfdG9rZW4sCiAgICAgICAgcGF5bG9hZD1wYXlsb2FkX2RpY3QKICAgICkKICAgIAogICAgeHRpbWUgPSBpbnQoZW5jcnlwdGVkX3BheWxvYWRbImVuY3J5cHRlZF9ib2R5Il1bInh0aW1lIl0pCiAgICAKICAgIG5vdyA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZS51dGMpLmFzdGltZXpvbmUoKQogICAgc2lnX3RpbWVfc2VjID0gKHh0aW1lIC8vIDEwMDApCgogICAgYm9keSA9IGVuY3J5cHRlZF9wYXlsb2FkWyJlbmNyeXB0ZWRfYm9keSJdCiAgICB4X3NpZyA9IGVuY3J5cHRlZF9wYXlsb2FkWyJ4X3NpZ25hdHVyZSJdCiAgICAKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgImhvc3QiOiBCQVNFX0FQSV9VUkwucmVwbGFjZSgiaHR0cHM6Ly8iLCAiIiksCiAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04IiwKICAgICAgICAidXNlci1hZ2VudCI6IFVBLAogICAgICAgICJ4LWFwaS1rZXkiOiBBUElfS0VZLAogICAgICAgICJhdXRob3JpemF0aW9uIjogZiJCZWFyZXIge2lkX3Rva2VufSIsCiAgICAgICAgIngtaHYiOiAidjMiLAogICAgICAgICJ4LXNpZ25hdHVyZS10aW1lIjogc3RyKHNpZ190aW1lX3NlYyksCiAgICAgICAgIngtc2lnbmF0dXJlIjogeF9zaWcsCiAgICAgICAgIngtcmVxdWVzdC1pZCI6IHN0cih1dWlkLnV1aWQ0KCkpLAogICAgICAgICJ4LXJlcXVlc3QtYXQiOiBqYXZhX2xpa2VfdGltZXN0YW1wKG5vdyksCiAgICAgICAgIngtdmVyc2lvbi1hcHAiOiAiOC45LjAiLAogICAgfQoKICAgIHVybCA9IGYie0JBU0VfQVBJX1VSTH0ve3BhdGh9IgogICAgcmVzcCA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9anNvbi5kdW1wcyhib2R5KSwgdGltZW91dD0zMCkKICAgIAogICAgIyBwcmludChmIkhlYWRlcnM6IHtqc29uLmR1bXBzKGhlYWRlcnMsIGluZGVudD0yKX0iKQogICAgIyBwcmludChmIlJlc3BvbnNlIGJvZHk6IHtyZXNwLnRleHR9IikKCiAgICB0cnk6CiAgICAgICAgZGVjcnlwdGVkX2JvZHkgPSBkZWNyeXB0X3hkYXRhKGFwaV9rZXksIGpzb24ubG9hZHMocmVzcC50ZXh0KSkKICAgICAgICAjIHByaW50KGYiRGVjcnlwdGVkIGJvZHk6IHtqc29uLmR1bXBzKGRlY3J5cHRlZF9ib2R5LCBpbmRlbnQ9Mil9IikKICAgICAgICByZXR1cm4gZGVjcnlwdGVkX2JvZHkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludCgiW2RlY3J5cHQgZXJyXSIsIGUpCiAgICAgICAgcmV0dXJuIHJlc3AudGV4dAoKZGVmIGdldF9wcm9maWxlKGFwaV9rZXk6IHN0ciwgYWNjZXNzX3Rva2VuOiBzdHIsIGlkX3Rva2VuOiBzdHIpIC0+IGRpY3Q6CiAgICBwYXRoID0gImFwaS92OC9wcm9maWxlIgoKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJhY2Nlc3NfdG9rZW4iOiBhY2Nlc3NfdG9rZW4sCiAgICAgICAgImFwcF92ZXJzaW9uIjogIjguOS4wIiwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIgogICAgfQoKICAgIHByaW50KCJGZXRjaGluZyBwcm9maWxlLi4uIikKICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCgogICAgcmV0dXJuIHJlcy5nZXQoImRhdGEiKQoKZGVmIGdldF9iYWxhbmNlKGFwaV9rZXk6IHN0ciwgaWRfdG9rZW46IHN0cikgLT4gZGljdDoKICAgIHBhdGggPSAiYXBpL3Y4L3BhY2thZ2VzL2JhbGFuY2UtYW5kLWNyZWRpdCIKICAgIAogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIKICAgIH0KICAgIAogICAgcHJpbnQoIkZldGNoaW5nIGJhbGFuY2UuLi4iKQogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgaWRfdG9rZW4sICJQT1NUIikKICAgIAogICAgaWYgImRhdGEiIGluIHJlczoKICAgICAgICBpZiAiYmFsYW5jZSIgaW4gcmVzWyJkYXRhIl06CiAgICAgICAgICAgIHJldHVybiByZXNbImRhdGEiXVsiYmFsYW5jZSJdCiAgICBlbHNlOgogICAgICAgIHByaW50KCJFcnJvciBnZXR0aW5nIGJhbGFuY2U6IiwgcmVzLmdldCgiZXJyb3IiLCAiVW5rbm93biBlcnJvciIpKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZ2V0X2ZhbWlseSgKICAgIGFwaV9rZXk6IHN0ciwKICAgIHRva2VuczogZGljdCwKICAgIGZhbWlseV9jb2RlOiBzdHIsCiAgICBpc19lbnRlcnByaXNlOiBib29sIHwgTm9uZSA9IE5vbmUsCiAgICBtaWdyYXRpb25fdHlwZTogc3RyIHwgTm9uZSA9IE5vbmUKKSAtPiBkaWN0OgogICAgcHJpbnQoIkZldGNoaW5nIHBhY2thZ2UgZmFtaWx5Li4uIikKICAgIAogICAgaXNfZW50ZXJwcmlzZV9saXN0ID0gWwogICAgICAgIEZhbHNlLAogICAgICAgIFRydWUKICAgIF0KCiAgICBtaWdyYXRpb25fdHlwZV9saXN0ID0gWwogICAgICAgICJOT05FIiwKICAgICAgICAiUFJFX1RPX1BSSU9IIiwKICAgICAgICAiUFJJT0hfVE9fUFJJTyIsCiAgICAgICAgIlBSSU9fVE9fUFJJT0giCiAgICBdCgogICAgaWYgaXNfZW50ZXJwcmlzZSBpcyBub3QgTm9uZToKICAgICAgICBpc19lbnRlcnByaXNlX2xpc3QgPSBbaXNfZW50ZXJwcmlzZV0KCiAgICBpZiBtaWdyYXRpb25fdHlwZSBpcyBub3QgTm9uZToKICAgICAgICBtaWdyYXRpb25fdHlwZV9saXN0ID0gW21pZ3JhdGlvbl90eXBlXQoKICAgIHBhdGggPSAiYXBpL3Y4L3hsLXN0b3Jlcy9vcHRpb25zL2xpc3QiCiAgICBpZF90b2tlbiA9IHRva2Vucy5nZXQoImlkX3Rva2VuIikKCiAgICBmYW1pbHlfZGF0YSA9IE5vbmUKCiAgICBmb3IgbXQgaW4gbWlncmF0aW9uX3R5cGVfbGlzdDoKICAgICAgICBpZiBmYW1pbHlfZGF0YSBpcyBub3QgTm9uZToKICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgZm9yIGllIGluIGlzX2VudGVycHJpc2VfbGlzdDoKICAgICAgICAgICAgaWYgZmFtaWx5X2RhdGEgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIAogICAgICAgICAgICBwcmludChmIlRyeWluZyBpc19lbnRlcnByaXNlPXtpZX0sIG1pZ3JhdGlvbl90eXBlPXttdH0uIikKCiAgICAgICAgICAgIHBheWxvYWRfZGljdCA9IHsKICAgICAgICAgICAgICAgICJpc19zaG93X3RhZ2dpbmdfdGFiIjogVHJ1ZSwKICAgICAgICAgICAgICAgICJpc19kZWRpY2F0ZWRfZXZlbnQiOiBUcnVlLAogICAgICAgICAgICAgICAgImlzX3RyYW5zYWN0aW9uX3JvdXRpbmUiOiBGYWxzZSwKICAgICAgICAgICAgICAgICJtaWdyYXRpb25fdHlwZSI6IG10LAogICAgICAgICAgICAgICAgInBhY2thZ2VfZmFtaWx5X2NvZGUiOiBmYW1pbHlfY29kZSwKICAgICAgICAgICAgICAgICJpc19hdXRvYnV5IjogRmFsc2UsCiAgICAgICAgICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IGllLAogICAgICAgICAgICAgICAgImlzX3BkbHAiOiBUcnVlLAogICAgICAgICAgICAgICAgInJlZmVycmFsX2NvZGUiOiAiIiwKICAgICAgICAgICAgICAgICJpc19taWdyYXRpb24iOiBGYWxzZSwKICAgICAgICAgICAgICAgICJsYW5nIjogImVuIgogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcGF5bG9hZF9kaWN0LCBpZF90b2tlbiwgIlBPU1QiKQoKICAgICAgICAgICAgaWYgcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGZhbWlseV9uYW1lID0gcmVzWyJkYXRhIl1bInBhY2thZ2VfZmFtaWx5Il0uZ2V0KCJuYW1lIiwgIiIpCiAgICAgICAgICAgIGlmIGZhbWlseV9uYW1lICE9ICIiOgogICAgICAgICAgICAgICAgZmFtaWx5X2RhdGEgPSByZXNbImRhdGEiXQogICAgICAgICAgICAgICAgcHJpbnQoZiJTdWNjZXNzIHdpdGggaXNfZW50ZXJwcmlzZT17aWV9LCBtaWdyYXRpb25fdHlwZT17bXR9LiBGYW1pbHkgbmFtZToge2ZhbWlseV9uYW1lfSIpCgoKICAgIGlmIGZhbWlseV9kYXRhIGlzIE5vbmU6CiAgICAgICAgcHJpbnQoZiJGYWlsZWQgdG8gZ2V0IHZhbGlkIGZhbWlseSBkYXRhIGZvciB7ZmFtaWx5X2NvZGV9IikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHJldHVybiBmYW1pbHlfZGF0YQoKZGVmIGdldF9mYW1pbGllcyhhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgcGFja2FnZV9jYXRlZ29yeV9jb2RlOiBzdHIpIC0+IGRpY3Q6CiAgICBwcmludCgiRmV0Y2hpbmcgZmFtaWxpZXMuLi4iKQogICAgcGF0aCA9ICJhcGkvdjgveGwtc3RvcmVzL2ZhbWlsaWVzIgogICAgcGF5bG9hZF9kaWN0ID0gewogICAgICAgICJtaWdyYXRpb25fdHlwZSI6ICIiLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgImlzX3NoYXJlYWJsZSI6IEZhbHNlLAogICAgICAgICJwYWNrYWdlX2NhdGVnb3J5X2NvZGUiOiBwYWNrYWdlX2NhdGVnb3J5X2NvZGUsCiAgICAgICAgIndpdGhfaWNvbl91cmwiOiBUcnVlLAogICAgICAgICJpc19taWdyYXRpb24iOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIKICAgIH0KICAgIAogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCBwYXlsb2FkX2RpY3QsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgaWYgcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgIHByaW50KGYiRmFpbGVkIHRvIGdldCBmYW1pbGllcyBmb3IgY2F0ZWdvcnkge3BhY2thZ2VfY2F0ZWdvcnlfY29kZX0iKQogICAgICAgIHByaW50KGYiUmVzOntqc29uLmR1bXBzKHJlcywgaW5kZW50PTIpfSIpCiAgICAgICAgaW5wdXQoIlByZXNzIEVudGVyIHRvIGNvbnRpbnVlLi4uIikKICAgICAgICByZXR1cm4gTm9uZQogICAgcmV0dXJuIHJlc1siZGF0YSJdCgpkZWYgZ2V0X3BhY2thZ2UoCiAgICBhcGlfa2V5OiBzdHIsCiAgICB0b2tlbnM6IGRpY3QsCiAgICBwYWNrYWdlX29wdGlvbl9jb2RlOiBzdHIsCiAgICBwYWNrYWdlX2ZhbWlseV9jb2RlOiBzdHIgPSAiIiwKICAgIHBhY2thZ2VfdmFyaWFudF9jb2RlOiBzdHIgPSAiIgogICAgKSAtPiBkaWN0OgogICAgcGF0aCA9ICJhcGkvdjgveGwtc3RvcmVzL29wdGlvbnMvZGV0YWlsIgogICAgCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiaXNfdHJhbnNhY3Rpb25fcm91dGluZSI6IEZhbHNlLAogICAgICAgICJtaWdyYXRpb25fdHlwZSI6ICJOT05FIiwKICAgICAgICAicGFja2FnZV9mYW1pbHlfY29kZSI6IHBhY2thZ2VfZmFtaWx5X2NvZGUsCiAgICAgICAgImZhbWlseV9yb2xlX2h1YiI6ICIiLAogICAgICAgICJpc19hdXRvYnV5IjogRmFsc2UsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAiaXNfc2hhcmVhYmxlIjogRmFsc2UsCiAgICAgICAgImlzX21pZ3JhdGlvbiI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImlkIiwKICAgICAgICAicGFja2FnZV9vcHRpb25fY29kZSI6IHBhY2thZ2Vfb3B0aW9uX2NvZGUsCiAgICAgICAgImlzX3Vwc2VsbF9wZHAiOiBGYWxzZSwKICAgICAgICAicGFja2FnZV92YXJpYW50X2NvZGUiOiBwYWNrYWdlX3ZhcmlhbnRfY29kZQogICAgfQogICAgCiAgICBwcmludCgiRmV0Y2hpbmcgcGFja2FnZS4uLiIpCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgIAogICAgaWYgImRhdGEiIG5vdCBpbiByZXM6CiAgICAgICAgcHJpbnQoanNvbi5kdW1wcyhyZXMsIGluZGVudD0yKSkKICAgICAgICBwcmludCgiRXJyb3IgZ2V0dGluZyBwYWNrYWdlOiIsIHJlcy5nZXQoImVycm9yIiwgIlVua25vd24gZXJyb3IiKSkKICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgcmV0dXJuIHJlc1siZGF0YSJdCgpkZWYgZ2V0X2FkZG9ucyhhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgcGFja2FnZV9vcHRpb25fY29kZTogc3RyKSAtPiBkaWN0OgogICAgcGF0aCA9ICJhcGkvdjgveGwtc3RvcmVzL29wdGlvbnMvYWRkb25zLXBpbmt5LWJveCIKICAgIAogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgInBhY2thZ2Vfb3B0aW9uX2NvZGUiOiBwYWNrYWdlX29wdGlvbl9jb2RlCiAgICB9CiAgICAKICAgIHByaW50KCJGZXRjaGluZyBhZGRvbnMuLi4iKQogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICAKICAgIGlmICJkYXRhIiBub3QgaW4gcmVzOgogICAgICAgIHByaW50KCJFcnJvciBnZXR0aW5nIGFkZG9uczoiLCByZXMuZ2V0KCJlcnJvciIsICJVbmtub3duIGVycm9yIikpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIHJldHVybiByZXNbImRhdGEiXQoKZGVmIGludGVyY2VwdF9wYWdlKAogICAgYXBpX2tleTogc3RyLAogICAgdG9rZW5zOiBkaWN0LAogICAgb3B0aW9uX2NvZGU6IHN0ciwKICAgIGlzX2VudGVycHJpc2U6IGJvb2wgPSBGYWxzZQopOgogICAgcGF0aCA9ICJtaXNjL2FwaS92OC91dGlsaXR5L2ludGVyY2VwdC1wYWdlIgogICAgCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IGlzX2VudGVycHJpc2UsCiAgICAgICAgImxhbmciOiAiZW4iLAogICAgICAgICJwYWNrYWdlX29wdGlvbl9jb2RlIjogb3B0aW9uX2NvZGUKICAgIH0KICAgIAogICAgcHJpbnQoIkZldGNoaW5nIGludGVyY2VwdCBwYWdlLi4uIikKICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgCiAgICBpZiAic3RhdHVzIiBpbiByZXM6CiAgICAgICAgcHJpbnQoZiJJbnRlcmNlcHQgc3RhdHVzOiB7cmVzWydzdGF0dXMnXX0iKQogICAgZWxzZToKICAgICAgICBwcmludCgiSW50ZXJjZXB0IGVycm9yIikKCmRlZiBsb2dpbl9pbmZvKAogICAgYXBpX2tleTogc3RyLAogICAgdG9rZW5zOiBkaWN0LAogICAgaXNfZW50ZXJwcmlzZTogYm9vbCA9IEZhbHNlCik6CiAgICBwYXRoID0gImFwaS92OC9hdXRoL2xvZ2luIgogICAgCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiYWNjZXNzX3Rva2VuIjogdG9rZW5zWyJhY2Nlc3NfdG9rZW4iXSwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IGlzX2VudGVycHJpc2UsCiAgICAgICAgImxhbmciOiAiZW4iCiAgICB9CgogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICAKICAgIGlmICJkYXRhIiBub3QgaW4gcmVzOgogICAgICAgIHByaW50KGpzb24uZHVtcHMocmVzLCBpbmRlbnQ9MikpCiAgICAgICAgcHJpbnQoIkVycm9yIGdldHRpbmcgcGFja2FnZToiLCByZXMuZ2V0KCJlcnJvciIsICJVbmtub3duIGVycm9yIikpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIHJldHVybiByZXNbImRhdGEiXQoKZGVmIGdldF9wYWNrYWdlX2RldGFpbHMoCiAgICBhcGlfa2V5OiBzdHIsCiAgICB0b2tlbnM6IGRpY3QsCiAgICBmYW1pbHlfY29kZTogc3RyLAogICAgdmFyaWFudF9jb2RlOiBzdHIsCiAgICBvcHRpb25fb3JkZXI6IGludCwKICAgIGlzX2VudGVycHJpc2U6IGJvb2wgfCBOb25lID0gTm9uZSwKICAgIG1pZ3JhdGlvbl90eXBlOiBzdHIgfCBOb25lID0gTm9uZQopIC0+IGRpY3QgfCBOb25lOgogICAgZmFtaWx5X2RhdGEgPSBnZXRfZmFtaWx5KGFwaV9rZXksIHRva2VucywgZmFtaWx5X2NvZGUsIGlzX2VudGVycHJpc2UsIG1pZ3JhdGlvbl90eXBlKQogICAgaWYgbm90IGZhbWlseV9kYXRhOgogICAgICAgIHByaW50KGYiR2FnYWwgbWVuZ2FtYmlsIGRhdGEgZmFtaWx5IHVudHVrIHtmYW1pbHlfY29kZX0uIikKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBwYWNrYWdlX29wdGlvbnMgPSBbXQogICAgCiAgICBwYWNrYWdlX3ZhcmlhbnRzID0gZmFtaWx5X2RhdGFbInBhY2thZ2VfdmFyaWFudHMiXQogICAgb3B0aW9uX2NvZGUgPSBOb25lCiAgICBmb3IgdmFyaWFudCBpbiBwYWNrYWdlX3ZhcmlhbnRzOgogICAgICAgIGlmIHZhcmlhbnRbInBhY2thZ2VfdmFyaWFudF9jb2RlIl0gPT0gdmFyaWFudF9jb2RlOgogICAgICAgICAgICBzZWxlY3RlZF92YXJpYW50ID0gdmFyaWFudAogICAgICAgICAgICBwYWNrYWdlX29wdGlvbnMgPSBzZWxlY3RlZF92YXJpYW50WyJwYWNrYWdlX29wdGlvbnMiXQogICAgICAgICAgICBmb3Igb3B0aW9uIGluIHBhY2thZ2Vfb3B0aW9uczoKICAgICAgICAgICAgICAgIGlmIG9wdGlvblsib3JkZXIiXSA9PSBvcHRpb25fb3JkZXI6CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfb3B0aW9uID0gb3B0aW9uCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uX2NvZGUgPSBzZWxlY3RlZF9vcHRpb25bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgaWYgb3B0aW9uX2NvZGUgaXMgTm9uZToKICAgICAgICBwcmludCgiR2FnYWwgbWVuZW11a2FuIG9wc2kgcGFrZXQgeWFuZyBzZXN1YWkuIikKICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIAogICAgcGFja2FnZV9kZXRhaWxzX2RhdGEgPSBnZXRfcGFja2FnZShhcGlfa2V5LCB0b2tlbnMsIG9wdGlvbl9jb2RlKQogICAgaWYgbm90IHBhY2thZ2VfZGV0YWlsc19kYXRhOgogICAgICAgIHByaW50KCJHYWdhbCBtZW5nYW1iaWwgZGV0YWlsIHBha2V0LiIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgcmV0dXJuIHBhY2thZ2VfZGV0YWlsc19kYXRhCgpkZWYgZ2V0X25vdGlmaWNhdGlvbnMoCiAgICBhcGlfa2V5OiBzdHIsCiAgICB0b2tlbnM6IGRpY3QsCik6CiAgICBwYXRoID0gImFwaS92OC9ub3RpZmljYXRpb24tbm9uLWdyb3VwaW5nIgogICAgCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIgogICAgfQogICAgCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgIAogICAgaWYgaXNpbnN0YW5jZShyZXMsIGRpY3QpIGFuZCByZXMuZ2V0KCJzdGF0dXMiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgcHJpbnQoIkVycm9yIGdldHRpbmcgbm90aWZpY2F0aW9uczoiLCByZXMuZ2V0KCJlcnJvciIsICJVbmtub3duIGVycm9yIikpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIHJldHVybiByZXMKCmRlZiBnZXRfbm90aWZpY2F0aW9uX2RldGFpbCgKICAgIGFwaV9rZXk6IHN0ciwKICAgIHRva2VuczogZGljdCwKICAgIG5vdGlmaWNhdGlvbl9pZDogc3RyCik6CiAgICBwYXRoID0gImFwaS92OC9ub3RpZmljYXRpb24vZGV0YWlsIgogICAgCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAibm90aWZpY2F0aW9uX2lkIjogbm90aWZpY2F0aW9uX2lkCiAgICB9CiAgICAKICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgCiAgICBpZiBpc2luc3RhbmNlKHJlcywgZGljdCkgYW5kIHJlcy5nZXQoInN0YXR1cyIpICE9ICJTVUNDRVNTIjoKICAgICAgICBwcmludCgiRXJyb3IgZ2V0dGluZyBub3RpZmljYXRpb24gZGV0YWlsOiIsIHJlcy5nZXQoImVycm9yIiwgIlVua25vd24gZXJyb3IiKSkKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHJldHVybiByZXMKCmRlZiBnZXRfcGVuZGluZ190cmFuc2FjdGlvbihhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCkgLT4gZGljdDoKICAgICMgQFRPRE86IGltcGxlbWVudCB0aGlzIGZ1bmN0aW9uIHByb3Blcmx5CiAgICBwYXRoID0gImFwaS92OC9wcm9maWxlIgoKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgImxhbmciOiAiZW4iCiAgICB9CgogICAgcHJpbnQoIkZldGNoaW5nIHBlbmRpbmcgdHJhbnNhY3Rpb25zLi4uIikKICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQoKICAgICMgewogICAgIyAgICAgImNvZGUiOiAiMDAwIiwKICAgICMgICAgICJkYXRhIjogewogICAgIyAgICAgICAgICJwZW5kaW5nX3BheW1lbnQiOiBbCiAgICAjICAgICAgICAgICAgIHsKICAgICMgICAgICAgICAgICAgICAgICJwYXltZW50X2ZvciI6ICJCVVlfUEFDS0FHRSIsCiAgICAjICAgICAgICAgICAgICAgICAicmVmZXJlbmNlX2lkIjogInh4eC14eHgiLAogICAgIyAgICAgICAgICAgICAgICAgImZvcm1hdGVkX2RhdGUiOiAiMDUgT2N0b2JlciAyMDI1IHwgMTE6MTAgV0lCIiwKICAgICMgICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJQYWNrYWdlIFB1cmNoYXNlIiwKICAgICMgICAgICAgICAgICAgICAgICJwYXltZW50X3dpdGhfbGFiZWwiOiAiUVJJUyIsCiAgICAjICAgICAgICAgICAgICAgICAicGF5bWVudF9pZCI6ICIxMjM0NTY3ODkwIiwKICAgICMgICAgICAgICAgICAgICAgICJwcmljZSI6ICJJRFJ4eC54eHgiLAogICAgIyAgICAgICAgICAgICAgICAgInBhY2thZ2VfbmFtZSI6ICJQYWNrYWdlIFB1cmNoYXNlIiwKICAgICMgICAgICAgICAgICAgICAgICJwYXltZW50X3dpdGgiOiAiUVJJUyIsCiAgICAjICAgICAgICAgICAgICAgICAicGF5bWVudF93aXRoX2ljb24iOiAiIiwKICAgICMgICAgICAgICAgICAgICAgICJyYXdfcHJpY2UiOiB4eHh4eCwKICAgICMgICAgICAgICAgICAgICAgICJzdGF0dXMiOiAiRklOSVNIRUQiLAogICAgIyAgICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IHh4eHh4eHh4eHh4LAogICAgIyAgICAgICAgICAgICB9CiAgICAjICAgICAgICAgXQogICAgIyAgICAgfSwKICAgICMgICAgICJzdGF0dXMiOiAiU1VDQ0VTUyIKICAgICMgfQoKICAgIHJldHVybiByZXMuZ2V0KCJkYXRhIikKCmRlZiBnZXRfdHJhbnNhY3Rpb25faGlzdG9yeShhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCkgLT4gZGljdDoKICAgIHBhdGggPSAicGF5bWVudHMvYXBpL3Y4L3RyYW5zYWN0aW9uLWhpc3RvcnkiCgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIKICAgIH0KCiAgICBwcmludCgiRmV0Y2hpbmcgdHJhbnNhY3Rpb24gaGlzdG9yeS4uLiIpCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgICMgcHJpbnQoanNvbi5kdW1wcyhyZXMsIGluZGVudD00KSkKCiMgewojICAgImNvZGUiOiAiMDAwIiwKIyAgICJkYXRhIjogeyJsaXN0IjogWwojICAgICB7CiMgICAgICAgInNob3dfdGltZSI6IGZhbHNlLAojICAgICAgICJjb2RlIjogInRvIGdldCBkZXRhaWwiLAojICAgICAgICJwYXltZW50X21ldGhvZF9pY29uIjogIiIsCiMgICAgICAgImZvcm1hdGVkX2RhdGUiOiAiIiwKIyAgICAgICAicGF5bWVudF9zdGF0dXMiOiAiUkVGVU5ELVNVQ0NFU1MiLAojICAgICAgICJpY29uIjogIiIsCiMgICAgICAgInRpdGxlIjogIlh0cmEgRWR1a2FzaSAyR0IsIDFociIsCiMgICAgICAgInRyeF9jb2RlIjogIiIsCiMgICAgICAgInByaWNlIjogIklEUiAyMDAwIiwKIyAgICAgICAidGFyZ2V0X21zaXNkbiI6ICIiLAojICAgICAgICJwYXltZW50X21ldGhvZF9sYWJlbCI6ICJYUVJJUyIsCiMgICAgICAgInZhbGlkaXR5IjogIjEgRGF5IiwKIyAgICAgICAiY2F0ZWdvcnkiOiAiIiwKIyAgICAgICAicGF5bWVudF9tZXRob2QiOiAiWFFSSVMiLAojICAgICAgICJyYXdfcHJpY2UiOiAyMDAwLAojICAgICAgICJ0aW1lc3RhbXAiOiAxNzU5NTIzNjIzLAojICAgICAgICJzdGF0dXMiOiAiRkFJTEVEIgojICAgICB9CiMgICBdfSwKIyAgICJzdGF0dXMiOiAiU1VDQ0VTUyIKIyB9CgogICAgcmV0dXJuIHJlcy5nZXQoImRhdGEiKQoKZGVmIGdldF90aWVyaW5nX2luZm8oYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QpIC0+IGRpY3Q6CiAgICBwYXRoID0gImdhbWlmaWNhdGlvbi9hcGkvdjgvbG95YWx0aWVzL3RpZXJpbmcvaW5mbyIKCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIgogICAgfQoKICAgIHByaW50KCJGZXRjaGluZyB0aWVyaW5nIGluZm8uLi4iKQogICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICAKICAgIGlmIHJlczoKICAgICAgICByZXR1cm4gcmVzLmdldCgiZGF0YSIsIHt9KQogICAgcmV0dXJuIHt9CgpkZWYgdW5zdWJzY3JpYmUoCiAgICBhcGlfa2V5OiBzdHIsCiAgICB0b2tlbnM6IGRpY3QsCiAgICBxdW90YV9jb2RlOiBzdHIsCiAgICBwcm9kdWN0X2RvbWFpbjogc3RyLAogICAgcHJvZHVjdF9zdWJzY3JpcHRpb25fdHlwZTogc3RyLAopIC0+IGJvb2w6CiAgICBwYXRoID0gImFwaS92OC9wYWNrYWdlcy91bnN1YnNjcmliZSIKCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAicHJvZHVjdF9zdWJzY3JpcHRpb25fdHlwZSI6IHByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGUsCiAgICAgICAgInF1b3RhX2NvZGUiOiBxdW90YV9jb2RlLAogICAgICAgICJwcm9kdWN0X2RvbWFpbiI6IHByb2R1Y3RfZG9tYWluLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgInVuc3Vic2NyaWJlX3JlYXNvbl9jb2RlIjogIiIsCiAgICAgICAgImxhbmciOiAiZW4iLAogICAgICAgICJmYW1pbHlfbWVtYmVyX2lkIjogIiIKICAgIH0KICAgIAogICAgIyBwcmludChmIlBheWxvYWQ6IHtqc29uLmR1bXBzKHJhd19wYXlsb2FkLCBpbmRlbnQ9NCl9IikKCiAgICB0cnk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICAgICAgcHJpbnQoanNvbi5kdW1wcyhyZXMsIGluZGVudD00KSkKCiAgICAgICAgaWYgcmVzIGFuZCByZXMuZ2V0KCJjb2RlIikgPT0gIjAwMCI6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgZGFzaGJvYXJkX3NlZ21lbnRzKAogICAgYXBpX2tleTogc3RyLAogICAgdG9rZW5zOiBkaWN0LAopIC0+IGRpY3Q6CiAgICBwYXRoID0gImRhc2hib2FyZC9hcGkvdjgvc2VnbWVudHMiCgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgImFjY2Vzc190b2tlbiI6IHRva2Vuc1siYWNjZXNzX3Rva2VuIl0sCiAgICAgICAgIyAiYXBwX3ZlcnNpb24iOiAiIiwKICAgICAgICAjICJtb2RlbF9uYW1lIjogIiIsCiAgICAgICAgIyAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICMgImN1cnJlbnRfYmFsYW5jZSI6IDAsCiAgICAgICAgIyAiZmFtaWx5X3BsYW5fcm9sZSI6ICIiLAogICAgICAgICMgIm1hbnVmYWN0dXJlcl9uYW1lIjogIiIsCiAgICAgICAgIyAibGFuZyI6ICJlbiIKICAgIH0KCiAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICByZXR1cm4gcmVzCg==').decode())
