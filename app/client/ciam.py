#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGJhc2U2NAppbXBvcnQgb3MKaW1wb3J0IGpzb24KaW1wb3J0IHV1aWQKaW1wb3J0IHJlcXVlc3RzCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxwYXJzZQoKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lLCB0aW1lZGVsdGEKCmZyb20gYXBwLmNsaWVudC5lbmNyeXB0IGltcG9ydCAoCiAgICBqYXZhX2xpa2VfdGltZXN0YW1wLAogICAgdHNfZ210N193aXRob3V0X2NvbG9uLAogICAgYXhfYXBpX3NpZ25hdHVyZSwKICAgIGxvYWRfYXhfZnAsCiAgICBheF9kZXZpY2VfaWQKKQoKQkFTRV9DSUFNX1VSTCA9IG9zLmdldGVudigiQkFTRV9DSUFNX1VSTCIpCmlmIG5vdCBCQVNFX0NJQU1fVVJMOgogICAgcmFpc2UgVmFsdWVFcnJvcigiQkFTRV9DSUFNX1VSTCBlbnZpcm9ubWVudCB2YXJpYWJsZSBub3Qgc2V0IikKCkJBU0lDX0FVVEggPSBvcy5nZXRlbnYoIkJBU0lDX0FVVEgiKQpBWF9ERVZJQ0VfSUQgPSBheF9kZXZpY2VfaWQoKQpBWF9GUCA9IGxvYWRfYXhfZnAoKQpVQSA9IG9zLmdldGVudigiVUEiKQoKZGVmIHZhbGlkYXRlX2NvbnRhY3QoY29udGFjdDogc3RyKSAtPiBib29sOgogICAgaWYgbm90IGNvbnRhY3Quc3RhcnRzd2l0aCgiNjI4Iikgb3IgbGVuKGNvbnRhY3QpID4gMTQ6CiAgICAgICAgcHJpbnQoIkludmFsaWQgbnVtYmVyIikKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiBUcnVlCgpkZWYgZ2V0X290cChjb250YWN0OiBzdHIpIC0+IHN0cjoKICAgIGlmIG5vdCB2YWxpZGF0ZV9jb250YWN0KGNvbnRhY3QpOgogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIHVybCA9IEJBU0VfQ0lBTV9VUkwgKyAiL3JlYWxtcy94bC1jaWFtL2F1dGgvb3RwIgoKICAgIHF1ZXJ5c3RyaW5nID0gewogICAgICAgICJjb250YWN0IjogY29udGFjdCwKICAgICAgICAiY29udGFjdFR5cGUiOiAiU01TIiwKICAgICAgICAiYWx0ZXJuYXRlQ29udGFjdCI6ICJmYWxzZSIKICAgIH0KICAgIAogICAgbm93ID0gZGF0ZXRpbWUubm93KHRpbWV6b25lKHRpbWVkZWx0YShob3Vycz03KSkpCiAgICBheF9yZXF1ZXN0X2F0ID0gamF2YV9saWtlX3RpbWVzdGFtcChub3cpICAjIGZvcm1hdDogIjIwMjMtMTAtMjBUMTI6MzQ6NTYuNzgrMDc6MDAiCiAgICBheF9yZXF1ZXN0X2lkID0gc3RyKHV1aWQudXVpZDQoKSkKCiAgICBwYXlsb2FkID0gIiIKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkFjY2VwdC1FbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlLCBiciIsCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiBmIkJhc2ljIHtCQVNJQ19BVVRIfSIsCiAgICAgICAgIkF4LURldmljZS1JZCI6IEFYX0RFVklDRV9JRCwKICAgICAgICAiQXgtRmluZ2VycHJpbnQiOiBBWF9GUCwKICAgICAgICAiQXgtUmVxdWVzdC1BdCI6IGF4X3JlcXVlc3RfYXQsCiAgICAgICAgIkF4LVJlcXVlc3QtRGV2aWNlIjogInNhbXN1bmciLAogICAgICAgICJBeC1SZXF1ZXN0LURldmljZS1Nb2RlbCI6ICJTTS1OOTM1RiIsCiAgICAgICAgIkF4LVJlcXVlc3QtSWQiOiBheF9yZXF1ZXN0X2lkLAogICAgICAgICJBeC1TdWJzdHlwZSI6ICJQUkVQQUlEIiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJIb3N0IjogQkFTRV9DSUFNX1VSTC5yZXBsYWNlKCJodHRwczovLyIsICIiKSwKICAgICAgICAiVXNlci1BZ2VudCI6IFVBLAogICAgfQoKICAgIHByaW50KCJSZXF1ZXN0aW5nIE9UUC4uLiIpCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5yZXF1ZXN0KCJHRVQiLCB1cmwsIGRhdGE9cGF5bG9hZCwgaGVhZGVycz1oZWFkZXJzLCBwYXJhbXM9cXVlcnlzdHJpbmcsIHRpbWVvdXQ9MzApCiAgICAgICAgcHJpbnQoInJlc3BvbnNlIGJvZHkiLCByZXNwb25zZS50ZXh0KQogICAgICAgIGpzb25fYm9keSA9IGpzb24ubG9hZHMocmVzcG9uc2UudGV4dCkKICAgIAogICAgICAgIGlmICJzdWJzY3JpYmVyX2lkIiBub3QgaW4ganNvbl9ib2R5OgogICAgICAgICAgICBwcmludChqc29uX2JvZHkuZ2V0KCJlcnJvciIsICJObyBlcnJvciBtZXNzYWdlIGluIHJlc3BvbnNlIikpCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIlN1YnNjcmliZXIgSUQgbm90IGZvdW5kIGluIHJlc3BvbnNlIikKICAgICAgICAKICAgICAgICByZXR1cm4ganNvbl9ib2R5WyJzdWJzY3JpYmVyX2lkIl0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIkVycm9yIHJlcXVlc3RpbmcgT1RQOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZXh0ZW5kX3Nlc3Npb24oc3Vic2NyaWJlcl9pZDogc3RyKSAtPiBzdHI6CiAgICBiNjRfc3Vic2NyaWJlcl9pZCA9IGJhc2U2NC5iNjRlbmNvZGUoc3Vic2NyaWJlcl9pZC5lbmNvZGUoKSkuZGVjb2RlKCkKICAgIHVybCA9IGYie0JBU0VfQ0lBTV9VUkx9L3JlYWxtcy94bC1jaWFtL2F1dGgvZXh0ZW5kLXNlc3Npb24iCgogICAgcXVlcnlzdHJpbmcgPSB7CiAgICAgICAgImNvbnRhY3QiOiBiNjRfc3Vic2NyaWJlcl9pZCwKICAgICAgICAiY29udGFjdFR5cGUiOiAiREVWSUNFSUQiCiAgICB9CiAgICAKICAgIG5vdyA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZSh0aW1lZGVsdGEoaG91cnM9NykpKQogICAgYXhfcmVxdWVzdF9hdCA9IGphdmFfbGlrZV90aW1lc3RhbXAobm93KSAgIyBmb3JtYXQ6ICIyMDIzLTEwLTIwVDEyOjM0OjU2Ljc4KzA3OjAwIgogICAgYXhfcmVxdWVzdF9pZCA9IHN0cih1dWlkLnV1aWQ0KCkpCiAgICAKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkFjY2VwdC1FbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlLCBiciIsCiAgICAgICAgIkF1dGhvcml6YXRpb24iOiBmIkJhc2ljIHtCQVNJQ19BVVRIfSIsCiAgICAgICAgIkF4LURldmljZS1JZCI6IEFYX0RFVklDRV9JRCwKICAgICAgICAiQXgtRmluZ2VycHJpbnQiOiBBWF9GUCwKICAgICAgICAiQXgtUmVxdWVzdC1BdCI6IGF4X3JlcXVlc3RfYXQsCiAgICAgICAgIkF4LVJlcXVlc3QtRGV2aWNlIjogInNhbXN1bmciLAogICAgICAgICJBeC1SZXF1ZXN0LURldmljZS1Nb2RlbCI6ICJTTS1OOTM1RiIsCiAgICAgICAgIkF4LVJlcXVlc3QtSWQiOiBheF9yZXF1ZXN0X2lkLAogICAgICAgICJBeC1TdWJzdHlwZSI6ICJQUkVQQUlEIiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJIb3N0IjogQkFTRV9DSUFNX1VSTC5yZXBsYWNlKCJodHRwczovLyIsICIiKSwKICAgICAgICAiVXNlci1BZ2VudCI6IFVBLAogICAgfQogICAgCiAgICBwcmludCgiRXh0ZW5kaW5nIHNlc3Npb24uLi4iKQogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBwYXJhbXM9cXVlcnlzdHJpbmcsIHRpbWVvdXQ9MzApCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAwOgogICAgICAgICAgICBwcmludChmIkZhaWxlZCB0byBleHRlbmQgc2Vzc2lvbjoge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSAtIHtyZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgIGV4Y2hhbmdlX2NvZGUgPSBkYXRhLmdldCgiZGF0YSIsIHt9KS5nZXQoImV4Y2hhbmdlX2NvZGUiKQogICAgICAgIAogICAgICAgIHJldHVybiBleGNoYW5nZV9jb2RlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJFcnJvciBleHRlbmRpbmcgc2Vzc2lvbjoge2V9IikKICAgICAgICByZXR1cm4gTm9uZQoKZGVmIHN1Ym1pdF9vdHAoCiAgICBhcGlfa2V5OiBzdHIsCiAgICBjb250YWN0X3R5cGU6IHN0ciwKICAgIGNvbnRhY3Q6IHN0ciwKICAgIGNvZGU6IHN0cgopOgogICAgZmluYWxfY29udGFjdCA9ICIiCiAgICBmaW5hbF9jb2RlID0gIiIKCiAgICBpZiBjb250YWN0X3R5cGUgPT0gIlNNUyI6CiAgICAgICAgaWYgbm90IHZhbGlkYXRlX2NvbnRhY3QoY29udGFjdCk6CiAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIG51bWJlciIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZmluYWxfY29udGFjdCA9IGNvbnRhY3QKICAgIAogICAgICAgIGlmIG5vdCBjb2RlIG9yIGxlbihjb2RlKSAhPSA2OgogICAgICAgICAgICBwcmludCgiSW52YWxpZCBPVFAgY29kZSBmb3JtYXQiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGZpbmFsX2NvZGUgPSBjb2RlCiAgICBlbGlmIGNvbnRhY3RfdHlwZSA9PSAiREVWSUNFSUQiOgogICAgICAgIGZpbmFsX2NvbnRhY3QgPSBiYXNlNjQuYjY0ZW5jb2RlKGNvbnRhY3QuZW5jb2RlKCkpLmRlY29kZSgpCiAgICAgICAgZmluYWxfY29kZSA9IGNvZGUKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoIlVuc3VwcG9ydGVkIGNvbnRhY3QgdHlwZSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICB1cmwgPSBCQVNFX0NJQU1fVVJMICsgIi9yZWFsbXMveGwtY2lhbS9wcm90b2NvbC9vcGVuaWQtY29ubmVjdC90b2tlbiIKCiAgICBub3dfZ210NyA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZSh0aW1lZGVsdGEoaG91cnM9NykpKQogICAgdHNfZm9yX3NpZ24gPSB0c19nbXQ3X3dpdGhvdXRfY29sb24obm93X2dtdDcpCiAgICB0c19oZWFkZXIgPSB0c19nbXQ3X3dpdGhvdXRfY29sb24obm93X2dtdDcgLSB0aW1lZGVsdGEobWludXRlcz01KSkKICAgIHNpZ25hdHVyZSA9IGF4X2FwaV9zaWduYXR1cmUoYXBpX2tleSwgdHNfZm9yX3NpZ24sIGZpbmFsX2NvbnRhY3QsIGNvZGUsIGNvbnRhY3RfdHlwZSkKCiAgICBwYXlsb2FkID0gZiJjb250YWN0VHlwZT17Y29udGFjdF90eXBlfSZjb2RlPXtmaW5hbF9jb2RlfSZncmFudF90eXBlPXBhc3N3b3JkJmNvbnRhY3Q9e2ZpbmFsX2NvbnRhY3R9JnNjb3BlPW9wZW5pZCIKCiAgICBoZWFkZXJzID0gewogICAgICAgICJBY2NlcHQtRW5jb2RpbmciOiAiZ3ppcCwgZGVmbGF0ZSwgYnIiLAogICAgICAgICJBdXRob3JpemF0aW9uIjogZiJCYXNpYyB7QkFTSUNfQVVUSH0iLAogICAgICAgICJBeC1BcGktU2lnbmF0dXJlIjogc2lnbmF0dXJlLAogICAgICAgICJBeC1EZXZpY2UtSWQiOiBBWF9ERVZJQ0VfSUQsCiAgICAgICAgIkF4LUZpbmdlcnByaW50IjogQVhfRlAsCiAgICAgICAgIkF4LVJlcXVlc3QtQXQiOiB0c19oZWFkZXIsCiAgICAgICAgIkF4LVJlcXVlc3QtRGV2aWNlIjogInNhbXN1bmciLAogICAgICAgICJBeC1SZXF1ZXN0LURldmljZS1Nb2RlbCI6ICJTTS1OOTM1RiIsCiAgICAgICAgIkF4LVJlcXVlc3QtSWQiOiBzdHIodXVpZC51dWlkNCgpKSwKICAgICAgICAiQXgtU3Vic3R5cGUiOiAiUFJFUEFJRCIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICJVc2VyLUFnZW50IjogVUEsCiAgICB9CgogICAgcHJpbnQoIlN1Ym1pdHRpbmcgT1RQLi4uIikKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPXBheWxvYWQsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgICBqc29uX2JvZHkgPSBqc29uLmxvYWRzKHJlc3BvbnNlLnRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICBpZiAiZXJyb3IiIGluIGpzb25fYm9keToKICAgICAgICAgICAgcHJpbnQoZiJbRXJyb3Igc3VibWl0X290cF06IHtqc29uX2JvZHl9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgICAgICBwcmludCgiTG9naW4gc3VjY2Vzc2Z1bC4iKQogICAgICAgIHJldHVybiBqc29uX2JvZHkKICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiJbRXJyb3Igc3VibWl0X290cF06IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCmRlZiBnZXRfbmV3X3Rva2VuKGFwaV9rZXk6IHN0ciwgcmVmcmVzaF90b2tlbjogc3RyLCBzdWJzY3JpYmVyX2lkOiBzdHIpIC0+IHN0cjoKICAgIHVybCA9IEJBU0VfQ0lBTV9VUkwgKyAiL3JlYWxtcy94bC1jaWFtL3Byb3RvY29sL29wZW5pZC1jb25uZWN0L3Rva2VuIgoKICAgIG5vdyA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZSh0aW1lZGVsdGEoaG91cnM9NykpKQogICAgYXhfcmVxdWVzdF9hdCA9IG5vdy5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVMuJWYiKVs6LTNdICsgIiswNzAwIgogICAgYXhfcmVxdWVzdF9pZCA9IHN0cih1dWlkLnV1aWQ0KCkpCgogICAgaGVhZGVycyA9IHsKICAgICAgICAiSG9zdCI6IEJBU0VfQ0lBTV9VUkwucmVwbGFjZSgiaHR0cHM6Ly8iLCAiIiksCiAgICAgICAgImF4LXJlcXVlc3QtYXQiOiBheF9yZXF1ZXN0X2F0LAogICAgICAgICJheC1kZXZpY2UtaWQiOiBBWF9ERVZJQ0VfSUQsCiAgICAgICAgImF4LXJlcXVlc3QtaWQiOiBheF9yZXF1ZXN0X2lkLAogICAgICAgICJheC1yZXF1ZXN0LWRldmljZSI6ICJzYW1zdW5nIiwKICAgICAgICAiYXgtcmVxdWVzdC1kZXZpY2UtbW9kZWwiOiAiU00tTjkzNUYiLAogICAgICAgICJheC1maW5nZXJwcmludCI6IEFYX0ZQLAogICAgICAgICJhdXRob3JpemF0aW9uIjogZiJCYXNpYyB7QkFTSUNfQVVUSH0iLAogICAgICAgICJ1c2VyLWFnZW50IjogVUEsCiAgICAgICAgImF4LXN1YnN0eXBlIjogIlBSRVBBSUQiLAogICAgICAgICJjb250ZW50LXR5cGUiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIgogICAgfQoKICAgIGRhdGEgPSB7CiAgICAgICAgImdyYW50X3R5cGUiOiAicmVmcmVzaF90b2tlbiIsCiAgICAgICAgInJlZnJlc2hfdG9rZW4iOiByZWZyZXNoX3Rva2VuCiAgICB9CgogICAgcHJpbnQoIlJlZnJlc2hpbmcgdG9rZW4uLi4iKQogICAgcmVzcCA9IHJlcXVlc3RzLnBvc3QodXJsLCBoZWFkZXJzPWhlYWRlcnMsIGRhdGE9ZGF0YSwgdGltZW91dD0zMCkKICAgIGlmIHJlc3Auc3RhdHVzX2NvZGUgPT0gNDAwOgogICAgICAgIGlmIHJlc3AuanNvbigpLmdldCgiZXJyb3JfZGVzY3JpcHRpb24iKSAhPSAiU2Vzc2lvbiBub3QgYWN0aXZlIjoKICAgICAgICAgICAgcHJpbnQoZiJGYWlsZWQgdG8gcmVmcmVzaCB0b2tlbjoge3Jlc3Auc3RhdHVzX2NvZGV9IC0ge3Jlc3AudGV4dH0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICBpZiBzdWJzY3JpYmVyX2lkID09ICIiOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJTdWJzY3JpYmVyIElEIGlzIG1pc3NpbmciKQogICAgICAgIAogICAgICAgIGV4Y2hhbmdlX2NvZGUgPSBleHRlbmRfc2Vzc2lvbihzdWJzY3JpYmVyX2lkKQogICAgICAgIGlmIGV4Y2hhbmdlX2NvZGUgaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiRmFpbGVkIHRvIGdldCBleGNoYW5nZSBjb2RlIikKICAgICAgICAKICAgICAgICBleHRlbmRfcmVzdWx0ID0gc3VibWl0X290cCgKICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgIkRFVklDRUlEIiwKICAgICAgICAgICAgc3Vic2NyaWJlcl9pZCwKICAgICAgICAgICAgZXhjaGFuZ2VfY29kZQogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBleHRlbmRfcmVzdWx0IGlzIE5vbmU6CiAgICAgICAgICAgIGlmICJJbnZhbGlkIHJlZnJlc2ggdG9rZW4iIGluIHJlc3AudGV4dDoKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIlJlZnJlc2ggdG9rZW4gaXMgaW52YWxpZCBvciBleHBpcmVkLiBQbGVhc2UgbG9naW4gYWdhaW4uIikKCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoIkZhaWxlZCB0byBzdWJtaXQgT1RQIGFmdGVyIGV4dGVuZGluZyBzZXNzaW9uIikKICAgICAgICAKICAgICAgICByZXR1cm4gZXh0ZW5kX3Jlc3VsdAoKICAgIHJlc3AucmFpc2VfZm9yX3N0YXR1cygpCgogICAgYm9keSA9IHJlc3AuanNvbigpCiAgICAKICAgIGlmICJpZF90b2tlbiIgbm90IGluIGJvZHk6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiSUQgdG9rZW4gbm90IGZvdW5kIGluIHJlc3BvbnNlIikKICAgIGlmICJlcnJvciIgaW4gYm9keToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYiRXJyb3IgaW4gcmVzcG9uc2U6IHtib2R5WydlcnJvciddfSAtIHtib2R5LmdldCgnZXJyb3JfZGVzY3JpcHRpb24nLCAnJyl9IikKICAgIAogICAgcmV0dXJuIGJvZHkKCmRlZiBnZXRfYXV0aF9jb2RlKHRva2VuczogZGljdCwgcGluOiBzdHIsIG1zaXNkbjogc3RyKToKICAgIHVybCA9IEJBU0VfQ0lBTV9VUkwgKyAiL2NpYW0vYXV0aC9hdXRob3JpemF0aW9uLXRva2VuL2dlbmVyYXRlIgoKICAgIHBhcnNlZCA9IHVybHBhcnNlKEJBU0VfQ0lBTV9VUkwpCiAgICBob3N0X2hlYWRlciA9IHBhcnNlZC5uZXRsb2Mgb3IgQkFTRV9DSUFNX1VSTC5yZXBsYWNlKCJodHRwczovLyIsICIiKQoKICAgIG5vdyA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZSh0aW1lZGVsdGEoaG91cnM9NykpKQogICAgYXhfcmVxdWVzdF9hdCA9IG5vdy5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVMuJWYiKVs6LTNdICsgIiswNzAwIgogICAgYXhfcmVxdWVzdF9pZCA9IHN0cih1dWlkLnV1aWQ0KCkpCgogICAgaGVhZGVycyA9IHsKICAgICAgICAiSG9zdCI6IGhvc3RfaGVhZGVyLAogICAgICAgICJBeC1SZXF1ZXN0LUF0IjogYXhfcmVxdWVzdF9hdCwKICAgICAgICAiQXgtRGV2aWNlLUlkIjogQVhfREVWSUNFX0lELAogICAgICAgICJBeC1SZXF1ZXN0LUlkIjogYXhfcmVxdWVzdF9pZCwKICAgICAgICAiQXgtUmVxdWVzdC1EZXZpY2UiOiAic2Ftc3VuZyIsCiAgICAgICAgIkF4LVJlcXVlc3QtRGV2aWNlLU1vZGVsIjogIlNNLU45MzVGIiwKICAgICAgICAiQXgtRmluZ2VycHJpbnQiOiBBWF9GUCwKICAgICAgICAiQXV0aG9yaXphdGlvbiI6IGYiQmVhcmVyIHt0b2tlbnNbJ2FjY2Vzc190b2tlbiddfSIsCiAgICAgICAgIlVzZXItQWdlbnQiOiBVQSwKICAgICAgICAiQXgtU3Vic3R5cGUiOiAiUFJFUEFJRCIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgIH0KCiAgICBwaW5fYjY0ID0gYmFzZTY0LmI2NGVuY29kZShwaW4uZW5jb2RlKCJ1dGYtOCIpKS5kZWNvZGUoInV0Zi04IikKCiAgICBib2R5ID0gewogICAgICAgICJwaW4iOiBwaW5fYjY0LAogICAgICAgICJ0cmFuc2FjdGlvbl90eXBlIjogIlNIQVJFX0JBTEFOQ0UiLAogICAgICAgICJyZWNlaXZlcl9tc2lzZG4iOiBtc2lzZG4sCiAgICB9CgogICAgdHJ5OgogICAgICAgIHJlc3AgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWJvZHksIHRpbWVvdXQ9MzApCiAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYiW2dldF9hdXRoX2NvZGVdIFJlcXVlc3QgZXJyb3I6IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCgogICAgaWYgcmVzcC5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgcHJpbnQoZiJGYWlsZWQgdG8gZ2V0IGF1dGggY29kZToge3Jlc3Auc3RhdHVzX2NvZGV9IC0ge3Jlc3AudGV4dH0iKQogICAgICAgIHJldHVybiBOb25lCgogICAgdHJ5OgogICAgICAgIGRhdGEgPSByZXNwLmpzb24oKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcHJpbnQoZiJJbnZhbGlkIEpTT04gcmVzcG9uc2U6IHtyZXNwLnRleHR9IikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGRhdGEsIGRpY3QpOgogICAgICAgIHByaW50KGYiVW5leHBlY3RlZCByZXNwb25zZSBmb3JtYXQ6IHtkYXRhIXJ9IikKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBzdGF0dXMgPSBkYXRhLmdldCgic3RhdHVzIiwgIiIpCiAgICBpZiBzdGF0dXMgIT0gIlN1Y2Nlc3MiOgogICAgICAgIHByaW50KGYiRXJyb3IgZ2V0dGluZyBhdXRob3JpemF0aW9uIGNvZGU6IHtzdGF0dXN9IikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGF1dGhvcml6YXRpb25fY29kZSA9IGRhdGEuZ2V0KCJkYXRhIiwge30pLmdldCgiYXV0aG9yaXphdGlvbl9jb2RlIikKICAgIGlmIG5vdCBhdXRob3JpemF0aW9uX2NvZGU6CiAgICAgICAgcHJpbnQoZiJBdXRob3JpemF0aW9uIGNvZGUgbm90IGZvdW5kIGluIHJlc3BvbnNlOiB7ZGF0YX0iKQogICAgICAgIHJldHVybiBOb25lCgogICAgcmV0dXJuIGF1dGhvcml6YXRpb25fY29kZQo=').decode())
