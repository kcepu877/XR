#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCgpmcm9tIGFwcC5jb25maWcuaW1wb3J0cyBpbXBvcnQgKgpmcm9tIGFwcC5tZW51cy51dGlsIGltcG9ydCBjbGVhcl9zY3JlZW4sIHBhdXNlLCBwcmludF9wYW5lbCwgcHJpbnRfZXJyb3IKZnJvbSBhcHAubWVudXMucGFja2FnZSBpbXBvcnQgc2hvd19wYWNrYWdlX2RldGFpbHMKZnJvbSBhcHAubWVudXMudXRpbCBpbXBvcnQgZ2V0X3J1cGlhaAoKY29uc29sZSA9IENvbnNvbGUoKQoKCmRlZiBmZXRjaF9zcGVjaWFsX2Zvcl95b3UoYXBpX2tleTogc3RyLCBpZF90b2tlbjogc3RyLCBhY2Nlc3NfdG9rZW46IHN0ciwgYmFsYW5jZTogaW50ID0gMCkgLT4gbGlzdDoKICAgIHRyeToKICAgICAgICBzZWdfZGF0YSA9IGRhc2hfc2VnbWVudHMoYXBpX2tleSwgaWRfdG9rZW4sIGFjY2Vzc190b2tlbiwgYmFsYW5jZSkKICAgICAgICBpZiBub3Qgc2VnX2RhdGE6CiAgICAgICAgICAgIHJldHVybiBbXQoKICAgICAgICBwYWNrYWdlcyA9IHNlZ19kYXRhLmdldCgic3BlY2lhbF9wYWNrYWdlcyIsIFtdKQogICAgICAgIHNwZWNpYWxfcGFja2FnZXMgPSBbXQoKICAgICAgICBmb3IgcGtnIGluIHBhY2thZ2VzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuYW1lID0gcGtnLmdldCgibmFtZSIsICJVbmtub3duIFBhY2thZ2UiKQogICAgICAgICAgICAgICAga29kZV9wYWtldCA9IHBrZy5nZXQoImtvZGVfcGFrZXQiLCAiLSIpCgogICAgICAgICAgICAgICAgaWYgbm90IGtvZGVfcGFrZXQgb3Iga29kZV9wYWtldCA9PSAiLSI6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBvcmlnaW5hbF9wcmljZSA9IGludChwa2cuZ2V0KCJvcmlnaW5hbF9wcmljZSIsIDApKQogICAgICAgICAgICAgICAgZGlza29uX3ByaWNlID0gaW50KHBrZy5nZXQoImRpc2tvbl9wcmljZSIsIG9yaWdpbmFsX3ByaWNlKSkKCiAgICAgICAgICAgICAgICBkaXNrb25fcGVyY2VudCA9IDAKICAgICAgICAgICAgICAgIGlmIG9yaWdpbmFsX3ByaWNlID4gMCBhbmQgZGlza29uX3ByaWNlIDwgb3JpZ2luYWxfcHJpY2U6CiAgICAgICAgICAgICAgICAgICAgZGlza29uX3BlcmNlbnQgPSBpbnQocm91bmQoKG9yaWdpbmFsX3ByaWNlIC0gZGlza29uX3ByaWNlKSAvIG9yaWdpbmFsX3ByaWNlICogMTAwKSkKCiAgICAgICAgICAgICAgICBzcGVjaWFsX3BhY2thZ2VzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBuYW1lLAogICAgICAgICAgICAgICAgICAgICJrb2RlX3Bha2V0Ijoga29kZV9wYWtldCwKICAgICAgICAgICAgICAgICAgICAib3JpZ2luYWxfcHJpY2UiOiBvcmlnaW5hbF9wcmljZSwKICAgICAgICAgICAgICAgICAgICAiZGlza29uX3ByaWNlIjogZGlza29uX3ByaWNlLAogICAgICAgICAgICAgICAgICAgICJkaXNrb25fcGVyY2VudCI6IGRpc2tvbl9wZXJjZW50LAogICAgICAgICAgICAgICAgICAgICJrdW90YV9nYiI6IHBrZy5nZXQoImt1b3RhX2diIiwgMCksCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIEVycm9yIiwgZiJHYWdhbCBwYXJzZSBwYWtldDoge2V9IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIHNwZWNpYWxfcGFja2FnZXMuc29ydChrZXk9bGFtYmRhIHg6IHhbImRpc2tvbl9wZXJjZW50Il0sIHJldmVyc2U9VHJ1ZSkKICAgICAgICByZXR1cm4gc3BlY2lhbF9wYWNrYWdlcwoKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIEVycm9yIiwgZiJHYWdhbCBtZW5nYW1iaWwgZGF0YSBTRlk6IHtlfSIpCiAgICAgICAgcmV0dXJuIFtdCgoKZGVmIHNob3dfc3BlY2lhbF9mb3JfeW91X21lbnUodG9rZW5zOiBkaWN0KToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKCiAgICBhcGlfa2V5ID0gQXV0aEluc3RhbmNlLmFwaV9rZXkKICAgIGlkX3Rva2VuID0gdG9rZW5zLmdldCgiaWRfdG9rZW4iLCAiIikKICAgIGFjY2Vzc190b2tlbiA9IHRva2Vucy5nZXQoImFjY2Vzc190b2tlbiIsICIiKQogICAgYmFsYW5jZSA9IDAKCiAgICBzcGVjaWFsX3BhY2thZ2VzID0gZmV0Y2hfc3BlY2lhbF9mb3JfeW91KGFwaV9rZXksIGlkX3Rva2VuLCBhY2Nlc3NfdG9rZW4sIGJhbGFuY2UpCgogICAgd2hpbGUgVHJ1ZToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGVuc3VyZV9naXQoKQoKICAgICAgICBpZiBub3Qgc3BlY2lhbF9wYWNrYWdlczoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyBJbmZvIiwgIlRpZGFrIGFkYSBwYWtldCBzcGVzaWFsIHRlcnNlZGlhIHNhYXQgaW5pLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGluZm9fdGV4dCA9IEFsaWduLmNlbnRlcigKICAgICAgICAgICAgZiJbe3RoZW1lWyd0ZXh0X2JvZHknXX1d8J+UpSBEYWZ0YXIgUGFrZXQgU3BlY2lhbCBGb3IgWW91IPCflKVbL3t0aGVtZVsndGV4dF9ib2R5J119XSIKICAgICAgICApCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgaW5mb190ZXh0LAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDEsIDIpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCgogICAgICAgIHRhYmxlID0gVGFibGUoYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIk5vIiwganVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJOYW1hIFBha2V0Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIkRpc2tvbiIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfbW9uZXkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJIYXJnYSBOb3JtYWwiLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2VyciJdKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIkhhcmdhIERpc2tvbiIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfbW9uZXkiXSkKCiAgICAgICAgZm9yIGlkeCwgcGtnIGluIGVudW1lcmF0ZShzcGVjaWFsX3BhY2thZ2VzLCAxKToKICAgICAgICAgICAgZW1vamlfZGlza29uID0gIvCfkrgiIGlmIHBrZy5nZXQoImRpc2tvbl9wZXJjZW50IiwgMCkgPj0gNTAgZWxzZSAiIgogICAgICAgICAgICBlbW9qaV9rdW90YSA9ICLwn5SlIiBpZiBwa2cuZ2V0KCJrdW90YV9nYiIsIDApID49IDEwMCBlbHNlICIiCgogICAgICAgICAgICBvcmlnaW5hbF9wcmljZSA9IGdldF9ydXBpYWgocGtnLmdldCgib3JpZ2luYWxfcHJpY2UiLCAwKSkKICAgICAgICAgICAgZGlza29uX3ByaWNlID0gZ2V0X3J1cGlhaChwa2cuZ2V0KCJkaXNrb25fcHJpY2UiLCAwKSkKCiAgICAgICAgICAgIHRhYmxlLmFkZF9yb3coCiAgICAgICAgICAgICAgICBzdHIoaWR4KSwKICAgICAgICAgICAgICAgIGYie2Vtb2ppX2t1b3RhfSB7cGtnLmdldCgnbmFtZScsICctJyl9IiwKICAgICAgICAgICAgICAgIGYie3BrZy5nZXQoJ2Rpc2tvbl9wZXJjZW50JywgMCl9JSB7ZW1vamlfZGlza29ufSIsCiAgICAgICAgICAgICAgICBmIlt7dGhlbWVbJ3RleHRfZXJyJ119XVtzdHJpa2Vde29yaWdpbmFsX3ByaWNlfVsvc3RyaWtlXVsve3RoZW1lWyd0ZXh0X2VyciddfV0iLAogICAgICAgICAgICAgICAgZiJbe3RoZW1lWyd0ZXh0X21vbmV5J119XXtkaXNrb25fcHJpY2V9Wy97dGhlbWVbJ3RleHRfbW9uZXknXX1dIgogICAgICAgICAgICApCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwodGFibGUsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgcGFkZGluZz0oMCwgMCksIGV4cGFuZD1UcnVlKSkKCiAgICAgICAgbmF2X3RhYmxlID0gVGFibGUoc2hvd19oZWFkZXI9RmFsc2UsIGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD02KQogICAgICAgIG5hdl90YWJsZS5hZGRfY29sdW1uKHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUtlbWJhbGkga2UgbWVudSBzZWJlbHVtbnlhWy9dIikKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgbmF2X3RhYmxlLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sCiAgICAgICAgICAgIHBhZGRpbmc9KDAsIDEpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCgogICAgICAgIGNob2ljZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3RpdGxlJ119XVBpbGloIHBha2V0IChub21vcik6Wy97dGhlbWVbJ3RleHRfdGl0bGUnXX1dICIpLnN0cmlwKCkKCiAgICAgICAgaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgaWYgbm90IGNob2ljZS5pc2RpZ2l0KCk6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gRXJyb3IiLCAiSW5wdXQgdGlkYWsgdmFsaWQuIE1hc3Vra2FuIGFuZ2thIHlhbmcgc2VzdWFpLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgY2hvaWNlX2lkeCA9IGludChjaG9pY2UpIC0gMQogICAgICAgIGlmIDAgPD0gY2hvaWNlX2lkeCA8IGxlbihzcGVjaWFsX3BhY2thZ2VzKToKICAgICAgICAgICAgc2VsZWN0ZWRfcGtnID0gc3BlY2lhbF9wYWNrYWdlc1tjaG9pY2VfaWR4XQogICAgICAgICAgICBhcGlfa2V5ID0gQXV0aEluc3RhbmNlLmFwaV9rZXkKICAgICAgICAgICAgcmVzdWx0ID0gc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBzZWxlY3RlZF9wa2dbImtvZGVfcGFrZXQiXSwgaXNfZW50ZXJwcmlzZT1GYWxzZSkKCiAgICAgICAgICAgIGlmIHJlc3VsdCA9PSAiTUFJTiI6CiAgICAgICAgICAgICAgICByZXR1cm4gIk1BSU4iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBFcnJvciIsICJOb21vciBwYWtldCB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICBwYXVzZSgpCg==').decode())
