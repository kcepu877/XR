#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IHJlcXVlc3RzLCB0aW1lLCBzeXMKZnJvbSByYW5kb20gaW1wb3J0IHJhbmRpbnQKZnJvbSBhcHAuY2xpZW50LmVuZ3NlbCBpbXBvcnQgZ2V0X2ZhbWlseSwgZ2V0X3BhY2thZ2VfZGV0YWlscywgZ2V0X3BhY2thZ2UKZnJvbSBhcHAubWVudXMudXRpbCBpbXBvcnQgcGF1c2UKZnJvbSBhcHAuc2VydmljZS5hdXRoIGltcG9ydCBBdXRoSW5zdGFuY2UKZnJvbSBhcHAuc2VydmljZS5kZWNveSBpbXBvcnQgRGVjb3lJbnN0YW5jZQpmcm9tIGFwcC50eXBlX2RpY3QgaW1wb3J0IFBheW1lbnRJdGVtCmZyb20gYXBwLmNsaWVudC5wdXJjaGFzZS5iYWxhbmNlIGltcG9ydCBzZXR0bGVtZW50X2JhbGFuY2UKCgpkZWYgZGVsYXlfaW5saW5lKHNlY29uZHM6IGludCk6CiAgICBmb3IgaSBpbiByYW5nZShzZWNvbmRzLCAwLCAtMSk6CiAgICAgICAgc3lzLnN0ZG91dC53cml0ZShmIlxy4o+zIFR1bmdndSB7aX0gZGV0aWsuLi4iKQogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIHByaW50KCJccuKPsyBTZWxlc2FpISAgICAgICAgICAgIikKCgpkZWYgcHVyY2hhc2VfYnlfZmFtaWx5KAogICAgZmFtaWx5X2NvZGU6IHN0ciwKICAgIHVzZV9kZWNveTogYm9vbCwKICAgIHBhdXNlX29uX3N1Y2Nlc3M6IGJvb2wgPSBUcnVlLAogICAgZGVsYXlfc2Vjb25kczogaW50ID0gMCwKICAgIHN0YXJ0X2Zyb21fb3B0aW9uOiBpbnQgPSAxLAopOgogICAgYWN0aXZlX3VzZXIgPSBBdXRoSW5zdGFuY2UuZ2V0X2FjdGl2ZV91c2VyKCkKICAgIHN1YnNjcmlwdGlvbl90eXBlID0gYWN0aXZlX3VzZXIuZ2V0KCJzdWJzY3JpcHRpb25fdHlwZSIsICIiKQogICAgCiAgICBhcGlfa2V5ID0gQXV0aEluc3RhbmNlLmFwaV9rZXkKICAgIHRva2VuczogZGljdCA9IEF1dGhJbnN0YW5jZS5nZXRfYWN0aXZlX3Rva2VucygpIG9yIHt9CiAgICAKICAgIGlmIHVzZV9kZWNveToKICAgICAgICAjIEJhbGFuY2Ugd2l0aCBEZWNveQogICAgICAgIGRlY295ID0gRGVjb3lJbnN0YW5jZS5nZXRfZGVjb3koImJhbGFuY2UiKQogICAgICAgIAogICAgICAgIGRlY295X3BhY2thZ2VfZGV0YWlsID0gZ2V0X3BhY2thZ2UoCiAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgZGVjb3lbIm9wdGlvbl9jb2RlIl0sCiAgICAgICAgKQogICAgICAgIAogICAgICAgIGlmIG5vdCBkZWNveV9wYWNrYWdlX2RldGFpbDoKICAgICAgICAgICAgcHJpbnQoIkZhaWxlZCB0byBsb2FkIGRlY295IHBhY2thZ2UgZGV0YWlscy4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIGJhbGFuY2VfdHJlc2hvbGQgPSBkZWNveV9wYWNrYWdlX2RldGFpbFsicGFja2FnZV9vcHRpb24iXVsicHJpY2UiXQogICAgICAgIHByaW50KGYiUGFzdGlrYW4gc2lzYSBiYWxhbmNlIEtVUkFORyBEQVJJIFJwe2JhbGFuY2VfdHJlc2hvbGR9ISEhIikKICAgICAgICBiYWxhbmNlX2Fuc3dlciA9IGlucHV0KCJBcGFrYWggYW5kYSB5YWtpbiBpbmdpbiBtZWxhbmp1dGthbiBwZW1iZWxpYW4/ICh5L24pOiAiKQogICAgICAgIGlmIGJhbGFuY2VfYW5zd2VyLmxvd2VyKCkgIT0gInkiOgogICAgICAgICAgICBwcmludCgiUGVtYmVsaWFuIGRpYmF0YWxrYW4gb2xlaCB1c2VyLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZmFtaWx5X2RhdGEgPSBnZXRfZmFtaWx5KGFwaV9rZXksIHRva2VucywgZmFtaWx5X2NvZGUpCiAgICBpZiBub3QgZmFtaWx5X2RhdGE6CiAgICAgICAgcHJpbnQoZiJGYWlsZWQgdG8gZ2V0IGZhbWlseSBkYXRhIGZvciBjb2RlOiB7ZmFtaWx5X2NvZGV9LiIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGZhbWlseV9uYW1lID0gZmFtaWx5X2RhdGFbInBhY2thZ2VfZmFtaWx5Il1bIm5hbWUiXQogICAgdmFyaWFudHMgPSBmYW1pbHlfZGF0YVsicGFja2FnZV92YXJpYW50cyJdCiAgICAKICAgIHByaW50KCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKICAgIHN1Y2Nlc3NmdWxfcHVyY2hhc2VzID0gW10KICAgIHBhY2thZ2VzX2NvdW50ID0gMAogICAgZm9yIHZhcmlhbnQgaW4gdmFyaWFudHM6CiAgICAgICAgcGFja2FnZXNfY291bnQgKz0gbGVuKHZhcmlhbnRbInBhY2thZ2Vfb3B0aW9ucyJdKQogICAgCiAgICBwdXJjaGFzZV9jb3VudCA9IDAKICAgIHN0YXJ0X2J1eWluZyA9IEZhbHNlCiAgICBpZiBzdGFydF9mcm9tX29wdGlvbiA8PSAxOgogICAgICAgIHN0YXJ0X2J1eWluZyA9IFRydWUKCiAgICBmb3IgdmFyaWFudCBpbiB2YXJpYW50czoKICAgICAgICB2YXJpYW50X25hbWUgPSB2YXJpYW50WyJuYW1lIl0KICAgICAgICBmb3Igb3B0aW9uIGluIHZhcmlhbnRbInBhY2thZ2Vfb3B0aW9ucyJdOgogICAgICAgICAgICB0b2tlbnMgPSBBdXRoSW5zdGFuY2UuZ2V0X2FjdGl2ZV90b2tlbnMoKQogICAgICAgICAgICBvcHRpb25fb3JkZXIgPSBvcHRpb25bIm9yZGVyIl0KICAgICAgICAgICAgaWYgbm90IHN0YXJ0X2J1eWluZyBhbmQgb3B0aW9uX29yZGVyID09IHN0YXJ0X2Zyb21fb3B0aW9uOgogICAgICAgICAgICAgICAgc3RhcnRfYnV5aW5nID0gVHJ1ZQogICAgICAgICAgICBpZiBub3Qgc3RhcnRfYnV5aW5nOgogICAgICAgICAgICAgICAgcHJpbnQoZiJTa2lwcGluZyBvcHRpb24ge29wdGlvbl9vcmRlcn0uIHtvcHRpb25bJ25hbWUnXX0iKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgIG9wdGlvbl9uYW1lID0gb3B0aW9uWyJuYW1lIl0KICAgICAgICAgICAgb3B0aW9uX3ByaWNlID0gb3B0aW9uWyJwcmljZSJdCiAgICAgICAgICAgIAogICAgICAgICAgICBwdXJjaGFzZV9jb3VudCArPSAxCiAgICAgICAgICAgIHByaW50KGYiUHVyY2hhc2Uge3B1cmNoYXNlX2NvdW50fSBvZiB7cGFja2FnZXNfY291bnR9Li4uIikKICAgICAgICAgICAgcHJpbnQoZiJUcnlpbmcgdG8gYnV5OiB7dmFyaWFudF9uYW1lfSAtIHtvcHRpb25fb3JkZXJ9LiB7b3B0aW9uX25hbWV9IC0ge29wdGlvblsncHJpY2UnXX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgcGF5bWVudF9pdGVtcyA9IFtdCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiB1c2VfZGVjb3k6ICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRlY295ID0gRGVjb3lJbnN0YW5jZS5nZXRfZGVjb3koImJhbGFuY2UiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRlY295X3BhY2thZ2VfZGV0YWlsID0gZ2V0X3BhY2thZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgZGVjb3lbIm9wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBkZWNveV9wYWNrYWdlX2RldGFpbDoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkZhaWxlZCB0byBsb2FkIGRlY295IHBhY2thZ2UgZGV0YWlscy4iKQogICAgICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0YXJnZXRfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZV9kZXRhaWxzKAogICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLAogICAgICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlLAogICAgICAgICAgICAgICAgICAgIHZhcmlhbnRbInBhY2thZ2VfdmFyaWFudF9jb2RlIl0sCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uWyJvcmRlciJdLAogICAgICAgICAgICAgICAgICAgIE5vbmUsCiAgICAgICAgICAgICAgICAgICAgTm9uZSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJFeGNlcHRpb24gb2NjdXJyZWQgd2hpbGUgZmV0Y2hpbmcgcGFja2FnZSBkZXRhaWxzOiB7ZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiJGYWlsZWQgdG8gZ2V0IHBhY2thZ2UgZGV0YWlscyBmb3Ige3ZhcmlhbnRfbmFtZX0gLSB7b3B0aW9uX25hbWV9LiBTa2lwcGluZy4iKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgCiAgICAgICAgICAgIHBheW1lbnRfaXRlbXMuYXBwZW5kKAogICAgICAgICAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICAgICAgaXRlbV9jb2RlPXRhcmdldF9wYWNrYWdlX2RldGFpbFsicGFja2FnZV9vcHRpb24iXVsicGFja2FnZV9vcHRpb25fY29kZSJdLAogICAgICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgICAgICBpdGVtX3ByaWNlPXRhcmdldF9wYWNrYWdlX2RldGFpbFsicGFja2FnZV9vcHRpb24iXVsicHJpY2UiXSwKICAgICAgICAgICAgICAgICAgICBpdGVtX25hbWU9c3RyKHJhbmRpbnQoMTAwMCwgOTk5OSkpICsgIiAiICsgdGFyZ2V0X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICAgICAgdGF4PTAsCiAgICAgICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPXRhcmdldF9wYWNrYWdlX2RldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHVzZV9kZWNveToKICAgICAgICAgICAgICAgIHBheW1lbnRfaXRlbXMuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIFBheW1lbnRJdGVtKAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtX2NvZGU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF90eXBlPSIiLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtX3ByaWNlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtX25hbWU9c3RyKHJhbmRpbnQoMTAwMCwgOTk5OSkpICsgIiAiICsgZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bIm5hbWUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgdGF4PTAsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbj1kZWNveV9wYWNrYWdlX2RldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0sCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudCA9IHRhcmdldF9wYWNrYWdlX2RldGFpbFsicGFja2FnZV9vcHRpb24iXVsicHJpY2UiXQogICAgICAgICAgICBpZiB1c2VfZGVjb3kgb3Igb3ZlcndyaXRlX2Ftb3VudCA9PSAwOgogICAgICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudCArPSBkZWNveV9wYWNrYWdlX2RldGFpbFsicGFja2FnZV9vcHRpb24iXVsicHJpY2UiXQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVycm9yX21zZyA9ICIiCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXMgPSBzZXR0bGVtZW50X2JhbGFuY2UoCiAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcywKICAgICAgICAgICAgICAgICAgICAi8J+kkSIsCiAgICAgICAgICAgICAgICAgICAgRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudD1vdmVyd3JpdGVfYW1vdW50LAogICAgICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9MQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzLmdldCgibWVzc2FnZSIsICIiKQogICAgICAgICAgICAgICAgICAgIGlmICJCaXp6LWVyci5BbW91bnQuVG90YWwiIGluIGVycm9yX21zZzoKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnX2FyciA9IGVycm9yX21zZy5zcGxpdCgiPSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkX2Ftb3VudCA9IGludChlcnJvcl9tc2dfYXJyWzFdLnN0cmlwKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIkFkanVzdGVkIHRvdGFsIGFtb3VudCB0bzoge3ZhbGlkX2Ftb3VudH0iKQogICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBzZXR0bGVtZW50X2JhbGFuY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTSEFSRV9QQUNLQUdFIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudD12YWxpZF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb25faWR4PS0xCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzIGFuZCByZXMuZ2V0KCJzdGF0dXMiLCAiIikgPT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdWxfcHVyY2hhc2VzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmInt2YXJpYW50X25hbWV9fHtvcHRpb25fb3JkZXJ9LiB7b3B0aW9uX25hbWV9IC0ge29wdGlvbl9wcmljZX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhdXNlX29uX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlB1cmNoYXNlIHN1Y2Nlc3NmdWwhIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJQdXJjaGFzZSBzdWNjZXNzZnVsISIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSByZXMuZ2V0KCJtZXNzYWdlIiwgIiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdWxfcHVyY2hhc2VzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgZiJ7dmFyaWFudF9uYW1lfXx7b3B0aW9uX29yZGVyfS4ge29wdGlvbl9uYW1lfSAtIHtvcHRpb25fcHJpY2V9IgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBpZiBwYXVzZV9vbl9zdWNjZXNzOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiUHVyY2hhc2Ugc3VjY2Vzc2Z1bCEiKQogICAgICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlB1cmNoYXNlIHN1Y2Nlc3NmdWwhIikKCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYiRXhjZXB0aW9uIG9jY3VycmVkIHdoaWxlIGNyZWF0aW5nIG9yZGVyOiB7ZX0iKQogICAgICAgICAgICAgICAgcmVzID0gTm9uZQogICAgICAgICAgICBwcmludCgiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIpCiAgICAgICAgICAgIHNob3VsZF9kZWxheSA9IGVycm9yX21zZyA9PSAiIiBvciAiRmFpbGVkIGNhbGwgaXBhYXMgcHVyY2hhc2UiIGluIGVycm9yX21zZwogICAgICAgICAgICBpZiBkZWxheV9zZWNvbmRzID4gMCBhbmQgc2hvdWxkX2RlbGF5OgogICAgICAgICAgICAgICAgcHJpbnQoZiJXYWl0aW5nIGZvciB7ZGVsYXlfc2Vjb25kc30gc2Vjb25kcyBiZWZvcmUgbmV4dCBwdXJjaGFzZS4uLiIpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGVsYXlfaW5saW5lKGRlbGF5X3NlY29uZHMpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoZGVsYXlfc2Vjb25kcykKICAgICAgICAgICAgICAgIAogICAgcHJpbnQoZiJGYW1pbHk6IHtmYW1pbHlfbmFtZX1cblN1Y2Nlc3NmdWw6IHtsZW4oc3VjY2Vzc2Z1bF9wdXJjaGFzZXMpfSIpCiAgICBpZiBsZW4oc3VjY2Vzc2Z1bF9wdXJjaGFzZXMpID4gMDoKICAgICAgICBwcmludCgiLSIgKiA1NSkKICAgICAgICBwcmludCgiU3VjY2Vzc2Z1bCBwdXJjaGFzZXM6IikKICAgICAgICBmb3IgcHVyY2hhc2UgaW4gc3VjY2Vzc2Z1bF9wdXJjaGFzZXM6CiAgICAgICAgICAgIHByaW50KGYiLSB7cHVyY2hhc2V9IikKICAgIHByaW50KCItIiAqIDU1KQogICAgcGF1c2UoKQogICAgcmV0dXJuIFRydWUKCgpkZWYgcHVyY2hhc2Vfbl90aW1lcygKICAgIG46IGludCwKICAgIGZhbWlseV9jb2RlOiBzdHIsCiAgICB2YXJpYW50X2NvZGU6IHN0ciwKICAgIG9wdGlvbl9vcmRlcjogaW50LAogICAgdXNlX2RlY295OiBib29sLAogICAgZGVsYXlfc2Vjb25kczogaW50ID0gMCwKICAgIHBhdXNlX29uX3N1Y2Nlc3M6IGJvb2wgPSBGYWxzZSwKICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg6IGludCA9IDAsCik6CiAgICBhY3RpdmVfdXNlciA9IEF1dGhJbnN0YW5jZS5nZXRfYWN0aXZlX3VzZXIoKQogICAgc3Vic2NyaXB0aW9uX3R5cGUgPSBhY3RpdmVfdXNlci5nZXQoInN1YnNjcmlwdGlvbl90eXBlIiwgIiIpCiAgICAKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zOiBkaWN0ID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkgb3Ige30KICAgIAogICAgaWYgdXNlX2RlY295OgogICAgICAgICMgQmFsYW5jZSB3aXRoIERlY295CiAgICAgICAgZGVjb3kgPSBEZWNveUluc3RhbmNlLmdldF9kZWNveSgiYmFsYW5jZSIpCiAgICAgICAgCiAgICAgICAgZGVjb3lfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZSgKICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgdG9rZW5zLAogICAgICAgICAgICBkZWNveVsib3B0aW9uX2NvZGUiXSwKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgbm90IGRlY295X3BhY2thZ2VfZGV0YWlsOgogICAgICAgICAgICBwcmludCgiRmFpbGVkIHRvIGxvYWQgZGVjb3kgcGFja2FnZSBkZXRhaWxzLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgYmFsYW5jZV90cmVzaG9sZCA9IGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCiAgICAgICAgcHJpbnQoZiJQYXN0aWthbiBzaXNhIGJhbGFuY2UgS1VSQU5HIERBUkkgUnB7YmFsYW5jZV90cmVzaG9sZH0hISEiKQogICAgICAgIGJhbGFuY2VfYW5zd2VyID0gaW5wdXQoIkFwYWthaCBhbmRhIHlha2luIGluZ2luIG1lbGFuanV0a2FuIHBlbWJlbGlhbj8gKHkvbik6ICIpCiAgICAgICAgaWYgYmFsYW5jZV9hbnN3ZXIubG93ZXIoKSAhPSAieSI6CiAgICAgICAgICAgIHByaW50KCJQZW1iZWxpYW4gZGliYXRhbGthbiBvbGVoIHVzZXIuIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBmYW1pbHlfZGF0YSA9IGdldF9mYW1pbHkoYXBpX2tleSwgdG9rZW5zLCBmYW1pbHlfY29kZSkKICAgIGlmIG5vdCBmYW1pbHlfZGF0YToKICAgICAgICBwcmludChmIkZhaWxlZCB0byBnZXQgZmFtaWx5IGRhdGEgZm9yIGNvZGU6IHtmYW1pbHlfY29kZX0uIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGZhbWlseV9uYW1lID0gZmFtaWx5X2RhdGFbInBhY2thZ2VfZmFtaWx5Il1bIm5hbWUiXQogICAgdmFyaWFudHMgPSBmYW1pbHlfZGF0YVsicGFja2FnZV92YXJpYW50cyJdCiAgICB0YXJnZXRfdmFyaWFudCA9IE5vbmUKICAgIGZvciB2YXJpYW50IGluIHZhcmlhbnRzOgogICAgICAgIGlmIHZhcmlhbnRbInBhY2thZ2VfdmFyaWFudF9jb2RlIl0gPT0gdmFyaWFudF9jb2RlOgogICAgICAgICAgICB0YXJnZXRfdmFyaWFudCA9IHZhcmlhbnQKICAgICAgICAgICAgYnJlYWsKICAgIGlmIG5vdCB0YXJnZXRfdmFyaWFudDoKICAgICAgICBwcmludChmIlZhcmlhbnQgY29kZSB7dmFyaWFudF9jb2RlfSBub3QgZm91bmQgaW4gZmFtaWx5IHtmYW1pbHlfbmFtZX0uIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHRhcmdldF9vcHRpb24gPSBOb25lCiAgICBmb3Igb3B0aW9uIGluIHRhcmdldF92YXJpYW50WyJwYWNrYWdlX29wdGlvbnMiXToKICAgICAgICBpZiBvcHRpb25bIm9yZGVyIl0gPT0gb3B0aW9uX29yZGVyOgogICAgICAgICAgICB0YXJnZXRfb3B0aW9uID0gb3B0aW9uCiAgICAgICAgICAgIGJyZWFrCiAgICBpZiBub3QgdGFyZ2V0X29wdGlvbjoKICAgICAgICBwcmludChmIk9wdGlvbiBvcmRlciB7b3B0aW9uX29yZGVyfSBub3QgZm91bmQgaW4gdmFyaWFudCB7dGFyZ2V0X3ZhcmlhbnRbJ25hbWUnXX0uIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIG9wdGlvbl9uYW1lID0gdGFyZ2V0X29wdGlvblsibmFtZSJdCiAgICBvcHRpb25fcHJpY2UgPSB0YXJnZXRfb3B0aW9uWyJwcmljZSJdCiAgICBwcmludCgiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIpCiAgICBzdWNjZXNzZnVsX3B1cmNoYXNlcyA9IFtdCiAgICAKICAgIGZvciBpIGluIHJhbmdlKG4pOgogICAgICAgIHByaW50KGYiUHVyY2hhc2Uge2kgKyAxfSBvZiB7bn0uLi4iKQogICAgICAgIHByaW50KGYiVHJ5aW5nIHRvIGJ1eToge3RhcmdldF92YXJpYW50WyduYW1lJ119IC0ge29wdGlvbl9vcmRlcn0uIHtvcHRpb25fbmFtZX0gLSB7b3B0aW9uX3ByaWNlfSIpCiAgICAgICAgCiAgICAgICAgYXBpX2tleSA9IEF1dGhJbnN0YW5jZS5hcGlfa2V5CiAgICAgICAgdG9rZW5zOiBkaWN0ID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkgb3Ige30KICAgICAgICAKICAgICAgICBwYXltZW50X2l0ZW1zID0gW10KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHVzZV9kZWNveToKICAgICAgICAgICAgICAgIGRlY295ID0gRGVjb3lJbnN0YW5jZS5nZXRfZGVjb3koImJhbGFuY2UiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBkZWNveV9wYWNrYWdlX2RldGFpbCA9IGdldF9wYWNrYWdlKAogICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLAogICAgICAgICAgICAgICAgICAgIGRlY295WyJvcHRpb25fY29kZSJdLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgZGVjb3lfcGFja2FnZV9kZXRhaWw6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkZhaWxlZCB0byBsb2FkIGRlY295IHBhY2thZ2UgZGV0YWlscy4iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIHRhcmdldF9wYWNrYWdlX2RldGFpbCA9IGdldF9wYWNrYWdlX2RldGFpbHMoCiAgICAgICAgICAgICAgICBhcGlfa2V5LAogICAgICAgICAgICAgICAgdG9rZW5zLAogICAgICAgICAgICAgICAgZmFtaWx5X2NvZGUsCiAgICAgICAgICAgICAgICB0YXJnZXRfdmFyaWFudFsicGFja2FnZV92YXJpYW50X2NvZGUiXSwKICAgICAgICAgICAgICAgIHRhcmdldF9vcHRpb25bIm9yZGVyIl0sCiAgICAgICAgICAgICAgICBOb25lLAogICAgICAgICAgICAgICAgTm9uZSwKICAgICAgICAgICAgKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJFeGNlcHRpb24gb2NjdXJyZWQgd2hpbGUgZmV0Y2hpbmcgcGFja2FnZSBkZXRhaWxzOiB7ZX0iKQogICAgICAgICAgICBwcmludChmIkZhaWxlZCB0byBnZXQgcGFja2FnZSBkZXRhaWxzIGZvciB7dGFyZ2V0X3ZhcmlhbnRbJ25hbWUnXX0gLSB7b3B0aW9uX25hbWV9LiBTa2lwcGluZy4iKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIAogICAgICAgIHBheW1lbnRfaXRlbXMuYXBwZW5kKAogICAgICAgICAgICBQYXltZW50SXRlbSgKICAgICAgICAgICAgICAgIGl0ZW1fY29kZT10YXJnZXRfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9dGFyZ2V0X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgaXRlbV9uYW1lPXN0cihyYW5kaW50KDEwMDAsIDk5OTkpKSArICIgIiArIHRhcmdldF9wYWNrYWdlX2RldGFpbFsicGFja2FnZV9vcHRpb24iXVsibmFtZSJdLAogICAgICAgICAgICAgICAgdGF4PTAsCiAgICAgICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb249dGFyZ2V0X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgKQogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiB1c2VfZGVjb3k6CiAgICAgICAgICAgIHBheW1lbnRfaXRlbXMuYXBwZW5kKAogICAgICAgICAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICAgICAgaXRlbV9jb2RlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF90eXBlPSIiLAogICAgICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInByaWNlIl0sCiAgICAgICAgICAgICAgICAgICAgaXRlbV9uYW1lPXN0cihyYW5kaW50KDEwMDAsIDk5OTkpKSArICIgIiArIGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICAgICAgdGF4PTAsCiAgICAgICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRlY295X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgIHJlcyA9IE5vbmUKICAgICAgICAKICAgICAgICBvdmVyd3JpdGVfYW1vdW50ID0gdGFyZ2V0X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCiAgICAgICAgaWYgdXNlX2RlY295OgogICAgICAgICAgICBvdmVyd3JpdGVfYW1vdW50ICs9IGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKAogICAgICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgIHBheW1lbnRfaXRlbXMsCiAgICAgICAgICAgICAgICAi8J+kqyIsCiAgICAgICAgICAgICAgICBGYWxzZSwKICAgICAgICAgICAgICAgIG92ZXJ3cml0ZV9hbW91bnQ9b3ZlcndyaXRlX2Ftb3VudCwKICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9dG9rZW5fY29uZmlybWF0aW9uX2lkeAogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSByZXMuZ2V0KCJtZXNzYWdlIiwgIlVua25vd24gZXJyb3IiKQogICAgICAgICAgICAgICAgaWYgIkJpenotZXJyLkFtb3VudC5Ub3RhbCIgaW4gZXJyb3JfbXNnOgogICAgICAgICAgICAgICAgICAgIGVycm9yX21zZ19hcnIgPSBlcnJvcl9tc2cuc3BsaXQoIj0iKQogICAgICAgICAgICAgICAgICAgIHZhbGlkX2Ftb3VudCA9IGludChlcnJvcl9tc2dfYXJyWzFdLnN0cmlwKCkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCB0b3RhbCBhbW91bnQgdG86IHt2YWxpZF9hbW91bnR9IikKICAgICAgICAgICAgICAgICAgICByZXMgPSBzZXR0bGVtZW50X2JhbGFuY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgIvCfpKsiLAogICAgICAgICAgICAgICAgICAgICAgICBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudD12YWxpZF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9dG9rZW5fY29uZmlybWF0aW9uX2lkeAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdWxfcHVyY2hhc2VzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYie3RhcmdldF92YXJpYW50WyduYW1lJ119fHtvcHRpb25fb3JkZXJ9LiB7b3B0aW9uX25hbWV9IC0ge29wdGlvbl9wcmljZX0iCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhdXNlX29uX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiUHVyY2hhc2Ugc3VjY2Vzc2Z1bCEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlB1cmNoYXNlIHN1Y2Nlc3NmdWwhIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdWxfcHVyY2hhc2VzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBmInt0YXJnZXRfdmFyaWFudFsnbmFtZSddfXx7b3B0aW9uX29yZGVyfS4ge29wdGlvbl9uYW1lfSAtIHtvcHRpb25fcHJpY2V9IgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgcGF1c2Vfb25fc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICBwcmludCgiUHVyY2hhc2Ugc3VjY2Vzc2Z1bCEiKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlB1cmNoYXNlIHN1Y2Nlc3NmdWwhIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiRXhjZXB0aW9uIG9jY3VycmVkIHdoaWxlIGNyZWF0aW5nIG9yZGVyOiB7ZX0iKQogICAgICAgICAgICByZXMgPSBOb25lCiAgICAgICAgcHJpbnQoIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0iKQoKICAgICAgICBpZiBkZWxheV9zZWNvbmRzID4gMCBhbmQgaSA8IG4gLSAxOgogICAgICAgICAgICBwcmludChmIldhaXRpbmcgZm9yIHtkZWxheV9zZWNvbmRzfSBzZWNvbmRzIGJlZm9yZSBuZXh0IHB1cmNoYXNlLi4uIikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVsYXlfaW5saW5lKGRlbGF5X3NlY29uZHMpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKGRlbGF5X3NlY29uZHMpCgogICAgcHJpbnQoZiJUb3RhbCBzdWNjZXNzZnVsIHB1cmNoYXNlcyB7bGVuKHN1Y2Nlc3NmdWxfcHVyY2hhc2VzKX0ve259IGZvcjpcbkZhbWlseToge2ZhbWlseV9uYW1lfVxuVmFyaWFudDoge3RhcmdldF92YXJpYW50WyduYW1lJ119XG5PcHRpb246IHtvcHRpb25fb3JkZXJ9LiB7b3B0aW9uX25hbWV9IC0ge29wdGlvbl9wcmljZX0iKQogICAgaWYgbGVuKHN1Y2Nlc3NmdWxfcHVyY2hhc2VzKSA+IDA6CiAgICAgICAgcHJpbnQoIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0iKQogICAgICAgIHByaW50KCJTdWNjZXNzZnVsIHB1cmNoYXNlczoiKQogICAgICAgIGZvciBpZHgsIHB1cmNoYXNlIGluIGVudW1lcmF0ZShzdWNjZXNzZnVsX3B1cmNoYXNlcyk6CiAgICAgICAgICAgIHByaW50KGYie2lkeCArIDF9LiB7cHVyY2hhc2V9IikKICAgIHByaW50KCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKICAgIHBhdXNlKCkKICAgIHJldHVybiBUcnVlCgpkZWYgcHVyY2hhc2Vfbl90aW1lc19ieV9vcHRpb25fY29kZSgKICAgIG46IGludCwKICAgIG9wdGlvbl9jb2RlOiBzdHIsCiAgICB1c2VfZGVjb3k6IGJvb2wsCiAgICBkZWxheV9zZWNvbmRzOiBpbnQgPSAwLAogICAgcGF1c2Vfb25fc3VjY2VzczogYm9vbCA9IEZhbHNlLAogICAgdG9rZW5fY29uZmlybWF0aW9uX2lkeDogaW50ID0gMCwKKToKICAgIGFjdGl2ZV91c2VyID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdXNlcigpCiAgICBzdWJzY3JpcHRpb25fdHlwZSA9IGFjdGl2ZV91c2VyLmdldCgic3Vic2NyaXB0aW9uX3R5cGUiLCAiIikKICAgIAogICAgYXBpX2tleSA9IEF1dGhJbnN0YW5jZS5hcGlfa2V5CiAgICB0b2tlbnM6IGRpY3QgPSBBdXRoSW5zdGFuY2UuZ2V0X2FjdGl2ZV90b2tlbnMoKSBvciB7fQogICAgCiAgICBpZiB1c2VfZGVjb3k6CiAgICAgICAgZGVjb3kgPSBEZWNveUluc3RhbmNlLmdldF9kZWNveSgiYmFsYW5jZSIpCiAgICAgICAgCiAgICAgICAgZGVjb3lfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZSgKICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgdG9rZW5zLAogICAgICAgICAgICBkZWNveVsib3B0aW9uX2NvZGUiXSwKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgbm90IGRlY295X3BhY2thZ2VfZGV0YWlsOgogICAgICAgICAgICBwcmludCgiRmFpbGVkIHRvIGxvYWQgZGVjb3kgcGFja2FnZSBkZXRhaWxzLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgYmFsYW5jZV90cmVzaG9sZCA9IGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCiAgICAgICAgcHJpbnQoZiJQYXN0aWthbiBzaXNhIGJhbGFuY2UgS1VSQU5HIERBUkkgUnB7YmFsYW5jZV90cmVzaG9sZH0hISEiKQogICAgICAgIGJhbGFuY2VfYW5zd2VyID0gaW5wdXQoIkFwYWthaCBhbmRhIHlha2luIGluZ2luIG1lbGFuanV0a2FuIHBlbWJlbGlhbj8gKHkvbik6ICIpCiAgICAgICAgaWYgYmFsYW5jZV9hbnN3ZXIubG93ZXIoKSAhPSAieSI6CiAgICAgICAgICAgIHByaW50KCJQZW1iZWxpYW4gZGliYXRhbGthbiBvbGVoIHVzZXIuIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBwcmludCgiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIpCiAgICBzdWNjZXNzZnVsX3B1cmNoYXNlcyA9IFtdCiAgICAKICAgIGZvciBpIGluIHJhbmdlKG4pOgogICAgICAgIHByaW50KGYiUHVyY2hhc2Uge2kgKyAxfSBvZiB7bn0uLi4iKQogICAgICAgIAogICAgICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgICAgIHRva2VuczogZGljdCA9IEF1dGhJbnN0YW5jZS5nZXRfYWN0aXZlX3Rva2VucygpIG9yIHt9CiAgICAgICAgCiAgICAgICAgcGF5bWVudF9pdGVtcyA9IFtdCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiB1c2VfZGVjb3k6CiAgICAgICAgICAgICAgICBkZWNveSA9IERlY295SW5zdGFuY2UuZ2V0X2RlY295KCJiYWxhbmNlIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZGVjb3lfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZSgKICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LAogICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICBkZWNveVsib3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGRlY295X3BhY2thZ2VfZGV0YWlsOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJGYWlsZWQgdG8gbG9hZCBkZWNveSBwYWNrYWdlIGRldGFpbHMuIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICB0YXJnZXRfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZSgKICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICBvcHRpb25fY29kZSwKICAgICAgICAgICAgKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJFeGNlcHRpb24gb2NjdXJyZWQgd2hpbGUgZmV0Y2hpbmcgcGFja2FnZSBkZXRhaWxzOiB7ZX0iKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIAogICAgICAgIHBheW1lbnRfaXRlbXMuYXBwZW5kKAogICAgICAgICAgICBQYXltZW50SXRlbSgKICAgICAgICAgICAgICAgIGl0ZW1fY29kZT10YXJnZXRfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9dGFyZ2V0X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgaXRlbV9uYW1lPXN0cihyYW5kaW50KDEwMDAsIDk5OTkpKSArICIgIiArIHRhcmdldF9wYWNrYWdlX2RldGFpbFsicGFja2FnZV9vcHRpb24iXVsibmFtZSJdLAogICAgICAgICAgICAgICAgdGF4PTAsCiAgICAgICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb249dGFyZ2V0X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgKQogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiB1c2VfZGVjb3k6CiAgICAgICAgICAgIHBheW1lbnRfaXRlbXMuYXBwZW5kKAogICAgICAgICAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICAgICAgaXRlbV9jb2RlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF90eXBlPSIiLAogICAgICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInByaWNlIl0sCiAgICAgICAgICAgICAgICAgICAgaXRlbV9uYW1lPXN0cihyYW5kaW50KDEwMDAsIDk5OTkpKSArICIgIiArIGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICAgICAgdGF4PTAsCiAgICAgICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRlY295X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgIHJlcyA9IE5vbmUKICAgICAgICAKICAgICAgICBvdmVyd3JpdGVfYW1vdW50ID0gdGFyZ2V0X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCiAgICAgICAgaWYgdXNlX2RlY295OgogICAgICAgICAgICBvdmVyd3JpdGVfYW1vdW50ICs9IGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKAogICAgICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgIHBheW1lbnRfaXRlbXMsCiAgICAgICAgICAgICAgICAi8J+kqyIsCiAgICAgICAgICAgICAgICBGYWxzZSwKICAgICAgICAgICAgICAgIG92ZXJ3cml0ZV9hbW91bnQ9b3ZlcndyaXRlX2Ftb3VudCwKICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9dG9rZW5fY29uZmlybWF0aW9uX2lkeAogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSByZXMuZ2V0KCJtZXNzYWdlIiwgIlVua25vd24gZXJyb3IiKQogICAgICAgICAgICAgICAgaWYgIkJpenotZXJyLkFtb3VudC5Ub3RhbCIgaW4gZXJyb3JfbXNnOgogICAgICAgICAgICAgICAgICAgIGVycm9yX21zZ19hcnIgPSBlcnJvcl9tc2cuc3BsaXQoIj0iKQogICAgICAgICAgICAgICAgICAgIHZhbGlkX2Ftb3VudCA9IGludChlcnJvcl9tc2dfYXJyWzFdLnN0cmlwKCkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJBZGp1c3RlZCB0b3RhbCBhbW91bnQgdG86IHt2YWxpZF9hbW91bnR9IikKICAgICAgICAgICAgICAgICAgICByZXMgPSBzZXR0bGVtZW50X2JhbGFuY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgIvCfpKsiLAogICAgICAgICAgICAgICAgICAgICAgICBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudD12YWxpZF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9dG9rZW5fY29uZmlybWF0aW9uX2lkeAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NmdWxfcHVyY2hhc2VzLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYiUHVyY2hhc2Uge2kgKyAxfSIKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGF1c2Vfb25fc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJQdXJjaGFzZSBzdWNjZXNzZnVsISIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiUHVyY2hhc2Ugc3VjY2Vzc2Z1bCEiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bF9wdXJjaGFzZXMuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIGYiUHVyY2hhc2Uge2kgKyAxfSIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHBhdXNlX29uX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlB1cmNoYXNlIHN1Y2Nlc3NmdWwhIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJQdXJjaGFzZSBzdWNjZXNzZnVsISIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIkV4Y2VwdGlvbiBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyBvcmRlcjoge2V9IikKICAgICAgICAgICAgcmVzID0gTm9uZQogICAgICAgIHByaW50KCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIikKCiAgICAgICAgaWYgZGVsYXlfc2Vjb25kcyA+IDAgYW5kIGkgPCBuIC0gMToKICAgICAgICAgICAgcHJpbnQoZiJXYWl0aW5nIGZvciB7ZGVsYXlfc2Vjb25kc30gc2Vjb25kcyBiZWZvcmUgbmV4dCBwdXJjaGFzZS4uLiIpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlbGF5X2lubGluZShkZWxheV9zZWNvbmRzKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcChkZWxheV9zZWNvbmRzKQoKICAgIHByaW50KGYiVG90YWwgc3VjY2Vzc2Z1bCBwdXJjaGFzZXMge2xlbihzdWNjZXNzZnVsX3B1cmNoYXNlcyl9L3tufSIpCiAgICBpZiBsZW4oc3VjY2Vzc2Z1bF9wdXJjaGFzZXMpID4gMDoKICAgICAgICBwcmludCgiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSIpCiAgICAgICAgcHJpbnQoIlN1Y2Nlc3NmdWwgcHVyY2hhc2VzOiIpCiAgICAgICAgZm9yIGlkeCwgcHVyY2hhc2UgaW4gZW51bWVyYXRlKHN1Y2Nlc3NmdWxfcHVyY2hhc2VzKToKICAgICAgICAgICAgcHJpbnQoZiJ7aWR4ICsgMX0uIHtwdXJjaGFzZX0iKQogICAgcHJpbnQoIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0iKQogICAgcGF1c2UoKQogICAgcmV0dXJuIFRydWUKICAgIAoK').decode())
