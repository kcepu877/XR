#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGpzb24KZnJvbSBhcHAubWVudXMucGFja2FnZSBpbXBvcnQgZ2V0X3BhY2thZ2VzX2J5X2ZhbWlseSwgc2hvd19wYWNrYWdlX2RldGFpbHMKZnJvbSBhcHAubWVudXMudXRpbCBpbXBvcnQgcGF1c2UsIGNsZWFyX3NjcmVlbiwgZm9ybWF0X3F1b3RhX2J5dGUKZnJvbSBhcHAuY2xpZW50LmNpcmNsZSBpbXBvcnQgKAogICAgZ2V0X2dyb3VwX2RhdGEsCiAgICBnZXRfZ3JvdXBfbWVtYmVycywKICAgIGNyZWF0ZV9jaXJjbGUsCiAgICB2YWxpZGF0ZV9jaXJjbGVfbWVtYmVyLAogICAgaW52aXRlX2NpcmNsZV9tZW1iZXIsCiAgICByZW1vdmVfY2lyY2xlX21lbWJlciwKICAgIGFjY2VwdF9jaXJjbGVfaW52aXRhdGlvbiwKICAgIHNwZW5kaW5nX3RyYWNrZXIsCiAgICBnZXRfYm9udXNfZGF0YSwKKQpmcm9tIGFwcC5zZXJ2aWNlLmF1dGggaW1wb3J0IEF1dGhJbnN0YW5jZQpmcm9tIGFwcC5jbGllbnQuZW5jcnlwdCBpbXBvcnQgZGVjcnlwdF9jaXJjbGVfbXNpc2RuCgpXSURUSCA9IDU1CgoKZGVmIHByaW50X2hlYWRlcih0aXRsZTogc3RyKToKICAgIHByaW50KCI9IiAqIFdJRFRIKQogICAgcHJpbnQodGl0bGUuY2VudGVyKFdJRFRIKSkKICAgIHByaW50KCItIiAqIFdJRFRIKQoKCmRlZiBzaG93X2NpcmNsZV9jcmVhdGlvbihhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCk6CiAgICBjbGVhcl9zY3JlZW4oKQogICAgcHJpbnRfaGVhZGVyKCJCdWF0IENpcmNsZSBCYXJ1IikKICAgIHBhcmVudF9uYW1lID0gaW5wdXQoIk1hc3Vra2FuIG5hbWEgQW5kYSAoUGFyZW50KTogIikKICAgIGdyb3VwX25hbWUgPSBpbnB1dCgiTWFzdWtrYW4gbmFtYSBDaXJjbGU6ICIpCiAgICBtZW1iZXJfbXNpc2RuID0gaW5wdXQoIk1hc3Vra2FuIE1TSVNETiBtZW1iZXIgYXdhbCAoNjI4eHh4eCk6ICIpCiAgICBtZW1iZXJfbmFtZSA9IGlucHV0KCJNYXN1a2thbiBuYW1hIG1lbWJlciBhd2FsOiAiKQoKICAgIGNyZWF0ZV9yZXMgPSBjcmVhdGVfY2lyY2xlKGFwaV9rZXksIHRva2VucywgcGFyZW50X25hbWUsIGdyb3VwX25hbWUsIG1lbWJlcl9tc2lzZG4sIG1lbWJlcl9uYW1lKQoKICAgIHByaW50KCJSZXNwb24gc2VydmVyOiIpCiAgICBwcmludChqc29uLmR1bXBzKGNyZWF0ZV9yZXMsIGluZGVudD0yKSkKICAgIHBhdXNlKCkKCgpkZWYgc2hvd19ib251c19saXN0KGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBwYXJlbnRfc3Vic19pZDogc3RyLCBmYW1pbHlfaWQ6IHN0cik6CiAgICBpbl9jaXJjbGVfYm9udXNfbWVudSA9IFRydWUKICAgIHdoaWxlIGluX2NpcmNsZV9ib251c19tZW51OgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgcHJpbnQoIlNlZGFuZyBtZW5nYW1iaWwgZGF0YSBib251cy4uLiIpCiAgICAgICAgYm9udXNfZGF0YSA9IGdldF9ib251c19kYXRhKGFwaV9rZXksIHRva2VucywgcGFyZW50X3N1YnNfaWQsIGZhbWlseV9pZCkKCiAgICAgICAgaWYgYm9udXNfZGF0YS5nZXQoInN0YXR1cyIpICE9ICJTVUNDRVNTIjoKICAgICAgICAgICAgcHJpbnQoIkdhZ2FsIG1lbmdhbWJpbCBkYXRhIGJvbnVzLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGJvbnVzX2xpc3QgPSBib251c19kYXRhLmdldCgiZGF0YSIsIHt9KS5nZXQoImJvbnVzZXMiLCBbXSkKICAgICAgICBpZiBub3QgYm9udXNfbGlzdDoKICAgICAgICAgICAgcHJpbnQoIlRpZGFrIGFkYSBib251cyB0ZXJzZWRpYS4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBwcmludF9oZWFkZXIoIkRhZnRhciBCb251cyBDaXJjbGUiKQogICAgICAgIGZvciBpZHgsIGJvbnVzIGluIGVudW1lcmF0ZShib251c19saXN0LCBzdGFydD0xKToKICAgICAgICAgICAgYm9udXNfbmFtZSA9IGJvbnVzLmdldCgibmFtZSIsICJOL0EiKQogICAgICAgICAgICBib251c190eXBlID0gYm9udXMuZ2V0KCJib251c190eXBlIiwgIk4vQSIpCiAgICAgICAgICAgIGFjdGlvbl90eXBlID0gYm9udXMuZ2V0KCJhY3Rpb25fdHlwZSIsICJOL0EiKQogICAgICAgICAgICBhY3Rpb25fcGFyYW0gPSBib251cy5nZXQoImFjdGlvbl9wYXJhbSIsICJOL0EiKQogICAgICAgICAgICBwcmludChmIntpZHh9LiB7Ym9udXNfbmFtZX0gfCBUeXBlOiB7Ym9udXNfdHlwZX0iKQogICAgICAgICAgICBwcmludChmIiAgIEFjdGlvbjoge2FjdGlvbl90eXBlfSB8IFBhcmFtOiB7YWN0aW9uX3BhcmFtfSIpCgogICAgICAgIHByaW50KCItIiAqIFdJRFRIKQogICAgICAgIHByaW50KCJPcHNpOiIpCiAgICAgICAgcHJpbnQoIjAwLiBLZW1iYWxpIGtlIG1lbnUgdXRhbWEiKQogICAgICAgIGNob2ljZSA9IGlucHV0KCJQaWxpaCBib251czogIikuc3RyaXAoKQoKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgaW5fY2lyY2xlX2JvbnVzX21lbnUgPSBGYWxzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGJvbnVzX251bWJlciA9IGludChjaG9pY2UpCiAgICAgICAgICAgICAgICBpZiBub3QgKDEgPD0gYm9udXNfbnVtYmVyIDw9IGxlbihib251c19saXN0KSk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIk5vbW9yIGJvbnVzIHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgc2VsZWN0ZWRfYm9udXMgPSBib251c19saXN0W2JvbnVzX251bWJlciAtIDFdCiAgICAgICAgICAgICAgICBhY3Rpb25fdHlwZSA9IHNlbGVjdGVkX2JvbnVzLmdldCgiYWN0aW9uX3R5cGUiLCAiTi9BIikKICAgICAgICAgICAgICAgIGFjdGlvbl9wYXJhbSA9IHNlbGVjdGVkX2JvbnVzLmdldCgiYWN0aW9uX3BhcmFtIiwgIk4vQSIpCgogICAgICAgICAgICAgICAgaWYgYWN0aW9uX3R5cGUgPT0gIlBMUCI6CiAgICAgICAgICAgICAgICAgICAgZ2V0X3BhY2thZ2VzX2J5X2ZhbWlseShhY3Rpb25fcGFyYW0pCiAgICAgICAgICAgICAgICBlbGlmIGFjdGlvbl90eXBlID09ICJQRFAiOgogICAgICAgICAgICAgICAgICAgIHNob3dfcGFja2FnZV9kZXRhaWxzKGFwaV9rZXksIHRva2VucywgYWN0aW9uX3BhcmFtLCBGYWxzZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkFjdGlvbiB0eXBlIGJlbHVtIGRpdGFuZ2FuaS4iKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiQWN0aW9uOiB7YWN0aW9uX3R5cGV9IHwgUGFyYW06IHthY3Rpb25fcGFyYW19IikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoIklucHV0IHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCgoKZGVmIHNob3dfY2lyY2xlX2luZm8oYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QpOgogICAgaW5fY2lyY2xlX21lbnUgPSBUcnVlCiAgICB1c2VyOiBkaWN0ID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdXNlcigpCiAgICBteV9tc2lzZG4gPSB1c2VyLmdldCgibnVtYmVyIiwgIiIpCgogICAgd2hpbGUgaW5fY2lyY2xlX21lbnU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBncm91cF9yZXMgPSBnZXRfZ3JvdXBfZGF0YShhcGlfa2V5LCB0b2tlbnMpCiAgICAgICAgaWYgZ3JvdXBfcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgICAgICBwcmludCgiR2FnYWwgbWVuZ2FtYmlsIGRhdGEgQ2lyY2xlLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGdyb3VwX2RhdGEgPSBncm91cF9yZXMuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgZ3JvdXBfaWQgPSBncm91cF9kYXRhLmdldCgiZ3JvdXBfaWQiLCAiIikKCiAgICAgICAgaWYgZ3JvdXBfaWQgPT0gIiI6CiAgICAgICAgICAgIHByaW50KCJBbmRhIGJlbHVtIGJlcmdhYnVuZyBkZW5nYW4gQ2lyY2xlLiIpCiAgICAgICAgICAgIGNyZWF0ZV9uZXcgPSBpbnB1dCgiSW5naW4gbWVtYnVhdCBDaXJjbGUgYmFydT8gKHkvbik6ICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICBpZiBjcmVhdGVfbmV3ID09ICJ5IjoKICAgICAgICAgICAgICAgIHNob3dfY2lyY2xlX2NyZWF0aW9uKGFwaV9rZXksIHRva2VucykKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYgZ3JvdXBfZGF0YS5nZXQoImdyb3VwX3N0YXR1cyIsICJOL0EiKSA9PSAiQkxPQ0tFRCI6CiAgICAgICAgICAgIHByaW50KCJDaXJjbGUgaW5pIHNlZGFuZyBkaWJsb2tpci4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBncm91cF9uYW1lID0gZ3JvdXBfZGF0YS5nZXQoImdyb3VwX25hbWUiLCAiTi9BIikKICAgICAgICBvd25lcl9uYW1lID0gZ3JvdXBfZGF0YS5nZXQoIm93bmVyX25hbWUiLCAiTi9BIikKCiAgICAgICAgbWVtYmVyc19yZXMgPSBnZXRfZ3JvdXBfbWVtYmVycyhhcGlfa2V5LCB0b2tlbnMsIGdyb3VwX2lkKQogICAgICAgIGlmIG1lbWJlcnNfcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgICAgICBwcmludCgiR2FnYWwgbWVuZ2FtYmlsIGRhdGEgbWVtYmVyIENpcmNsZS4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBtZW1iZXJzID0gbWVtYmVyc19yZXMuZ2V0KCJkYXRhIiwge30pLmdldCgibWVtYmVycyIsIFtdKQogICAgICAgIGlmIG5vdCBtZW1iZXJzOgogICAgICAgICAgICBwcmludCgiQ2lyY2xlIGluaSBiZWx1bSBtZW1pbGlraSBtZW1iZXIuIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgcGFyZW50X21lbWJlcl9pZCwgcGFyZW50X3N1YnNfaWQsIHBhcnJlbnRfbXNpc2RuID0gIiIsICIiLCAiIgogICAgICAgIGZvciBtZW1iZXIgaW4gbWVtYmVyczoKICAgICAgICAgICAgaWYgbWVtYmVyLmdldCgibWVtYmVyX3JvbGUiKSA9PSAiUEFSRU5UIjoKICAgICAgICAgICAgICAgIHBhcmVudF9tZW1iZXJfaWQgPSBtZW1iZXIuZ2V0KCJtZW1iZXJfaWQiLCAiIikKICAgICAgICAgICAgICAgIHBhcmVudF9zdWJzX2lkID0gbWVtYmVyLmdldCgic3Vic2NyaWJlcl9udW1iZXIiLCAiIikKICAgICAgICAgICAgICAgIHBhcnJlbnRfbXNpc2RuID0gZGVjcnlwdF9jaXJjbGVfbXNpc2RuKGFwaV9rZXksIG1lbWJlci5nZXQoIm1zaXNkbiIsICIiKSkKCiAgICAgICAgcGFja2FnZSA9IG1lbWJlcnNfcmVzLmdldCgiZGF0YSIsIHt9KS5nZXQoInBhY2thZ2UiLCB7fSkKICAgICAgICBwYWNrYWdlX25hbWUgPSBwYWNrYWdlLmdldCgibmFtZSIsICJOL0EiKQogICAgICAgIGJlbmVmaXQgPSBwYWNrYWdlLmdldCgiYmVuZWZpdCIsIHt9KQogICAgICAgIGZvcm1hdHRlZF9hbGxvY2F0aW9uID0gZm9ybWF0X3F1b3RhX2J5dGUoYmVuZWZpdC5nZXQoImFsbG9jYXRpb24iLCAwKSkKICAgICAgICBmb3JtYXR0ZWRfcmVtYWluaW5nID0gZm9ybWF0X3F1b3RhX2J5dGUoYmVuZWZpdC5nZXQoInJlbWFpbmluZyIsIDApKQoKICAgICAgICBzcGVuZGluZ19yZXMgPSBzcGVuZGluZ190cmFja2VyKGFwaV9rZXksIHRva2VucywgcGFyZW50X3N1YnNfaWQsIGdyb3VwX2lkKQogICAgICAgIGlmIHNwZW5kaW5nX3Jlcy5nZXQoInN0YXR1cyIpICE9ICJTVUNDRVNTIjoKICAgICAgICAgICAgcHJpbnQoIkdhZ2FsIG1lbmdhbWJpbCBkYXRhIHNwZW5kaW5nIHRyYWNrZXIuIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgc3BlbmRpbmdfZGF0YSA9IHNwZW5kaW5nX3Jlcy5nZXQoImRhdGEiLCB7fSkKICAgICAgICBzcGVuZCA9IHNwZW5kaW5nX2RhdGEuZ2V0KCJzcGVuZCIsIDApCiAgICAgICAgdGFyZ2V0ID0gc3BlbmRpbmdfZGF0YS5nZXQoInRhcmdldCIsIDApCgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgcHJpbnRfaGVhZGVyKGYiQ2lyY2xlOiB7Z3JvdXBfbmFtZX0iKQogICAgICAgIHByaW50KGYiT3duZXI6IHtvd25lcl9uYW1lfSB7cGFycmVudF9tc2lzZG59Ii5jZW50ZXIoV0lEVEgpKQogICAgICAgIHByaW50KCItIiAqIFdJRFRIKQogICAgICAgIHByaW50KGYiUGFja2FnZToge3BhY2thZ2VfbmFtZX0gfCB7Zm9ybWF0dGVkX3JlbWFpbmluZ30gLyB7Zm9ybWF0dGVkX2FsbG9jYXRpb259Ii5jZW50ZXIoV0lEVEgpKQogICAgICAgIHByaW50KGYiU3BlbmRpbmc6IFJwe3NwZW5kOix9IC8gUnB7dGFyZ2V0Oix9Ii5jZW50ZXIoV0lEVEgpKQogICAgICAgIHByaW50KCI9IiAqIFdJRFRIKQoKICAgICAgICBwcmludCgiTWVtYmVyczoiKQogICAgICAgIGZvciBpZHgsIG1lbWJlciBpbiBlbnVtZXJhdGUobWVtYmVycywgc3RhcnQ9MSk6CiAgICAgICAgICAgIG1zaXNkbiA9IGRlY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtZW1iZXIuZ2V0KCJtc2lzZG4iLCAiIikpIG9yICI8Tm8gTnVtYmVyPiIKICAgICAgICAgICAgbWVfbWFyayA9ICIoQW5kYSkiIGlmIHN0cihtc2lzZG4pID09IHN0cihteV9tc2lzZG4pIGVsc2UgIiIKICAgICAgICAgICAgbWVtYmVyX3R5cGUgPSAiUGFyZW50IiBpZiBtZW1iZXIuZ2V0KCJtZW1iZXJfcm9sZSIpID09ICJQQVJFTlQiIGVsc2UgIk1lbWJlciIKICAgICAgICAgICAgam9pbl9kYXRlID0gZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcChtZW1iZXIuZ2V0KCJqb2luX2RhdGUiLCAwKSkuc3RyZnRpbWUoIiVZLSVtLSVkIikKICAgICAgICAgICAgYWxsb2MgPSBmb3JtYXRfcXVvdGFfYnl0ZShtZW1iZXIuZ2V0KCJhbGxvY2F0aW9uIiwgMCkpCiAgICAgICAgICAgIHVzZWQgPSBmb3JtYXRfcXVvdGFfYnl0ZShtZW1iZXIuZ2V0KCJhbGxvY2F0aW9uIiwgMCkgLSBtZW1iZXIuZ2V0KCJyZW1haW5pbmciLCAwKSkKCiAgICAgICAgICAgIHByaW50KGYie2lkeH0uIHttc2lzZG59ICh7bWVtYmVyLmdldCgnbWVtYmVyX25hbWUnLCAnTi9BJyl9KSB8IHttZW1iZXJfdHlwZX0ge21lX21hcmt9IikKICAgICAgICAgICAgcHJpbnQoZiIgICBKb2luZWQ6IHtqb2luX2RhdGV9IHwgU2xvdDoge21lbWJlci5nZXQoJ3Nsb3RfdHlwZScsICdOL0EnKX0gfCBTdGF0dXM6IHttZW1iZXIuZ2V0KCdzdGF0dXMnLCAnTi9BJyl9IikKICAgICAgICAgICAgcHJpbnQoZiIgICBVc2FnZToge3VzZWR9IC8ge2FsbG9jfSIpCiAgICAgICAgICAgIHByaW50KCItIiAqIFdJRFRIKQoKICAgICAgICBwcmludCgiT3BzaToiKQogICAgICAgIHByaW50KCIgWzEuXSBJbnZpdGUgTWVtYmVyIikKICAgICAgICBwcmludCgiIGRlbCA8bnVtYmVyPiAtIEhhcHVzIE1lbWJlciIpCiAgICAgICAgcHJpbnQoIiBhY2MgPG51bWJlcj4gLSBBY2NlcHQgSW52aXRhdGlvbiIpCiAgICAgICAgcHJpbnQoIiBbMi5dTGloYXQgQm9udXMiKQogICAgICAgIHByaW50KCJbMDAuXUtlbWJhbGkga2UgbWVudSB1dGFtYSIpCiAgICAgICAgcHJpbnQoIi0iICogV0lEVEgpCiAgICAgICAgY2hvaWNlID0gaW5wdXQoIlBpbGloIG9wc2k6ICIpLnN0cmlwKCkKCiAgICAgICAgaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgICAgIGluX2NpcmNsZV9tZW51ID0gRmFsc2UKCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICAgICBtc2lzZG5fdG9faW52aXRlID0gaW5wdXQoIk1hc3Vra2FuIE1TSVNETiBtZW1iZXIgKDYyOHh4eHgpOiAiKS5zdHJpcCgpCgogICAgICAgICAgICBpZiBub3QgbXNpc2RuX3RvX2ludml0ZS5zdGFydHN3aXRoKCI2MjgiKSBvciBub3QgbXNpc2RuX3RvX2ludml0ZS5pc2RpZ2l0KCkgb3IgbGVuKG1zaXNkbl90b19pbnZpdGUpIDwgMTAgb3IgbGVuKG1zaXNkbl90b19pbnZpdGUpID4gMTQ6CiAgICAgICAgICAgICAgICBwcmludCgiTm9tb3IgdGlkYWsgdmFsaWQuIFBhc3Rpa2FuIGRpYXdhbGkgJzYyOCcgZGFuIHBhbmphbmdueWEgc2VzdWFpLiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgdmFsaWRhdGVfcmVzID0gdmFsaWRhdGVfY2lyY2xlX21lbWJlcihhcGlfa2V5LCB0b2tlbnMsIG1zaXNkbl90b19pbnZpdGUpCiAgICAgICAgICAgIGlmIHZhbGlkYXRlX3Jlcy5nZXQoInN0YXR1cyIpID09ICJTVUNDRVNTIjoKICAgICAgICAgICAgICAgIGlmIHZhbGlkYXRlX3Jlcy5nZXQoImRhdGEiLCB7fSkuZ2V0KCJyZXNwb25zZV9jb2RlIiwgIiIpICE9ICIyMDAtMjAwMSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJUaWRhayBiaXNhIG1lbmd1bmRhbmcge21zaXNkbl90b19pbnZpdGV9OiB7dmFsaWRhdGVfcmVzLmdldCgnZGF0YScsIHt9KS5nZXQoJ21lc3NhZ2UnLCAnVW5rbm93biBlcnJvcicpfSIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiR2FnYWwgdmFsaWRhc2kgbWVtYmVyLiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgbWVtYmVyX25hbWUgPSBpbnB1dCgiTWFzdWtrYW4gbmFtYSBtZW1iZXI6ICIpLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IG1lbWJlcl9uYW1lOgogICAgICAgICAgICAgICAgcHJpbnQoIk5hbWEgbWVtYmVyIHRpZGFrIGJvbGVoIGtvc29uZy4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGludml0ZV9yZXMgPSBpbnZpdGVfY2lyY2xlX21lbWJlcigKICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICBtc2lzZG5fdG9faW52aXRlLAogICAgICAgICAgICAgICAgbWVtYmVyX25hbWUsCiAgICAgICAgICAgICAgICBncm91cF9pZCwKICAgICAgICAgICAgICAgIHBhcmVudF9tZW1iZXJfaWQKICAgICAgICAgICAgKQoKICAgICAgICAgICAgaWYgaW52aXRlX3Jlcy5nZXQoInN0YXR1cyIpID09ICJTVUNDRVNTIjoKICAgICAgICAgICAgICAgIGlmIGludml0ZV9yZXMuZ2V0KCJkYXRhIiwge30pLmdldCgicmVzcG9uc2VfY29kZSIsICIiKSA9PSAiMjAwLTAwIjoKICAgICAgICAgICAgICAgICAgICBwcmludChmIlVuZGFuZ2FuIHVudHVrIHttc2lzZG5fdG9faW52aXRlfSBiZXJoYXNpbCBkaWtpcmltLiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiVW5kYW5nYW4gZ2FnYWw6IHtpbnZpdGVfcmVzLmdldCgnZGF0YScsIHt9KS5nZXQoJ21lc3NhZ2UnLCAnVW5rbm93biBlcnJvcicpfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiVGVyamFkaSBrZXNhbGFoYW4gc2FhdCBtZW5naXJpbSB1bmRhbmdhbi4iKQogICAgICAgICAgICAgICAgcHJpbnQoanNvbi5kdW1wcyhpbnZpdGVfcmVzLCBpbmRlbnQ9MikpCgogICAgICAgICAgICBwYXVzZSgpCgogICAgICAgIGVsaWYgY2hvaWNlLnN0YXJ0c3dpdGgoImRlbCAiKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbWVtYmVyX251bWJlciA9IGludChjaG9pY2Uuc3BsaXQoIiAiKVsxXSkKICAgICAgICAgICAgICAgIGlmIG5vdCAoMSA8PSBtZW1iZXJfbnVtYmVyIDw9IGxlbihtZW1iZXJzKSk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIk5vbW9yIG1lbWJlciB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgIG1lbWJlcl90b19yZW1vdmUgPSBtZW1iZXJzW21lbWJlcl9udW1iZXIgLSAxXQoKICAgICAgICAgICAgICAgIGlmIG1lbWJlcl90b19yZW1vdmUuZ2V0KCJtZW1iZXJfcm9sZSIpID09ICJQQVJFTlQiOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJUaWRhayBiaXNhIG1lbmdoYXB1cyBwYXJlbnQuIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBpc19sYXN0X21lbWJlciA9IGxlbihtZW1iZXJzKSA9PSAyCiAgICAgICAgICAgICAgICBpZiBpc19sYXN0X21lbWJlcjoKICAgICAgICAgICAgICAgICAgICBwcmludCgiVGlkYWsgYmlzYSBtZW5naGFwdXMgbWVtYmVyIHRlcmFraGlyLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgbXNpc2RuX3RvX3JlbW92ZSA9IGRlY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtZW1iZXJfdG9fcmVtb3ZlLmdldCgibXNpc2RuIiwgIiIpKQogICAgICAgICAgICAgICAgY29uZmlybSA9IGlucHV0KGYiWWFraW4gaW5naW4gbWVuZ2hhcHVzIHttc2lzZG5fdG9fcmVtb3ZlfSBkYXJpIENpcmNsZT8gKHkvbik6ICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICAgICAgaWYgY29uZmlybSAhPSAieSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlBlbmdoYXB1c2FuIGRpYmF0YWxrYW4uIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICByZW1vdmVfcmVzID0gcmVtb3ZlX2NpcmNsZV9tZW1iZXIoCiAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgbWVtYmVyX3RvX3JlbW92ZS5nZXQoIm1lbWJlcl9pZCIsICIiKSwKICAgICAgICAgICAgICAgICAgICBncm91cF9pZCwKICAgICAgICAgICAgICAgICAgICBwYXJlbnRfbWVtYmVyX2lkLAogICAgICAgICAgICAgICAgICAgIGlzX2xhc3RfbWVtYmVyCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiByZW1vdmVfcmVzLmdldCgic3RhdHVzIikgPT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYie21zaXNkbl90b19yZW1vdmV9IGJlcmhhc2lsIGRpaGFwdXMgZGFyaSBDaXJjbGUuIikKICAgICAgICAgICAgICAgICAgICBwcmludChqc29uLmR1bXBzKHJlbW92ZV9yZXMsIGluZGVudD0yKSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJUZXJqYWRpIGtlc2FsYWhhbjoge3JlbW92ZV9yZXN9IikKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludCgiRm9ybWF0IGlucHV0IGhhcHVzIHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgIHBhdXNlKCkKCiAgICAgICAgZWxpZiBjaG9pY2Uuc3RhcnRzd2l0aCgiYWNjICIpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBtZW1iZXJfbnVtYmVyID0gaW50KGNob2ljZS5zcGxpdCgiICIpWzFdKQogICAgICAgICAgICAgICAgaWYgbm90ICgxIDw9IG1lbWJlcl9udW1iZXIgPD0gbGVuKG1lbWJlcnMpKToKICAgICAgICAgICAgICAgICAgICBwcmludCgiTm9tb3IgbWVtYmVyIHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgbWVtYmVyX3RvX2FjY2VwdCA9IG1lbWJlcnNbbWVtYmVyX251bWJlciAtIDFdCiAgICAgICAgICAgICAgICBpZiBtZW1iZXJfdG9fYWNjZXB0LmdldCgic3RhdHVzIikgIT0gIklOVklURUQiOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJNZW1iZXIgaW5pIHRpZGFrIGRhbGFtIHN0YXR1cyBpbnZpdGVkLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgbXNpc2RuX3RvX2FjY2VwdCA9IGRlY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtZW1iZXJfdG9fYWNjZXB0LmdldCgibXNpc2RuIiwgIiIpKQogICAgICAgICAgICAgICAgY29uZmlybSA9IGlucHV0KGYiVGVyaW1hIHVuZGFuZ2FuIHVudHVrIHttc2lzZG5fdG9fYWNjZXB0fT8gKHkvbik6ICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICAgICAgaWYgY29uZmlybSAhPSAieSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlBlbmVyaW1hYW4gdW5kYW5nYW4gZGliYXRhbGthbi4iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgIGFjY2VwdF9yZXMgPSBhY2NlcHRfY2lyY2xlX2ludml0YXRpb24oYXBpX2tleSwgdG9rZW5zLCBncm91cF9pZCwgbWVtYmVyX3RvX2FjY2VwdC5nZXQoIm1lbWJlcl9pZCIsICIiKSkKICAgICAgICAgICAgICAgIGlmIGFjY2VwdF9yZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJVbmRhbmdhbiB1bnR1ayB7bXNpc2RuX3RvX2FjY2VwdH0gYmVyaGFzaWwgZGl0ZXJpbWEuIikKICAgICAgICAgICAgICAgICAgICBwcmludChqc29uLmR1bXBzKGFjY2VwdF9yZXMsIGluZGVudD0yKSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJUZXJqYWRpIGtlc2FsYWhhbjoge2FjY2VwdF9yZXN9IikKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludCgiRm9ybWF0IGlucHV0IGFjY2VwdCB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICBwYXVzZSgpCgogICAgICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAgICAgc2hvd19ib251c19saXN0KGFwaV9rZXksIHRva2VucywgcGFyZW50X3N1YnNfaWQsIGdyb3VwX2lkKQo=').decode())
