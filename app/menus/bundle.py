#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBhcHAuY29uZmlnLmltcG9ydHMgaW1wb3J0ICoKZnJvbSBhcHAuY2xpZW50LnB1cmNoYXNlLmJhbGFuY2UgaW1wb3J0IHNldHRsZW1lbnRfYmFsYW5jZQpmcm9tIGFwcC5jbGllbnQucHVyY2hhc2UucXJpcyBpbXBvcnQgc2hvd19xcmlzX3BheW1lbnQKZnJvbSBhcHAuY2xpZW50LnB1cmNoYXNlLmV3YWxsZXQgaW1wb3J0IHNob3dfbXVsdGlwYXltZW50CmZyb20gYXBwLm1lbnVzLnV0aWwgaW1wb3J0IGNsZWFyX3NjcmVlbiwgcGF1c2UsIHByaW50X3BhbmVsLCBnZXRfcnVwaWFoLCBzaW1wbGVfbnVtYmVyCmZyb20gYXBwLm1lbnVzLnBhY2thZ2UgaW1wb3J0IGdldF9wYWNrYWdlc19ieV9mYW1pbHkKZnJvbSBhcHAubWVudXMuZmFtaWx5X2dydXAgaW1wb3J0IHNob3dfZmFtaWx5X2dydXBfbWVudQpmcm9tIGFwcC5tZW51cy5ib29rbWFyayBpbXBvcnQgc2hvd19ib29rbWFya19tZW51Cgpjb25zb2xlID0gQ29uc29sZSgpCgoKZGVmIHNob3dfYnVuZGxlX21lbnUoKToKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKCiAgICBjYXJ0X2l0ZW1zID0gW10KICAgIGRpc3BsYXlfY2FydCA9IFtdCiAgICB0b3RhbF9wcmljZSA9IDAKCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZW5zdXJlX2dpdCgpCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKCLwn5uSIEtlcmFuamFuZyBQYWtldCIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQogICAgICAgIHNpbXBsZV9udW1iZXIoKQoKICAgICAgICBpZiBjYXJ0X2l0ZW1zOgogICAgICAgICAgICB0YWJsZSA9IFRhYmxlKGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTm8iLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD00KQogICAgICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJOYW1hIFBha2V0Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJIYXJnYSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X21vbmV5Il0sIGp1c3RpZnk9InJpZ2h0IikKCiAgICAgICAgICAgIGZvciBpLCBpdGVtIGluIGVudW1lcmF0ZShkaXNwbGF5X2NhcnQsIHN0YXJ0PTEpOgogICAgICAgICAgICAgICAgdGFibGUuYWRkX3JvdyhzdHIoaSksIGl0ZW1bIm5hbWUiXSwgZ2V0X3J1cGlhaChpdGVtWyJwcmljZSJdKSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwodGFibGUsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgcGFkZGluZz0oMCwgMSksIGV4cGFuZD1UcnVlKSkKICAgICAgICAgICAgY29uc29sZS5wcmludChmIlt7dGhlbWVbJ3RleHRfYm9keSddfV1Ub3RhbCBIYXJnYTogUnAge2dldF9ydXBpYWgodG90YWxfcHJpY2UpfVsvXSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyIsICJLZXJhbmphbmcgbWFzaWgga29zb25nLiIpCgogICAgICAgIG5hdiA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2LmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NikKICAgICAgICBuYXYuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2LmFkZF9yb3coIjEiLCAiVGFtYmFoIGRhcmkgQm9va21hcmsiKQogICAgICAgIG5hdi5hZGRfcm93KCIyIiwgIlRhbWJhaCBkYXJpIEZhbWlseSBDb2RlIFRlcnNpbXBhbiIpCiAgICAgICAgbmF2LmFkZF9yb3coIjMiLCAiVGFtYmFoIGRhcmkgRmFtaWx5IENvZGUgTWFudWFsIikKICAgICAgICBpZiBjYXJ0X2l0ZW1zOgogICAgICAgICAgICBuYXYuYWRkX3JvdygiNCIsIGYiW3t0aGVtZVsndGV4dF9lcnInXX1dSGFwdXMgSXRlbSBkYXJpIEtlcmFuamFuZ1svXSIpCiAgICAgICAgICAgIG5hdi5hZGRfcm93KCI1IiwgZiJbe3RoZW1lWyd0ZXh0X3dhcm4nXX1d8J+SsyBMYW5qdXRrYW4ga2UgUGVtYmF5YXJhblsvXSIpCiAgICAgICAgbmF2LmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1LZW1iYWxpIGtlIG1lbnUgdXRhbWFbL10iKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKG5hdiwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLCBwYWRkaW5nPSgwLCAwKSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWhhbjpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKCiAgICAgICAgZGVmIGFkZF90b19jYXJ0KGRldGFpbCwgbmFtZSk6CiAgICAgICAgICAgIG5vbmxvY2FsIHRvdGFsX3ByaWNlCiAgICAgICAgICAgIG9wdGlvbiA9IGRldGFpbFsicGFja2FnZV9vcHRpb24iXQogICAgICAgICAgICBjYXJ0X2l0ZW1zLmFwcGVuZChQYXltZW50SXRlbSgKICAgICAgICAgICAgICAgIGl0ZW1fY29kZT1vcHRpb25bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwgaXRlbV9wcmljZT1vcHRpb25bInByaWNlIl0sCiAgICAgICAgICAgICAgICBpdGVtX25hbWU9b3B0aW9uWyJuYW1lIl0sIHRheD0wLAogICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0KICAgICAgICAgICAgKSkKICAgICAgICAgICAgZGlzcGxheV9jYXJ0LmFwcGVuZCh7Im5hbWUiOiBuYW1lLCAicHJpY2UiOiBvcHRpb25bInByaWNlIl19KQogICAgICAgICAgICB0b3RhbF9wcmljZSArPSBvcHRpb25bInByaWNlIl0KICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKchSBEaXRhbWJhaGthbiIsIGYiUGFrZXQgJ3tuYW1lfScgYmVyaGFzaWwgbWFzdWsga2VyYW5qYW5nLiIpCiAgICAgICAgICAgIHBhdXNlKCkKCiAgICAgICAgaWYgY2hvaWNlID09ICIxIjoKICAgICAgICAgICAgcmVzdWx0ID0gc2hvd19ib29rbWFya19tZW51KHJldHVybl9wYWNrYWdlX2RldGFpbD1UcnVlKQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHJlc3VsdCwgdHVwbGUpOgogICAgICAgICAgICAgICAgZGV0YWlsLCBuYW1lID0gcmVzdWx0CiAgICAgICAgICAgICAgICBpZiBkZXRhaWw6CiAgICAgICAgICAgICAgICAgICAgYWRkX3RvX2NhcnQoZGV0YWlsLCBuYW1lKQoKICAgICAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgICAgIHJlc3VsdCA9IHNob3dfZmFtaWx5X2dydXBfbWVudShyZXR1cm5fcGFja2FnZV9kZXRhaWw9VHJ1ZSkKICAgICAgICAgICAgaWYgcmVzdWx0ID09ICJNQUlOIjoKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShyZXN1bHQsIHR1cGxlKToKICAgICAgICAgICAgICAgIGRldGFpbCwgbmFtZSA9IHJlc3VsdAogICAgICAgICAgICAgICAgaWYgZGV0YWlsOgogICAgICAgICAgICAgICAgICAgIGFkZF90b19jYXJ0KGRldGFpbCwgbmFtZSkKCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjMiOgogICAgICAgICAgICBmYyA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2thbiBGYW1pbHkgQ29kZTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICAgICAgcmVzdWx0ID0gZ2V0X3BhY2thZ2VzX2J5X2ZhbWlseShmYywgcmV0dXJuX3BhY2thZ2VfZGV0YWlsPVRydWUpCiAgICAgICAgICAgIGlmIHJlc3VsdCA9PSAiTUFJTiI6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UocmVzdWx0LCB0dXBsZSk6CiAgICAgICAgICAgICAgICBkZXRhaWwsIG5hbWUgPSByZXN1bHQKICAgICAgICAgICAgICAgIGlmIGRldGFpbDoKICAgICAgICAgICAgICAgICAgICBhZGRfdG9fY2FydChkZXRhaWwsIG5hbWUpCgogICAgICAgIGVsaWYgY2hvaWNlID09ICI0IiBhbmQgY2FydF9pdGVtczoKICAgICAgICAgICAgaWR4ID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XU5vbW9yIGl0ZW0geWFuZyBpbmdpbiBkaWhhcHVzOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgICAgICAgICBpZiBpZHguaXNkaWdpdCgpIGFuZCAxIDw9IGludChpZHgpIDw9IGxlbihjYXJ0X2l0ZW1zKToKICAgICAgICAgICAgICAgIGkgPSBpbnQoaWR4KSAtIDEKICAgICAgICAgICAgICAgIHJlbW92ZWQgPSBkaXNwbGF5X2NhcnQucG9wKGkpCiAgICAgICAgICAgICAgICBjYXJ0X2l0ZW1zLnBvcChpKQogICAgICAgICAgICAgICAgdG90YWxfcHJpY2UgLT0gcmVtb3ZlZFsicHJpY2UiXQogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIvCfl5HvuI8gRGloYXB1cyIsIGYiSXRlbSAne3JlbW92ZWRbJ25hbWUnXX0nIHRlbGFoIGRpaGFwdXMuIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gRXJyb3IiLCAiTm9tb3IgaXRlbSB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQoKICAgICAgICBlbGlmIGNob2ljZSA9PSAiNSIgYW5kIGNhcnRfaXRlbXM6CiAgICAgICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgICAgIGluZm9fdGV4dCA9IFRleHQoKQogICAgICAgICAgICBpbmZvX3RleHQuYXBwZW5kKCJEZXRhaWwgUGVtYmF5YXJhbjpcbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICAgICAgZm9yIGksIGl0ZW0gaW4gZW51bWVyYXRlKGRpc3BsYXlfY2FydCwgc3RhcnQ9MSk6CiAgICAgICAgICAgICAgICBpbmZvX3RleHQuYXBwZW5kKGYie2l9LiB7aXRlbVsnbmFtZSddfSAtIFJwIHtnZXRfcnVwaWFoKGl0ZW1bJ3ByaWNlJ10pfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICBpbmZvX3RleHQuYXBwZW5kKGYiXG5Ub3RhbDogUnAge2dldF9ydXBpYWgodG90YWxfcHJpY2UpfSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X21vbmV5Il0pCgogICAgICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICAgICAgaW5mb190ZXh0LAogICAgICAgICAgICAgICAgdGl0bGU9ZiJbe3RoZW1lWyd0ZXh0X3RpdGxlJ119XUluZm9ybWFzaSBQZW1iYXlhcmFuWy9dIiwKICAgICAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgICAgIHBhZGRpbmc9KDEsIDIpLAogICAgICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICAgICAgKSkKICAgICAgICAgICAgc2ltcGxlX251bWJlcigpCgogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlID0gVGFibGUoc2hvd19oZWFkZXI9RmFsc2UsIGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICAgICAgICAgIG1ldGhvZF90YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUuYWRkX3JvdygiMSIsICLwn5KwIEJhbGFuY2UiKQogICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlLmFkZF9yb3coIjIiLCAi8J+SsyBFLVdhbGxldCIpCiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUuYWRkX3JvdygiMyIsICLwn5OxIFFSSVMiKQogICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1LZW1iYWxpIGtlIG1lbnUgc2ViZWx1bW55YVsvXSIpCgogICAgICAgICAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU9ZiJbe3RoZW1lWyd0ZXh0X3RpdGxlJ119XfCfkrMgUGlsaWggTWV0b2RlIFBlbWJheWFyYW5bL10iLAogICAgICAgICAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICAgICAgICAgKSkKCiAgICAgICAgICAgICAgICBtZXRob2QgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWggbWV0b2RlOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQoKICAgICAgICAgICAgICAgIGlmIG1ldGhvZCA9PSAiMDAiOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAgICAgY29uZmlybSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1MYW5qdXRrYW4gcGVtYmVsaWFuIGRlbmdhbiBtZXRvZGUgaW5pPyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICAgICAgaWYgY29uZmlybSAhPSAieSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyIsICJQZW1iYXlhcmFuIGRpYmF0YWxrYW4uIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBpZiBtZXRob2QgPT0gIjEiOgogICAgICAgICAgICAgICAgICAgIHNldHRsZW1lbnRfYmFsYW5jZShhcGlfa2V5LCB0b2tlbnMsIGNhcnRfaXRlbXMsICJCVVlfUEFDS0FHRSIsIFRydWUpCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XeKchSBQZW1iYXlhcmFuIHNlbGVzYWkuIFRla2FuIEVudGVyLi4uWy97dGhlbWVbJ3RleHRfc3ViJ119XSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYgbWV0aG9kID09ICIyIjoKICAgICAgICAgICAgICAgICAgICBzaG93X211bHRpcGF5bWVudChhcGlfa2V5LCB0b2tlbnMsIGNhcnRfaXRlbXMsICJCVVlfUEFDS0FHRSIsIFRydWUpCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XeKchSBQZW1iYXlhcmFuIHNlbGVzYWkuIFRla2FuIEVudGVyLi4uWy97dGhlbWVbJ3RleHRfc3ViJ119XSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYgbWV0aG9kID09ICIzIjoKICAgICAgICAgICAgICAgICAgICBzaG93X3FyaXNfcGF5bWVudChhcGlfa2V5LCB0b2tlbnMsIGNhcnRfaXRlbXMsICJCVVlfUEFDS0FHRSIsIFRydWUpCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XeKchSBQZW1iYXlhcmFuIHNlbGVzYWkuIFRla2FuIEVudGVyLi4uWy97dGhlbWVbJ3RleHRfc3ViJ119XSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBFcnJvciIsICJNZXRvZGUgdGlkYWsgdmFsaWQuIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCgogICAgICAgIGVsaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgICAgIGJyZWFrCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gRXJyb3IiLCAiUGlsaWhhbiB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICBwYXVzZSgpCg==').decode())
