#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCgojIEZpbGUgY2FjaGUgbG9rYWwgKGhpZGRlbiBmaWxlKQpDQUNIRV9GSUxFID0gIi5jYWNoZS5qc29uIgoKIyBDYWNoZSBpbi1tZW1vcnkKX21lbW9yeV9jYWNoZSA9IHt9CgojIExpbWl0IGp1bWxhaCBrZXkgZGkgZmlsZSBjYWNoZSAoZGVmYXVsdCA1MCkKTUFYX0tFWVMgPSA1MDAgICMgYmlzYSBkaXNlc3VhaWthbgoKCmRlZiBfbG9hZF9maWxlX2NhY2hlKCk6CiAgICBpZiBvcy5wYXRoLmV4aXN0cyhDQUNIRV9GSUxFKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdpdGggb3BlbihDQUNIRV9GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5sb2FkKGYpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICByZXR1cm4ge30KCmRlZiBfc2F2ZV9maWxlX2NhY2hlKGNhY2hlOiBkaWN0KToKICAgIHRyeToKICAgICAgICAjIEJhdGFzaSBqdW1sYWgga2V5IGFnYXIgZmlsZSB0aWRhayBtZW1iZXNhcgogICAgICAgIGlmIGxlbihjYWNoZSkgPiBNQVhfS0VZUzoKICAgICAgICAgICAgb2xkZXN0ID0gbWluKGNhY2hlLml0ZW1zKCksIGtleT1sYW1iZGEgeDogeFsxXVsidGltZSJdKVswXQogICAgICAgICAgICBkZWwgY2FjaGVbb2xkZXN0XQogICAgICAgIHdpdGggb3BlbihDQUNIRV9GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgICMgaW5kZW50PTIgbWVtYnVhdCBKU09OIHJhcGksIHRpYXAgbGV2ZWwgbWFzdWsgMiBzcGFzaQogICAgICAgICAgICBqc29uLmR1bXAoY2FjaGUsIGYsIGluZGVudD0yLCBlbnN1cmVfYXNjaWk9RmFsc2UpCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHBhc3MKCmRlZiBfbWFrZV9rZXkoYWNjb3VudF9pZDogc3RyLCBrZXk6IHN0cikgLT4gc3RyOgogICAgIiIiR2FidW5na2FuIGFjY291bnRfaWQgZGVuZ2FuIGtleSBhZ2FyIGNhY2hlIHBlciBha3VuLiIiIgogICAgcmV0dXJuIGYie2FjY291bnRfaWR9X3trZXl9IgoKZGVmIGdldF9jYWNoZShhY2NvdW50X2lkOiBzdHIsIGtleTogc3RyLCB0dGw6IGludCA9IDYwLCB1c2VfZmlsZTogYm9vbCA9IEZhbHNlLCBkZWZhdWx0PU5vbmUpOgogICAgIiIiCiAgICBBbWJpbCBkYXRhIGRhcmkgY2FjaGUgcGVyIGFrdW4uCiAgICAtIGFjY291bnRfaWQ6IGlkZW50aWZpZXIgYWt1biAobWlzYWxueWEgbm9tb3Ivc3Vic2NyaWJlcl9pZCkKICAgIC0ga2V5OiBuYW1hIGRhdGEgKGJhbGFuY2UsIHF1b3RhLCBzZWdtZW50cykKICAgIC0gdHRsOiB3YWt0dSBoaWR1cCBjYWNoZSAoZGV0aWspCiAgICAtIHVzZV9maWxlOiBUcnVlIHVudHVrIGNhY2hlIGZpbGUsIEZhbHNlIHVudHVrIGNhY2hlIG1lbW9yeQogICAgLSBkZWZhdWx0OiBuaWxhaSBkZWZhdWx0IGppa2EgY2FjaGUga29zb25nL2thZGFsdWFyc2EKICAgICIiIgogICAgbm93ID0gdGltZS5tb25vdG9uaWMoKQogICAgZnVsbF9rZXkgPSBfbWFrZV9rZXkoYWNjb3VudF9pZCwga2V5KQoKICAgIGlmIHVzZV9maWxlOgogICAgICAgIGNhY2hlID0gX2xvYWRfZmlsZV9jYWNoZSgpCiAgICAgICAgaWYgZnVsbF9rZXkgaW4gY2FjaGU6CiAgICAgICAgICAgIGlmIG5vdyAtIGNhY2hlW2Z1bGxfa2V5XVsidGltZSJdIDwgdHRsOgogICAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlW2Z1bGxfa2V5XVsidmFsdWUiXQogICAgZWxzZToKICAgICAgICBkYXRhID0gX21lbW9yeV9jYWNoZS5nZXQoZnVsbF9rZXkpCiAgICAgICAgaWYgZGF0YSBhbmQgKG5vdyAtIGRhdGFbInRpbWUiXSA8IHR0bCk6CiAgICAgICAgICAgIHJldHVybiBkYXRhWyJ2YWx1ZSJdCiAgICByZXR1cm4gZGVmYXVsdAoKZGVmIHNldF9jYWNoZShhY2NvdW50X2lkOiBzdHIsIGtleTogc3RyLCB2YWx1ZSwgdXNlX2ZpbGU6IGJvb2wgPSBGYWxzZSk6CiAgICAiIiIKICAgIFNpbXBhbiBkYXRhIGtlIGNhY2hlIHBlciBha3VuLgogICAgIiIiCiAgICBub3cgPSB0aW1lLm1vbm90b25pYygpCiAgICBmdWxsX2tleSA9IF9tYWtlX2tleShhY2NvdW50X2lkLCBrZXkpCgogICAgaWYgdXNlX2ZpbGU6CiAgICAgICAgY2FjaGUgPSBfbG9hZF9maWxlX2NhY2hlKCkKICAgICAgICBjYWNoZVtmdWxsX2tleV0gPSB7InZhbHVlIjogdmFsdWUsICJ0aW1lIjogbm93fQogICAgICAgIF9zYXZlX2ZpbGVfY2FjaGUoY2FjaGUpCiAgICBlbHNlOgogICAgICAgIF9tZW1vcnlfY2FjaGVbZnVsbF9rZXldID0geyJ2YWx1ZSI6IHZhbHVlLCAidGltZSI6IG5vd30KCmRlZiBjbGVhcl9jYWNoZShhY2NvdW50X2lkOiBzdHIgPSBOb25lKToKICAgICIiIgogICAgQmVyc2loa2FuIGNhY2hlLgogICAgLSBKaWthIGFjY291bnRfaWQgZGliZXJpa2FuLCBoYW55YSBjYWNoZSB1bnR1ayBha3VuIGl0dSB5YW5nIGRpaGFwdXMuCiAgICAtIEppa2EgdGlkYWssIHNlbXVhIGNhY2hlIGRpaGFwdXMuCiAgICAiIiIKICAgIGdsb2JhbCBfbWVtb3J5X2NhY2hlCiAgICBpZiBhY2NvdW50X2lkOgogICAgICAgICMgSGFwdXMgY2FjaGUgbWVtb3J5IHBlciBha3VuCiAgICAgICAgX21lbW9yeV9jYWNoZSA9IHtrOiB2IGZvciBrLCB2IGluIF9tZW1vcnlfY2FjaGUuaXRlbXMoKSBpZiBub3Qgay5zdGFydHN3aXRoKGYie2FjY291bnRfaWR9XyIpfQogICAgICAgICMgSGFwdXMgY2FjaGUgZmlsZSBwZXIgYWt1bgogICAgICAgIGNhY2hlID0gX2xvYWRfZmlsZV9jYWNoZSgpCiAgICAgICAgY2FjaGUgPSB7azogdiBmb3IgaywgdiBpbiBjYWNoZS5pdGVtcygpIGlmIG5vdCBrLnN0YXJ0c3dpdGgoZiJ7YWNjb3VudF9pZH1fIil9CiAgICAgICAgX3NhdmVfZmlsZV9jYWNoZShjYWNoZSkKICAgIGVsc2U6CiAgICAgICAgIyBIYXB1cyBzZW11YSBjYWNoZQogICAgICAgIF9tZW1vcnlfY2FjaGUgPSB7fQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKENBQ0hFX0ZJTEUpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoQ0FDSEVfRklMRSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHBhc3MK').decode())
