#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCByZXF1ZXN0cwoKQkFTRV9ESVIgPSBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykpKQpIT1RfREFUQV9ESVIgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJob3RfZGF0YSIpCgpkZWYgbG9hZF9hcGlfa2V5KCkgLT4gc3RyOgogICAgYXBpX3BhdGggPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJhcGkua2V5IikKICAgIGlmIG9zLnBhdGguZXhpc3RzKGFwaV9wYXRoKToKICAgICAgICB3aXRoIG9wZW4oYXBpX3BhdGgsICJyIiwgZW5jb2Rpbmc9InV0ZjgiKSBhcyBmOgogICAgICAgICAgICBhcGlfa2V5ID0gZi5yZWFkKCkuc3RyaXAoKQogICAgICAgIGlmIGFwaV9rZXk6CiAgICAgICAgICAgIHByaW50KCJBUEkga2V5IGxvYWRlZCBzdWNjZXNzZnVsbHkuIikKICAgICAgICAgICAgcmV0dXJuIGFwaV9rZXkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludCgiQVBJIGtleSBmaWxlIGlzIGVtcHR5LiIpCiAgICAgICAgICAgIHJldHVybiAiIgogICAgZWxzZToKICAgICAgICBwcmludCgiQVBJIGtleSBmaWxlIG5vdCBmb3VuZC4iKQogICAgICAgIHJldHVybiAiIgogICAgCmRlZiBzYXZlX2FwaV9rZXkoYXBpX2tleTogc3RyKToKICAgIGFwaV9wYXRoID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiYXBpLmtleSIpCiAgICB3aXRoIG9wZW4oYXBpX3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0ZjgiKSBhcyBmOgogICAgICAgIGYud3JpdGUoYXBpX2tleSkKICAgIHByaW50KCJBUEkga2V5IHNhdmVkIHN1Y2Nlc3NmdWxseS4iKQogICAgCmRlZiBkZWxldGVfYXBpX2tleSgpOgogICAgYXBpX3BhdGggPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJhcGkua2V5IikKICAgIGlmIG9zLnBhdGguZXhpc3RzKGFwaV9wYXRoKToKICAgICAgICBvcy5yZW1vdmUoYXBpX3BhdGgpCiAgICAgICAgcHJpbnQoIkFQSSBrZXkgZmlsZSBkZWxldGVkLiIpCiAgICBlbHNlOgogICAgICAgIHByaW50KCJBUEkga2V5IGZpbGUgZG9lcyBub3QgZXhpc3QuIikKCmRlZiB2ZXJpZnlfYXBpX2tleShhcGlfa2V5OiBzdHIsICosIHRpbWVvdXQ6IGZsb2F0ID0gMTAuMCkgLT4gYm9vbDoKICAgIHJldHVybiBUcnVlCgpkZWYgZW5zdXJlX2FwaV9rZXkoKSAtPiBzdHI6CiAgICByZXR1cm4gIk5vaXIxIgoKCmRlZiBtZXJnZV9ob3QxKGFwaV91cmw6IHN0ciwgcHJlZmVyX3NlcnZlcjogYm9vbCA9IFRydWUpOgogICAgbG9jYWxfZmlsZSA9IG9zLnBhdGguam9pbihIT1RfREFUQV9ESVIsICJob3QuanNvbiIpCiAgICBtZXJnZWQgPSB7fQoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4obG9jYWxfZmlsZSwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBsb2NhbF9kYXRhID0ganNvbi5sb2FkKGYpCiAgICAgICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShsb2NhbF9kYXRhLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICBsb2NhbF9kYXRhID0gW10KICAgICAgICAgICAgZXhjZXB0IGpzb24uSlNPTkRlY29kZUVycm9yOgogICAgICAgICAgICAgICAgbG9jYWxfZGF0YSA9IFtdCiAgICAgICAgICAgICNwcmludChmIk1lbXVhdCB7bGVuKGxvY2FsX2RhdGEpfSBpdGVtIGRhcmkge2xvY2FsX2ZpbGV9IikKICAgICAgICAgICAgZm9yIHBrZyBpbiBsb2NhbF9kYXRhOgogICAgICAgICAgICAgICAga2V5ID0gZiJ7cGtnLmdldCgnZmFtaWx5X2NvZGUnLCcnKX0te3BrZy5nZXQoJ29yZGVyJywnJyl9LXtwa2cuZ2V0KCd2YXJpYW50X25hbWUnLCcnKX0iCiAgICAgICAgICAgICAgICBwa2dbInNvdXJjZSJdID0gImxvY2FsIgogICAgICAgICAgICAgICAgbWVyZ2VkW2tleV0gPSBwa2cKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjoKICAgICAgICAjcHJpbnQoZiJ7bG9jYWxfZmlsZX0gdGlkYWsgZGl0ZW11a2FuLiIpCiAgICAgICAgcGFzcyAgIyB0ZXRhcCBzaWxlbnQKCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoYXBpX3VybCwgdGltZW91dD0zMCkKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIGFwaV9kYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgIGZvciBwa2cgaW4gYXBpX2RhdGE6CiAgICAgICAgICAgICAgICBrZXkgPSBmIntwa2cuZ2V0KCdmYW1pbHlfY29kZScsJycpfS17cGtnLmdldCgnb3JkZXInLCcnKX0te3BrZy5nZXQoJ3ZhcmlhbnRfbmFtZScsJycpfSIKICAgICAgICAgICAgICAgIHBrZ1sic291cmNlIl0gPSAic2VydmVyIgogICAgICAgICAgICAgICAgaWYgcHJlZmVyX3NlcnZlciBvciBrZXkgbm90IGluIG1lcmdlZDoKICAgICAgICAgICAgICAgICAgICBtZXJnZWRba2V5XSA9IHBrZwogICAgICAgIGVsc2U6CiAgICAgICAgICAgICNwcmludCgiR2FnYWwgYW1iaWwgZGF0YSBob3QxIGRhcmkgc2VydmVyLiIpCiAgICAgICAgICAgIHBhc3MgICMgdGV0YXAgc2lsZW50CiAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICNwcmludChmIkVycm9yIEFQSSBob3QxOiB7ZX0iKQogICAgICAgIHBhc3MgICMgdGV0YXAgc2lsZW50CgogICAgcmV0dXJuIGxpc3QobWVyZ2VkLnZhbHVlcygpKQoKCmRlZiBtZXJnZV9ob3QyKGFwaV91cmw6IHN0ciwgcHJlZmVyX3NlcnZlcjogYm9vbCA9IFRydWUpOgogICAgbG9jYWxfZmlsZSA9IG9zLnBhdGguam9pbihIT1RfREFUQV9ESVIsICJob3QyLmpzb24iKQogICAgbWVyZ2VkID0ge30KCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKGxvY2FsX2ZpbGUsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbG9jYWxfZGF0YSA9IGpzb24ubG9hZChmKQogICAgICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UobG9jYWxfZGF0YSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgbG9jYWxfZGF0YSA9IFtdCiAgICAgICAgICAgIGV4Y2VwdCBqc29uLkpTT05EZWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgIGxvY2FsX2RhdGEgPSBbXQogICAgICAgICAgICAjcHJpbnQoZiJNZW11YXQge2xlbihsb2NhbF9kYXRhKX0gaXRlbSBkYXJpIHtsb2NhbF9maWxlfSIpCiAgICAgICAgICAgIGZvciBwa2cgaW4gbG9jYWxfZGF0YToKICAgICAgICAgICAgICAgIGtleSA9IGYie3BrZy5nZXQoJ25hbWUnLCcnKX0te3BrZy5nZXQoJ3ByaWNlJywnJyl9LXtwa2cuZ2V0KCdvcmRlcicsJycpfSIKICAgICAgICAgICAgICAgIHBrZ1sic291cmNlIl0gPSAibG9jYWwiCiAgICAgICAgICAgICAgICBtZXJnZWRba2V5XSA9IHBrZwogICAgZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgogICAgICAgICNwcmludChmIntsb2NhbF9maWxlfSB0aWRhayBkaXRlbXVrYW4uIikKICAgICAgICBwYXNzICAjIHRldGFwIHNpbGVudAoKICAgIHRyeToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChhcGlfdXJsLCB0aW1lb3V0PTMwKQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgYXBpX2RhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgZm9yIHBrZyBpbiBhcGlfZGF0YToKICAgICAgICAgICAgICAgIGtleSA9IGYie3BrZy5nZXQoJ25hbWUnLCcnKX0te3BrZy5nZXQoJ3ByaWNlJywnJyl9LXtwa2cuZ2V0KCdvcmRlcicsJycpfSIKICAgICAgICAgICAgICAgIHBrZ1sic291cmNlIl0gPSAic2VydmVyIgogICAgICAgICAgICAgICAgaWYgcHJlZmVyX3NlcnZlciBvciBrZXkgbm90IGluIG1lcmdlZDoKICAgICAgICAgICAgICAgICAgICBtZXJnZWRba2V5XSA9IHBrZwogICAgICAgIGVsc2U6CiAgICAgICAgICAgICNwcmludCgiR2FnYWwgYW1iaWwgZGF0YSBob3QyIGRhcmkgc2VydmVyLiIpCiAgICAgICAgICAgIHBhc3MgICMgdGV0YXAgc2lsZW50CiAgICBleGNlcHQgcmVxdWVzdHMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICNwcmludChmIkVycm9yIEFQSSBob3QyOiB7ZX0iKQogICAgICAgIHBhc3MgICMgdGV0YXAgc2lsZW50CgogICAgcmV0dXJuIGxpc3QobWVyZ2VkLnZhbHVlcygpKQo=').decode())
