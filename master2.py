#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBkb3RlbnYgaW1wb3J0IGxvYWRfZG90ZW52CmxvYWRfZG90ZW52KCkKCmltcG9ydCBzeXMsIGpzb24sIHJhbmRvbQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIGFwcDIuY29uZmlnLmltcG9ydHMgaW1wb3J0ICoKZnJvbSBhcHAyLm1lbnVzLnV0aWwgaW1wb3J0IGNsZWFyX3NjcmVlbngKZnJvbSBhcHAyLm1lbnVzLnNoYXJpbmcgaW1wb3J0IHNob3dfYmFsYW5jZV9hbGxvdG1lbnRfbWVudQpmcm9tIGFwcDIubWVudXMucHVyY2hhc2UgaW1wb3J0IHJlZGVlbV9sb29waW5nCgoKZGVmIHNob3dfbWFpbl9tZW51KHByb2ZpbGU6IGRpY3QsIGRpc3BsYXlfcXVvdGE6IHN0ciwgc2VnbWVudHM6IGRpY3QpOgogICAgY2xlYXJfc2NyZWVueCgpCiAgICB0aGVtZSA9IGdldF90aGVtZSgpCgogICAgZXhwaXJlZF9hdF90cyA9IHByb2ZpbGUuZ2V0KCJiYWxhbmNlX2V4cGlyZWRfYXQiKQogICAgZXhwaXJlZF9hdF9kdCA9IGRhdGV0aW1lLmZyb210aW1lc3RhbXAoZXhwaXJlZF9hdF90cykuc3RyZnRpbWUoIiVZLSVtLSVkICVIOiVNOiVTIikgaWYgZXhwaXJlZF9hdF90cyBlbHNlICItIgogICAgcHVsc2Ffc3RyID0gZ2V0X3J1cGlhaChwcm9maWxlLmdldCgiYmFsYW5jZSIsIDApKQoKICAgIGluZm9fdGFibGUgPSBUYWJsZS5ncmlkKHBhZGRpbmc9KDAsIDEpKQogICAgaW5mb190YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9ImxlZnQiLCBzdHlsZT1nZXRfdGhlbWVfc3R5bGUoImJvcmRlcl9pbmZvIikpCiAgICBpbmZvX3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0ibGVmdCIsIHN0eWxlPWdldF90aGVtZV9zdHlsZSgidGV4dF9ib2R5IikpCgogICAgaW5mb190YWJsZS5hZGRfcm93KCIgTm9tb3IiLCBmIjog8J+TniBbe3RoZW1lWyd0ZXh0X2JvZHknXX1de3Byb2ZpbGVbJ251bWJlciddfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIiBUaXBlIiwgZiI6IPCfp74gW3t0aGVtZVsndGV4dF9ib2R5J119XXtwcm9maWxlWydzdWJzY3JpcHRpb25fdHlwZSddfSAoe3Byb2ZpbGVbJ3N1YnNjcmliZXJfaWQnXX0pWy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiIFB1bHNhIiwgZiI6IPCfkrAgUnAgW3t0aGVtZVsndGV4dF9tb25leSddfV17cHVsc2Ffc3RyfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIiBLdW90YSIsIGYiOiDwn5OKIFt7dGhlbWVbJ3RleHRfZGF0ZSddfV17ZGlzcGxheV9xdW90YX1bL10iKQogICAgaW5mb190YWJsZS5hZGRfcm93KCIgVGllcmluZyIsIGYiOiDwn4+FIFt7dGhlbWVbJ3RleHRfZGF0ZSddfV17cHJvZmlsZVsncG9pbnRfaW5mbyddfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIiBNYXNhIEFrdGlmIiwgZiI6IOKPsyBbe3RoZW1lWyd0ZXh0X2RhdGUnXX1de2V4cGlyZWRfYXRfZHR9Wy9dIikKCiAgICBjb25zb2xlLnByaW50KAogICAgICAgIFBhbmVsKAogICAgICAgICAgICBpbmZvX3RhYmxlLAogICAgICAgICAgICB0aXRsZT1mIlt7Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X3RpdGxlJyl9XVsgSW5mb3JtYXNpIEFrdW4gXVsvXSIsCiAgICAgICAgICAgIHRpdGxlX2FsaWduPSJjZW50ZXIiLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9Z2V0X3RoZW1lX3N0eWxlKCJib3JkZXJfaW5mbyIpLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUsCiAgICAgICAgKQogICAgKQoKICAgIHNwZWNpYWxfcGFja2FnZXMgPSBzZWdtZW50cy5nZXQoInNwZWNpYWxfcGFja2FnZXMiLCBbXSkKICAgIGlmIHNwZWNpYWxfcGFja2FnZXM6CiAgICAgICAgYmVzdCA9IHJhbmRvbS5jaG9pY2Uoc3BlY2lhbF9wYWNrYWdlcykKICAgICAgICBuYW1lID0gYmVzdC5nZXQoIm5hbWUiLCAiLSIpCiAgICAgICAgZGlza29uX3BlcmNlbnQgPSBiZXN0LmdldCgiZGlza29uX3BlcmNlbnQiLCAwKQogICAgICAgIGRpc2tvbl9wcmljZSA9IGJlc3QuZ2V0KCJkaXNrb25fcHJpY2UiLCAwKQogICAgICAgIG9yaWdpbmFsX3ByaWNlID0gYmVzdC5nZXQoIm9yaWdpbmFsX3ByaWNlIiwgMCkKICAgICAgICBlbW9qaV9kaXNrb24gPSAi8J+SuCIgaWYgZGlza29uX3BlcmNlbnQgPj0gNTAgZWxzZSAiIgogICAgICAgIGVtb2ppX2t1b3RhID0gIvCflKUiIGlmIGJlc3QuZ2V0KCJrdW90YV9nYiIsIDApID49IDEwMCBlbHNlICIiCgogICAgICAgIHNwZWNpYWxfdGV4dCA9ICgKICAgICAgICAgICAgZiJbYm9sZCB7dGhlbWVbJ3RleHRfdGl0bGUnXX1d8J+UpfCflKXwn5SlIFBha2V0IFNwZWNpYWwgVW50dWttdSEg8J+UpfCflKXwn5SlWy97dGhlbWVbJ3RleHRfdGl0bGUnXX1dXG5cbiIKICAgICAgICAgICAgZiJbe3RoZW1lWyd0ZXh0X2JvZHknXX1de2Vtb2ppX2t1b3RhfSB7bmFtZX1bL3t0aGVtZVsndGV4dF9ib2R5J119XVxuIgogICAgICAgICAgICBmIkRpc2tvbiB7ZGlza29uX3BlcmNlbnR9JSB7ZW1vamlfZGlza29ufSAiCiAgICAgICAgICAgIGYiUnBbe3RoZW1lWyd0ZXh0X2VyciddfV1bc3RyaWtlXXtnZXRfcnVwaWFoKG9yaWdpbmFsX3ByaWNlKX1bL3N0cmlrZV1bL3t0aGVtZVsndGV4dF9lcnInXX1dIOKeoSAiCiAgICAgICAgICAgIGYiUnBbe3RoZW1lWyd0ZXh0X21vbmV5J119XXtnZXRfcnVwaWFoKGRpc2tvbl9wcmljZSl9Wy97dGhlbWVbJ3RleHRfbW9uZXknXX1dIgogICAgICAgICkKCiAgICAgICAgY29uc29sZS5wcmludCgKICAgICAgICAgICAgUGFuZWwoCiAgICAgICAgICAgICAgICBBbGlnbi5jZW50ZXIoc3BlY2lhbF90ZXh0KSwKICAgICAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3dhcm5pbmciXSwKICAgICAgICAgICAgICAgIHBhZGRpbmc9KDAsIDEpLAogICAgICAgICAgICAgICAgd2lkdGg9Y29uc29sZS5zaXplLndpZHRoLAogICAgICAgICAgICApCiAgICAgICAgKQogICAgICAgIGNvbnNvbGUucHJpbnQoQWxpZ24uY2VudGVyKGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWggW1ldIHVudHVrIG1lbGloYXQgc2VtdWEgcGFrZXQgc3Blc2lhbFsve3RoZW1lWyd0ZXh0X3N1YiddfV0iKSkKCiAgICBtZW51X3RhYmxlID0gVGFibGUoc2hvd19oZWFkZXI9RmFsc2UsIGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgIG1lbnVfdGFibGUuYWRkX2NvbHVtbigiS29kZSIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9Z2V0X3RoZW1lX3N0eWxlKCJ0ZXh0X2tleSIpLCB3aWR0aD02KQogICAgbWVudV90YWJsZS5hZGRfY29sdW1uKCJBa3NpIiwgc3R5bGU9Z2V0X3RoZW1lX3N0eWxlKCJ0ZXh0X2JvZHkiKSkKCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIjEiLCAi8J+UkCBMb2dpbiAvIEdhbnRpIGFrdW4iKQogICAgbWVudV90YWJsZS5hZGRfcm93KCIyIiwgIvCfk5EgTGloYXQgcGFrZXQgYWt0aWYiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCIzIiwgIvCfk5wgUml3YXlhdCBUcmFuc2Frc2kiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI0IiwgIvCflKUgQmVsaSBwYWtldCBIb3QgcHJvbW8iKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI1IiwgIuKaoSBCZWxpIHBha2V0IEhvdCBwcm9tby0yIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiNiIsICLwn6epIEJlbGkgcGFrZXQgdmlhIE9wdGlvbiBDb2RlIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiNyIsICLwn5K1IEJlbGkgcGFrZXQgdmlhIEZhbWlseSBDb2RlIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiOCIsICLwn5uSIEJlbGkgc2VtdWEgcGFrZXQgZGkgRmFtaWx5IENvZGUiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI5IiwgIvCflIIgQXV0byBMb29wIHRhcmdldCBQYWtldCBieSBGYW1pbHkiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCIiLCAiIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTAiLCAi8J+OgSBDbGFpbSBCb251cyBCZWJhcyBQdWFzIChMb29waW5nKSIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIiIsICIgIC1LdW90YSBZb3V0dWJlICYgVGlrdG9rIDMuMTMgR0IgIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiIiwgIiAgLUt1b3RhIFV0YW1hIDEuMjUgR0IgIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiIiwgIiAgLUt1b3RhIE1hbGFtIDMuNzUgR0IgIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiIiwgIiIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIltEXSIsICLwn46tIEJ1YXQgYnVuZGxlIHBha2V0IGRlY295IikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiW0ZdIiwgIvCfkr4gU2ltcGFuL0tlbG9sYSBGYW1pbHkgQ29kZSIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIltCXSIsICLirZAgQm9va21hcmsgcGFrZXQgZmF2b3JpdCIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIltDXSIsIGYiW3t0aGVtZVsndGV4dF9ib2R5J119XfCfp7kgQmVyc2loa2FuIGNhY2hlIGFrdW5bL10iKQogICAgbWVudV90YWJsZS5hZGRfcm93KCJbTV0iLCBmIlt7dGhlbWVbJ3RleHRfYm9keSddfV3imJUgTGFuanV0IGtlIG1lbnUgYmVyaWt1dG55YVsvXSIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIiIsICIiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI2NiIsIGYiW3t0aGVtZVsnYm9yZGVyX3dhcm5pbmcnXX1d8J+ToiBJbmZvcm1hc2kga29kZSB1bmxvY2tbL10iKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI2OSIsIGYiW3t0aGVtZVsndGV4dF9zdWInXX1d8J+OqCBHYW50aSB0ZW1hIENMSVsvXSIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIjk5IiwgZiJbe3RoZW1lWyd0ZXh0X2VyciddfV3im5QgS2VsdWFyIC8gVHV0dXAgYXBsaWthc2lbL10iKQoKICAgIGNvbnNvbGUucHJpbnQoCiAgICAgICAgUGFuZWwoCiAgICAgICAgICAgIG1lbnVfdGFibGUsCiAgICAgICAgICAgIHRpdGxlPWYiW3tnZXRfdGhlbWVfc3R5bGUoJ3RleHRfdGl0bGUnKX1dTWVudSBVdGFtYVsvXSIsCiAgICAgICAgICAgIHRpdGxlX2FsaWduPSJjZW50ZXIiLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9Z2V0X3RoZW1lX3N0eWxlKCJib3JkZXJfcHJpbWFyeSIpLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUsCiAgICAgICAgKQogICAgKQoKCmRlZiBzaG93X21haW5fbWVudTIoYWN0aXZlX3VzZXI6IGRpY3QsIHByb2ZpbGU6IGRpY3QpOgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQoKICAgIGlmIG5vdCBhY3RpdmVfdXNlciBvciAidG9rZW5zIiBub3QgaW4gYWN0aXZlX3VzZXI6CiAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJVc2VyIGJlbHVtIGFrdGlmLCBzaWxha2FuIGxvZ2luIHRlcmxlYmloIGRhaHVsdS4iKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4KCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsZWFyX3NjcmVlbngoKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBBbGlnbi5jZW50ZXIoIkhhbGFtYW4gTWVudS0yIiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDEsIDIpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCiAgICAgICAgc2ltcGxlX251bWJlcigpCgogICAgICAgIG1lbnVfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIG1lbnVfdGFibGUuYWRkX2NvbHVtbigiS29kZSIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgbWVudV90YWJsZS5hZGRfY29sdW1uKCJBa3NpIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQoKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIjEiLCAi8J+UkCBMb2dpbiAvIEdhbnRpIGFrdW4iKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTEiLCAi8J+knSBGYW1pbHkgUGxhbi9Ba3JhYiBPcmdhbml6ZXIiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTIiLCAi8J+RpSBDaXJjbGUiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTMiLCAi8J+PrCBTZWdtZW4gU3RvcmUiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTQiLCAi8J+TgiBGYW1pbHkgTGlzdCBQYWtldCIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCIxNSIsICLwn5OmIFBha2V0IFN0b3JlIikKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIjE2IiwgIvCfjoEgUmVkZWVtIFJld2FyZC9Cb251cyIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCIiLCAiIikKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIltURl0iLCAi8J+SuCBUcmFuc2ZlciBQdWxzYSIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCJbTl0iLCAi8J+UlCBDZWsgTm90aWZpa2FzaSIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCJbUl0iLCAi8J+TnSBSZWdpc3RyYXNpIE1TSVNETiIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCJbVl0iLCAi4pyFIFZhbGlkYXNpIE5vbW9yIChNU0lTRE4pIikKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIiIsICIiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XfCfj6AgS2VtYmFsaSBrZSBtZW51IHV0YW1hWy9dIikKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIjk5IiwgZiJbe3RoZW1lWyd0ZXh0X2VyciddfV3im5QgS2VsdWFyIC8gVHV0dXAgYXBsaWthc2lbL10iKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBtZW51X3RhYmxlLAogICAgICAgICAgICB0aXRsZT1mIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1dTWVudS0yWy9dIiwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWggbWVudTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICAgICBzZWxlY3RlZF91c2VyX251bWJlciA9IHNob3dfYWNjb3VudF9tZW51KCkKICAgICAgICAgICAgaWYgc2VsZWN0ZWRfdXNlcl9udW1iZXI6CiAgICAgICAgICAgICAgICBBdXRoSW5zdGFuY2Uuc2V0X2FjdGl2ZV91c2VyKHNlbGVjdGVkX3VzZXJfbnVtYmVyKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJUaWRhayBhZGEgdXNlciB0ZXJwaWxpaC4iKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGVsaWYgY2hvaWNlID09ICIxMSI6CiAgICAgICAgICAgIHNob3dfZmFtaWx5X2luZm8oQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXSkKICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTIiOgogICAgICAgICAgICBzaG93X2NpcmNsZV9pbmZvKEF1dGhJbnN0YW5jZS5hcGlfa2V5LCBhY3RpdmVfdXNlclsidG9rZW5zIl0pCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjEzIjoKICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1FbnRlcnByaXNlIHN0b3JlPyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLmxvd2VyKCkgPT0gInkiCiAgICAgICAgICAgIHNob3dfc3RvcmVfc2VnbWVudHNfbWVudShpc19lbnRlcnByaXNlKQogICAgICAgIGVsaWYgY2hvaWNlID09ICIxNCI6CiAgICAgICAgICAgIGlzX2VudGVycHJpc2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dRW50ZXJwcmlzZT8gKHkvbik6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5sb3dlcigpID09ICJ5IgogICAgICAgICAgICBzaG93X2ZhbWlseV9saXN0X21lbnUocHJvZmlsZVsic3Vic2NyaXB0aW9uX3R5cGUiXSwgaXNfZW50ZXJwcmlzZSkKICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTUiOgogICAgICAgICAgICBpc19lbnRlcnByaXNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUVudGVycHJpc2U/ICh5L24pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikubG93ZXIoKSA9PSAieSIKICAgICAgICAgICAgc2hvd19zdG9yZV9wYWNrYWdlc19tZW51KHByb2ZpbGVbInN1YnNjcmlwdGlvbl90eXBlIl0sIGlzX2VudGVycHJpc2UpCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjE2IjoKICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1FbnRlcnByaXNlPyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLmxvd2VyKCkgPT0gInkiCiAgICAgICAgICAgIHNob3dfcmVkZWVtYWJsZXNfbWVudShpc19lbnRlcnByaXNlKQogICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gInRmIjoKICAgICAgICAgICAgc2hvd19iYWxhbmNlX2FsbG90bWVudF9tZW51KCkKICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJuIjoKICAgICAgICAgICAgc2hvd19ub3RpZmljYXRpb25fbWVudSgpCiAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKSA9PSAiciI6CiAgICAgICAgICAgIG1zaXNkbiA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2thbiBNU0lTRE4gKDYyOHh4eHgpOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikKICAgICAgICAgICAgbmlrID0gY29uc29sZS5pbnB1dCgiTWFzdWtrYW4gTklLOiAiKQogICAgICAgICAgICBrayA9IGNvbnNvbGUuaW5wdXQoIk1hc3Vra2FuIEtLOiAiKQogICAgICAgICAgICByZXMgPSBkdWtjYXBpbChBdXRoSW5zdGFuY2UuYXBpX2tleSwgbXNpc2RuLCBraywgbmlrKQogICAgICAgICAgICBwcmludF9wYW5lbCgiSGFzaWwgUmVnaXN0cmFzaSIsIGpzb24uZHVtcHMocmVzLCBpbmRlbnQ9MikpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJ2IjoKICAgICAgICAgICAgbXNpc2RuID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XU1hc3Vra2FuIE1TSVNETiB1bnR1ayB2YWxpZGFzaSAoNjI4eHh4eCk6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKQogICAgICAgICAgICByZXMgPSB2YWxpZGF0ZV9tc2lzZG4oQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXSwgbXNpc2RuKQogICAgICAgICAgICBwcmludF9wYW5lbCgiSGFzaWwgVmFsaWRhc2kiLCBqc29uLmR1bXBzKHJlcywgaW5kZW50PTIpKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgd2l0aCBsaXZlX2xvYWRpbmcoIktlbWJhbGkga2UgbWVudSB1dGFtYS4uLiIsIHRoZW1lKToKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjk5IjoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlbHVhciIsICJBcGxpa2FzaSBkaXR1dHVwIGRlbmdhbiBhbWFuLiIpCiAgICAgICAgICAgIHN5cy5leGl0KDApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJQaWxpaGFuIHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgIHBhdXNlKCkKCgpkZWYgbWFpbigpOgogICAgZW5zdXJlX2dpdCgpCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgICAgICBhY3RpdmVfdXNlciA9IEF1dGhJbnN0YW5jZS5nZXRfYWN0aXZlX3VzZXIoKQogICAgICAgIGlmIGFjdGl2ZV91c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICBhY2NvdW50X2lkID0gYWN0aXZlX3VzZXJbIm51bWJlciJdCgogICAgICAgICAgICAjIEJhbGFuY2UgY2FjaGUgcGVyIGFrdW4gKFRUTCA5MCBkZXRpaykKICAgICAgICAgICAgYmFsYW5jZSA9IGdldF9jYWNoZShhY2NvdW50X2lkLCAiYmFsYW5jZSIsIHR0bD05MCkKICAgICAgICAgICAgaWYgbm90IGJhbGFuY2U6CiAgICAgICAgICAgICAgICBiYWxhbmNlID0gZ2V0X2JhbGFuY2UoQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXVsiaWRfdG9rZW4iXSkKICAgICAgICAgICAgICAgIHNldF9jYWNoZShhY2NvdW50X2lkLCAiYmFsYW5jZSIsIGJhbGFuY2UpCgogICAgICAgICAgICAjIFF1b3RhIGNhY2hlIHBlciBha3VuIChUVEwgNzAgZGV0aWspCiAgICAgICAgICAgIHF1b3RhID0gZ2V0X2NhY2hlKGFjY291bnRfaWQsICJxdW90YSIsIHR0bD03MCkKICAgICAgICAgICAgaWYgbm90IHF1b3RhOgogICAgICAgICAgICAgICAgcXVvdGEgPSBnZXRfcXVvdGEoQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXVsiaWRfdG9rZW4iXSkgb3Ige30KICAgICAgICAgICAgICAgIHNldF9jYWNoZShhY2NvdW50X2lkLCAicXVvdGEiLCBxdW90YSkKCiAgICAgICAgICAgICMgU2VnbWVudHMgY2FjaGUgcGVyIGFrdW4gKFRUTCAyOTAgZGV0aWssIGZpbGUtYmFzZWQpCiAgICAgICAgICAgIHNlZ21lbnRzID0gZ2V0X2NhY2hlKGFjY291bnRfaWQsICJzZWdtZW50cyIsIHR0bD0yOTAsIHVzZV9maWxlPVRydWUpCiAgICAgICAgICAgIGlmIG5vdCBzZWdtZW50czoKICAgICAgICAgICAgICAgIHNlZ21lbnRzID0gZGFzaF9zZWdtZW50cygKICAgICAgICAgICAgICAgICAgICBBdXRoSW5zdGFuY2UuYXBpX2tleSwKICAgICAgICAgICAgICAgICAgICBhY3RpdmVfdXNlclsidG9rZW5zIl1bImlkX3Rva2VuIl0sCiAgICAgICAgICAgICAgICAgICAgYWN0aXZlX3VzZXJbInRva2VucyJdWyJhY2Nlc3NfdG9rZW4iXQogICAgICAgICAgICAgICAgKSBvciB7fQogICAgICAgICAgICAgICAgc2V0X2NhY2hlKGFjY291bnRfaWQsICJzZWdtZW50cyIsIHNlZ21lbnRzLCB1c2VfZmlsZT1UcnVlKQoKICAgICAgICAgICAgcmVtYWluaW5nID0gcXVvdGEuZ2V0KCJyZW1haW5pbmciLCAwKQogICAgICAgICAgICB0b3RhbCA9IHF1b3RhLmdldCgidG90YWwiLCAwKQogICAgICAgICAgICBoYXNfdW5saW1pdGVkID0gcXVvdGEuZ2V0KCJoYXNfdW5saW1pdGVkIiwgRmFsc2UpCiAgICAgICAgICAgIGlmIHRvdGFsID4gMCBvciBoYXNfdW5saW1pdGVkOgogICAgICAgICAgICAgICAgZGlzcGxheV9xdW90YSA9IGYie3JlbWFpbmluZy8xZTk6LjJmfSAvIHt0b3RhbC8xZTk6LjJmfSBHQiIgKyAoIiAoVW5saW1pdGVkKSIgaWYgaGFzX3VubGltaXRlZCBlbHNlICIiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZGlzcGxheV9xdW90YSA9ICItIgoKICAgICAgICAgICAgcG9pbnRfaW5mbyA9ICJQb2ludHM6IE4vQSB8IFRpZXI6IE4vQSIKICAgICAgICAgICAgaWYgYWN0aXZlX3VzZXJbInN1YnNjcmlwdGlvbl90eXBlIl0gPT0gIlBSRVBBSUQiOgogICAgICAgICAgICAgICAgdGllcmluZ19kYXRhID0gZ2V0X2NhY2hlKGFjY291bnRfaWQsICJ0aWVyaW5nIiwgdHRsPTI1MCkKICAgICAgICAgICAgICAgIGlmIG5vdCB0aWVyaW5nX2RhdGE6CiAgICAgICAgICAgICAgICAgICAgdGllcmluZ19kYXRhID0gZ2V0X3RpZXJpbmdfaW5mbyhBdXRoSW5zdGFuY2UuYXBpX2tleSwgYWN0aXZlX3VzZXJbInRva2VucyJdKQogICAgICAgICAgICAgICAgICAgIHNldF9jYWNoZShhY2NvdW50X2lkLCAidGllcmluZyIsIHRpZXJpbmdfZGF0YSkKICAgICAgICAgICAgICAgIHBvaW50X2luZm8gPSBmIlBvaW50czoge3RpZXJpbmdfZGF0YS5nZXQoJ2N1cnJlbnRfcG9pbnQnLDApfSB8IFRpZXI6IHt0aWVyaW5nX2RhdGEuZ2V0KCd0aWVyJywwKX0iCgogICAgICAgICAgICBwcm9maWxlID0gewogICAgICAgICAgICAgICAgIm51bWJlciI6IGFjdGl2ZV91c2VyWyJudW1iZXIiXSwKICAgICAgICAgICAgICAgICJzdWJzY3JpYmVyX2lkIjogYWN0aXZlX3VzZXJbInN1YnNjcmliZXJfaWQiXSwKICAgICAgICAgICAgICAgICJzdWJzY3JpcHRpb25fdHlwZSI6IGFjdGl2ZV91c2VyWyJzdWJzY3JpcHRpb25fdHlwZSJdLAogICAgICAgICAgICAgICAgImJhbGFuY2UiOiBiYWxhbmNlLmdldCgicmVtYWluaW5nIiksCiAgICAgICAgICAgICAgICAiYmFsYW5jZV9leHBpcmVkX2F0IjogYmFsYW5jZS5nZXQoImV4cGlyZWRfYXQiKSwKICAgICAgICAgICAgICAgICJwb2ludF9pbmZvIjogcG9pbnRfaW5mbywKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2hvd19tYWluX21lbnUocHJvZmlsZSwgZGlzcGxheV9xdW90YSwgc2VnbWVudHMpCgogICAgICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWggbWVudTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKCiAgICAgICAgICAgIGlmIGNob2ljZSA9PSAiMSI6CiAgICAgICAgICAgICAgICBzZWxlY3RlZF91c2VyX251bWJlciA9IHNob3dfYWNjb3VudF9tZW51KCkKICAgICAgICAgICAgICAgIGlmIHNlbGVjdGVkX3VzZXJfbnVtYmVyOgogICAgICAgICAgICAgICAgICAgIEF1dGhJbnN0YW5jZS5zZXRfYWN0aXZlX3VzZXIoc2VsZWN0ZWRfdXNlcl9udW1iZXIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiVGlkYWsgYWRhIHVzZXIgdGVycGlsaWguIikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAgICAgICAgIGZldGNoX215X3BhY2thZ2VzKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIzIjoKICAgICAgICAgICAgICAgIHNob3dfdHJhbnNhY3Rpb25faGlzdG9yeShBdXRoSW5zdGFuY2UuYXBpX2tleSwgYWN0aXZlX3VzZXJbInRva2VucyJdKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNCI6CiAgICAgICAgICAgICAgICBzaG93X2hvdF9tZW51KCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjUiOgogICAgICAgICAgICAgICAgc2hvd19ob3RfbWVudTIoKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNiI6CiAgICAgICAgICAgICAgICBvcHRpb25fY29kZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2thbiBvcHRpb24gY29kZTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpCiAgICAgICAgICAgICAgICBpZiBvcHRpb25fY29kZSA9PSAiOTkiOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBzaG93X3BhY2thZ2VfZGV0YWlscyhBdXRoSW5zdGFuY2UuYXBpX2tleSwgYWN0aXZlX3VzZXJbInRva2VucyJdLCBvcHRpb25fY29kZSwgRmFsc2UpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI3IjoKICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XU1hc3Vra2FuIGZhbWlseSBjb2RlOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikKICAgICAgICAgICAgICAgIGlmIGZhbWlseV9jb2RlID09ICI5OSI6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGdldF9wYWNrYWdlc19ieV9mYW1pbHkoZmFtaWx5X2NvZGUpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI4IjoKICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XU1hc3Vra2FuIGZhbWlseSBjb2RlOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikKICAgICAgICAgICAgICAgIGlmIGZhbWlseV9jb2RlID09ICI5OSI6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHN0YXJ0X2Zyb21fb3B0aW9uID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XU11bGFpIGRhcmkgb3B0aW9uIG51bWJlciAoZGVmYXVsdCAxKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc3RhcnRfZnJvbV9vcHRpb24gPSBpbnQoc3RhcnRfZnJvbV9vcHRpb24pCiAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgICAgICBzdGFydF9mcm9tX29wdGlvbiA9IDEKICAgICAgICAgICAgICAgIHVzZV9kZWNveSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1HdW5ha2FuIGRlY295IHBhY2thZ2U/ICh5L24pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikubG93ZXIoKSA9PSAieSIKICAgICAgICAgICAgICAgIHBhdXNlX29uX3N1Y2Nlc3MgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGF1c2Ugc2V0aWFwIHN1a3Nlcz8gKHkvbik6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5sb3dlcigpID09ICJ5IgogICAgICAgICAgICAgICAgZGVsYXlfc2Vjb25kcyA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1EZWxheSBhbnRhciBwZW1iZWxpYW4gKDAgPSB0YW5wYSBkZWxheSk6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlbGF5X3NlY29uZHMgPSBpbnQoZGVsYXlfc2Vjb25kcykKICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIGRlbGF5X3NlY29uZHMgPSAwCiAgICAgICAgICAgICAgICBwdXJjaGFzZV9ieV9mYW1pbHkoZmFtaWx5X2NvZGUsIHVzZV9kZWNveSwgcGF1c2Vfb25fc3VjY2VzcywgZGVsYXlfc2Vjb25kcywgc3RhcnRfZnJvbV9vcHRpb24pCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI5IjoKICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XU1hc3Vra2FuIGZhbWlseSBjb2RlOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvcmRlciA9IGludChjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTWFzdWtrYW4gb3JkZXIgbnVtYmVyIChkZWZhdWx0IDEpOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikgb3IgMSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIG9yZGVyID0gMQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlbGF5ID0gaW50KGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2thbiBkZWxheSAoZGV0aWspIChkZWZhdWx0IDApOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikgb3IgMCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIGRlbGF5ID0gMAogICAgICAgICAgICAgICAgcGF1c2Vfb25fc3VjY2VzcyA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1Ba3RpZmthbiBtb2RlIHBhdXNlPyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLmxvd2VyKCkgPT0gJ3knCiAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgICAgIHNob3VsZF9jb250aW51ZSA9IHB1cmNoYXNlX2xvb3AoCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlPWZhbWlseV9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICBvcmRlcj1vcmRlciwKICAgICAgICAgICAgICAgICAgICAgICAgdXNlX2RlY295PVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5PWRlbGF5LAogICAgICAgICAgICAgICAgICAgICAgICBwYXVzZV9vbl9zdWNjZXNzPXBhdXNlX29uX3N1Y2Nlc3MKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNob3VsZF9jb250aW51ZToKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTAiOgogICAgICAgICAgICAgICAgdW5sb2NrX2NvZGUgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTWFzdWtrYW4ga29kZSB1bmxvY2s6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiB1bmxvY2tfY29kZSAhPSAiZG9uYXNpIjoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIktvZGUgdW5sb2NrIHNhbGFoLCBha3NlcyBkaXRvbGFrLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGxvb3BfY291bnQgPSBpbnQoY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUJlcmFwYSBrYWxpIGxvb3Bpbmc/IDpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpIG9yIDEpCiAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgICAgICBsb29wX2NvdW50ID0gMQogICAgICAgICAgICAgICAgcGF1c2Vfb25fc3VjY2VzcyA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1QYXVzZSBzZXRpYXAgc3Vrc2VzPyAoeS9uKTogWy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5sb3dlcigpID09ICJ5IgogICAgICAgICAgICAgICAgcmVkZWVtX2xvb3BpbmcobG9vcF9jb3VudCwgcGF1c2Vfb25fc3VjY2VzcykKCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gImQiOgogICAgICAgICAgICAgICAgc2hvd19idW5kbGVfbWVudSgpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gImYiOgogICAgICAgICAgICAgICAgc2hvd19mYW1pbHlfZ3J1cF9tZW51KCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKSA9PSAiYiI6CiAgICAgICAgICAgICAgICBzaG93X2Jvb2ttYXJrX21lbnUoKQogICAgICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJtIjoKICAgICAgICAgICAgICAgIHNob3dfbWFpbl9tZW51MihhY3RpdmVfdXNlciwgcHJvZmlsZSkKICAgICAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKSA9PSAiYyI6CiAgICAgICAgICAgICAgICBjbGVhcl9jYWNoZShhY2NvdW50X2lkKQogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsIGYiQ2FjaGUgYWt1biB7YWNjb3VudF9pZH0gdGVsYWggZGliZXJzaWhrYW4uIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjY2IjoKICAgICAgICAgICAgICAgIHNob3dfaW5mb19tZW51KCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjY5IjoKICAgICAgICAgICAgICAgIHNob3dfdGhlbWVfbWVudSgpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI5OSI6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VsdWFyIiwgIkFwbGlrYXNpIGRpdHV0dXAgZGVuZ2FuIGFtYW4uIikKICAgICAgICAgICAgICAgIHN5cy5leGl0KDApCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gInkiOgogICAgICAgICAgICAgICAgc2hvd19zcGVjaWFsX2Zvcl95b3VfbWVudShhY3RpdmVfdXNlclsidG9rZW5zIl0pCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gInMiOgogICAgICAgICAgICAgICAgZW50ZXJfc2VudHJ5X21vZGUoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJQaWxpaGFuIHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZWN0ZWRfdXNlcl9udW1iZXIgPSBzaG93X2FjY291bnRfbWVudSgpCiAgICAgICAgICAgIGlmIHNlbGVjdGVkX3VzZXJfbnVtYmVyOgogICAgICAgICAgICAgICAgQXV0aEluc3RhbmNlLnNldF9hY3RpdmVfdXNlcihzZWxlY3RlZF91c2VyX251bWJlcikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiVGlkYWsgYWRhIHVzZXIgdGVycGlsaWguIikKCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgdHJ5OgogICAgICAgIHdpdGggbGl2ZV9sb2FkaW5nKCJNZW1lcmlrc2EgcGVtYmFydWFuLi4uIiwgZ2V0X3RoZW1lKCkpOgogICAgICAgICAgICBuZWVkX3VwZGF0ZSA9IGNoZWNrX2Zvcl91cGRhdGVzKCkKICAgICAgICAjIEppa2EgaW5naW4gcGFrc2EgdXBkYXRlLCBha3RpZmthbiBibG9rIGluaToKICAgICAgICAjIGlmIG5lZWRfdXBkYXRlOgogICAgICAgICMgICAgIHByaW50X3dhcm5pbmcoIkluZm9ybWFzaSIsICJWZXJzaSBiYXJ1IHRlcnNlZGlhLCBzaWxha2FuIHVwZGF0ZSBzZWJlbHVtIG1lbGFuanV0a2FuLiIpCiAgICAgICAgIyAgICAgcGF1c2UoKQogICAgICAgICMgICAgIHN5cy5leGl0KDApCiAgICAgICAgbWFpbigpCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgcHJpbnRfZXJyb3IoIktlbHVhciIsICJBcGxpa2FzaSBkaWhlbnRpa2FuIG9sZWggcGVuZ2d1bmEuIikK').decode())
