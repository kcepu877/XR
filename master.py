#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBkb3RlbnYgaW1wb3J0IGxvYWRfZG90ZW52CmxvYWRfZG90ZW52KCkKCmltcG9ydCBzeXMsIGpzb24sIHJhbmRvbQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIGFwcC5jb25maWcuaW1wb3J0cyBpbXBvcnQgKgoKCmRlZiBzaG93X21haW5fbWVudShwcm9maWxlOiBkaWN0LCBkaXNwbGF5X3F1b3RhOiBzdHIsIHNlZ21lbnRzOiBkaWN0KToKICAgIGNsZWFyX3NjcmVlbigpCiAgICB0aGVtZSA9IGdldF90aGVtZSgpCgogICAgZXhwaXJlZF9hdF90cyA9IHByb2ZpbGUuZ2V0KCJiYWxhbmNlX2V4cGlyZWRfYXQiKQogICAgZXhwaXJlZF9hdF9kdCA9IGRhdGV0aW1lLmZyb210aW1lc3RhbXAoZXhwaXJlZF9hdF90cykuc3RyZnRpbWUoIiVZLSVtLSVkICVIOiVNOiVTIikgaWYgZXhwaXJlZF9hdF90cyBlbHNlICItIgogICAgcHVsc2Ffc3RyID0gZ2V0X3J1cGlhaChwcm9maWxlLmdldCgiYmFsYW5jZSIsIDApKQoKICAgIGluZm9fdGFibGUgPSBUYWJsZS5ncmlkKHBhZGRpbmc9KDAsIDEpKQogICAgaW5mb190YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9ImxlZnQiLCBzdHlsZT1nZXRfdGhlbWVfc3R5bGUoImJvcmRlcl9pbmZvIikpCiAgICBpbmZvX3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0ibGVmdCIsIHN0eWxlPWdldF90aGVtZV9zdHlsZSgidGV4dF9ib2R5IikpCgogICAgaW5mb190YWJsZS5hZGRfcm93KCIgTm9tb3IiLCBmIjog8J+TniBbYm9sZCB7dGhlbWVbJ3RleHRfYm9keSddfV17cHJvZmlsZVsnbnVtYmVyJ119Wy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiIFR5cGUiLCBmIjog8J+nviBbe3RoZW1lWyd0ZXh0X2JvZHknXX1de3Byb2ZpbGVbJ3N1YnNjcmlwdGlvbl90eXBlJ119ICh7cHJvZmlsZVsnc3Vic2NyaWJlcl9pZCddfSlbL10iKQogICAgaW5mb190YWJsZS5hZGRfcm93KCIgUHVsc2EiLCBmIjog8J+SsCBScCBbe3RoZW1lWyd0ZXh0X21vbmV5J119XXtwdWxzYV9zdHJ9Wy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiIEt1b3RhIiwgZiI6IPCfk4ogW3t0aGVtZVsndGV4dF9kYXRlJ119XXtkaXNwbGF5X3F1b3RhfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIiBUaWVyaW5nIiwgZiI6IPCfj4UgW3t0aGVtZVsndGV4dF9kYXRlJ119XXtwcm9maWxlWydwb2ludF9pbmZvJ119Wy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiIE1hc2EgQWt0aWYiLCBmIjog4o+zIFt7dGhlbWVbJ3RleHRfZGF0ZSddfV17ZXhwaXJlZF9hdF9kdH1bL10iKQoKICAgIGNvbnNvbGUucHJpbnQoCiAgICAgICAgUGFuZWwoCiAgICAgICAgICAgIGluZm9fdGFibGUsCiAgICAgICAgICAgIHRpdGxlPWYiW3tnZXRfdGhlbWVfc3R5bGUoJ3RleHRfdGl0bGUnKX1d4pyoIEluZm9ybWFzaSBBa3VuIOKcqFsvXSIsCiAgICAgICAgICAgIHRpdGxlX2FsaWduPSJjZW50ZXIiLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9Z2V0X3RoZW1lX3N0eWxlKCJib3JkZXJfaW5mbyIpLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUsCiAgICAgICAgKQogICAgKQoKICAgIHNwZWNpYWxfcGFja2FnZXMgPSBzZWdtZW50cy5nZXQoInNwZWNpYWxfcGFja2FnZXMiLCBbXSkKICAgIGlmIHNwZWNpYWxfcGFja2FnZXM6CiAgICAgICAgYmVzdCA9IHJhbmRvbS5jaG9pY2Uoc3BlY2lhbF9wYWNrYWdlcykKICAgICAgICBuYW1lID0gYmVzdC5nZXQoIm5hbWUiLCAiLSIpCiAgICAgICAgZGlza29uX3BlcmNlbnQgPSBiZXN0LmdldCgiZGlza29uX3BlcmNlbnQiLCAwKQogICAgICAgIGRpc2tvbl9wcmljZSA9IGJlc3QuZ2V0KCJkaXNrb25fcHJpY2UiLCAwKQogICAgICAgIG9yaWdpbmFsX3ByaWNlID0gYmVzdC5nZXQoIm9yaWdpbmFsX3ByaWNlIiwgMCkKICAgICAgICBlbW9qaV9kaXNrb24gPSAi8J+SuCIgaWYgZGlza29uX3BlcmNlbnQgPj0gNTAgZWxzZSAiIgogICAgICAgIGVtb2ppX2t1b3RhID0gIvCflKUiIGlmIGJlc3QuZ2V0KCJrdW90YV9nYiIsIDApID49IDEwMCBlbHNlICIiCgogICAgICAgIHNwZWNpYWxfdGV4dCA9ICgKICAgICAgICAgICAgZiJbYm9sZCB7dGhlbWVbJ3RleHRfdGl0bGUnXX1d8J+UpfCflKXwn5SlIFBha2V0IFNwZWNpYWwgVW50dWttdSEg8J+UpfCflKXwn5SlWy97dGhlbWVbJ3RleHRfdGl0bGUnXX1dXG5cbiIKICAgICAgICAgICAgZiJbe3RoZW1lWyd0ZXh0X2JvZHknXX1de2Vtb2ppX2t1b3RhfSB7bmFtZX1bL3t0aGVtZVsndGV4dF9ib2R5J119XVxuIgogICAgICAgICAgICBmIkRpc2tvbiB7ZGlza29uX3BlcmNlbnR9JSB7ZW1vamlfZGlza29ufSAiCiAgICAgICAgICAgIGYiUnBbe3RoZW1lWyd0ZXh0X2VyciddfV1bc3RyaWtlXXtnZXRfcnVwaWFoKG9yaWdpbmFsX3ByaWNlKX1bL3N0cmlrZV1bL3t0aGVtZVsndGV4dF9lcnInXX1dIOKeoe+4jyAiCiAgICAgICAgICAgIGYiUnBbe3RoZW1lWyd0ZXh0X21vbmV5J119XXtnZXRfcnVwaWFoKGRpc2tvbl9wcmljZSl9Wy97dGhlbWVbJ3RleHRfbW9uZXknXX1dIgogICAgICAgICkKCiAgICAgICAgY29uc29sZS5wcmludCgKICAgICAgICAgICAgUGFuZWwoCiAgICAgICAgICAgICAgICBBbGlnbi5jZW50ZXIoc3BlY2lhbF90ZXh0KSwKICAgICAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3dhcm5pbmciXSwKICAgICAgICAgICAgICAgIHBhZGRpbmc9KDAsIDIpLAogICAgICAgICAgICAgICAgd2lkdGg9Y29uc29sZS5zaXplLndpZHRoLAogICAgICAgICAgICApCiAgICAgICAgKQogICAgICAgIGNvbnNvbGUucHJpbnQoQWxpZ24uY2VudGVyKGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWggW1ldIHVudHVrIGxpaGF0IHNlbXVhIHBha2V0IHNwZXNpYWxbL3t0aGVtZVsndGV4dF9zdWInXX1dIikpCgogICAgbWVudV90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICBtZW51X3RhYmxlLmFkZF9jb2x1bW4oIktvZGUiLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPWdldF90aGVtZV9zdHlsZSgidGV4dF9rZXkiKSwgd2lkdGg9NikKICAgIG1lbnVfdGFibGUuYWRkX2NvbHVtbigiQWtzaSIsIHN0eWxlPWdldF90aGVtZV9zdHlsZSgidGV4dF9ib2R5IikpCgogICAgbWVudV90YWJsZS5hZGRfcm93KCIxIiwgIvCflJAgTG9naW4vR2FudGkgYWt1biIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIjIiLCAi8J+TkSBMaWhhdCBQYWtldCBTYXlhIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMyIsICLwn5SlIEJlbGkgUGFrZXQgSG90IFByb21vIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiNCIsICLwn5SlIEJlbGkgUGFrZXQgSG90IFByb21vLTIiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI1IiwgIvCfkrQgQmVsaSBQYWtldCBWaWEgT3B0aW9uIENvZGUiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI2IiwgIvCfkrUgQmVsaSBQYWtldCBWaWEgRmFtaWx5IENvZGUiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI3IiwgIvCflIEgQmVsaSBTZW11YSBQYWtldCBkaSBGYW1pbHkgQ29kZSIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIjgiLCAi8J+UgiBCZWxpIGJlcnVsYW5nIGRhcmkgRmFtaWx5IENvZGUiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCIiLCAiIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiRCIsICLwn46tIENpcHRha2FuIFBha2V0IGJ1bmRsZSAoZGVjb3kpIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiRiIsICLwn5K+IFNpbXBhbi9LZWxvbGEgRmFtaWx5IENvZGUiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCJCIiwgIvCfk4wgTGlzdCBCb29rbWFyayBQYWtldCIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIkMiLCBmIlt7dGhlbWVbJ3RleHRfYm9keSddfV3wn6e5IEJlcnNpaGthbiBDYWNoZSBha3VuWy9dIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiTSIsIGYiW3t0aGVtZVsndGV4dF9ib2R5J119XeKYlSBNZW51IEJlcmlrdXRueWEuLlsvXSIpCiAgICBtZW51X3RhYmxlLmFkZF9yb3coIiIsICIiKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI2NiIsIGYiW3t0aGVtZVsnYm9yZGVyX3dhcm5pbmcnXX1d8J+ToiBJbmZvIFVubG9jayBDb2RlWy9dIikKICAgIG1lbnVfdGFibGUuYWRkX3JvdygiNjkiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XfCfjqggR2FudGkgVGVtYSBDTElbL10iKQogICAgbWVudV90YWJsZS5hZGRfcm93KCI5OSIsIGYiW3t0aGVtZVsndGV4dF9lcnInXX1d4puUIFR1dHVwIEFwbGlrYXNpWy9dIikKCiAgICBjb25zb2xlLnByaW50KAogICAgICAgIFBhbmVsKAogICAgICAgICAgICBtZW51X3RhYmxlLAogICAgICAgICAgICB0aXRsZT1mIlt7Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X3RpdGxlJyl9XeKcqCBNZW51IFV0YW1hIOKcqFsvXSIsCiAgICAgICAgICAgIHRpdGxlX2FsaWduPSJjZW50ZXIiLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9Z2V0X3RoZW1lX3N0eWxlKCJib3JkZXJfcHJpbWFyeSIpLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUsCiAgICAgICAgKQogICAgKQoKCmRlZiBzaG93X21haW5fbWVudTIoYWN0aXZlX3VzZXI6IGRpY3QsIHByb2ZpbGU6IGRpY3QpOgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQoKICAgIGlmIG5vdCBhY3RpdmVfdXNlciBvciAidG9rZW5zIiBub3QgaW4gYWN0aXZlX3VzZXI6CiAgICAgICAgcHJpbnRfZXJyb3IoIuKdjCIsICJVc2VyIGJlbHVtIGFrdGlmLCBzaWxha2FuIGxvZ2luIGR1bHUuIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuCgogICAgd2hpbGUgVHJ1ZToKICAgICAgICBjbGVhcl9zY3JlZW4oKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBBbGlnbi5jZW50ZXIoIuKYlSBIYWxhbWFuIE1lbnUtMiIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQogICAgICAgIHNpbXBsZV9udW1iZXIoKQoKICAgICAgICBtZW51X3RhYmxlID0gVGFibGUoc2hvd19oZWFkZXI9RmFsc2UsIGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBtZW51X3RhYmxlLmFkZF9jb2x1bW4oIktvZGUiLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPWdldF90aGVtZV9zdHlsZSgidGV4dF9rZXkiKSwgd2lkdGg9NikKICAgICAgICBtZW51X3RhYmxlLmFkZF9jb2x1bW4oIkFrc2kiLCBzdHlsZT1nZXRfdGhlbWVfc3R5bGUoInRleHRfYm9keSIpKQoKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIjEwIiwgIvCfk5wgUml3YXlhdCBUcmFuc2Frc2kiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTEiLCAi8J+RqOKAjfCfkanigI3wn5Gn4oCN8J+RpiBBa3JhYiBPcmdhbml6ZXIiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTIiLCAi8J+RpSBDaXJjbGUiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTMiLCAi8J+PrCBTdG9yZSBTZWdtZW50cyIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCIxNCIsICLwn5OCIFN0b3JlIEZhbWlseSBMaXN0IikKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIjE1IiwgIvCfk6YgU3RvcmUgUGFja2FnZXMiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMTYiLCAi8J+OgSBSZWRlZW1hYmxlcyIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCIiLCAiIikKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIk4iLCAi8J+UlCBOb3RpZmlrYXNpIikKICAgICAgICBtZW51X3RhYmxlLmFkZF9yb3coIlIiLCAi8J+TnSBSZWdpc3RlciIpCiAgICAgICAgbWVudV90YWJsZS5hZGRfcm93KCJWIiwgIuKchSBWYWxpZGF0ZSBNU0lTRE4iKQogICAgICAgICNtZW51X3RhYmxlLmFkZF9yb3coIiIsICIiKQogICAgICAgIG1lbnVfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUtlbWJhbGkga2UgbWVudSB1dGFtYVsvXSIpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIG1lbnVfdGFibGUsCiAgICAgICAgICAgIHRpdGxlPWYiW3tnZXRfdGhlbWVfc3R5bGUoJ3RleHRfdGl0bGUnKX1d8J+nviBNZW51Wy9dIiwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWggbWVudTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjEwIjoKICAgICAgICAgICAgc2hvd190cmFuc2FjdGlvbl9oaXN0b3J5KEF1dGhJbnN0YW5jZS5hcGlfa2V5LCBhY3RpdmVfdXNlclsidG9rZW5zIl0pCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjExIjoKICAgICAgICAgICAgc2hvd19mYW1pbHlfaW5mbyhBdXRoSW5zdGFuY2UuYXBpX2tleSwgYWN0aXZlX3VzZXJbInRva2VucyJdKQogICAgICAgIGVsaWYgY2hvaWNlID09ICIxMiI6CiAgICAgICAgICAgIHNob3dfY2lyY2xlX2luZm8oQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXSkKICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTMiOgogICAgICAgICAgICBpc19lbnRlcnByaXNlID0gaW5wdXQoIvCfj6wgRW50ZXJwcmlzZSBzdG9yZT8gKHkvbik6ICIpLmxvd2VyKCkgPT0gInkiCiAgICAgICAgICAgIHNob3dfc3RvcmVfc2VnbWVudHNfbWVudShpc19lbnRlcnByaXNlKQogICAgICAgIGVsaWYgY2hvaWNlID09ICIxNCI6CiAgICAgICAgICAgIGlzX2VudGVycHJpc2UgPSBpbnB1dCgi8J+TgiBFbnRlcnByaXNlPyAoeS9uKTogIikubG93ZXIoKSA9PSAieSIKICAgICAgICAgICAgc2hvd19mYW1pbHlfbGlzdF9tZW51KHByb2ZpbGVbInN1YnNjcmlwdGlvbl90eXBlIl0sIGlzX2VudGVycHJpc2UpCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjE1IjoKICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSA9IGlucHV0KCLwn5OmIEVudGVycHJpc2U/ICh5L24pOiAiKS5sb3dlcigpID09ICJ5IgogICAgICAgICAgICBzaG93X3N0b3JlX3BhY2thZ2VzX21lbnUocHJvZmlsZVsic3Vic2NyaXB0aW9uX3R5cGUiXSwgaXNfZW50ZXJwcmlzZSkKICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTYiOgogICAgICAgICAgICBpc19lbnRlcnByaXNlID0gaW5wdXQoIvCfjoEgRW50ZXJwcmlzZT8gKHkvbik6ICIpLmxvd2VyKCkgPT0gInkiCiAgICAgICAgICAgIHNob3dfcmVkZWVtYWJsZXNfbWVudShpc19lbnRlcnByaXNlKQoKICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJuIjoKICAgICAgICAgICAgc2hvd19ub3RpZmljYXRpb25fbWVudSgpCiAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKSA9PSAiciI6CiAgICAgICAgICAgIG1zaXNkbiA9IGlucHV0KCLwn5OdIE1hc3Vra2FuIG1zaXNkbiAoNjI4eHh4eCk6ICIpCiAgICAgICAgICAgIG5payA9IGlucHV0KCJNYXN1a2thbiBOSUs6ICIpCiAgICAgICAgICAgIGtrID0gaW5wdXQoIk1hc3Vra2FuIEtLOiAiKQogICAgICAgICAgICByZXMgPSBkdWtjYXBpbChBdXRoSW5zdGFuY2UuYXBpX2tleSwgbXNpc2RuLCBraywgbmlrKQogICAgICAgICAgICBwcmludF9wYW5lbCgi8J+TkSBIYXNpbCBSZWdpc3RyYXNpIiwganNvbi5kdW1wcyhyZXMsIGluZGVudD0yKSkKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gInYiOgogICAgICAgICAgICBtc2lzZG4gPSBpbnB1dCgi4pyFIE1hc3Vra2FuIG1zaXNkbiB1bnR1ayB2YWxpZGFzaSAoNjI4eHh4eCk6ICIpCiAgICAgICAgICAgIHJlcyA9IHZhbGlkYXRlX21zaXNkbihBdXRoSW5zdGFuY2UuYXBpX2tleSwgYWN0aXZlX3VzZXJbInRva2VucyJdLCBtc2lzZG4pCiAgICAgICAgICAgIHByaW50X3BhbmVsKCLwn5ORIEhhc2lsIFZhbGlkYXNpIiwganNvbi5kdW1wcyhyZXMsIGluZGVudD0yKSkKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgIGVsaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgICAgIGxpdmVfbG9hZGluZyh0ZXh0PSJLZW1iYWxpIGtlIG1lbnUgdXRhbWEuLi4iLCB0aGVtZT10aGVtZSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfd2FybmluZygi4pqg77iPIiwgIlBpbGloYW4gdGlkYWsgdmFsaWQuIFNpbGFrYW4gY29iYSBsYWdpLiIpCiAgICAgICAgICAgIHBhdXNlKCkKCgpkZWYgbWFpbigpOgogICAgZW5zdXJlX2dpdCgpCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgICAgICBhY3RpdmVfdXNlciA9IEF1dGhJbnN0YW5jZS5nZXRfYWN0aXZlX3VzZXIoKQogICAgICAgIGlmIGFjdGl2ZV91c2VyIGlzIG5vdCBOb25lOgogICAgICAgICAgICBhY2NvdW50X2lkID0gYWN0aXZlX3VzZXJbIm51bWJlciJdCgogICAgICAgICAgICB3aXRoIGxpdmVfbG9hZGluZygi8J+UhCBNZW11YXQgZGF0YSBha3VuLi4uIiwgZ2V0X3RoZW1lKCkpOgogICAgICAgICAgICAgICAgIyBCYWxhbmNlIGNhY2hlIHBlciBha3VuIChUVEwgMzAgZGV0aWspCiAgICAgICAgICAgICAgICBiYWxhbmNlID0gZ2V0X2NhY2hlKGFjY291bnRfaWQsICJiYWxhbmNlIiwgdHRsPTkwKQogICAgICAgICAgICAgICAgaWYgbm90IGJhbGFuY2U6CiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZSA9IGdldF9iYWxhbmNlKEF1dGhJbnN0YW5jZS5hcGlfa2V5LCBhY3RpdmVfdXNlclsidG9rZW5zIl1bImlkX3Rva2VuIl0pCiAgICAgICAgICAgICAgICAgICAgc2V0X2NhY2hlKGFjY291bnRfaWQsICJiYWxhbmNlIiwgYmFsYW5jZSkKCiAgICAgICAgICAgICAgICAjIFF1b3RhIGNhY2hlIHBlciBha3VuIChUVEwgMzAgZGV0aWspCiAgICAgICAgICAgICAgICBxdW90YSA9IGdldF9jYWNoZShhY2NvdW50X2lkLCAicXVvdGEiLCB0dGw9NjApCiAgICAgICAgICAgICAgICBpZiBub3QgcXVvdGE6CiAgICAgICAgICAgICAgICAgICAgcXVvdGEgPSBnZXRfcXVvdGEoQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXVsiaWRfdG9rZW4iXSkgb3Ige30KICAgICAgICAgICAgICAgICAgICBzZXRfY2FjaGUoYWNjb3VudF9pZCwgInF1b3RhIiwgcXVvdGEpCgogICAgICAgICAgICAgICAgIyBTZWdtZW50cyBjYWNoZSBwZXIgYWt1biAoVFRMIDMwMCBkZXRpaywgZmlsZS1iYXNlZCkKICAgICAgICAgICAgICAgIHNlZ21lbnRzID0gZ2V0X2NhY2hlKGFjY291bnRfaWQsICJzZWdtZW50cyIsIHR0bD0zMDAsIHVzZV9maWxlPVRydWUpCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VnbWVudHM6CiAgICAgICAgICAgICAgICAgICAgc2VnbWVudHMgPSBkYXNoX3NlZ21lbnRzKAogICAgICAgICAgICAgICAgICAgICAgICBBdXRoSW5zdGFuY2UuYXBpX2tleSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlX3VzZXJbInRva2VucyJdWyJpZF90b2tlbiJdLAogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVfdXNlclsidG9rZW5zIl1bImFjY2Vzc190b2tlbiJdCiAgICAgICAgICAgICAgICAgICAgKSBvciB7fQogICAgICAgICAgICAgICAgICAgIHNldF9jYWNoZShhY2NvdW50X2lkLCAic2VnbWVudHMiLCBzZWdtZW50cywgdXNlX2ZpbGU9VHJ1ZSkKCiAgICAgICAgICAgIHJlbWFpbmluZyA9IHF1b3RhLmdldCgicmVtYWluaW5nIiwgMCkKICAgICAgICAgICAgdG90YWwgPSBxdW90YS5nZXQoInRvdGFsIiwgMCkKICAgICAgICAgICAgaGFzX3VubGltaXRlZCA9IHF1b3RhLmdldCgiaGFzX3VubGltaXRlZCIsIEZhbHNlKQogICAgICAgICAgICBpZiB0b3RhbCA+IDAgb3IgaGFzX3VubGltaXRlZDoKICAgICAgICAgICAgICAgIGRpc3BsYXlfcXVvdGEgPSBmIntyZW1haW5pbmcvMWU5Oi4yZn0gLyB7dG90YWwvMWU5Oi4yZn0gR0IiICsgKCIgKFVubGltaXRlZCkiIGlmIGhhc191bmxpbWl0ZWQgZWxzZSAiIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGRpc3BsYXlfcXVvdGEgPSAiLSIKCiAgICAgICAgICAgIHBvaW50X2luZm8gPSAiUG9pbnRzOiBOL0EgfCBUaWVyOiBOL0EiCiAgICAgICAgICAgIGlmIGFjdGl2ZV91c2VyWyJzdWJzY3JpcHRpb25fdHlwZSJdID09ICJQUkVQQUlEIjoKICAgICAgICAgICAgICAgICMgVGllcmluZyBjYWNoZSBwZXIgYWt1biAoVFRMIDMwMCBkZXRpaykKICAgICAgICAgICAgICAgIHRpZXJpbmdfZGF0YSA9IGdldF9jYWNoZShhY2NvdW50X2lkLCAidGllcmluZyIsIHR0bD0yNDApCiAgICAgICAgICAgICAgICBpZiBub3QgdGllcmluZ19kYXRhOgogICAgICAgICAgICAgICAgICAgIHRpZXJpbmdfZGF0YSA9IGdldF90aWVyaW5nX2luZm8oQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXSkKICAgICAgICAgICAgICAgICAgICBzZXRfY2FjaGUoYWNjb3VudF9pZCwgInRpZXJpbmciLCB0aWVyaW5nX2RhdGEpCiAgICAgICAgICAgICAgICBwb2ludF9pbmZvID0gZiJQb2ludHM6IHt0aWVyaW5nX2RhdGEuZ2V0KCdjdXJyZW50X3BvaW50JywwKX0gfCBUaWVyOiB7dGllcmluZ19kYXRhLmdldCgndGllcicsMCl9IgoKICAgICAgICAgICAgcHJvZmlsZSA9IHsKICAgICAgICAgICAgICAgICJudW1iZXIiOiBhY3RpdmVfdXNlclsibnVtYmVyIl0sCiAgICAgICAgICAgICAgICAic3Vic2NyaWJlcl9pZCI6IGFjdGl2ZV91c2VyWyJzdWJzY3JpYmVyX2lkIl0sCiAgICAgICAgICAgICAgICAic3Vic2NyaXB0aW9uX3R5cGUiOiBhY3RpdmVfdXNlclsic3Vic2NyaXB0aW9uX3R5cGUiXSwKICAgICAgICAgICAgICAgICJiYWxhbmNlIjogYmFsYW5jZS5nZXQoInJlbWFpbmluZyIpLAogICAgICAgICAgICAgICAgImJhbGFuY2VfZXhwaXJlZF9hdCI6IGJhbGFuY2UuZ2V0KCJleHBpcmVkX2F0IiksCiAgICAgICAgICAgICAgICAicG9pbnRfaW5mbyI6IHBvaW50X2luZm8sCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNob3dfbWFpbl9tZW51KHByb2ZpbGUsIGRpc3BsYXlfcXVvdGEsIHNlZ21lbnRzKQoKICAgICAgICAgICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XfCfkYkgUGlsaWggbWVudTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKCiAgICAgICAgICAgIGlmIGNob2ljZS5sb3dlcigpID09ICJ0IjoKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICAgICAgICAgc2VsZWN0ZWRfdXNlcl9udW1iZXIgPSBzaG93X2FjY291bnRfbWVudSgpCiAgICAgICAgICAgICAgICBpZiBzZWxlY3RlZF91c2VyX251bWJlcjoKICAgICAgICAgICAgICAgICAgICBBdXRoSW5zdGFuY2Uuc2V0X2FjdGl2ZV91c2VyKHNlbGVjdGVkX3VzZXJfbnVtYmVyKQogICAgICAgICAgICAgICAgICAgIHByaW50X3N1Y2Nlc3MoIvCflJAiLCBmIkFrdW4gYWt0aWYgZGlnYW50aSBrZSB7c2VsZWN0ZWRfdXNlcl9udW1iZXJ9IikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfZXJyb3IoIuKdjCIsICJUaWRhayBhZGEgdXNlciB0ZXJwaWxpaCBhdGF1IGdhZ2FsIG1lbXVhdCB1c2VyLiIpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgICAgICAgICBmZXRjaF9teV9wYWNrYWdlcygpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMyI6CiAgICAgICAgICAgICAgICBzaG93X2hvdF9tZW51KCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjQiOgogICAgICAgICAgICAgICAgc2hvd19ob3RfbWVudTIoKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNSI6CiAgICAgICAgICAgICAgICBvcHRpb25fY29kZSA9IGlucHV0KCLwn5SOIE1hc3Vra2FuIG9wdGlvbiBjb2RlOiAiKQogICAgICAgICAgICAgICAgaWYgb3B0aW9uX2NvZGUgPT0gIjk5IjoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgc2hvd19wYWNrYWdlX2RldGFpbHMoQXV0aEluc3RhbmNlLmFwaV9rZXksIGFjdGl2ZV91c2VyWyJ0b2tlbnMiXSwgb3B0aW9uX2NvZGUsIEZhbHNlKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNiI6CiAgICAgICAgICAgICAgICBmYW1pbHlfY29kZSA9IGlucHV0KCLwn5SOIE1hc3Vra2FuIGZhbWlseSBjb2RlOiAiKQogICAgICAgICAgICAgICAgaWYgZmFtaWx5X2NvZGUgPT0gIjk5IjoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZ2V0X3BhY2thZ2VzX2J5X2ZhbWlseShmYW1pbHlfY29kZSkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjciOgogICAgICAgICAgICAgICAgZmFtaWx5X2NvZGUgPSBpbnB1dCgi8J+UjiBNYXN1a2thbiBmYW1pbHkgY29kZTogIikKICAgICAgICAgICAgICAgIGlmIGZhbWlseV9jb2RlID09ICI5OSI6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHN0YXJ0X2Zyb21fb3B0aW9uID0gaW5wdXQoIk11bGFpIGRhcmkgb3B0aW9uIG51bWJlciAoZGVmYXVsdCAxKTogIikKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzdGFydF9mcm9tX29wdGlvbiA9IGludChzdGFydF9mcm9tX29wdGlvbikKICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIHN0YXJ0X2Zyb21fb3B0aW9uID0gMQogICAgICAgICAgICAgICAgdXNlX2RlY295ID0gaW5wdXQoIkd1bmFrYW4gZGVjb3kgcGFja2FnZT8gKHkvbik6ICIpLmxvd2VyKCkgPT0gInkiCiAgICAgICAgICAgICAgICBwYXVzZV9vbl9zdWNjZXNzID0gaW5wdXQoIlBhdXNlIHRpYXAgc3Vrc2VzPyAoeS9uKTogIikubG93ZXIoKSA9PSAieSIKICAgICAgICAgICAgICAgIGRlbGF5X3NlY29uZHMgPSBpbnB1dCgiRGVsYXkgYW50YXIgcGVtYmVsaWFuICgwID0gdGFucGEgZGVsYXkpOiAiKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlbGF5X3NlY29uZHMgPSBpbnQoZGVsYXlfc2Vjb25kcykKICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIGRlbGF5X3NlY29uZHMgPSAwCiAgICAgICAgICAgICAgICBwdXJjaGFzZV9ieV9mYW1pbHkoZmFtaWx5X2NvZGUsIHVzZV9kZWNveSwgcGF1c2Vfb25fc3VjY2VzcywgZGVsYXlfc2Vjb25kcywgc3RhcnRfZnJvbV9vcHRpb24pCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI4IjoKICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlID0gaW5wdXQoIkVudGVyIGZhbWlseSBjb2RlOiAiKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG9yZGVyID0gaW50KGlucHV0KCJFbnRlciBvcmRlciBudW1iZXI6ICIpIG9yIDEpCiAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgICAgICBvcmRlciA9IDEKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkZWxheSA9IGludChpbnB1dCgiRW50ZXIgZGVsYXkgaW4gc2Vjb25kczogIikgb3IgMCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgIGRlbGF5ID0gMAogICAgICAgICAgICAgICAgcGF1c2Vfb25fc3VjY2VzcyA9IGlucHV0KCJBa3RpZmthbiBtb2RlIHBhdXNlPyAoeS9uKTogIikubG93ZXIoKSA9PSAneScKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgc2hvdWxkX2NvbnRpbnVlID0gcHVyY2hhc2VfbG9vcCgKICAgICAgICAgICAgICAgICAgICAgICAgZmFtaWx5X2NvZGU9ZmFtaWx5X2NvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyPW9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VfZGVjb3k9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk9ZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdXNlX29uX3N1Y2Nlc3M9cGF1c2Vfb25fc3VjY2VzcwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2hvdWxkX2NvbnRpbnVlOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY29udGludWUKIAogICAgICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJkIjoKICAgICAgICAgICAgICAgIHNob3dfYnVuZGxlX21lbnUoKQogICAgICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJmIjoKICAgICAgICAgICAgICAgIHNob3dfZmFtaWx5X2dydXBfbWVudSgpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gImIiOgogICAgICAgICAgICAgICAgc2hvd19ib29rbWFya19tZW51KCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKSA9PSAibSI6CiAgICAgICAgICAgICAgICBzaG93X21haW5fbWVudTIoYWN0aXZlX3VzZXIsIHByb2ZpbGUpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gImMiOgogICAgICAgICAgICAgICAgY2xlYXJfY2FjaGUoYWNjb3VudF9pZCkKICAgICAgICAgICAgICAgIHByaW50X3N1Y2Nlc3MoIvCfp7kiLCBmIkNhY2hlIHVudHVrIGFrdW4ge2FjY291bnRfaWR9IGJlcmhhc2lsIGRpYmVyc2loa2FuLiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCgogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNjYiOgogICAgICAgICAgICAgICAgc2hvd19pbmZvX21lbnUoKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNjkiOgogICAgICAgICAgICAgICAgc2hvd190aGVtZV9tZW51KCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjk5IjoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLwn5GLIFNhbXBhaSBqdW1wYSEiLCAiQXBsaWthc2kgZGl0dXR1cCBkZW5nYW4gYW1hbi4iKQogICAgICAgICAgICAgICAgc3lzLmV4aXQoMCkKCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gInkiOgogICAgICAgICAgICAgICAgc2hvd19zcGVjaWFsX2Zvcl95b3VfbWVudShhY3RpdmVfdXNlclsidG9rZW5zIl0pCiAgICAgICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gInMiOgogICAgICAgICAgICAgICAgZW50ZXJfc2VudHJ5X21vZGUoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfd2FybmluZygi4pqg77iPIiwgIlBpbGloYW4gdGlkYWsgdmFsaWQuIFNpbGFrYW4gY29iYSBsYWdpLiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZWN0ZWRfdXNlcl9udW1iZXIgPSBzaG93X2FjY291bnRfbWVudSgpCiAgICAgICAgICAgIGlmIHNlbGVjdGVkX3VzZXJfbnVtYmVyOgogICAgICAgICAgICAgICAgQXV0aEluc3RhbmNlLnNldF9hY3RpdmVfdXNlcihzZWxlY3RlZF91c2VyX251bWJlcikKICAgICAgICAgICAgICAgIHByaW50X3N1Y2Nlc3MoIvCflJAiLCBmIkFrdW4gYWt0aWYgZGlnYW50aSBrZSB7c2VsZWN0ZWRfdXNlcl9udW1iZXJ9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50X2Vycm9yKCLinYwiLCAiVGlkYWsgYWRhIHVzZXIgdGVycGlsaWggYXRhdSBnYWdhbCBtZW11YXQgdXNlci4iKQoKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0cnk6CiAgICAgICAgd2l0aCBsaXZlX2xvYWRpbmcoIvCflIQgQ2hlY2tpbmcgZm9yIHVwZGF0ZXMuLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgICAgIG5lZWRfdXBkYXRlID0gY2hlY2tfZm9yX3VwZGF0ZXMoKQogICAgICAgICMgSmlrYSBpbmdpbiBwYWtzYSB1cGRhdGUsIGFrdGlma2FuIGJsb2sgaW5pOgogICAgICAgICMgaWYgbmVlZF91cGRhdGU6CiAgICAgICAgIyAgICAgcHJpbnRfd2FybmluZygi4qyG77iPIiwgIlZlcnNpIGJhcnUgdGVyc2VkaWEsIHNpbGFrYW4gdXBkYXRlIHNlYmVsdW0gbWVsYW5qdXRrYW4uIikKICAgICAgICAjICAgICBwYXVzZSgpCiAgICAgICAgIyAgICAgc3lzLmV4aXQoMCkKICAgICAgICBtYWluKCkKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICBwcmludF9lcnJvcigi8J+RiyBLZWx1YXIiLCAiQXBsaWthc2kgZGloZW50aWthbiBvbGVoIHBlbmdndW5hLiIpCg==').decode())
