name: ğŸ›¡ï¸ Rollback via Protected Branch

on:
  workflow_dispatch:
    inputs:
      commit_hash:
        description: 'Commit hash to rollback to'
        required: true
        default: '7f4fb63d06f4a60fe822d57733d86317df759f76'

jobs:
  rollback:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Create branch dari commit target
      - name: ğŸŒ¿ Create Rollback Branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.commit_hash }}
          
      - name: Push as New Branch
        run: |
          BRANCH_NAME="rollback-$(date +%s)"
          git checkout -b "$BRANCH_NAME"
          git push origin "$BRANCH_NAME" --force
          echo "ğŸ“Œ Branch created: $BRANCH_NAME"
          echo "ğŸ‘‰ Create PR from $BRANCH_NAME to main"
          
      # Step 2: Auto-create Pull Request
      - name: ğŸ“ Create Pull Request
        uses: repo-sync/pull-request@v2
        with:
          destination_branch: "main"
          github_token: ${{ secrets.GITHUB_TOKEN }}
          pr_title: "ğŸš€ Rollback to ${{ github.event.inputs.commit_hash }}"
          pr_body: |
            Automated rollback to previous stable version.
            
            **Target Commit:** ${{ github.event.inputs.commit_hash }}
            **Created:** $(date)
            
            Merge this PR to complete rollback.
          pr_reviewer: ""
          pr_assignee: ""
