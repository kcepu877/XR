name: üåê Universal Code Obfuscator

on:
  workflow_dispatch:
    inputs:
      extensions:
        description: 'File extensions to process (comma separated)'
        required: false
        default: 'py,sh,js'

jobs:
  obfuscate-all:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Obfuscate Multiple File Types
      run: |
        # Split extensions from input
        IFS=',' read -ra EXT_ARRAY <<< "${{ github.event.inputs.extensions || 'py,sh,js' }}"
        
        for ext in "${EXT_ARRAY[@]}"; do
          echo "üß™ Processing .$ext files..."
          
          # Find all files with this extension
          find . -type f -name "*.$ext" ! -path "./.git/*" | while read -r file; do
            echo "üîß Processing: $file"
            
            case "$ext" in
              sh)
                # BASH/SH OBFUSCATION
                encoded=$(base64 -w 0 "$file")
                cat > "${file}.tmp" << EOF
#!/bin/bash
# üî• OBFUSCATED - $(basename "$file")
eval "\$(echo "$encoded" | base64 -d)"
EOF
                ;;
                
              py)
                # PYTHON OBFUSCATION
                encoded=$(base64 -w 0 "$file")
                cat > "${file}.tmp" << EOF
#!/usr/bin/env python3
# üî• OBFUSCATED - $(basename "$file")
import base64, sys

CODE = """$encoded"""

try:
    exec(base64.b64decode(CODE).decode('utf-8'))
except Exception as e:
    print(f"[Obfuscation Error] {e}")
    sys.exit(1)
EOF
                ;;
                
              js)
                # JAVASCRIPT OBFUSCATION
                encoded=$(base64 -w 0 "$file")
                cat > "${file}.tmp" << EOF
#!/usr/bin/env node
// üî• OBFUSCATED - $(basename "$file")
const encoded = "$encoded";
const Buffer = require('buffer').Buffer;

try {
    eval(Buffer.from(encoded, 'base64').toString());
} catch(e) {
    console.error("[Obfuscation Error]", e);
    process.exit(1);
}
EOF
                ;;
                
              *)
                echo "‚ö†Ô∏è Unknown extension: .$ext"
                continue
                ;;
            esac
            
            # Replace original file
            if [ -f "${file}.tmp" ]; then
              mv -f "${file}.tmp" "$file"
              chmod +x "$file"
              echo "‚úÖ Obfuscated: $file"
            fi
          done
          
          echo "üìä Total .$ext files: $(find . -type f -name "*.$ext" ! -path "./.git/*" | wc -l)"
        done
    
    - name: Commit & Push Changes
      run: |
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "actions@github.com"
        
        # Check if there are changes
        if git diff --quiet && git diff --staged --quiet; then
          echo "ü§∑ No changes to commit"
        else
          git add -A
          git commit -m "üåê Auto-obfuscate: ${{ github.event.inputs.extensions || 'py,sh,js' }} [$(date +'%Y-%m-%d %H:%M:%S')]"
          git push
          echo "üöÄ Changes pushed successfully"
        fi
