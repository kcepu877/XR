name: üåê Universal Code Obfuscator

on:
  workflow_dispatch:
    inputs:
      extensions:
        description: 'File extensions to process (comma separated)'
        required: false
        default: 'py,sh,js'

jobs:
  obfuscate-all:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Obfuscate Multiple File Types
      run: |
        # Split extensions from input
        EXTENSIONS="${{ github.event.inputs.extensions || 'py,sh,js' }}"
        IFS=',' read -ra EXT_ARRAY <<< "$EXTENSIONS"
        
        for ext in "${EXT_ARRAY[@]}"; do
          echo "üß™ Processing .$ext files..."
          
          # Find all files with this extension
          find . -type f -name "*.$ext" ! -path "./.git/*" | while read -r file; do
            echo "üîß Processing: $file"
            
            case "$ext" in
              sh)
                # BASH/SH OBFUSCATION
                encoded=$(base64 -w 0 "$file")
                cat > "${file}.tmp" << 'EOF'
#!/bin/bash
# üî• OBFUSCATED
eval "$(base64 -d <<< "
EOF
                echo "$encoded" >> "${file}.tmp"
                cat >> "${file}.tmp" << 'EOF'
")"
EOF
                ;;
                
              py)
                # PYTHON OBFUSCATION
                encoded=$(base64 -w 0 "$file")
                cat > "${file}.tmp" << EOF
#!/usr/bin/env python3
# üî• OBFUSCATED
import base64, sys

CODE = """$encoded"""

try:
    exec(base64.b64decode(CODE).decode('utf-8'))
except Exception as e:
    print(f"[Obfuscation Error] {e}")
    sys.exit(1)
EOF
                ;;
                
              js)
                # JAVASCRIPT OBFUSCATION
                encoded=$(base64 -w 0 "$file")
                cat > "${file}.tmp" << EOF
#!/usr/bin/env node
// üî• OBFUSCATED
const encoded = "$encoded";

try {
    eval(Buffer.from(encoded, 'base64').toString());
} catch(e) {
    console.error("[Obfuscation Error]", e);
    process.exit(1);
}
EOF
                ;;
            esac
            
            # Replace original file
            if [ -f "${file}.tmp" ]; then
              mv -f "${file}.tmp" "$file"
              chmod +x "$file"
              echo "‚úÖ Obfuscated: $file"
            fi
          done
          
          count=$(find . -type f -name "*.$ext" ! -path "./.git/*" | wc -l)
          echo "üìä Total .$ext files: $count"
        done
    
    - name: Commit & Push Changes
      run: |
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "actions@github.com"
        
        git add -A
        if git diff --staged --quiet; then
          echo "ü§∑ No changes to commit"
        else
          git commit -m "üåê Auto-obfuscate files"
          git push
          echo "üöÄ Changes pushed successfully"
        fi
