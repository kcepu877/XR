#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KCmZyb20gYXBwMy5jb25maWcuaW1wb3J0cyBpbXBvcnQgKgpmcm9tIGFwcC50eXBlX2RpY3QgaW1wb3J0IFBheW1lbnRJdGVtCmZyb20gYXBwMy5jbGllbnQuZW5nc2VsIGltcG9ydCBnZXRfcGFja2FnZV9kZXRhaWxzLCBnZXRfZmFtaWx5CmZyb20gYXBwMy5tZW51cy5wYWNrYWdlIGltcG9ydCBzaG93X3BhY2thZ2VfZGV0YWlscwpmcm9tIGFwcDMubWVudXMudXRpbCBpbXBvcnQgY2xlYXJfc2NyZWVuLCBwYXVzZSwgcHJpbnRfcGFuZWwsIGZvcm1hdF9xdW90YV9ieXRlLCBkaXNwbGF5X2h0bWwsIHNpbXBsZV9udW1iZXIsIGdldF9ydXBpYWgsIGxpdmVfbG9hZGluZwpmcm9tIGFwcDMuY2xpZW50LnB1cmNoYXNlLmV3YWxsZXQgaW1wb3J0IHNob3dfbXVsdGlwYXltZW50CmZyb20gYXBwMy5jbGllbnQucHVyY2hhc2UucXJpcyBpbXBvcnQgc2hvd19xcmlzX3BheW1lbnQKZnJvbSBhcHAzLmNsaWVudC5wdXJjaGFzZS5iYWxhbmNlIGltcG9ydCBzZXR0bGVtZW50X2JhbGFuY2UKZnJvbSBhcHAudXRpbCBpbXBvcnQgbWVyZ2VfaG90MSwgbWVyZ2VfaG90MgoKY29uc29sZSA9IENvbnNvbGUoKQoKCmRlZiBzaG93X2hvdF9tZW51KCk6CiAgICB0aGVtZSA9IGdldF90aGVtZSgpCiAgICBhcGlfa2V5ID0gQXV0aEluc3RhbmNlLmFwaV9rZXkKICAgIHRva2VucyA9IEF1dGhJbnN0YW5jZS5nZXRfYWN0aXZlX3Rva2VucygpCiAgICAKICAgIGluX2hvdF9tZW51ID0gVHJ1ZQogICAgd2hpbGUgaW5faG90X21lbnU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKICAgICAgICAKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBBbGlnbi5jZW50ZXIoIvCflKUgUGFrZXQgSG90IFByb21vIPCfpJkiLCB2ZXJ0aWNhbD0ibWlkZGxlIiksCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKICAgICAgICBzaW1wbGVfbnVtYmVyKCkKCiAgICAgICAgd2l0aCBsaXZlX2xvYWRpbmcoIk1lbXVhdCBkYXRhLi4uIPCfpJkiLCB0aGVtZSk6CiAgICAgICAgICAgIGhvdF9wYWNrYWdlcyA9IG1lcmdlX2hvdDEoImh0dHBzOi8vbWUubWFzaHUubG9sL3BnLWhvdC5qc29uIikKCiAgICAgICAgaWYgbm90IGhvdF9wYWNrYWdlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKCJob3RfZGF0YS9ob3QuanNvbiIsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgICAgICBob3RfcGFja2FnZXMgPSBqc29uLmxvYWQoZikKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCBmIkdhZ2FsIGxvYWQgaG90Lmpzb24gYnJvOiB7ZX0g8J+kryIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYgbm90IGhvdF9wYWNrYWdlczoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiTmdnYWsgYWRhIGRhdGEgSE9UIGJybyDwn5qoIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgdGFibGUgPSBUYWJsZShib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTm8iLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCwganVzdGlmeT0icmlnaHQiKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIkZhbWlseSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJWYXJpYW50Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIk9wdGlvbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJTb3VyY2UiLCBzdHlsZT10aGVtZVsidGV4dF9zdWIiXSwganVzdGlmeT0icmlnaHQiKQoKICAgICAgICBmb3IgaWR4LCBwIGluIGVudW1lcmF0ZShob3RfcGFja2FnZXMsIHN0YXJ0PTEpOgogICAgICAgICAgICB0YWJsZS5hZGRfcm93KAogICAgICAgICAgICAgICAgc3RyKGlkeCksCiAgICAgICAgICAgICAgICBwWyJmYW1pbHlfbmFtZSJdLAogICAgICAgICAgICAgICAgcFsidmFyaWFudF9uYW1lIl0sCiAgICAgICAgICAgICAgICBwWyJvcHRpb25fbmFtZSJdLAogICAgICAgICAgICAgICAgcC5nZXQoInNvdXJjZSIsICJsb2NhbCIpCiAgICAgICAgICAgICkKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCh0YWJsZSwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NikKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1DYWJ1dCBiYWxpayBrZSBtZW51IHV0YW1hIPCfj6BbL10iKQogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwobmF2X3RhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sIGV4cGFuZD1UcnVlKSkKCiAgICAgICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XVBpbGloIHBha2V0IGJybyDwn5GJOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgICAgIGlmIGNob2ljZSA9PSAiMDAiOgogICAgICAgICAgICBpbl9ob3RfbWVudSA9IEZhbHNlCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGlmIGNob2ljZS5pc2RpZ2l0KCkgYW5kIDEgPD0gaW50KGNob2ljZSkgPD0gbGVuKGhvdF9wYWNrYWdlcyk6CiAgICAgICAgICAgIHNlbGVjdGVkX2JtID0gaG90X3BhY2thZ2VzW2ludChjaG9pY2UpIC0gMV0KICAgICAgICAgICAgZmFtaWx5X2NvZGUgPSBzZWxlY3RlZF9ibVsiZmFtaWx5X2NvZGUiXQogICAgICAgICAgICBpc19lbnRlcnByaXNlID0gc2VsZWN0ZWRfYm0uZ2V0KCJpc19lbnRlcnByaXNlIiwgRmFsc2UpCiAgICAgICAgICAgIAogICAgICAgICAgICBmYW1pbHlfZGF0YSA9IGdldF9mYW1pbHkoYXBpX2tleSwgdG9rZW5zLCBmYW1pbHlfY29kZSwgaXNfZW50ZXJwcmlzZSkKICAgICAgICAgICAgaWYgbm90IGZhbWlseV9kYXRhOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCBmIkdhZ2FsIG5nYW1iaWwgZGF0YSBmYW1pbHkge2ZhbWlseV9jb2RlfSBicm8g8J+kryIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgb3B0aW9uX2NvZGUgPSBuZXh0KAogICAgICAgICAgICAgICAgKG9wdFsicGFja2FnZV9vcHRpb25fY29kZSJdIGZvciB2IGluIGZhbWlseV9kYXRhWyJwYWNrYWdlX3ZhcmlhbnRzIl0KICAgICAgICAgICAgICAgICBpZiB2WyJuYW1lIl0gPT0gc2VsZWN0ZWRfYm1bInZhcmlhbnRfbmFtZSJdCiAgICAgICAgICAgICAgICAgZm9yIG9wdCBpbiB2WyJwYWNrYWdlX29wdGlvbnMiXQogICAgICAgICAgICAgICAgIGlmIG9wdFsib3JkZXIiXSA9PSBzZWxlY3RlZF9ibVsib3JkZXIiXSksCiAgICAgICAgICAgICAgICBOb25lCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG9wdGlvbl9jb2RlOgogICAgICAgICAgICAgICAgc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBvcHRpb25fY29kZSwgaXNfZW50ZXJwcmlzZSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk9wdGlvbiBjb2RlIG5nZ2FrIGtldGVtdSBicm8g8J+aqCIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiSW5wdXQgbG8gbmdhY28gYnJvLCBjb2JhIGxhZ2kg8J+aqCIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCgpkZWYgc2hvd19ob3RfbWVudTIoKToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKCiAgICBpbl9ob3RfbWVudTIgPSBUcnVlCiAgICB3aGlsZSBpbl9ob3RfbWVudTI6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKICAgICAgICBtYWluX3BhY2thZ2VfZGV0YWlsID0ge30KCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKCLwn5SlIFBha2V0IEhvdCBQcm9tbyAyIPCfpJkiLCB2ZXJ0aWNhbD0ibWlkZGxlIiksCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKICAgICAgICBzaW1wbGVfbnVtYmVyKCkKCiAgICAgICAgd2l0aCBsaXZlX2xvYWRpbmcoIk1lbXVhdCBkYXRhLi4uIPCfpJkiLCB0aGVtZSk6CiAgICAgICAgICAgIGhvdF9wYWNrYWdlcyA9IG1lcmdlX2hvdDIoImh0dHBzOi8vbWUubWFzaHUubG9sL3BnLWhvdDIuanNvbiIpCgogICAgICAgIGlmIG5vdCBob3RfcGFja2FnZXM6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk5nZ2FrIGFkYSBkYXRhIEhPVDIgYnJvIPCfmqgiKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHBrZ190YWJsZSA9IFRhYmxlKGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBwa2dfdGFibGUuYWRkX2NvbHVtbigiTm8iLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD00KQogICAgICAgIHBrZ190YWJsZS5hZGRfY29sdW1uKCJOYW1hIFBha2V0Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIHBrZ190YWJsZS5hZGRfY29sdW1uKCJIYXJnYSIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfbW9uZXkiXSwgd2lkdGg9MTYpCiAgICAgICAgcGtnX3RhYmxlLmFkZF9jb2x1bW4oIlNvdXJjZSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X3N1YiJdLCBqdXN0aWZ5PSJyaWdodCIpCgogICAgICAgIGZvciBpZHgsIHAgaW4gZW51bWVyYXRlKGhvdF9wYWNrYWdlcywgc3RhcnQ9MSk6CiAgICAgICAgICAgIGZvcm1hdHRlZF9wcmljZSA9IGdldF9ydXBpYWgocFsicHJpY2UiXSkKICAgICAgICAgICAgcGtnX3RhYmxlLmFkZF9yb3coc3RyKGlkeCksIHBbIm5hbWUiXSwgZm9ybWF0dGVkX3ByaWNlLCBwLmdldCgic291cmNlIiwgImxvY2FsIikpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwocGtnX3RhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sIHBhZGRpbmc9KDAsIDApLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCkKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1DYWJ1dCBiYWxpayBrZSBtZW51IHV0YW1hIPCfj6BbL10iKQogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwobmF2X3RhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sIHBhZGRpbmc9KDAsIDEpLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIGNob2ljZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1QaWxpaCBwYWtldCBicm8g8J+RiTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgaW5faG90X21lbnUyID0gRmFsc2UKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgaWYgY2hvaWNlLmlzZGlnaXQoKSBhbmQgMSA8PSBpbnQoY2hvaWNlKSA8PSBsZW4oaG90X3BhY2thZ2VzKToKICAgICAgICAgICAgc2VsZWN0ZWRfcGFja2FnZSA9IGhvdF9wYWNrYWdlc1tpbnQoY2hvaWNlKSAtIDFdCiAgICAgICAgICAgIHBhY2thZ2VzID0gc2VsZWN0ZWRfcGFja2FnZS5nZXQoInBhY2thZ2VzIiwgW10pCiAgICAgICAgICAgIGlmIGxlbihwYWNrYWdlcykgPT0gMDoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIlBha2V0IG5nZ2FrIHRlcnNlZGlhIGJybyDwn5qoIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBwYXltZW50X2l0ZW1zID0gW10KICAgICAgICAgICAgZm9yIHBrZ19pZHgsIHBhY2thZ2UgaW4gZW51bWVyYXRlKHBhY2thZ2VzKToKICAgICAgICAgICAgICAgIGRldGFpbCA9IGdldF9wYWNrYWdlX2RldGFpbHMoCiAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgcGFja2FnZVsiZmFtaWx5X2NvZGUiXSwKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlWyJ2YXJpYW50X2NvZGUiXSwKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlWyJvcmRlciJdLAogICAgICAgICAgICAgICAgICAgIHBhY2thZ2VbImlzX2VudGVycHJpc2UiXSwKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlWyJtaWdyYXRpb25fdHlwZSJdLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGlmIHBrZ19pZHggPT0gMDoKICAgICAgICAgICAgICAgICAgICBtYWluX3BhY2thZ2VfZGV0YWlsID0gZGV0YWlsCgogICAgICAgICAgICAgICAgaWYgbm90IGRldGFpbDoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsIGYiR2FnYWwgbmdhbWJpbCBkZXRhaWwgcGFrZXQgYnVhdCB7cGFja2FnZVsnZmFtaWx5X2NvZGUnXX0g8J+kryIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgICAgICBwYXltZW50X2l0ZW1zLmFwcGVuZChQYXltZW50SXRlbSgKICAgICAgICAgICAgICAgICAgICBpdGVtX2NvZGU9ZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF90eXBlPSIiLAogICAgICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9ZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgICAgIGl0ZW1fbmFtZT1kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bIm5hbWUiXSwKICAgICAgICAgICAgICAgICAgICB0YXg9MCwKICAgICAgICAgICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb249ZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgICAgICkpCgogICAgICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgICAgICBlbnN1cmVfZ2l0KCkKICAgICAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgICAgIEFsaWduLmNlbnRlcihmIvCfk6Yge3NlbGVjdGVkX3BhY2thZ2VbJ25hbWUnXX0iLCB2ZXJ0aWNhbD0ibWlkZGxlIiksCiAgICAgICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgICAgICkpCiAgICAgICAgICAgIHNpbXBsZV9udW1iZXIoKQoKICAgICAgICAgICAgaW5mb190ZXh0ID0gVGV4dCgpCiAgICAgICAgICAgIGluZm9fdGV4dC5hcHBlbmQoZiJ7c2VsZWN0ZWRfcGFja2FnZVsnbmFtZSddfVxuIiwgc3R5bGU9ImJvbGQiKQogICAgICAgICAgICBpbmZvX3RleHQuYXBwZW5kKGYiSGFyZ2E6IFJwIHtnZXRfcnVwaWFoKHNlbGVjdGVkX3BhY2thZ2VbJ3ByaWNlJ10pfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfbW9uZXkiXSkKICAgICAgICAgICAgaW5mb190ZXh0LmFwcGVuZCgiRGV0YWlsOlxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICBmb3IgbGluZSBpbiBzZWxlY3RlZF9wYWNrYWdlLmdldCgiZGV0YWlsIiwgIiIpLnNwbGl0KCJcbiIpOgogICAgICAgICAgICAgICAgY2xlYW5lZCA9IGxpbmUuc3RyaXAoKQogICAgICAgICAgICAgICAgaWYgY2xlYW5lZDoKICAgICAgICAgICAgICAgICAgICBpbmZvX3RleHQuYXBwZW5kKGYiLSB7Y2xlYW5lZH1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgICAgICBpbmZvX3RleHQsCiAgICAgICAgICAgICAgICB0aXRsZT1mIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1d8J+TpiBEZXRhaWwgUGFrZXRbL10iLAogICAgICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICAgICApKQoKICAgICAgICAgICAgcGF5bWVudF9mb3IgPSBzZWxlY3RlZF9wYWNrYWdlLmdldCgicGF5bWVudF9mb3IiLCAiQlVZX1BBQ0tBR0UiKQogICAgICAgICAgICBhc2tfb3ZlcndyaXRlID0gc2VsZWN0ZWRfcGFja2FnZS5nZXQoImFza19vdmVyd3JpdGUiLCBGYWxzZSkKICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudCA9IHNlbGVjdGVkX3BhY2thZ2UuZ2V0KCJvdmVyd3JpdGVfYW1vdW50IiwgLTEpCiAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHggPSBzZWxlY3RlZF9wYWNrYWdlLmdldCgidG9rZW5fY29uZmlybWF0aW9uX2lkeCIsIDApCiAgICAgICAgICAgIGFtb3VudF9pZHggPSBzZWxlY3RlZF9wYWNrYWdlLmdldCgiYW1vdW50X2lkeCIsIC0xKQoKICAgICAgICAgICAgaW5fcGF5bWVudF9tZW51ID0gVHJ1ZQogICAgICAgICAgICB3aGlsZSBpbl9wYXltZW50X21lbnU6CiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NikKICAgICAgICAgICAgICAgIG1ldGhvZF90YWJsZS5hZGRfY29sdW1uKHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICAgICAgICAgIG1ldGhvZF90YWJsZS5hZGRfcm93KCIxIiwgIvCfkrAgQmFsYW5jZSIpCiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUuYWRkX3JvdygiMiIsICLwn5KzIEUtV2FsbGV0IikKICAgICAgICAgICAgICAgIG1ldGhvZF90YWJsZS5hZGRfcm93KCIzIiwgIvCfk7EgUVJJUyIpCiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUJhbGlrIGtlIG1lbnUgc2ViZWx1bW55YSDinIzvuI9bL10iKQoKICAgICAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlLAogICAgICAgICAgICAgICAgICAgIHRpdGxlPWYiW3t0aGVtZVsndGV4dF90aXRsZSddfV3wn5KzIFBpbGloIE1ldG9kZSBQZW1iZWxpYW5bL10iLAogICAgICAgICAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICAgICAgICAgKSkKCiAgICAgICAgICAgICAgICBpbnB1dF9tZXRob2QgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWggbWV0b2RlIGJybyDwn5GJOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQoKICAgICAgICAgICAgICAgIGlmIGlucHV0X21ldGhvZCA9PSAiMSI6CiAgICAgICAgICAgICAgICAgICAgaWYgb3ZlcndyaXRlX2Ftb3VudCA9PSAtMToKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9wcmljZSA9IHBheW1lbnRfaXRlbXNbLTFdLml0ZW1fcHJpY2UgaWYgaGFzYXR0cihwYXltZW50X2l0ZW1zWy0xXSwgIml0ZW1fcHJpY2UiKSBlbHNlIHBheW1lbnRfaXRlbXNbLTFdWyJpdGVtX3ByaWNlIl0KICAgICAgICAgICAgICAgICAgICAgICAgd2Fybl9wcmljZV9zdHIgPSBnZXRfcnVwaWFoKGxhc3RfcHJpY2UpIGlmIGlzaW5zdGFuY2UobGFzdF9wcmljZSwgKGludCwgZmxvYXQpKSBlbHNlIHN0cihsYXN0X3ByaWNlKQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KGYiW3t0aGVtZVsndGV4dF93YXJuJ119XeKaoO+4jyBQYXN0aWthbiBzaXNhIGJhbGFuY2UgS1VSQU5HIERBUkkgUnB7d2Fybl9wcmljZV9zdHJ9IGJybyEhIVsvXSIpCgogICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlX2Fuc3dlciA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1HYXMgbGFuanV0IHBlbWJlbGlhbj8gKHkvbik6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJhbGFuY2VfYW5zd2VyLmxvd2VyKCkgIT0gInkiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyBTYW50dXkiLCAiUGVtYmVsaWFuIGRpYmF0YWxpbiBicm8g4pyM77iPIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluX3BheW1lbnRfbWVudSA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgICAgICBzZXR0bGVtZW50X2JhbGFuY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9mb3IsCiAgICAgICAgICAgICAgICAgICAgICAgIGFza19vdmVyd3JpdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJ3cml0ZV9hbW91bnQ9b3ZlcndyaXRlX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uX2lkeD10b2tlbl9jb25maXJtYXRpb25faWR4LAogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnRfaWR4PWFtb3VudF9pZHgsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV3inIUgUGVtYmVsaWFuIGtlbGFyIGJybywgdGVrYW4gZW50ZXIuLi5bL3t0aGVtZVsndGV4dF9zdWInXX1dICIpCiAgICAgICAgICAgICAgICAgICAgaW5fcGF5bWVudF9tZW51ID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBpbl9ib29rbWFya19tZW51ID0gRmFsc2UKCiAgICAgICAgICAgICAgICBlbGlmIGlucHV0X21ldGhvZCA9PSAiMiI6CiAgICAgICAgICAgICAgICAgICAgc2hvd19tdWx0aXBheW1lbnQoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9mb3IsCiAgICAgICAgICAgICAgICAgICAgICAgIGFza19vdmVyd3JpdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJ3cml0ZV9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHgsCiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudF9pZHgsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV3inIUgUGVtYmVsaWFuIGtlbGFyIGJybywgdGVrYW4gZW50ZXIuLi5bL3t0aGVtZVsndGV4dF9zdWInXX1dICIpCiAgICAgICAgICAgICAgICAgICAgaW5fcGF5bWVudF9tZW51ID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBpbl9ib29rbWFya19tZW51ID0gRmFsc2UKCiAgICAgICAgICAgICAgICBlbGlmIGlucHV0X21ldGhvZCA9PSAiMyI6CiAgICAgICAgICAgICAgICAgICAgc2hvd19xcmlzX3BheW1lbnQoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcywKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bWVudF9mb3IsCiAgICAgICAgICAgICAgICAgICAgICAgIGFza19vdmVyd3JpdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJ3cml0ZV9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHgsCiAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudF9pZHgsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV3inIUgUGVtYmVsaWFuIGtlbGFyIGJybywgdGVrYW4gZW50ZXIuLi5bL3t0aGVtZVsndGV4dF9zdWInXX1dICIpCiAgICAgICAgICAgICAgICAgICAgaW5fcGF5bWVudF9tZW51ID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBpbl9ib29rbWFya19tZW51ID0gRmFsc2UKCiAgICAgICAgICAgICAgICBlbGlmIGlucHV0X21ldGhvZCA9PSAiMDAiOgogICAgICAgICAgICAgICAgICAgIGluX3BheW1lbnRfbWVudSA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk1ldG9kZSBuZ2dhayB2YWxpZCBicm8g8J+aqCIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIklucHV0IGxvIG5nYWNvIGJybyDwn5qoIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICBjb250aW51ZQo=').decode())
