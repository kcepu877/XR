#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGpzb24KZnJvbSBhcHAzLmNvbmZpZy5pbXBvcnRzIGltcG9ydCAqCmZyb20gYXBwMy5tZW51cy5wYWNrYWdlIGltcG9ydCBnZXRfcGFja2FnZXNfYnlfZmFtaWx5LCBzaG93X3BhY2thZ2VfZGV0YWlscwpmcm9tIGFwcDMubWVudXMudXRpbCBpbXBvcnQgcGF1c2UsIGNsZWFyX3NjcmVlbiwgZm9ybWF0X3F1b3RhX2J5dGUsIGxpdmVfbG9hZGluZywgZ2V0X3J1cGlhaCAscHJpbnRfcGFuZWwKZnJvbSBhcHAzLmNsaWVudC5jaXJjbGUgaW1wb3J0ICgKICAgIGdldF9ncm91cF9kYXRhLAogICAgZ2V0X2dyb3VwX21lbWJlcnMsCiAgICBjcmVhdGVfY2lyY2xlLAogICAgdmFsaWRhdGVfY2lyY2xlX21lbWJlciwKICAgIGludml0ZV9jaXJjbGVfbWVtYmVyLAogICAgcmVtb3ZlX2NpcmNsZV9tZW1iZXIsCiAgICBhY2NlcHRfY2lyY2xlX2ludml0YXRpb24sCiAgICBzcGVuZGluZ190cmFja2VyLAogICAgZ2V0X2JvbnVzX2RhdGEsCikKZnJvbSBhcHAzLmNsaWVudC5lbmNyeXB0IGltcG9ydCBkZWNyeXB0X2NpcmNsZV9tc2lzZG4KCmNvbnNvbGUgPSBDb25zb2xlKCkKCgpkZWYgc2hvd19jaXJjbGVfY3JlYXRpb24oYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGVuc3VyZV9naXQoKQogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQoKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgQWxpZ24uY2VudGVyKCLwn5SlIEJpa2luIENpcmNsZSBCYXJ1IEJybyDwn6SZIiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICBleHBhbmQ9VHJ1ZQogICAgKSkKCiAgICBwYXJlbnRfbmFtZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2luIG5hbWEgbG8gKFBhcmVudCk6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCiAgICBncm91cF9uYW1lID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUthc2loIG5hbWEgQ2lyY2xlIGxvIGN1eTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgIG1lbWJlcl9tc2lzZG4gPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTm9tb3IgbWVtYmVyIHBlcnRhbWEgKGNvbnRvaCA2MjgxMjMuLi4pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgbWVtYmVyX25hbWUgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTmFtYSBtZW1iZXIgcGVydGFtYSBicm86Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCgogICAgd2l0aCBsaXZlX2xvYWRpbmcoIvCflIQgTGFnaSBiaWtpbiBDaXJjbGUgYnJvLi4uIiwgdGhlbWUpOgogICAgICAgIGNyZWF0ZV9yZXMgPSBjcmVhdGVfY2lyY2xlKGFwaV9rZXksIHRva2VucywgcGFyZW50X25hbWUsIGdyb3VwX25hbWUsIG1lbWJlcl9tc2lzZG4sIG1lbWJlcl9uYW1lKQoKICAgIHJlc190ZXh0ID0gVGV4dCgpCiAgICByZXNfdGV4dC5hcHBlbmQoIlJlc3BvbiBTZXJ2ZXI6XG4iLCBzdHlsZT0iYm9sZCIpCiAgICByZXNfdGV4dC5hcHBlbmQoanNvbi5kdW1wcyhjcmVhdGVfcmVzLCBpbmRlbnQ9MiksIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwocmVzX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwgZXhwYW5kPVRydWUpKQogICAgcGF1c2UoKQoKCmRlZiBzaG93X2JvbnVzX2xpc3QoYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QsIHBhcmVudF9zdWJzX2lkOiBzdHIsIGZhbWlseV9pZDogc3RyKToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGluX2NpcmNsZV9ib251c19tZW51ID0gVHJ1ZQoKICAgIHdoaWxlIGluX2NpcmNsZV9ib251c19tZW51OgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZW5zdXJlX2dpdCgpCgogICAgICAgIGJvbnVzX2RhdGEgPSBnZXRfYm9udXNfZGF0YShhcGlfa2V5LCB0b2tlbnMsIHBhcmVudF9zdWJzX2lkLCBmYW1pbHlfaWQpCgogICAgICAgIGlmIGJvbnVzX2RhdGEuZ2V0KCJzdGF0dXMiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIG5nYW1iaWwgZGF0YSBib251cyBicm8g8J+kryIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGJvbnVzX2xpc3QgPSBib251c19kYXRhLmdldCgiZGF0YSIsIHt9KS5nZXQoImJvbnVzZXMiLCBbXSkKICAgICAgICBpZiBub3QgYm9udXNfbGlzdDoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyBTYW50dXkiLCAiU2VwaSBjdXksIG5nZ2FrIGFkYSBib251cyDwn5i0IikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKCLwn46BIEJvbnVzIENpcmNsZSDwn6SZIiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDEsIDEpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCgogICAgICAgIGZvciBpZHgsIGJvbnVzIGluIGVudW1lcmF0ZShib251c19saXN0LCBzdGFydD0xKToKICAgICAgICAgICAgYm9udXNfbmFtZSA9IGJvbnVzLmdldCgibmFtZSIsICJOL0EiKQogICAgICAgICAgICBib251c190eXBlID0gYm9udXMuZ2V0KCJib251c190eXBlIiwgIk4vQSIpCiAgICAgICAgICAgIGFjdGlvbl90eXBlID0gYm9udXMuZ2V0KCJhY3Rpb25fdHlwZSIsICJOL0EiKQogICAgICAgICAgICBhY3Rpb25fcGFyYW0gPSBib251cy5nZXQoImFjdGlvbl9wYXJhbSIsICJOL0EiKQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGFjdGlvbl9wYXJhbSwgKGludCwgZmxvYXQpKToKICAgICAgICAgICAgICAgIGFjdGlvbl9wYXJhbSA9IGdldF9ydXBpYWgoYWN0aW9uX3BhcmFtKQoKICAgICAgICAgICAgYm9udXNfdGV4dCA9IFRleHQoKQogICAgICAgICAgICBib251c190ZXh0LmFwcGVuZChmIntpZHh9LiB7Ym9udXNfbmFtZX1cbiIsIHN0eWxlPSJib2xkIikKICAgICAgICAgICAgYm9udXNfdGV4dC5hcHBlbmQoZiJUaXBlOiB7Ym9udXNfdHlwZX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICAgICAgYm9udXNfdGV4dC5hcHBlbmQoZiJBa3NpOiB7YWN0aW9uX3R5cGV9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgIGJvbnVzX3RleHQuYXBwZW5kKGYiUGFyYW06IHthY3Rpb25fcGFyYW19XG4iLCBzdHlsZT10aGVtZVsidGV4dF9zdWIiXSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoYm9udXNfdGV4dCwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCkKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1LZW1iYWxpWy9dIikKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKG5hdl90YWJsZSwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIGNob2ljZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1QaWxpaCBib251cyBicm86Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCiAgICAgICAgaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgICAgIGluX2NpcmNsZV9ib251c19tZW51ID0gRmFsc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBub3QgY2hvaWNlLmlzZGlnaXQoKToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk5vbW9yIGJvbnVzIG5nZ2FrIHZhbGlkIGJybyDwn5qoIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBib251c19udW1iZXIgPSBpbnQoY2hvaWNlKQogICAgICAgICAgICBpZiBib251c19udW1iZXIgPCAxIG9yIGJvbnVzX251bWJlciA+IGxlbihib251c19saXN0KToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk5vbW9yIGJvbnVzIG5nZ2FrIHZhbGlkIGJybyDwn6SvIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBzZWxlY3RlZF9ib251cyA9IGJvbnVzX2xpc3RbYm9udXNfbnVtYmVyIC0gMV0KICAgICAgICAgICAgYWN0aW9uX3R5cGUgPSBzZWxlY3RlZF9ib251cy5nZXQoImFjdGlvbl90eXBlIiwgIk4vQSIpCiAgICAgICAgICAgIGFjdGlvbl9wYXJhbSA9IHNlbGVjdGVkX2JvbnVzLmdldCgiYWN0aW9uX3BhcmFtIiwgIk4vQSIpCgogICAgICAgICAgICBpZiBhY3Rpb25fdHlwZSA9PSAiUExQIjoKICAgICAgICAgICAgICAgIGdldF9wYWNrYWdlc19ieV9mYW1pbHkoYWN0aW9uX3BhcmFtKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICBlbGlmIGFjdGlvbl90eXBlID09ICJQRFAiOgogICAgICAgICAgICAgICAgc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBhY3Rpb25fcGFyYW0sIEZhbHNlKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZGV0YWlsX3RleHQgPSBUZXh0KCkKICAgICAgICAgICAgICAgIGRldGFpbF90ZXh0LmFwcGVuZCgi4pqg77iPIEJlbHVtIGFkYSBha3NpIGJ1YXQgdGlwZSBpbmkgYnJvXG4iLCBzdHlsZT0iYm9sZCIpCiAgICAgICAgICAgICAgICBkZXRhaWxfdGV4dC5hcHBlbmQoZiJBa3NpOiB7YWN0aW9uX3R5cGV9XG5QYXJhbToge2FjdGlvbl9wYXJhbX0iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKGRldGFpbF90ZXh0LCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sIGV4cGFuZD1UcnVlKSkKICAgICAgICAgICAgICAgIHBhdXNlKCkKCgpkZWYgc2hvd19jaXJjbGVfaW5mbyhhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCk6CiAgICB0aGVtZSA9IGdldF90aGVtZSgpCiAgICBpbl9jaXJjbGVfbWVudSA9IFRydWUKICAgIHVzZXI6IGRpY3QgPSBBdXRoSW5zdGFuY2UuZ2V0X2FjdGl2ZV91c2VyKCkKICAgIG15X21zaXNkbiA9IHVzZXIuZ2V0KCJudW1iZXIiLCAiIikKCiAgICB3aGlsZSBpbl9jaXJjbGVfbWVudToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGVuc3VyZV9naXQoKQoKICAgICAgICBncm91cF9yZXMgPSBnZXRfZ3JvdXBfZGF0YShhcGlfa2V5LCB0b2tlbnMpCgogICAgICAgIGlmIGdyb3VwX3Jlcy5nZXQoInN0YXR1cyIpICE9ICJTVUNDRVNTIjoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiR2FnYWwgbmdhbWJpbCBkYXRhIENpcmNsZSBicm8g8J+kryIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBncm91cF9kYXRhID0gZ3JvdXBfcmVzLmdldCgiZGF0YSIsIHt9KQogICAgICAgIGdyb3VwX2lkID0gZ3JvdXBfZGF0YS5nZXQoImdyb3VwX2lkIiwgIiIpCgogICAgICAgIGlmIGdyb3VwX2lkID09ICIiOgogICAgICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICAgICAgQWxpZ24uY2VudGVyKCLwn5qrIExvIGJlbHVtIGpvaW4gQ2lyY2xlIG1hbmFwdW4gYnJvIPCfmLQiLCB2ZXJ0aWNhbD0ibWlkZGxlIiksCiAgICAgICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgICAgICkpCiAgICAgICAgICAgIGNyZWF0ZV9uZXcgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dR2FzIGJpa2luIENpcmNsZSBiYXJ1PyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICBpZiBjcmVhdGVfbmV3ID09ICJ5IjoKICAgICAgICAgICAgICAgIHNob3dfY2lyY2xlX2NyZWF0aW9uKGFwaV9rZXksIHRva2VucykKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgICAgIGlmIGdyb3VwX2RhdGEuZ2V0KCJncm91cF9zdGF0dXMiKSA9PSAiQkxPQ0tFRCI6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gSW5mbyIsICJDaXJjbGUgaW5pIGxhZ2kga2UtYmxvY2sgY3V5IPCfmqgiKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgZ3JvdXBfbmFtZSA9IGdyb3VwX2RhdGEuZ2V0KCJncm91cF9uYW1lIiwgIk4vQSIpCiAgICAgICAgb3duZXJfbmFtZSA9IGdyb3VwX2RhdGEuZ2V0KCJvd25lcl9uYW1lIiwgIk4vQSIpCgogICAgICAgIG1lbWJlcnNfcmVzID0gZ2V0X2dyb3VwX21lbWJlcnMoYXBpX2tleSwgdG9rZW5zLCBncm91cF9pZCkKCiAgICAgICAgaWYgbWVtYmVyc19yZXMuZ2V0KCJzdGF0dXMiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIG5nYW1iaWwgZGF0YSBtZW1iZXIgQ2lyY2xlIGJybyDwn6SvIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgICAgIG1lbWJlcnNfZGF0YSA9IG1lbWJlcnNfcmVzLmdldCgiZGF0YSIsIHt9KQogICAgICAgIG1lbWJlcnMgPSBtZW1iZXJzX2RhdGEuZ2V0KCJtZW1iZXJzIiwgW10pCiAgICAgICAgaWYgbm90IG1lbWJlcnM6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLihLnvuI8gU2FudHV5IiwgIlNlcGkgY3V5LCBuZ2dhayBhZGEgbWVtYmVyIPCfmLQiKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgcGFyZW50X21lbWJlcl9pZCA9ICIiCiAgICAgICAgcGFyZW50X3N1YnNfaWQgPSAiIgogICAgICAgIHBhcnJlbnRfbXNpc2RuID0gIiIKICAgICAgICBmb3IgbWVtYmVyIGluIG1lbWJlcnM6CiAgICAgICAgICAgIGlmIG1lbWJlci5nZXQoIm1lbWJlcl9yb2xlIikgPT0gIlBBUkVOVCI6CiAgICAgICAgICAgICAgICBwYXJlbnRfbWVtYmVyX2lkID0gbWVtYmVyLmdldCgibWVtYmVyX2lkIiwgIiIpCiAgICAgICAgICAgICAgICBwYXJlbnRfc3Vic19pZCA9IG1lbWJlci5nZXQoInN1YnNjcmliZXJfbnVtYmVyIiwgIiIpCiAgICAgICAgICAgICAgICBwYXJyZW50X21zaXNkbiA9IGRlY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtZW1iZXIuZ2V0KCJtc2lzZG4iLCAiIikpCgogICAgICAgIHBhY2thZ2UgPSBtZW1iZXJzX2RhdGEuZ2V0KCJwYWNrYWdlIiwge30pCiAgICAgICAgcGFja2FnZV9uYW1lID0gcGFja2FnZS5nZXQoIm5hbWUiLCAiTi9BIikKICAgICAgICBiZW5lZml0ID0gcGFja2FnZS5nZXQoImJlbmVmaXQiLCB7fSkKICAgICAgICBhbGxvY2F0aW9uX2J5dGUgPSBiZW5lZml0LmdldCgiYWxsb2NhdGlvbiIsIDApCiAgICAgICAgcmVtYWluaW5nX2J5dGUgPSBiZW5lZml0LmdldCgicmVtYWluaW5nIiwgMCkKCiAgICAgICAgZm9ybWF0dGVkX2FsbG9jYXRpb24gPSBmb3JtYXRfcXVvdGFfYnl0ZShhbGxvY2F0aW9uX2J5dGUpCiAgICAgICAgZm9ybWF0dGVkX3JlbWFpbmluZyA9IGZvcm1hdF9xdW90YV9ieXRlKHJlbWFpbmluZ19ieXRlKQoKICAgICAgICBzcGVuZGluZ19yZXMgPSBzcGVuZGluZ190cmFja2VyKGFwaV9rZXksIHRva2VucywgcGFyZW50X3N1YnNfaWQsIGdyb3VwX2lkKQoKICAgICAgICBpZiBzcGVuZGluZ19yZXMuZ2V0KCJzdGF0dXMiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIG5nYW1iaWwgZGF0YSBzcGVuZGluZyBicm8g8J+kryIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBzcGVuZGluZ19kYXRhID0gc3BlbmRpbmdfcmVzLmdldCgiZGF0YSIsIHt9KQogICAgICAgIHNwZW5kID0gc3BlbmRpbmdfZGF0YS5nZXQoInNwZW5kIiwgMCkKICAgICAgICB0YXJnZXQgPSBzcGVuZGluZ19kYXRhLmdldCgidGFyZ2V0IiwgMCkKCiAgICAgICAgaGVhZGVyX3RleHQgPSBUZXh0KCkKICAgICAgICBoZWFkZXJfdGV4dC5hcHBlbmQoZiLwn5SlIENpcmNsZToge2dyb3VwX25hbWV9XG4iLCBzdHlsZT0iYm9sZCIpCiAgICAgICAgaGVhZGVyX3RleHQuYXBwZW5kKGYi8J+RkSBPd25lcjoge293bmVyX25hbWV9IHtwYXJyZW50X21zaXNkbn1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICBoZWFkZXJfdGV4dC5hcHBlbmQoZiLwn5OmIFBha2V0OiB7cGFja2FnZV9uYW1lfSB8IHtmb3JtYXR0ZWRfcmVtYWluaW5nfSAvIHtmb3JtYXR0ZWRfYWxsb2NhdGlvbn1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICBoZWFkZXJfdGV4dC5hcHBlbmQoZiLwn5K4IFNwZW5kaW5nOiB7Z2V0X3J1cGlhaChzcGVuZCl9IC8ge2dldF9ydXBpYWgodGFyZ2V0KX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X21vbmV5Il0pCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoaGVhZGVyX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBmb3IgaWR4LCBtIGluIGVudW1lcmF0ZShtZW1iZXJzLCBzdGFydD0xKToKICAgICAgICAgICAgbXNpc2RuID0gZGVjcnlwdF9jaXJjbGVfbXNpc2RuKGFwaV9rZXksIG0uZ2V0KCJtc2lzZG4iLCAiIikpIG9yICI8Tm8gTnVtYmVyPiIKICAgICAgICAgICAgbWVfbWFyayA9ICIgKExvKSIgaWYgc3RyKG1zaXNkbikgPT0gc3RyKG15X21zaXNkbikgZWxzZSAiIgogICAgICAgICAgICByb2xlID0gIlBhcmVudCIgaWYgbS5nZXQoIm1lbWJlcl9yb2xlIikgPT0gIlBBUkVOVCIgZWxzZSAiTWVtYmVyIgogICAgICAgICAgICBqb2luZWRfc3RyID0gZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcChtLmdldCgiam9pbl9kYXRlIiwgMCkpLnN0cmZ0aW1lKCclWS0lbS0lZCcpIGlmIG0uZ2V0KCJqb2luX2RhdGUiKSBlbHNlICJOL0EiCiAgICAgICAgICAgIGFsbG9jID0gZm9ybWF0X3F1b3RhX2J5dGUobS5nZXQoImFsbG9jYXRpb24iLCAwKSkKICAgICAgICAgICAgdXNlZCA9IGZvcm1hdF9xdW90YV9ieXRlKG1heChtLmdldCgiYWxsb2NhdGlvbiIsIDApIC0gbS5nZXQoInJlbWFpbmluZyIsIDApLCAwKSkKICAgICAgICAgICAgdXNhZ2Vfc3RyID0gZiJ7dXNlZH0gLyB7YWxsb2N9IgoKICAgICAgICAgICAgbWVtYmVyX3RleHQgPSBUZXh0KCkKICAgICAgICAgICAgbWVtYmVyX3RleHQuYXBwZW5kKGYie2lkeH0uIHttLmdldCgnbWVtYmVyX25hbWUnLCdOL0EnKX0ge21lX21hcmt9XG4iLCBzdHlsZT0iYm9sZCIpCiAgICAgICAgICAgIG1lbWJlcl90ZXh0LmFwcGVuZChmIvCfk7EgTm9tb3I6IHttc2lzZG59XG4iLCBzdHlsZT10aGVtZVsiYm9yZGVyX3dhcm5pbmciXSkKICAgICAgICAgICAgbWVtYmVyX3RleHQuYXBwZW5kKGYi8J+OrSBSb2xlOiB7cm9sZX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICAgICAgbWVtYmVyX3RleHQuYXBwZW5kKGYi8J+ThSBKb2luOiB7am9pbmVkX3N0cn1cbiIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgICAgICBtZW1iZXJfdGV4dC5hcHBlbmQoZiLwn46yIFNsb3Q6IHttLmdldCgnc2xvdF90eXBlJywnTi9BJyl9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgIG1lbWJlcl90ZXh0LmFwcGVuZChmIuKaoSBTdGF0dXM6IHttLmdldCgnc3RhdHVzJywnTi9BJyl9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9zdWIiXSkKICAgICAgICAgICAgbWVtYmVyX3RleHQuYXBwZW5kKGYi8J+TiiBVc2FnZToge3VzYWdlX3N0cn1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwobWVtYmVyX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBuYXZfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIG5hdl90YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCIxIiwgIkludml0ZSBNZW1iZXIga2UgQ2lyY2xlIOKelSAiKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCJkZWwgPG51bT4iLCBmIlt7dGhlbWVbJ3RleHRfZXJyJ119XUhhcHVzIE1lbWJlciDwn5eR77iPIFsvXSIpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coImFjYyA8bnVtPiIsICJUZXJpbWEgVW5kYW5nYW4g4pyFICIpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjIiLCAiTGloYXQgQm9udXMgQ2lyY2xlIPCfjoEgIikKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUNhYnV0IGJhbGlrIGtlIG1lbnUgdXRhbWEg8J+PoFsvXSIpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwobmF2X3RhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sIGV4cGFuZD1UcnVlKSkKCiAgICAgICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XVBpbGloYW4gbG8gYnJvOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgICAgIGlmIGNob2ljZSA9PSAiMDAiOgogICAgICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgICAgIGVsaWYgY2hvaWNlID09ICIxIjoKICAgICAgICAgICAgbXNpc2RuX3RvX2ludml0ZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1Ob21vciBtZW1iZXIgeWFuZyBtYXUgZGktaW52aXRlOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgICAgICAgICB2YWxpZGF0ZV9yZXMgPSB2YWxpZGF0ZV9jaXJjbGVfbWVtYmVyKGFwaV9rZXksIHRva2VucywgbXNpc2RuX3RvX2ludml0ZSkKICAgICAgICAgICAgaWYgdmFsaWRhdGVfcmVzLmdldCgic3RhdHVzIikgPT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgaWYgdmFsaWRhdGVfcmVzLmdldCgiZGF0YSIsIHt9KS5nZXQoInJlc3BvbnNlX2NvZGUiLCAiIikgIT0gIjIwMC0yMDAxIjoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsIGYiTmdnYWsgYmlzYSBpbnZpdGUge21zaXNkbl90b19pbnZpdGV9OiB7dmFsaWRhdGVfcmVzLmdldCgnZGF0YScsIHt9KS5nZXQoJ21lc3NhZ2UnLCAnRXJyb3IgYnJvJyl9IikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgbWVtYmVyX25hbWUgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTmFtYSBtZW1iZXJueWEgYnJvOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgICAgICAgICB3aXRoIGxpdmVfbG9hZGluZygi8J+UhCBMYWdpIGtpcmltIHVuZGFuZ2FuLi4uIiwgdGhlbWUpOgogICAgICAgICAgICAgICAgaW52aXRlX3JlcyA9IGludml0ZV9jaXJjbGVfbWVtYmVyKGFwaV9rZXksIHRva2VucywgbXNpc2RuX3RvX2ludml0ZSwgbWVtYmVyX25hbWUsIGdyb3VwX2lkLCBwYXJlbnRfbWVtYmVyX2lkKQogICAgICAgICAgICBpZiBpbnZpdGVfcmVzLmdldCgic3RhdHVzIikgPT0gIlNVQ0NFU1MiIGFuZCBpbnZpdGVfcmVzLmdldCgiZGF0YSIsIHt9KS5nZXQoInJlc3BvbnNlX2NvZGUiKSA9PSAiMjAwLTAwIjoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLinIUgTWFudGFwIiwgZiJVbmRhbmdhbiB1ZGFoIGRpa2lyaW0ga2Uge21zaXNkbl90b19pbnZpdGV9IPCfmoAiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCBmIkdhZ2FsIGludml0ZSB7bXNpc2RuX3RvX2ludml0ZX0g8J+kryIpCiAgICAgICAgICAgIHBhdXNlKCkKCiAgICAgICAgZWxpZiBjaG9pY2Uuc3RhcnRzd2l0aCgiZGVsICIpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBtZW1iZXJfbnVtYmVyID0gaW50KGNob2ljZS5zcGxpdCgiICIpWzFdKQogICAgICAgICAgICAgICAgaWYgbWVtYmVyX251bWJlciA8IDEgb3IgbWVtYmVyX251bWJlciA+IGxlbihtZW1iZXJzKToKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJOb21vciBtZW1iZXIgbmdnYWsgdmFsaWQgYnJvIPCfmqgiKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgbWVtYmVyX3RvX3JlbW92ZSA9IG1lbWJlcnNbbWVtYmVyX251bWJlciAtIDFdCiAgICAgICAgICAgICAgICBpZiBtZW1iZXJfdG9fcmVtb3ZlLmdldCgibWVtYmVyX3JvbGUiKSA9PSAiUEFSRU5UIjoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIEluZm8iLCAiUGFyZW50IG5nZ2FrIGJpc2EgZGloYXB1cyBicm8g8J+aqCIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBpc19sYXN0X21lbWJlciA9IGxlbihtZW1iZXJzKSA9PSAyCiAgICAgICAgICAgICAgICBpZiBpc19sYXN0X21lbWJlcjoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIEluZm8iLCAiTmdnYWsgYmlzYSBoYXB1cyBtZW1iZXIgdGVyYWtoaXIgYnJvIPCfpK8iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgbXNpc2RuX3RvX3JlbW92ZSA9IGRlY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtZW1iZXJfdG9fcmVtb3ZlLmdldCgibXNpc2RuIiwgIiIpKQogICAgICAgICAgICAgICAgY29uZmlybSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1ZYWtpbiBtYXUgaGFwdXMge21zaXNkbl90b19yZW1vdmV9PyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICAgICAgaWYgY29uZmlybSAhPSAieSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyBTYW50dXkiLCAiUGVuZ2hhcHVzYW4gZGliYXRhbGluIGJybyDinIzvuI8iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgd2l0aCBsaXZlX2xvYWRpbmcoIvCflIQgTGFnaSBoYXB1cyBtZW1iZXIuLi4iLCB0aGVtZSk6CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlX3JlcyA9IHJlbW92ZV9jaXJjbGVfbWVtYmVyKGFwaV9rZXksIHRva2VucywgbWVtYmVyX3RvX3JlbW92ZS5nZXQoIm1lbWJlcl9pZCIsICIiKSwgZ3JvdXBfaWQsIHBhcmVudF9tZW1iZXJfaWQsIGlzX2xhc3RfbWVtYmVyKQogICAgICAgICAgICAgICAgaWYgcmVtb3ZlX3Jlcy5nZXQoInN0YXR1cyIpID09ICJTVUNDRVNTIjoKICAgICAgICAgICAgICAgICAgICByZXNfdGV4dCA9IFRleHQoKQogICAgICAgICAgICAgICAgICAgIHJlc190ZXh0LmFwcGVuZChmIvCfl5HvuI8gTWVtYmVyIHttc2lzZG5fdG9fcmVtb3ZlfSB1ZGFoIGd1ZSBoYXB1cyBicm8g4pyM77iPXG4iLCBzdHlsZT0iYm9sZCIpCiAgICAgICAgICAgICAgICAgICAgcmVzX3RleHQuYXBwZW5kKGpzb24uZHVtcHMocmVtb3ZlX3JlcywgaW5kZW50PTIpLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5wcmludChQYW5lbChyZXNfdGV4dCwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLCBleHBhbmQ9VHJ1ZSkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgZiJHYWdhbCBoYXB1cyBtZW1iZXI6IHtyZW1vdmVfcmVzfSIpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiRm9ybWF0IGlucHV0IGJ1YXQgaGFwdXMgbWVtYmVyIG5nYWNvIGJybyDwn5qoIikKICAgICAgICAgICAgcGF1c2UoKQoKICAgICAgICBlbGlmIGNob2ljZS5zdGFydHN3aXRoKCJhY2MgIik6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG1lbWJlcl9udW1iZXIgPSBpbnQoY2hvaWNlLnNwbGl0KCIgIilbMV0pCiAgICAgICAgICAgICAgICBpZiBtZW1iZXJfbnVtYmVyIDwgMSBvciBtZW1iZXJfbnVtYmVyID4gbGVuKG1lbWJlcnMpOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk5vbW9yIG1lbWJlciBuZ2dhayB2YWxpZCBicm8g8J+aqCIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBtZW1iZXJfdG9fYWNjZXB0ID0gbWVtYmVyc1ttZW1iZXJfbnVtYmVyIC0gMV0KICAgICAgICAgICAgICAgIGlmIG1lbWJlcl90b19hY2NlcHQuZ2V0KCJzdGF0dXMiKSAhPSAiSU5WSVRFRCI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBJbmZvIiwgIk1lbWJlciBpbmkgbmdnYWsgZGFsYW0gc3RhdHVzIHVuZGFuZ2FuIGJybyDwn6SoIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIG1zaXNkbl90b19hY2NlcHQgPSBkZWNyeXB0X2NpcmNsZV9tc2lzZG4oYXBpX2tleSwgbWVtYmVyX3RvX2FjY2VwdC5nZXQoIm1zaXNkbiIsICIiKSkKICAgICAgICAgICAgICAgIGNvbmZpcm0gPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dVGVyaW1hIHVuZGFuZ2FuIGJ1YXQge21zaXNkbl90b19hY2NlcHR9PyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICAgICAgaWYgY29uZmlybSAhPSAieSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyBTYW50dXkiLCAiVW5kYW5nYW4gbmdnYWsgamFkaSBkaXRlcmltYSBicm8g4pyM77iPIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHdpdGggbGl2ZV9sb2FkaW5nKCLwn5SEIExhZ2kgdGVyaW1hIHVuZGFuZ2FuLi4uIiwgdGhlbWUpOgogICAgICAgICAgICAgICAgICAgIGFjY2VwdF9yZXMgPSBhY2NlcHRfY2lyY2xlX2ludml0YXRpb24oYXBpX2tleSwgdG9rZW5zLCBncm91cF9pZCwgbWVtYmVyX3RvX2FjY2VwdC5nZXQoIm1lbWJlcl9pZCIsICIiKSkKICAgICAgICAgICAgICAgIGlmIGFjY2VwdF9yZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgcmVzX3RleHQgPSBUZXh0KCkKICAgICAgICAgICAgICAgICAgICByZXNfdGV4dC5hcHBlbmQoZiLinIUgVW5kYW5nYW4gYnVhdCB7bXNpc2RuX3RvX2FjY2VwdH0gdWRhaCBkaXRlcmltYSBicm8g8J+agFxuIiwgc3R5bGU9ImJvbGQiKQogICAgICAgICAgICAgICAgICAgIHJlc190ZXh0LmFwcGVuZChqc29uLmR1bXBzKGFjY2VwdF9yZXMsIGluZGVudD0yKSwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwocmVzX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgZXhwYW5kPVRydWUpKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsIGYiR2FnYWwgdGVyaW1hIHVuZGFuZ2FuOiB7YWNjZXB0X3Jlc30iKQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkZvcm1hdCBpbnB1dCBidWF0IHRlcmltYSB1bmRhbmdhbiBuZ2FjbyBicm8g8J+aqCIpCiAgICAgICAgICAgIHBhdXNlKCkKCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjIiOgogICAgICAgICAgICBzaG93X2JvbnVzX2xpc3QoYXBpX2tleSwgdG9rZW5zLCBwYXJlbnRfc3Vic19pZCwgZ3JvdXBfaWQpCgo=').decode())
