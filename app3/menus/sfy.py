#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCgpmcm9tIGFwcDMuY29uZmlnLmltcG9ydHMgaW1wb3J0ICoKZnJvbSBhcHAzLm1lbnVzLnV0aWwgaW1wb3J0IGNsZWFyX3NjcmVlbiwgcGF1c2UsIHByaW50X3BhbmVsLCBwcmludF9lcnJvcgpmcm9tIGFwcDMubWVudXMucGFja2FnZSBpbXBvcnQgc2hvd19wYWNrYWdlX2RldGFpbHMKZnJvbSBhcHAzLm1lbnVzLnV0aWwgaW1wb3J0IGdldF9ydXBpYWgKCmNvbnNvbGUgPSBDb25zb2xlKCkKCgpkZWYgZmV0Y2hfc3BlY2lhbF9mb3JfeW91KGFwaV9rZXk6IHN0ciwgaWRfdG9rZW46IHN0ciwgYWNjZXNzX3Rva2VuOiBzdHIsIGJhbGFuY2U6IGludCA9IDApIC0+IGxpc3Q6CiAgICB0cnk6CiAgICAgICAgc2VnX2RhdGEgPSBkYXNoX3NlZ21lbnRzKGFwaV9rZXksIGlkX3Rva2VuLCBhY2Nlc3NfdG9rZW4sIGJhbGFuY2UpCiAgICAgICAgaWYgbm90IHNlZ19kYXRhOgogICAgICAgICAgICByZXR1cm4gW10KCiAgICAgICAgcGFja2FnZXMgPSBzZWdfZGF0YS5nZXQoInNwZWNpYWxfcGFja2FnZXMiLCBbXSkKICAgICAgICBzcGVjaWFsX3BhY2thZ2VzID0gW10KCiAgICAgICAgZm9yIHBrZyBpbiBwYWNrYWdlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IHBrZy5nZXQoIm5hbWUiLCAiVW5rbm93biBQYWNrYWdlIikKICAgICAgICAgICAgICAgIGtvZGVfcGFrZXQgPSBwa2cuZ2V0KCJrb2RlX3Bha2V0IiwgIi0iKQoKICAgICAgICAgICAgICAgIGlmIG5vdCBrb2RlX3Bha2V0IG9yIGtvZGVfcGFrZXQgPT0gIi0iOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgb3JpZ2luYWxfcHJpY2UgPSBpbnQocGtnLmdldCgib3JpZ2luYWxfcHJpY2UiLCAwKSkKICAgICAgICAgICAgICAgIGRpc2tvbl9wcmljZSA9IGludChwa2cuZ2V0KCJkaXNrb25fcHJpY2UiLCBvcmlnaW5hbF9wcmljZSkpCgogICAgICAgICAgICAgICAgZGlza29uX3BlcmNlbnQgPSAwCiAgICAgICAgICAgICAgICBpZiBvcmlnaW5hbF9wcmljZSA+IDAgYW5kIGRpc2tvbl9wcmljZSA8IG9yaWdpbmFsX3ByaWNlOgogICAgICAgICAgICAgICAgICAgIGRpc2tvbl9wZXJjZW50ID0gaW50KHJvdW5kKChvcmlnaW5hbF9wcmljZSAtIGRpc2tvbl9wcmljZSkgLyBvcmlnaW5hbF9wcmljZSAqIDEwMCkpCgogICAgICAgICAgICAgICAgc3BlY2lhbF9wYWNrYWdlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogbmFtZSwKICAgICAgICAgICAgICAgICAgICAia29kZV9wYWtldCI6IGtvZGVfcGFrZXQsCiAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsX3ByaWNlIjogb3JpZ2luYWxfcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgImRpc2tvbl9wcmljZSI6IGRpc2tvbl9wcmljZSwKICAgICAgICAgICAgICAgICAgICAiZGlza29uX3BlcmNlbnQiOiBkaXNrb25fcGVyY2VudCwKICAgICAgICAgICAgICAgICAgICAia3VvdGFfZ2IiOiBwa2cuZ2V0KCJrdW90YV9nYiIsIDApLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCBmIkdhZ2FsIHBhcnNlIHBha2V0IGJybzoge2V9IPCfpK8iKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgc3BlY2lhbF9wYWNrYWdlcy5zb3J0KGtleT1sYW1iZGEgeDogeFsiZGlza29uX3BlcmNlbnQiXSwgcmV2ZXJzZT1UcnVlKQogICAgICAgIHJldHVybiBzcGVjaWFsX3BhY2thZ2VzCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgZiJHYWdhbCBuZ2FtYmlsIGRhdGEgU0ZZIGJybzoge2V9IPCfpK8iKQogICAgICAgIHJldHVybiBbXQoKCmRlZiBzaG93X3NwZWNpYWxfZm9yX3lvdV9tZW51KHRva2VuczogZGljdCk6CiAgICB0aGVtZSA9IGdldF90aGVtZSgpCgogICAgYXBpX2tleSA9IEF1dGhJbnN0YW5jZS5hcGlfa2V5CiAgICBpZF90b2tlbiA9IHRva2Vucy5nZXQoImlkX3Rva2VuIiwgIiIpCiAgICBhY2Nlc3NfdG9rZW4gPSB0b2tlbnMuZ2V0KCJhY2Nlc3NfdG9rZW4iLCAiIikKICAgIGJhbGFuY2UgPSAwCgogICAgc3BlY2lhbF9wYWNrYWdlcyA9IGZldGNoX3NwZWNpYWxfZm9yX3lvdShhcGlfa2V5LCBpZF90b2tlbiwgYWNjZXNzX3Rva2VuLCBiYWxhbmNlKQoKICAgIHdoaWxlIFRydWU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKCiAgICAgICAgaWYgbm90IHNwZWNpYWxfcGFja2FnZXM6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLihLnvuI8gU2FudHV5IiwgIlNlcGkgY3V5LCBuZ2dhayBhZGEgcGFrZXQgc3Blc2lhbCDwn5i0IikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaW5mb190ZXh0ID0gQWxpZ24uY2VudGVyKAogICAgICAgICAgICBmIlt7dGhlbWVbJ3RleHRfYm9keSddfV3wn5SlIFBha2V0IFNwZWNpYWwgRm9yIFlvdSDwn6SZ8J+UpVsve3RoZW1lWyd0ZXh0X2JvZHknXX1dIgogICAgICAgICkKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBpbmZvX3RleHQsCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKCiAgICAgICAgdGFibGUgPSBUYWJsZShib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTm8iLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD00KQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIk5hbWEgUGFrZXQiLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiRGlza29uIiwganVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9tb25leSJdKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIk5vcm1hbCIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfZXJyIl0pCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiSGFyZ2EiLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X21vbmV5Il0pCgogICAgICAgIGZvciBpZHgsIHBrZyBpbiBlbnVtZXJhdGUoc3BlY2lhbF9wYWNrYWdlcywgMSk6CiAgICAgICAgICAgIGVtb2ppX2Rpc2tvbiA9ICLwn5K4IiBpZiBwa2cuZ2V0KCJkaXNrb25fcGVyY2VudCIsIDApID49IDUwIGVsc2UgIiIKICAgICAgICAgICAgZW1vamlfa3VvdGEgPSAi8J+UpSIgaWYgcGtnLmdldCgia3VvdGFfZ2IiLCAwKSA+PSAxMDAgZWxzZSAiIgoKICAgICAgICAgICAgb3JpZ2luYWxfcHJpY2UgPSBnZXRfcnVwaWFoKHBrZy5nZXQoIm9yaWdpbmFsX3ByaWNlIiwgMCkpCiAgICAgICAgICAgIGRpc2tvbl9wcmljZSA9IGdldF9ydXBpYWgocGtnLmdldCgiZGlza29uX3ByaWNlIiwgMCkpCgogICAgICAgICAgICB0YWJsZS5hZGRfcm93KAogICAgICAgICAgICAgICAgc3RyKGlkeCksCiAgICAgICAgICAgICAgICBmIntlbW9qaV9rdW90YX0ge3BrZy5nZXQoJ25hbWUnLCAnLScpfSIsCiAgICAgICAgICAgICAgICBmIntwa2cuZ2V0KCdkaXNrb25fcGVyY2VudCcsIDApfSUge2Vtb2ppX2Rpc2tvbn0iLAogICAgICAgICAgICAgICAgZiJbe3RoZW1lWyd0ZXh0X2VyciddfV1bc3RyaWtlXXtvcmlnaW5hbF9wcmljZX1bL3N0cmlrZV1bL3t0aGVtZVsndGV4dF9lcnInXX1dIiwKICAgICAgICAgICAgICAgIGYiW3t0aGVtZVsndGV4dF9tb25leSddfV17ZGlza29uX3ByaWNlfVsve3RoZW1lWyd0ZXh0X21vbmV5J119XSIKICAgICAgICAgICAgKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKHRhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sIHBhZGRpbmc9KDAsIDApLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NikKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1DYWJ1dCBiYWxpayBrZSBtZW51IHNlYmVsdW1ueWEg8J+PoFsvXSIpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIG5hdl90YWJsZSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF90aXRsZSddfV1QaWxpaCBwYWtldCAobm9tb3IpIGJybyDwn5GJOlsve3RoZW1lWyd0ZXh0X3RpdGxlJ119XSAiKS5zdHJpcCgpCgogICAgICAgIGlmIGNob2ljZSA9PSAiMDAiOgogICAgICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgICAgIGlmIG5vdCBjaG9pY2UuaXNkaWdpdCgpOgogICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJJbnB1dCBsbyBuZ2FjbyBicm8sIG1hc3VraW4gYW5na2Eg8J+aqCIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgY2hvaWNlX2lkeCA9IGludChjaG9pY2UpIC0gMQogICAgICAgIGlmIDAgPD0gY2hvaWNlX2lkeCA8IGxlbihzcGVjaWFsX3BhY2thZ2VzKToKICAgICAgICAgICAgc2VsZWN0ZWRfcGtnID0gc3BlY2lhbF9wYWNrYWdlc1tjaG9pY2VfaWR4XQogICAgICAgICAgICBhcGlfa2V5ID0gQXV0aEluc3RhbmNlLmFwaV9rZXkKICAgICAgICAgICAgcmVzdWx0ID0gc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBzZWxlY3RlZF9wa2dbImtvZGVfcGFrZXQiXSwgaXNfZW50ZXJwcmlzZT1GYWxzZSkKCiAgICAgICAgICAgIGlmIHJlc3VsdCA9PSAiTUFJTiI6CiAgICAgICAgICAgICAgICByZXR1cm4gIk1BSU4iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiTm9tb3IgcGFrZXQgbmdnYWsgdmFsaWQgYnJvIPCfmqgiKQogICAgICAgICAgICBwYXVzZSgpCg==').decode())
