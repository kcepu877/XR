#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBhcHAzLmNvbmZpZy5pbXBvcnRzIGltcG9ydCAqCmZyb20gYXBwMy5tZW51cy51dGlsIGltcG9ydCBjbGVhcl9zY3JlZW4sIHNpbXBsZV9udW1iZXIsIHBhdXNlLCBwcmludF9wYW5lbApmcm9tIGFwcDMubWVudXMucGFja2FnZSBpbXBvcnQgc2hvd19wYWNrYWdlX2RldGFpbHMsIGdldF9wYWNrYWdlX2RldGFpbHMKCmNvbnNvbGUgPSBDb25zb2xlKCkKCgpkZWYgc2hvd19ib29rbWFya19tZW51KHJldHVybl9wYWNrYWdlX2RldGFpbDogYm9vbCA9IEZhbHNlKToKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZW5zdXJlX2dpdCgpCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKCLwn5OMIEJvb2ttYXJrIFBha2V0IPCfpJkiLCB2ZXJ0aWNhbD0ibWlkZGxlIiksCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKICAgICAgICBzaW1wbGVfbnVtYmVyKCkKCiAgICAgICAgYm9va21hcmtzID0gQm9va21hcmtJbnN0YW5jZS5nZXRfYm9va21hcmtzKCkKICAgICAgICBpZiBub3QgYm9va21hcmtzOgogICAgICAgICAgICBwcmludF9wYW5lbCgi4oS577iPIFNhbnR1eSIsICJCZWx1bSBhZGEgYm9va21hcmsgdGVyc2ltcGFuIGJybyDwn5i0IikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4gKE5vbmUsIE5vbmUpIGlmIHJldHVybl9wYWNrYWdlX2RldGFpbCBlbHNlIE5vbmUKCiAgICAgICAgdGFibGUgPSBUYWJsZShib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTm8iLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwganVzdGlmeT0icmlnaHQiLCB3aWR0aD00KQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIk5hbWEgUGFrZXQiLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCgogICAgICAgIGZvciBpZHgsIGJtIGluIGVudW1lcmF0ZShib29rbWFya3MpOgogICAgICAgICAgICBsYWJlbCA9IGYie2JtWydmYW1pbHlfbmFtZSddfSAtIHtibVsndmFyaWFudF9uYW1lJ119IC0ge2JtWydvcHRpb25fbmFtZSddfSIKICAgICAgICAgICAgdGFibGUuYWRkX3JvdyhzdHIoaWR4ICsgMSksIGxhYmVsKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKHRhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sIHBhZGRpbmc9KDAsIDApLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIG5hdiA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2LmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NikKICAgICAgICBuYXYuYWRkX2NvbHVtbihqdXN0aWZ5PSJsZWZ0Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIG5hdi5hZGRfcm93KCIwMCIsIGYiW3t0aGVtZVsndGV4dF9zdWInXX1dQ2FidXQgYmFsaWsga2UgbWVudSBhd2FsIPCfj6BbL10iKQogICAgICAgIG5hdi5hZGRfcm93KCIwMDAiLCBmIlt7dGhlbWVbJ3RleHRfZXJyJ119XUhhcHVzIEJvb2ttYXJrIGN1eSDwn5eR77iPIFsvXSIpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwobmF2LCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sIGV4cGFuZD1UcnVlKSkKCiAgICAgICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1dUGlsaWggYm9va21hcmsgKG5vbW9yKTog8J+RiSBbL3t0aGVtZVsndGV4dF90aXRsZSddfV0gIikuc3RyaXAoKQoKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgcmV0dXJuIChOb25lLCBOb25lKSBpZiByZXR1cm5fcGFja2FnZV9kZXRhaWwgZWxzZSBOb25lCgogICAgICAgIGVsaWYgY2hvaWNlID09ICIwMDAiOgogICAgICAgICAgICBkZWxfY2hvaWNlID0gY29uc29sZS5pbnB1dCgiTWFzdWtpbiBub21vciBib29rbWFyayB5YW5nIG1hdSBkaWhhcHVzOiAiKS5zdHJpcCgpCiAgICAgICAgICAgIGlmIGRlbF9jaG9pY2UuaXNkaWdpdCgpIGFuZCAxIDw9IGludChkZWxfY2hvaWNlKSA8PSBsZW4oYm9va21hcmtzKToKICAgICAgICAgICAgICAgIGRlbF9ibSA9IGJvb2ttYXJrc1tpbnQoZGVsX2Nob2ljZSkgLSAxXQogICAgICAgICAgICAgICAgQm9va21hcmtJbnN0YW5jZS5yZW1vdmVfYm9va21hcmsoCiAgICAgICAgICAgICAgICAgICAgZGVsX2JtWyJmYW1pbHlfY29kZSJdLAogICAgICAgICAgICAgICAgICAgIGRlbF9ibVsiaXNfZW50ZXJwcmlzZSJdLAogICAgICAgICAgICAgICAgICAgIGRlbF9ibVsidmFyaWFudF9uYW1lIl0sCiAgICAgICAgICAgICAgICAgICAgZGVsX2JtWyJvcmRlciJdLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCAiQm9va21hcmsgdWRhaCBndWUgaGFwdXMgYnJvIPCfmoAiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiSW5wdXQgbG8gbmdhY28sIGNvYmEgbGFnaSBjdXkg8J+kryIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgZWxpZiBjaG9pY2UuaXNkaWdpdCgpIGFuZCAxIDw9IGludChjaG9pY2UpIDw9IGxlbihib29rbWFya3MpOgogICAgICAgICAgICBzZWxlY3RlZF9ibSA9IGJvb2ttYXJrc1tpbnQoY2hvaWNlKSAtIDFdCiAgICAgICAgICAgIGZhbWlseV9jb2RlID0gc2VsZWN0ZWRfYm1bImZhbWlseV9jb2RlIl0KICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSA9IHNlbGVjdGVkX2JtWyJpc19lbnRlcnByaXNlIl0KCiAgICAgICAgICAgIGZhbWlseV9kYXRhID0gZ2V0X2ZhbWlseShhcGlfa2V5LCB0b2tlbnMsIGZhbWlseV9jb2RlLCBpc19lbnRlcnByaXNlKQogICAgICAgICAgICBpZiBub3QgZmFtaWx5X2RhdGE6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJHYWdhbCBuZ2FtYmlsIGRhdGEgZmFtaWx5IGJybyDwn5qoIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICB2YXJpYW50X2NvZGUgPSBOb25lCiAgICAgICAgICAgIG9wdGlvbl9jb2RlID0gTm9uZQogICAgICAgICAgICBmb3IgdmFyaWFudCBpbiBmYW1pbHlfZGF0YVsicGFja2FnZV92YXJpYW50cyJdOgogICAgICAgICAgICAgICAgaWYgdmFyaWFudFsibmFtZSJdID09IHNlbGVjdGVkX2JtWyJ2YXJpYW50X25hbWUiXToKICAgICAgICAgICAgICAgICAgICB2YXJpYW50X2NvZGUgPSB2YXJpYW50WyJwYWNrYWdlX3ZhcmlhbnRfY29kZSJdCiAgICAgICAgICAgICAgICAgICAgZm9yIG9wdGlvbiBpbiB2YXJpYW50WyJwYWNrYWdlX29wdGlvbnMiXToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3B0aW9uWyJvcmRlciJdID09IHNlbGVjdGVkX2JtWyJvcmRlciJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uX2NvZGUgPSBvcHRpb25bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGlmIG5vdCBvcHRpb25fY29kZSBvciBub3QgdmFyaWFudF9jb2RlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiUGFrZXQgbmdnYWsga2V0ZW11IGJybyDwn6SvIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBpZiByZXR1cm5fcGFja2FnZV9kZXRhaWw6CiAgICAgICAgICAgICAgICBkZXRhaWwgPSBnZXRfcGFja2FnZV9kZXRhaWxzKAogICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHRva2VucywKICAgICAgICAgICAgICAgICAgICBmYW1pbHlfY29kZSwKICAgICAgICAgICAgICAgICAgICB2YXJpYW50X2NvZGUsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfYm1bIm9yZGVyIl0sCiAgICAgICAgICAgICAgICAgICAgaXNfZW50ZXJwcmlzZQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgZGV0YWlsOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBmIntzZWxlY3RlZF9ibVsnZmFtaWx5X25hbWUnXX0gLSB7c2VsZWN0ZWRfYm1bJ3ZhcmlhbnRfbmFtZSddfSAtIHtzZWxlY3RlZF9ibVsnb3B0aW9uX25hbWUnXX0iCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRldGFpbCwgbmFtZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJHYWdhbCBuZ2FtYmlsIGRldGFpbCBwYWtldCBicm8g8J+aqCIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoTm9uZSwgTm9uZSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNob3dfcGFja2FnZV9kZXRhaWxzKGFwaV9rZXksIHRva2Vucywgb3B0aW9uX2NvZGUsIGlzX2VudGVycHJpc2UpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIklucHV0IGxvIG5nYWNvIGJybywgY29iYSBsYWdpIPCfmqgiKQogICAgICAgICAgICBwYXVzZSgpCg==').decode())
