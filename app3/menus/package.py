#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KaW1wb3J0IHN5cwppbXBvcnQgcmVxdWVzdHMKCmZyb20gYXBwMy5jb25maWcuaW1wb3J0cyBpbXBvcnQgKgpmcm9tIGFwcC50eXBlX2RpY3QgaW1wb3J0IFBheW1lbnRJdGVtCmZyb20gYXBwMy5tZW51cy51dGlsIGltcG9ydCBsaXZlX2xvYWRpbmcsIGNsZWFyX3NjcmVlbiwgcGF1c2UsIGRpc3BsYXlfaHRtbCwgcHJpbnRfcGFuZWwsIGdldF9ydXBpYWgsIGZvcm1hdF9xdW90YV9ieXRlLCBuYXZfcmFuZ2UsIHNpbXBsZV9udW1iZXIKZnJvbSBhcHAzLmNsaWVudC5lbmdzZWwgaW1wb3J0IGdldF9hZGRvbnMsIHNlbmRfYXBpX3JlcXVlc3QsIHVuc3Vic2NyaWJlCmZyb20gYXBwMy5jbGllbnQuY2lhbSBpbXBvcnQgZ2V0X2F1dGhfY29kZQpmcm9tIGFwcDMuY2xpZW50LnB1cmNoYXNlLnJlZGVlbSBpbXBvcnQgc2V0dGxlbWVudF9ib3VudHksIHNldHRsZW1lbnRfbG95YWx0eSwgYm91bnR5X2FsbG90bWVudApmcm9tIGFwcDMuY2xpZW50LnB1cmNoYXNlLnFyaXMgaW1wb3J0IHNob3dfcXJpc19wYXltZW50CmZyb20gYXBwMy5jbGllbnQucHVyY2hhc2UuZXdhbGxldCBpbXBvcnQgc2hvd19tdWx0aXBheW1lbnQKZnJvbSBhcHAzLmNsaWVudC5wdXJjaGFzZS5iYWxhbmNlIGltcG9ydCBzZXR0bGVtZW50X2JhbGFuY2UKZnJvbSBhcHAzLm1lbnVzLnB1cmNoYXNlIGltcG9ydCBwdXJjaGFzZV9uX3RpbWVzLCBwdXJjaGFzZV9uX3RpbWVzX2J5X29wdGlvbl9jb2RlCgpjb25zb2xlID0gQ29uc29sZSgpCgoKZGVmIHNob3dfcGFja2FnZV9kZXRhaWxzKGFwaV9rZXksIHRva2VucywgcGFja2FnZV9vcHRpb25fY29kZSwgaXNfZW50ZXJwcmlzZSwgb3B0aW9uX29yZGVyPS0xKToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGNsZWFyX3NjcmVlbigpCgogICAgcGFja2FnZSA9IGdldF9wYWNrYWdlKGFwaV9rZXksIHRva2VucywgcGFja2FnZV9vcHRpb25fY29kZSkKICAgIGlmIG5vdCBwYWNrYWdlOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIG11YXQgZGV0YWlsIHBha2V0IGJybyDwn5qoIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgIG9wdGlvbiA9IHBhY2thZ2UuZ2V0KCJwYWNrYWdlX29wdGlvbiIsIHt9KQogICAgZmFtaWx5ID0gcGFja2FnZS5nZXQoInBhY2thZ2VfZmFtaWx5Iiwge30pCiAgICB2YXJpYW50ID0gcGFja2FnZS5nZXQoInBhY2thZ2VfZGV0YWlsX3ZhcmlhbnQiLCB7fSkKCiAgICBwcmljZSA9IG9wdGlvbi5nZXQoInByaWNlIiwgMCkKICAgIGZvcm1hdHRlZF9wcmljZSA9IGdldF9ydXBpYWgocHJpY2UpCiAgICB2YWxpZGl0eSA9IG9wdGlvbi5nZXQoInZhbGlkaXR5IiwgIi0iKQogICAgcG9pbnQgPSBvcHRpb24uZ2V0KCJwb2ludCIsICItIikKICAgIHBsYW5fdHlwZSA9IGZhbWlseS5nZXQoInBsYW5fdHlwZSIsICItIikKICAgIHBheW1lbnRfZm9yID0gZmFtaWx5LmdldCgicGF5bWVudF9mb3IiLCAiIikgb3IgIkJVWV9QQUNLQUdFIgoKICAgIHRva2VuX2NvbmZpcm1hdGlvbiA9IHBhY2thZ2UuZ2V0KCJ0b2tlbl9jb25maXJtYXRpb24iLCAiIikKICAgIHRzX3RvX3NpZ24gPSBwYWNrYWdlLmdldCgidGltZXN0YW1wIiwgIiIpCiAgICBkZXRhaWwgPSBkaXNwbGF5X2h0bWwob3B0aW9uLmdldCgidG5jIiwgIiIpKQoKICAgIG9wdGlvbl9uYW1lID0gb3B0aW9uLmdldCgibmFtZSIsICIiKQogICAgZmFtaWx5X25hbWUgPSBmYW1pbHkuZ2V0KCJuYW1lIiwgIiIpCiAgICB2YXJpYW50X25hbWUgPSB2YXJpYW50LmdldCgibmFtZSIsICIiKQogICAgdGl0bGUgPSBmIntmYW1pbHlfbmFtZX0gLSB7dmFyaWFudF9uYW1lfSAtIHtvcHRpb25fbmFtZX0iLnN0cmlwKCkKCiAgICBmYW1pbHlfY29kZSA9IGZhbWlseS5nZXQoInBhY2thZ2VfZmFtaWx5X2NvZGUiLCAiIikKICAgIHBhcmVudF9jb2RlID0gcGFja2FnZS5nZXQoInBhY2thZ2VfYWRkb24iLCB7fSkuZ2V0KCJwYXJlbnRfY29kZSIsICIiKSBvciAiTi9BIgoKICAgIHBheW1lbnRfaXRlbXMgPSBbCiAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgIGl0ZW1fY29kZT1wYWNrYWdlX29wdGlvbl9jb2RlLAogICAgICAgICAgICBwcm9kdWN0X3R5cGU9IiIsCiAgICAgICAgICAgIGl0ZW1fcHJpY2U9cHJpY2UsCiAgICAgICAgICAgIGl0ZW1fbmFtZT1mInt2YXJpYW50X25hbWV9IHtvcHRpb25fbmFtZX0iLnN0cmlwKCksCiAgICAgICAgICAgIHRheD0wLAogICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb249dG9rZW5fY29uZmlybWF0aW9uLAogICAgICAgICkKICAgIF0KCiAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgIEFsaWduLmNlbnRlcihmIvCfk6Yge2ZhbWlseV9uYW1lfSIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgZXhwYW5kPVRydWUKICAgICkpCiAgICBzaW1wbGVfbnVtYmVyKCkKICAgIGVuc3VyZV9naXQoKQoKICAgIGluZm9fdGFibGUgPSBUYWJsZS5ncmlkKHBhZGRpbmc9KDAsIDEpKQogICAgaW5mb190YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9ImxlZnQiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSkKICAgIGluZm9fdGFibGUuYWRkX2NvbHVtbihqdXN0aWZ5PSJsZWZ0IikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiTmFtYSIsIGYiOiBbYm9sZCB7dGhlbWVbJ3RleHRfYm9keSddfV17dGl0bGV9Wy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiSGFyZ2EiLCBmIjogUnAgW3t0aGVtZVsndGV4dF9tb25leSddfV17Zm9ybWF0dGVkX3ByaWNlfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIk1hc2EgQWt0aWYiLCBmIjogW3t0aGVtZVsndGV4dF9kYXRlJ119XXt2YWxpZGl0eX1bL10iKQogICAgaW5mb190YWJsZS5hZGRfcm93KCJQb2ludCIsIGYiOiBbe3RoZW1lWyd0ZXh0X2JvZHknXX1de3BvaW50fVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIlBsYW4gVHlwZSIsIGYiOiBbe3RoZW1lWyd0ZXh0X2JvZHknXX1de3BsYW5fdHlwZX1bL10iKQogICAgaW5mb190YWJsZS5hZGRfcm93KCJQYXltZW50IEZvciIsIGYiOiBbe3RoZW1lWyd0ZXh0X2JvZHknXX1de3BheW1lbnRfZm9yfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIkZhbWlseSBDb2RlIiwgZiI6IFt7dGhlbWVbJ2JvcmRlcl93YXJuaW5nJ119XXtmYW1pbHlfY29kZX1bL10iKQogICAgaW5mb190YWJsZS5hZGRfcm93KCJQYXJlbnQgQ29kZSIsIGYiOiBbe3RoZW1lWyd0ZXh0X3N1YiddfV17cGFyZW50X2NvZGV9Wy9dIikKCiAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgIGluZm9fdGFibGUsCiAgICAgICAgdGl0bGU9ZiJbe3RoZW1lWyd0ZXh0X3RpdGxlJ119XfCfk6YgRGV0YWlsIFBha2V0Wy9dIiwKICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgZXhwYW5kPVRydWUKICAgICkpCgogICAgYmVuZWZpdHMgPSBvcHRpb24uZ2V0KCJiZW5lZml0cyIsIFtdKQogICAgaWYgYmVuZWZpdHM6CiAgICAgICAgYmVuZWZpdF90YWJsZSA9IFRhYmxlKGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBiZW5lZml0X3RhYmxlLmFkZF9jb2x1bW4oIk5hbWEiLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfY29sdW1uKCJKZW5pcyIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICBiZW5lZml0X3RhYmxlLmFkZF9jb2x1bW4oIlVubGkiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwganVzdGlmeT0iY2VudGVyIikKICAgICAgICBiZW5lZml0X3RhYmxlLmFkZF9jb2x1bW4oIlRvdGFsIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdLCBqdXN0aWZ5PSJyaWdodCIpCgogICAgICAgIGZvciBiIGluIGJlbmVmaXRzOgogICAgICAgICAgICBkdCA9IGJbImRhdGFfdHlwZSJdCiAgICAgICAgICAgIHRvdGFsID0gYlsidG90YWwiXQogICAgICAgICAgICBpc191bmxpID0gYlsiaXNfdW5saW1pdGVkIl0KCiAgICAgICAgICAgIGlmIGlzX3VubGk6CiAgICAgICAgICAgICAgICB0b3RhbF9zdHIgPSB7IlZPSUNFIjogIm1lbml0IiwgIlRFWFQiOiAiU01TIiwgIkRBVEEiOiAia3VvdGEifS5nZXQoZHQsIGR0KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgZHQgPT0gIlZPSUNFIjoKICAgICAgICAgICAgICAgICAgICB0b3RhbF9zdHIgPSBmInt0b3RhbCAvIDYwOi4wZn0gbWVuaXQiCiAgICAgICAgICAgICAgICBlbGlmIGR0ID09ICJURVhUIjoKICAgICAgICAgICAgICAgICAgICB0b3RhbF9zdHIgPSBmInt0b3RhbH0gU01TIgogICAgICAgICAgICAgICAgZWxpZiBkdCA9PSAiREFUQSI6CiAgICAgICAgICAgICAgICAgICAgaWYgdG90YWwgPj0gMV8wMDBfMDAwXzAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfc3RyID0gZiJ7dG90YWwgLyAoMTAyNCAqKiAzKTouMmZ9IEdCIgogICAgICAgICAgICAgICAgICAgIGVsaWYgdG90YWwgPj0gMV8wMDBfMDAwOgogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbF9zdHIgPSBmInt0b3RhbCAvICgxMDI0ICoqIDIpOi4yZn0gTUIiCiAgICAgICAgICAgICAgICAgICAgZWxpZiB0b3RhbCA+PSAxXzAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfc3RyID0gZiJ7dG90YWwgLyAxMDI0Oi4yZn0gS0IiCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfc3RyID0gZiJ7dG90YWx9IEIiCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRvdGFsX3N0ciA9IGYie3RvdGFsfSAoe2R0fSkiCgogICAgICAgICAgICBiZW5lZml0X3RhYmxlLmFkZF9yb3coYlsibmFtZSJdLCBkdCwgIllFUyIgaWYgaXNfdW5saSBlbHNlICItIiwgdG90YWxfc3RyKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBiZW5lZml0X3RhYmxlLAogICAgICAgICAgICB0aXRsZT1mIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1d8J+OgSBCZW5lZml0IFBha2V0Wy9dIiwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfc3VjY2VzcyJdLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAwKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgZGV0YWlsLAogICAgICAgIHRpdGxlPWYiW3t0aGVtZVsndGV4dF90aXRsZSddfV3wn5OcIFN5YXJhdCAmIEtldGVudHVhblsvXSIsCiAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfd2FybmluZyJdLAogICAgICAgIGV4cGFuZD1UcnVlCiAgICApKQoKICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD02KQogICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjEiLCAi8J+SsCBCZWxpIHBha2UgUHVsc2EiKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjIiLCAi8J+SsyBCYXlhciB2aWEgRS1XYWxsZXQiKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjMiLCAi8J+TsSBRUklTIikKICAgIG5hdl90YWJsZS5hZGRfcm93KCI0IiwgIvCfkrAgUHVsc2EgKyBEZWNveSIpCiAgICBuYXZfdGFibGUuYWRkX3JvdygiNSIsICLwn5KwIFB1bHNhICsgRGVjb3kgVjIiKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjYiLCAi8J+TsSBRUklTICsgRGVjb3kgKCsxSykiKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjciLCAi8J+TsSBRUklTICsgRGVjb3kgVjIiKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjgiLCAi8J+SsCBQdWxzYSBOIGthbGkiKQogICAgaWYgcGF5bWVudF9mb3IgPT0gIlJFREVFTV9WT1VDSEVSIjoKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiQiIsICLwn46BIEFtYmlsIGJvbnVzIGJybyIpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIkJBIiwgIvCfjoEgS2lyaW0gYm9udXMga2UgdGVtZW4iKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCJMIiwgIuKtkCBCZWxpIHBha2UgUG9pbiIpCiAgICBpZiBvcHRpb25fb3JkZXIgIT0gLTE6CiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAiLCAi8J+UliBUYW1iYWhpbiBrZSBCb29rbWFyayIpCiAgICBuYXZfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUJhbGlrIGtlIGRhZnRhciBwYWtldCDinIzvuI9bL10iKQoKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgbmF2X3RhYmxlLAogICAgICAgIHRpdGxlPWYiW3t0aGVtZVsndGV4dF90aXRsZSddfV3wn5uSIE9wc2kgUGVtYmVsaWFuWy9dIiwKICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sCiAgICAgICAgZXhwYW5kPVRydWUKICAgICkpCgogICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XfCfkYkgUGlsaWhhbiBsbyBicm86Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCgogICAgaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgIGVsaWYgY2hvaWNlID09ICIwIiBhbmQgb3B0aW9uX29yZGVyICE9IC0xOgogICAgICAgIHN1Y2Nlc3MgPSBCb29rbWFya0luc3RhbmNlLmFkZF9ib29rbWFyaygKICAgICAgICAgICAgZmFtaWx5X2NvZGU9cGFja2FnZS5nZXQoInBhY2thZ2VfZmFtaWx5Iiwge30pLmdldCgicGFja2FnZV9mYW1pbHlfY29kZSIsIiIpLAogICAgICAgICAgICBmYW1pbHlfbmFtZT1wYWNrYWdlLmdldCgicGFja2FnZV9mYW1pbHkiLCB7fSkuZ2V0KCJuYW1lIiwiIiksCiAgICAgICAgICAgIGlzX2VudGVycHJpc2U9aXNfZW50ZXJwcmlzZSwKICAgICAgICAgICAgdmFyaWFudF9uYW1lPXZhcmlhbnRfbmFtZSwKICAgICAgICAgICAgb3B0aW9uX25hbWU9b3B0aW9uX25hbWUsCiAgICAgICAgICAgIG9yZGVyPW9wdGlvbl9vcmRlciwKICAgICAgICApCiAgICAgICAgaWYgc3VjY2VzczoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCAiUGFrZXQgdWRhaCBtYXN1ayBib29rbWFyayBicm8g8J+agCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyBTYW50YWkiLCAiUGFrZXQgdWRhaCBhZGEgZGkgYm9va21hcmsgYnJvIPCfmYUiKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlID09ICIxIjoKICAgICAgICBzZXR0bGVtZW50X2JhbGFuY2UoYXBpX2tleSwgdG9rZW5zLCBwYXltZW50X2l0ZW1zLCBwYXltZW50X2ZvciwgVHJ1ZSkKICAgICAgICAjcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCAiUGVtYmVsaWFuIHZpYSBwdWxzYSBzdWtzZXMgYnJvIPCfmoAiKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICBzaG93X211bHRpcGF5bWVudChhcGlfa2V5LCB0b2tlbnMsIHBheW1lbnRfaXRlbXMsIHBheW1lbnRfZm9yLCBUcnVlKQogICAgICAgICNwcmludF9wYW5lbCgi4pyFIE1hbnRhcCIsICJQZW1iYXlhcmFuIHZpYSBlLXdhbGxldCBzdWtzZXMgYnJvIPCfmoAiKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlID09ICIzIjoKICAgICAgICBzaG93X3FyaXNfcGF5bWVudChhcGlfa2V5LCB0b2tlbnMsIHBheW1lbnRfaXRlbXMsIHBheW1lbnRfZm9yLCBUcnVlKQogICAgICAgICNwcmludF9wYW5lbCgi4pyFIE1hbnRhcCIsICJRUklTIGphbGFuIGxhbmNhciBicm8g8J+agCIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UgPT0gIjQiOgogICAgICAgIGRlY295ID0gRGVjb3lJbnN0YW5jZS5nZXRfZGVjb3koImJhbGFuY2UiKQogICAgICAgIGRlY295X3BhY2thZ2VfZGV0YWlsID0gZ2V0X3BhY2thZ2UoYXBpX2tleSwgdG9rZW5zLCBkZWNveVsib3B0aW9uX2NvZGUiXSkKICAgICAgICBpZiBub3QgZGVjb3lfcGFja2FnZV9kZXRhaWw6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkRldGFpbCBwYWtldCBkZWNveSBuZ2dhayBrZXRlbXUgYnJvIPCfmqgiKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgcGF5bWVudF9pdGVtcy5hcHBlbmQoCiAgICAgICAgICAgIFBheW1lbnRJdGVtKAogICAgICAgICAgICAgICAgaXRlbV9jb2RlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICBwcm9kdWN0X3R5cGU9IiIsCiAgICAgICAgICAgICAgICBpdGVtX3ByaWNlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgaXRlbV9uYW1lPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICB0YXg9MCwKICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbj1kZWNveV9wYWNrYWdlX2RldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0sCiAgICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIG92ZXJ3cml0ZV9hbW91bnQgPSBwcmljZSArIGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCiAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgcGF5bWVudF9mb3IsIEZhbHNlLCBvdmVyd3JpdGVfYW1vdW50PW92ZXJ3cml0ZV9hbW91bnQpCgogICAgICAgIGlmIHJlcyBhbmQgcmVzLmdldCgic3RhdHVzIiwgIiIpICE9ICJTVUNDRVNTIjoKICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzLmdldCgibWVzc2FnZSIsICJFcnJvciBuZ2FjbyBicm8iKQogICAgICAgICAgICBpZiAiQml6ei1lcnIuQW1vdW50LlRvdGFsIiBpbiBlcnJvcl9tc2c6CiAgICAgICAgICAgICAgICB2YWxpZF9hbW91bnQgPSBpbnQoZXJyb3JfbXNnLnNwbGl0KCI9IilbMV0uc3RyaXAoKSkKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLihLnvuI8gU2FudGFpIiwgZiJUb3RhbCBkaXNlc3VhaWthbiBrZToge3ZhbGlkX2Ftb3VudH0iKQogICAgICAgICAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgcGF5bWVudF9mb3IsIEZhbHNlLCBvdmVyd3JpdGVfYW1vdW50PXZhbGlkX2Ftb3VudCkKICAgICAgICAgICAgICAgIGlmIHJlcyBhbmQgcmVzLmdldCgic3RhdHVzIiwgIiIpID09ICJTVUNDRVNTIjoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pyFIE1hbnRhcCIsICJQZW1iZWxpYW4gc3Vrc2VzIGJybyDwn5qAIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludF9wYW5lbCgi4pyFIE1hbnRhcCIsICJQZW1iZWxpYW4gc3Vrc2VzIGJybyDwn5qAIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBlbGlmIGNob2ljZSA9PSAiNSI6CiAgICAgICAgZGVjb3kgPSBEZWNveUluc3RhbmNlLmdldF9kZWNveSgiYmFsYW5jZSIpCiAgICAgICAgZGVjb3lfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZShhcGlfa2V5LCB0b2tlbnMsIGRlY295WyJvcHRpb25fY29kZSJdKQogICAgICAgIGlmIG5vdCBkZWNveV9wYWNrYWdlX2RldGFpbDoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiRGV0YWlsIHBha2V0IGRlY295IG5nZ2FrIGtldGVtdSBicm8g8J+aqCIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBwYXltZW50X2l0ZW1zLmFwcGVuZCgKICAgICAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICBpdGVtX2NvZGU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInByaWNlIl0sCiAgICAgICAgICAgICAgICBpdGVtX25hbWU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bIm5hbWUiXSwKICAgICAgICAgICAgICAgIHRheD0wLAogICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRlY295X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgb3ZlcndyaXRlX2Ftb3VudCA9IHByaWNlICsgZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInByaWNlIl0KICAgICAgICByZXMgPSBzZXR0bGVtZW50X2JhbGFuY2UoCiAgICAgICAgICAgIGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgIvCfpKsiLCBGYWxzZSwKICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudD1vdmVyd3JpdGVfYW1vdW50LCB0b2tlbl9jb25maXJtYXRpb25faWR4PTEKICAgICAgICApCgogICAgICAgIGlmIHJlcyBhbmQgcmVzLmdldCgic3RhdHVzIiwgIiIpICE9ICJTVUNDRVNTIjoKICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzLmdldCgibWVzc2FnZSIsICJFcnJvciBuZ2FjbyBicm8iKQogICAgICAgICAgICBpZiAiQml6ei1lcnIuQW1vdW50LlRvdGFsIiBpbiBlcnJvcl9tc2c6CiAgICAgICAgICAgICAgICB2YWxpZF9hbW91bnQgPSBpbnQoZXJyb3JfbXNnLnNwbGl0KCI9IilbMV0uc3RyaXAoKSkKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLihLnvuI8gU2FudGFpIiwgZiJUb3RhbCBkaXNlc3VhaWthbiBrZToge3ZhbGlkX2Ftb3VudH0iKQogICAgICAgICAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgIvCfpKsiLCBGYWxzZSwgb3ZlcndyaXRlX2Ftb3VudD12YWxpZF9hbW91bnQsIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9LTEpCiAgICAgICAgICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCAiUGVtYmVsaWFuIHN1a3NlcyBicm8g8J+agCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCAiUGVtYmVsaWFuIHN1a3NlcyBicm8g8J+agCIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UgPT0gIjYiOgogICAgICAgIGRlY295ID0gRGVjb3lJbnN0YW5jZS5nZXRfZGVjb3koInFyaXMiKQogICAgICAgIGRlY295X3BhY2thZ2VfZGV0YWlsID0gZ2V0X3BhY2thZ2UoYXBpX2tleSwgdG9rZW5zLCBkZWNveVsib3B0aW9uX2NvZGUiXSkKICAgICAgICBpZiBub3QgZGVjb3lfcGFja2FnZV9kZXRhaWw6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkRldGFpbCBwYWtldCBkZWNveSBuZ2dhayBrZXRlbXUgYnJvIPCfmqgiKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgcGF5bWVudF9pdGVtcy5hcHBlbmQoCiAgICAgICAgICAgIFBheW1lbnRJdGVtKAogICAgICAgICAgICAgICAgaXRlbV9jb2RlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICBwcm9kdWN0X3R5cGU9IiIsCiAgICAgICAgICAgICAgICBpdGVtX3ByaWNlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgaXRlbV9uYW1lPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICB0YXg9MCwKICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbj1kZWNveV9wYWNrYWdlX2RldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0sCiAgICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIGNvbnNvbGUucnVsZSgpCiAgICAgICAgY29uc29sZS5wcmludChmIkhhcmdhIFBha2V0IFV0YW1hOiBScCB7cHJpY2V9IikKICAgICAgICBjb25zb2xlLnByaW50KGYiSGFyZ2EgUGFrZXQgRGVjb3k6IFJwIHtkZWNveV9wYWNrYWdlX2RldGFpbFsncGFja2FnZV9vcHRpb24nXVsncHJpY2UnXX0iKQogICAgICAgIGNvbnNvbGUucHJpbnQoIuKaoSBTaWxha2FuIHV0YWstYXRpayBhbW91bnQgYnJvICh0cmlhbCAmIGVycm9yLCAwID0gbmdhY28pIikKICAgICAgICBjb25zb2xlLnJ1bGUoKQoKICAgICAgICBzaG93X3FyaXNfcGF5bWVudChhcGlfa2V5LCB0b2tlbnMsIHBheW1lbnRfaXRlbXMsICJTSEFSRV9QQUNLQUdFIiwgVHJ1ZSwgdG9rZW5fY29uZmlybWF0aW9uX2lkeD0xKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlID09ICI3IjoKICAgICAgICBkZWNveSA9IERlY295SW5zdGFuY2UuZ2V0X2RlY295KCJxcmlzMCIpCiAgICAgICAgZGVjb3lfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZShhcGlfa2V5LCB0b2tlbnMsIGRlY295WyJvcHRpb25fY29kZSJdKQogICAgICAgIGlmIG5vdCBkZWNveV9wYWNrYWdlX2RldGFpbDoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiRGV0YWlsIHBha2V0IGRlY295IG5nZ2FrIGtldGVtdSBicm8g8J+aqCIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBwYXltZW50X2l0ZW1zLmFwcGVuZCgKICAgICAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICBpdGVtX2NvZGU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInByaWNlIl0sCiAgICAgICAgICAgICAgICBpdGVtX25hbWU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bIm5hbWUiXSwKICAgICAgICAgICAgICAgIHRheD0wLAogICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRlY295X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgY29uc29sZS5ydWxlKCkKICAgICAgICBjb25zb2xlLnByaW50KGYiSGFyZ2EgUGFrZXQgVXRhbWE6IFJwIHtwcmljZX0iKQogICAgICAgIGNvbnNvbGUucHJpbnQoZiJIYXJnYSBQYWtldCBEZWNveTogUnAge2RlY295X3BhY2thZ2VfZGV0YWlsWydwYWNrYWdlX29wdGlvbiddWydwcmljZSddfSIpCiAgICAgICAgY29uc29sZS5wcmludCgi4pqhIFNpbGFrYW4gdXRhay1hdGlrIGFtb3VudCBicm8gKHRyaWFsICYgZXJyb3IsIDAgPSBuZ2FjbykiKQogICAgICAgIGNvbnNvbGUucnVsZSgpCgogICAgICAgIHNob3dfcXJpc19wYXltZW50KGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgIlNIQVJFX1BBQ0tBR0UiLCBUcnVlLCB0b2tlbl9jb25maXJtYXRpb25faWR4PTEpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UgPT0gIjgiOgogICAgICAgIHVzZV9kZWNveV9mb3Jfbl90aW1lcyA9IGNvbnNvbGUuaW5wdXQoIlBha2UgZGVjb3kgcGFrZXQgYnJvPyAoeS9uKTogIikuc3RyaXAoKS5sb3dlcigpID09ICd5JwogICAgICAgIG5fdGltZXNfc3RyID0gY29uc29sZS5pbnB1dCgiTWF1IGJlbGkgYmVyYXBhIGthbGkgYnJvIChjdGg6IDMpOiAiKS5zdHJpcCgpCiAgICAgICAgZGVsYXlfc2Vjb25kc19zdHIgPSBjb25zb2xlLmlucHV0KCJEZWxheSBhbnRhciBwZW1iZWxpYW4gKGRldGlrLCBjdGg6IDI1KTogIikuc3RyaXAoKQogICAgICAgIGlmIG5vdCBkZWxheV9zZWNvbmRzX3N0ci5pc2RpZ2l0KCk6CiAgICAgICAgICAgIGRlbGF5X3NlY29uZHNfc3RyID0gIjAiCgogICAgICAgIHRyeToKICAgICAgICAgICAgbl90aW1lcyA9IGludChuX3RpbWVzX3N0cikKICAgICAgICAgICAgaWYgbl90aW1lcyA8IDE6CiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJNaW5pbWFsIDEgYnJvLiIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIklucHV0IGp1bWxhaCBuZ2FjbyBicm8g8J+aqCIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBwdXJjaGFzZV9uX3RpbWVzX2J5X29wdGlvbl9jb2RlKAogICAgICAgICAgICBuX3RpbWVzLAogICAgICAgICAgICBvcHRpb25fY29kZT1wYWNrYWdlX29wdGlvbl9jb2RlLAogICAgICAgICAgICB1c2VfZGVjb3k9dXNlX2RlY295X2Zvcl9uX3RpbWVzLAogICAgICAgICAgICBkZWxheV9zZWNvbmRzPWludChkZWxheV9zZWNvbmRzX3N0ciksCiAgICAgICAgICAgIHBhdXNlX29uX3N1Y2Nlc3M9RmFsc2UsCiAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9MQogICAgICAgICkKICAgICAgICAjcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCBmIlBlbWJlbGlhbiB7bl90aW1lc314IHN1a3NlcyBicm8g8J+agCIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UubG93ZXIoKSA9PSAiYiI6CiAgICAgICAgc2V0dGxlbWVudF9ib3VudHkoCiAgICAgICAgICAgIGFwaV9rZXk9YXBpX2tleSwKICAgICAgICAgICAgdG9rZW5zPXRva2VucywKICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPXRva2VuX2NvbmZpcm1hdGlvbiwKICAgICAgICAgICAgdHNfdG9fc2lnbj10c190b19zaWduLAogICAgICAgICAgICBwYXltZW50X3RhcmdldD1wYWNrYWdlX29wdGlvbl9jb2RlLAogICAgICAgICAgICBwcmljZT1wcmljZSwKICAgICAgICAgICAgaXRlbV9uYW1lPXZhcmlhbnRfbmFtZQogICAgICAgICkKICAgICAgICAjcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCAiQm9udXMgYmVyaGFzaWwgZGlhbWJpbCBicm8g8J+OgSIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UubG93ZXIoKSA9PSAiYmEiOgogICAgICAgIGRlc3RpbmF0aW9uX21zaXNkbiA9IGNvbnNvbGUuaW5wdXQoIk1hc3VraW4gbm9tb3IgdHVqdWFuIGJvbnVzIGJybyAoNjJ4eHgpOiAiKS5zdHJpcCgpCiAgICAgICAgYm91bnR5X2FsbG90bWVudCgKICAgICAgICAgICAgYXBpX2tleT1hcGlfa2V5LAogICAgICAgICAgICB0b2tlbnM9dG9rZW5zLAogICAgICAgICAgICB0c190b19zaWduPXRzX3RvX3NpZ24sCiAgICAgICAgICAgIGRlc3RpbmF0aW9uX21zaXNkbj1kZXN0aW5hdGlvbl9tc2lzZG4sCiAgICAgICAgICAgIGl0ZW1fbmFtZT1vcHRpb25fbmFtZSwKICAgICAgICAgICAgaXRlbV9jb2RlPXBhY2thZ2Vfb3B0aW9uX2NvZGUsCiAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbj10b2tlbl9jb25maXJtYXRpb24sCiAgICAgICAgKQogICAgICAgICNwcmludF9wYW5lbCgi4pyFIE1hbnRhcCIsICJCb251cyBiZXJoYXNpbCBkaWtpcmltIGJybyDwn46BIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJsIjoKICAgICAgICBzZXR0bGVtZW50X2xveWFsdHkoCiAgICAgICAgICAgIGFwaV9rZXk9YXBpX2tleSwKICAgICAgICAgICAgdG9rZW5zPXRva2VucywKICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPXRva2VuX2NvbmZpcm1hdGlvbiwKICAgICAgICAgICAgdHNfdG9fc2lnbj10c190b19zaWduLAogICAgICAgICAgICBwYXltZW50X3RhcmdldD1wYWNrYWdlX29wdGlvbl9jb2RlLAogICAgICAgICAgICBwcmljZT1wcmljZSwKICAgICAgICApCiAgICAgICAgI3ByaW50X3BhbmVsKCLinIUgTWFudGFwIiwgIlBlbWJlbGlhbiBwYWtlIHBvaW4gc3Vrc2VzIGJybyDirZAiKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsc2U6CiAgICAgICAgcHJpbnRfcGFuZWwoIuKEue+4jyBTYW50YWkiLCAiUGVtYmVsaWFuIGRpYmF0YWxpbiBicm8g8J+ZhSIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiAiQkFDSyIKCgpkZWYgZ2V0X3BhY2thZ2VzX2J5X2ZhbWlseSgKICAgIGZhbWlseV9jb2RlOiBzdHIsCiAgICBpc19lbnRlcnByaXNlOiBib29sIHwgTm9uZSA9IE5vbmUsCiAgICBtaWdyYXRpb25fdHlwZTogc3RyIHwgTm9uZSA9IE5vbmUsCiAgICByZXR1cm5fcGFja2FnZV9kZXRhaWw6IGJvb2wgPSBGYWxzZQopOgogICAgYXBpX2tleSA9IEF1dGhJbnN0YW5jZS5hcGlfa2V5CiAgICB0b2tlbnMgPSBBdXRoSW5zdGFuY2UuZ2V0X2FjdGl2ZV90b2tlbnMoKQogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQoKICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiVG9rZW4gdXNlciBha3RpZiBuZ2dhayBrZXRlbXUgYnJvIPCfmqgiKQogICAgICAgIHJldHVybiAiQkFDSyIKCiAgICBkYXRhID0gZ2V0X2ZhbWlseShhcGlfa2V5LCB0b2tlbnMsIGZhbWlseV9jb2RlLCBpc19lbnRlcnByaXNlLCBtaWdyYXRpb25fdHlwZSkKICAgIGlmIG5vdCBkYXRhOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIG11YXQgZGF0YSBwYWtldCBmYW1pbHkgYnJvIPCfmqgiKQogICAgICAgIHJldHVybiAiQkFDSyIKCiAgICBwcmljZV9jdXJyZW5jeSA9ICJScCIKICAgIGlmIGRhdGFbInBhY2thZ2VfZmFtaWx5Il0uZ2V0KCJyY19ib251c190eXBlIikgPT0gIk1ZUkVXQVJEUyI6CiAgICAgICAgcHJpY2VfY3VycmVuY3kgPSAiUG9pbiIKCiAgICBwYWNrYWdlcyA9IFtdCiAgICBmb3IgdmFyaWFudCBpbiBkYXRhWyJwYWNrYWdlX3ZhcmlhbnRzIl06CiAgICAgICAgZm9yIG9wdGlvbiBpbiB2YXJpYW50WyJwYWNrYWdlX29wdGlvbnMiXToKICAgICAgICAgICAgcGFja2FnZXMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICJudW1iZXIiOiBsZW4ocGFja2FnZXMpICsgMSwKICAgICAgICAgICAgICAgICJ2YXJpYW50X25hbWUiOiB2YXJpYW50WyJuYW1lIl0sCiAgICAgICAgICAgICAgICAib3B0aW9uX25hbWUiOiBvcHRpb25bIm5hbWUiXSwKICAgICAgICAgICAgICAgICJwcmljZSI6IG9wdGlvblsicHJpY2UiXSwKICAgICAgICAgICAgICAgICJjb2RlIjogb3B0aW9uWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICAib3B0aW9uX29yZGVyIjogb3B0aW9uWyJvcmRlciJdCiAgICAgICAgICAgIH0pCgogICAgd2hpbGUgVHJ1ZToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGVuc3VyZV9naXQoKQogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIEFsaWduLmNlbnRlcihmIvCfk6Yge2RhdGFbJ3BhY2thZ2VfZmFtaWx5J11bJ25hbWUnXX0iLCB2ZXJ0aWNhbD0ibWlkZGxlIiksCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKICAgICAgICBzaW1wbGVfbnVtYmVyKCkKCiAgICAgICAgaW5mb190ZXh0ID0gVGV4dCgpCiAgICAgICAgaW5mb190ZXh0LmFwcGVuZCgiTmFtYSBGYW1pbHk6ICIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgIGluZm9fdGV4dC5hcHBlbmQoZiJ7ZGF0YVsncGFja2FnZV9mYW1pbHknXVsnbmFtZSddfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfdmFsdWUiXSkKICAgICAgICBpbmZvX3RleHQuYXBwZW5kKCJLb2RlIEZhbWlseTogIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgaW5mb190ZXh0LmFwcGVuZChmIntmYW1pbHlfY29kZX1cbiIsIHN0eWxlPXRoZW1lWyJib3JkZXJfd2FybmluZyJdKQogICAgICAgIGluZm9fdGV4dC5hcHBlbmQoIlRpcGUgUGFrZXQ6ICIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgIGluZm9fdGV4dC5hcHBlbmQoZiJ7ZGF0YVsncGFja2FnZV9mYW1pbHknXVsncGFja2FnZV9mYW1pbHlfdHlwZSddfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfdmFsdWUiXSkKICAgICAgICBpbmZvX3RleHQuYXBwZW5kKCJKdW1sYWggVmFyaWFuOiAiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSkKICAgICAgICBpbmZvX3RleHQuYXBwZW5kKGYie2xlbihkYXRhWydwYWNrYWdlX3ZhcmlhbnRzJ10pfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfdmFsdWUiXSkKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgaW5mb190ZXh0LAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDAsIDIpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCgogICAgICAgIHRhYmxlID0gVGFibGUoYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIk5vIiwganVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJWYXJpYW4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTmFtYSBQYWtldCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJIYXJnYSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X21vbmV5Il0sIGp1c3RpZnk9InJpZ2h0IikKCiAgICAgICAgZm9yIHBrZyBpbiBwYWNrYWdlczoKICAgICAgICAgICAgaGFyZ2Ffc3RyID0gZ2V0X3J1cGlhaChwa2dbInByaWNlIl0pIGlmIHByaWNlX2N1cnJlbmN5ID09ICJScCIgZWxzZSBmIntwa2dbJ3ByaWNlJ119IFBvaW4iCiAgICAgICAgICAgIHRhYmxlLmFkZF9yb3coCiAgICAgICAgICAgICAgICBzdHIocGtnWyJudW1iZXIiXSksCiAgICAgICAgICAgICAgICBwa2dbInZhcmlhbnRfbmFtZSJdLAogICAgICAgICAgICAgICAgcGtnWyJvcHRpb25fbmFtZSJdLAogICAgICAgICAgICAgICAgaGFyZ2Ffc3RyCiAgICAgICAgICAgICkKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgdGFibGUsCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMCwgMCksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKCiAgICAgICAgbmF2ID0gVGFibGUoc2hvd19oZWFkZXI9RmFsc2UsIGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBuYXYuYWRkX2NvbHVtbihqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD02KQogICAgICAgIG5hdi5hZGRfY29sdW1uKHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICBuYXYuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUJhbGlrIGtlIG1lbnUgc2ViZWx1bW55YSDinIzvuI9bL10iKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBuYXYsCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwKICAgICAgICAgICAgcGFkZGluZz0oMCwgMSksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKCiAgICAgICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1d8J+RiSBQaWxpaCAobm9tb3IpIHBha2V0IGJybzpbL3t0aGVtZVsndGV4dF90aXRsZSddfV0gIikuc3RyaXAoKQogICAgICAgIGlmIGNob2ljZSA9PSAiMDAiOgogICAgICAgICAgICByZXR1cm4gIkJBQ0siCiAgICAgICAgaWYgbm90IGNob2ljZS5pc2RpZ2l0KCk6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIklucHV0IG5nYWNvIGJybywgbWFzdWtpbiBub21vciBwYWtldCDwn5qoIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBzZWxlY3RlZCA9IG5leHQoKHAgZm9yIHAgaW4gcGFja2FnZXMgaWYgcFsibnVtYmVyIl0gPT0gaW50KGNob2ljZSkpLCBOb25lKQogICAgICAgIGlmIG5vdCBzZWxlY3RlZDoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiTm9tb3IgcGFrZXQgbmdnYWsga2V0ZW11IGJybyDwn5qoIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBpZiByZXR1cm5fcGFja2FnZV9kZXRhaWw6CiAgICAgICAgICAgIHZhcmlhbnRfY29kZSA9IG5leHQoKHZbInBhY2thZ2VfdmFyaWFudF9jb2RlIl0gZm9yIHYgaW4gZGF0YVsicGFja2FnZV92YXJpYW50cyJdIGlmIHZbIm5hbWUiXSA9PSBzZWxlY3RlZFsidmFyaWFudF9uYW1lIl0pLCBOb25lKQogICAgICAgICAgICBkZXRhaWwgPSBnZXRfcGFja2FnZV9kZXRhaWxzKAogICAgICAgICAgICAgICAgYXBpX2tleSwgdG9rZW5zLAogICAgICAgICAgICAgICAgZmFtaWx5X2NvZGUsCiAgICAgICAgICAgICAgICB2YXJpYW50X2NvZGUsCiAgICAgICAgICAgICAgICBzZWxlY3RlZFsib3B0aW9uX29yZGVyIl0sCiAgICAgICAgICAgICAgICBpc19lbnRlcnByaXNlCiAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgZGV0YWlsOgogICAgICAgICAgICAgICAgZGlzcGxheV9uYW1lID0gZiJ7ZGF0YVsncGFja2FnZV9mYW1pbHknXVsnbmFtZSddfSAtIHtzZWxlY3RlZFsndmFyaWFudF9uYW1lJ119IC0ge3NlbGVjdGVkWydvcHRpb25fbmFtZSddfSIKICAgICAgICAgICAgICAgIHJldHVybiBkZXRhaWwsIGRpc3BsYXlfbmFtZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiR2FnYWwgbmdhbWJpbCBkZXRhaWwgcGFrZXQgYnJvIPCfmqgiKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXN1bHQgPSBzaG93X3BhY2thZ2VfZGV0YWlscygKICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICBzZWxlY3RlZFsiY29kZSJdLAogICAgICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSwKICAgICAgICAgICAgICAgIG9wdGlvbl9vcmRlcj1zZWxlY3RlZFsib3B0aW9uX29yZGVyIl0KICAgICAgICAgICAgKQogICAgICAgICAgICBpZiByZXN1bHQgPT0gIk1BSU4iOgogICAgICAgICAgICAgICAgcmV0dXJuICJNQUlOIgogICAgICAgICAgICBlbGlmIHJlc3VsdCA9PSAiQkFDSyI6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbGlmIHJlc3VsdCBpcyBUcnVlOgogICAgICAgICAgICAgICAgY29udGludWUKCgpkZWYgZmV0Y2hfbXlfcGFja2FnZXMoKToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiVG9rZW4gdXNlciBha3RpZiBuZ2dhayBrZXRlbXUgYnJvIPCfmqgiKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgaWRfdG9rZW4gPSB0b2tlbnMuZ2V0KCJpZF90b2tlbiIpCiAgICBwYXRoID0gImFwaS92OC9wYWNrYWdlcy9xdW90YS1kZXRhaWxzIgogICAgcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAiZmFtaWx5X21lbWJlcl9pZCI6ICIiCiAgICB9CgogICAgd2l0aCBsaXZlX2xvYWRpbmcoIvCflIQgTGFnaSBuZ2FtYmlsIHBha2V0IGFrdGlmIGJyby4uLiIsIHRoZW1lKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCgogICAgaWYgcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIG5nYW1iaWwgcGFrZXQgYWt0aWYgYnJvIPCfmqgiKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgcXVvdGFzID0gcmVzWyJkYXRhIl1bInF1b3RhcyJdCiAgICBpZiBub3QgcXVvdGFzOgogICAgICAgIHByaW50X3BhbmVsKCLihLnvuI8gSW5mbyIsICJOZ2dhayBhZGEgcGFrZXQgYWt0aWYga2V0ZW11IGJybyDwn5mFIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgIHdoaWxlIFRydWU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBBbGlnbi5jZW50ZXIoIvCfk6YgUGFrZXQgQWt0aWYgR3VlIiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDEsIDIpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCiAgICAgICAgc2ltcGxlX251bWJlcigpCgogICAgICAgIG15X3BhY2thZ2VzID0gW10KICAgICAgICBmb3IgbnVtLCBxdW90YSBpbiBlbnVtZXJhdGUocXVvdGFzLCBzdGFydD0xKToKICAgICAgICAgICAgcXVvdGFfY29kZSA9IHF1b3RhWyJxdW90YV9jb2RlIl0KICAgICAgICAgICAgZ3JvdXBfY29kZSA9IHF1b3RhWyJncm91cF9jb2RlIl0KICAgICAgICAgICAgcXVvdGFfbmFtZSA9IHF1b3RhWyJuYW1lIl0KICAgICAgICAgICAgZmFtaWx5X2NvZGUgPSAiTi9BIgoKICAgICAgICAgICAgcHJvZHVjdF9zdWJzY3JpcHRpb25fdHlwZSA9IHF1b3RhLmdldCgicHJvZHVjdF9zdWJzY3JpcHRpb25fdHlwZSIsICIiKQogICAgICAgICAgICBwcm9kdWN0X2RvbWFpbiA9IHF1b3RhLmdldCgicHJvZHVjdF9kb21haW4iLCAiIikKCiAgICAgICAgICAgIGJlbmVmaXRzID0gcXVvdGEuZ2V0KCJiZW5lZml0cyIsIFtdKQogICAgICAgICAgICBiZW5lZml0X3RhYmxlID0gTm9uZQogICAgICAgICAgICBpZiBiZW5lZml0czoKICAgICAgICAgICAgICAgIGJlbmVmaXRfdGFibGUgPSBUYWJsZShib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgICAgICAgICBiZW5lZml0X3RhYmxlLmFkZF9jb2x1bW4oIk5hbWEiLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgICAgICBiZW5lZml0X3RhYmxlLmFkZF9jb2x1bW4oIkplbmlzIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfY29sdW1uKCJLdW90YSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSwganVzdGlmeT0icmlnaHQiKQoKICAgICAgICAgICAgICAgIGZvciBiIGluIGJlbmVmaXRzOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBiLmdldCgibmFtZSIsICIiKQogICAgICAgICAgICAgICAgICAgIGR0ID0gYi5nZXQoImRhdGFfdHlwZSIsICJOL0EiKQogICAgICAgICAgICAgICAgICAgIHIgPSBiLmdldCgicmVtYWluaW5nIiwgMCkKICAgICAgICAgICAgICAgICAgICB0ID0gYi5nZXQoInRvdGFsIiwgMCkKCiAgICAgICAgICAgICAgICAgICAgaWYgZHQgPT0gIkRBVEEiOgogICAgICAgICAgICAgICAgICAgICAgICByX3N0ciA9IGZvcm1hdF9xdW90YV9ieXRlKHIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRfc3RyID0gZm9ybWF0X3F1b3RhX2J5dGUodCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGR0ID09ICJWT0lDRSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJfc3RyID0gZiJ7ciAvIDYwOi4yZn0gbWVuaXQiCiAgICAgICAgICAgICAgICAgICAgICAgIHRfc3RyID0gZiJ7dCAvIDYwOi4yZn0gbWVuaXQiCiAgICAgICAgICAgICAgICAgICAgZWxpZiBkdCA9PSAiVEVYVCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJfc3RyID0gZiJ7cn0gU01TIgogICAgICAgICAgICAgICAgICAgICAgICB0X3N0ciA9IGYie3R9IFNNUyIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByX3N0ciA9IHN0cihyKQogICAgICAgICAgICAgICAgICAgICAgICB0X3N0ciA9IHN0cih0KQoKICAgICAgICAgICAgICAgICAgICBiZW5lZml0X3RhYmxlLmFkZF9yb3cobmFtZSwgZHQsIGYie3Jfc3RyfSAvIHt0X3N0cn0iKQoKICAgICAgICAgICAgcGFja2FnZV9kZXRhaWxzID0gZ2V0X3BhY2thZ2UoYXBpX2tleSwgdG9rZW5zLCBxdW90YV9jb2RlKQogICAgICAgICAgICBpZiBwYWNrYWdlX2RldGFpbHM6CiAgICAgICAgICAgICAgICBmYW1pbHlfY29kZSA9IHBhY2thZ2VfZGV0YWlsc1sicGFja2FnZV9mYW1pbHkiXVsicGFja2FnZV9mYW1pbHlfY29kZSJdCgogICAgICAgICAgICBwYWNrYWdlX3RleHQgPSBUZXh0KCkKICAgICAgICAgICAgcGFja2FnZV90ZXh0LmFwcGVuZChmIvCfk6YgUGFrZXQge251bX1cbiIsIHN0eWxlPSJib2xkIikKICAgICAgICAgICAgcGFja2FnZV90ZXh0LmFwcGVuZCgiTmFtYTogIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgICAgIHBhY2thZ2VfdGV4dC5hcHBlbmQoZiJ7cXVvdGFfbmFtZX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X3N1YiJdKQogICAgICAgICAgICBwYWNrYWdlX3RleHQuYXBwZW5kKCJRdW90YSBDb2RlOiAiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSkKICAgICAgICAgICAgcGFja2FnZV90ZXh0LmFwcGVuZChmIntxdW90YV9jb2RlfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICBwYWNrYWdlX3RleHQuYXBwZW5kKCJGYW1pbHkgQ29kZTogIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgICAgIHBhY2thZ2VfdGV4dC5hcHBlbmQoZiJ7ZmFtaWx5X2NvZGV9XG4iLCBzdHlsZT10aGVtZVsiYm9yZGVyX3dhcm5pbmciXSkKICAgICAgICAgICAgcGFja2FnZV90ZXh0LmFwcGVuZCgiR3JvdXAgQ29kZTogIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgICAgIHBhY2thZ2VfdGV4dC5hcHBlbmQoZiJ7Z3JvdXBfY29kZX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKCiAgICAgICAgICAgIHBhbmVsX2NvbnRlbnQgPSBbcGFja2FnZV90ZXh0XQogICAgICAgICAgICBpZiBiZW5lZml0X3RhYmxlOgogICAgICAgICAgICAgICAgcGFuZWxfY29udGVudC5hcHBlbmQoYmVuZWZpdF90YWJsZSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgICAgICBHcm91cCgqcGFuZWxfY29udGVudCksCiAgICAgICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgICAgICkpCgogICAgICAgICAgICBteV9wYWNrYWdlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgIm51bWJlciI6IG51bSwKICAgICAgICAgICAgICAgICJuYW1lIjogcXVvdGFfbmFtZSwKICAgICAgICAgICAgICAgICJxdW90YV9jb2RlIjogcXVvdGFfY29kZSwKICAgICAgICAgICAgICAgICJwcm9kdWN0X3N1YnNjcmlwdGlvbl90eXBlIjogcHJvZHVjdF9zdWJzY3JpcHRpb25fdHlwZSwKICAgICAgICAgICAgICAgICJwcm9kdWN0X2RvbWFpbiI6IHByb2R1Y3RfZG9tYWluLAogICAgICAgICAgICB9KQoKICAgICAgICBuYXZfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIG5hdl90YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCIwMCIsIGYiW3t0aGVtZVsndGV4dF9zdWInXX1dQmFsaWsga2UgbWVudSB1dGFtYVsvXSIpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3cobmF2X3JhbmdlKCIiLCBsZW4obXlfcGFja2FnZXMpKSwgIkxpaGF0IGRldGFpbCBwYWtldCDwn5GAICIpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3cobmF2X3JhbmdlKCJkZWwiLCBsZW4obXlfcGFja2FnZXMpKSwgZiJbe3RoZW1lWyd0ZXh0X2VyciddfV1IYXB1cyBwYWtldCDwn5eR77iPIFsvXSIpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIG5hdl90YWJsZSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1d8J+RiSBQaWxpaGFuIGxvIGJybzpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBpZiBjaG9pY2UuaXNkaWdpdCgpOgogICAgICAgICAgICBub21vciA9IGludChjaG9pY2UpCiAgICAgICAgICAgIHNlbGVjdGVkID0gbmV4dCgocCBmb3IgcCBpbiBteV9wYWNrYWdlcyBpZiBwWyJudW1iZXIiXSA9PSBub21vciksIE5vbmUpCiAgICAgICAgICAgIGlmIG5vdCBzZWxlY3RlZDoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk5vbW9yIHBha2V0IG5nZ2FrIGtldGVtdSBicm8g8J+aqCIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBzaG93X3BhY2thZ2VfZGV0YWlscyhhcGlfa2V5LCB0b2tlbnMsIHNlbGVjdGVkWyJxdW90YV9jb2RlIl0sIEZhbHNlKQogICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBlbGlmIGNob2ljZS5zdGFydHN3aXRoKCJkZWwgIik6CiAgICAgICAgICAgIHBhcnRzID0gY2hvaWNlLnNwbGl0KCIgIikKICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSAhPSAyIG9yIG5vdCBwYXJ0c1sxXS5pc2RpZ2l0KCk6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJGb3JtYXQgaGFwdXMgcGFrZXQgbmdhY28gYnJvIPCfmqgiKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIG5vbW9yID0gaW50KHBhcnRzWzFdKQogICAgICAgICAgICBzZWxlY3RlZCA9IG5leHQoKHAgZm9yIHAgaW4gbXlfcGFja2FnZXMgaWYgcFsibnVtYmVyIl0gPT0gbm9tb3IpLCBOb25lKQogICAgICAgICAgICBpZiBub3Qgc2VsZWN0ZWQ6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJOb21vciBwYWtldCBuZ2dhayBrZXRlbXUgYnJvIPCfmqgiKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGNvbmZpcm0gPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dWWFraW4gbWF1IHVuc3Vic2NyaWJlIHBha2V0IHtub21vcn0gLSB7c2VsZWN0ZWRbJ25hbWUnXX0/ICh5L24pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKS5sb3dlcigpCiAgICAgICAgICAgIGlmIGNvbmZpcm0gPT0gInkiOgogICAgICAgICAgICAgICAgd2l0aCBsaXZlX2xvYWRpbmcoIvCflIQgTGFnaSBoYXB1cyBwYWtldCBicm8uLi4iLCB0aGVtZSk6CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IHVuc3Vic2NyaWJlKAogICAgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkWyJxdW90YV9jb2RlIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkWyJwcm9kdWN0X3N1YnNjcmlwdGlvbl90eXBlIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkWyJwcm9kdWN0X2RvbWFpbiJdCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiIGlmIHN1Y2Nlc3MgZWxzZSAi4pqg77iPIFVwcyIsICJVbnN1YnNjcmliZSBzdWtzZXMgYnJvIPCfmoAiIGlmIHN1Y2Nlc3MgZWxzZSAiR2FnYWwgdW5zdWJzY3JpYmUgYnJvIPCfmqgiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKdjiBJbmZvIiwgIlVuc3Vic2NyaWJlIGRpYmF0YWxpbiBicm8g8J+ZhSIpCiAgICAgICAgICAgIHBhdXNlKCkKCg==').decode())
