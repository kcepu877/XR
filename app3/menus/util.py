#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCByZQppbXBvcnQgdGV4dHdyYXAKZnJvbSBodG1sLnBhcnNlciBpbXBvcnQgSFRNTFBhcnNlcgoKZnJvbSByaWNoLmNvbnNvbGUgaW1wb3J0IENvbnNvbGUKZnJvbSByaWNoLnBhbmVsIGltcG9ydCBQYW5lbApmcm9tIHJpY2gudGFibGUgaW1wb3J0IFRhYmxlCmZyb20gcmljaC50ZXh0IGltcG9ydCBUZXh0CmZyb20gcmljaC5hbGlnbiBpbXBvcnQgQWxpZ24KZnJvbSByaWNoLnBhZGRpbmcgaW1wb3J0IFBhZGRpbmcKZnJvbSByaWNoIGltcG9ydCBib3gKCmZyb20gYXBwMy5jb25maWcudGhlbWVfY29uZmlnIGltcG9ydCBnZXRfdGhlbWUsIGdldF90aGVtZV9zdHlsZQppbXBvcnQgYXBwMy5tZW51cy5iYW5uZXIgYXMgYmFubmVyCgpjb25zb2xlID0gQ29uc29sZSgpCgphc2NpaV9hcnQgPSBiYW5uZXIubG9hZCgiaHR0cHM6Ly9kMTdlMjJsMnVoNGg0bi5jbG91ZGZyb250Lm5ldC9jb3Jwd2ViL3B1Yi14bGF4aWF0YS8yMDE5LTAzL3hsLWxvZ28ucG5nIiwgZ2xvYmFscygpKQoKZGVmIGNsZWFyX3NjcmVlbngoKToKICAgIHRyeToKICAgICAgICBvcy5zeXN0ZW0oJ2NscycgaWYgb3MubmFtZSA9PSAnbnQnIGVsc2UgJ2NsZWFyJykKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcHJpbnQoIlxuIiAqIDEwMCkKCiAgICBpZiBhc2NpaV9hcnQ6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBhc2NpaV9hcnQudG9fdGVybWluYWwoY29sdW1ucz01NSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBwYXNzCiAgICBwcmludF9iYW5uZXIoKQoKCmRlZiBwcmludF9iYW5uZXIoKToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGJhbm5lcl90ZXh0ID0gQWxpZ24uY2VudGVyKAogICAgICAgICJbYm9sZF1teVhMIENMSSB2OC45LjEgc3Vuc2V0Wy9dIiwKICAgICAgICB2ZXJ0aWNhbD0ibWlkZGxlIgogICAgKQogICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICBiYW5uZXJfdGV4dCwKICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sCiAgICAgICAgc3R5bGU9dGhlbWVbInRleHRfdGl0bGUiXSwKICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICBleHBhbmQ9VHJ1ZSwKICAgICAgICBib3g9Ym94LkRPVUJMRQogICAgKSkKCgpkZWYgc2ltcGxlX251bWJlcigpOgogICAgZnJvbSBhcHAuc2VydmljZS5hdXRoIGltcG9ydCBBdXRoSW5zdGFuY2UKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGFjdGl2ZV91c2VyID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdXNlcigpCgogICAgaWYgbm90IGFjdGl2ZV91c2VyOgogICAgICAgIHRleHQgPSBmIltib2xkIHt0aGVtZVsndGV4dF9lcnInXX1dU2VwaSBjdXksIG5nZ2FrIGFkYSBha3VuIGFrdGlmIPCfmLRbL10iCiAgICBlbHNlOgogICAgICAgIG51bWJlciA9IGFjdGl2ZV91c2VyLmdldCgibnVtYmVyIiwgIi0iKQogICAgICAgIHRleHQgPSBmIltib2xkIHt0aGVtZVsndGV4dF9zdWInXX1dQWt1biBha3RpZiDinKgge251bWJlcn0g4pyoWy9dIgoKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgQWxpZ24uY2VudGVyKHRleHQpLAogICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwKICAgICAgICBwYWRkaW5nPSgwLCAwKSwKICAgICAgICBleHBhbmQ9VHJ1ZQogICAgKSkKCgpkZWYgY2xlYXJfc2NyZWVuKCk6CiAgICBvcy5zeXN0ZW0oJ2NscycgaWYgb3MubmFtZSA9PSAnbnQnIGVsc2UgJ2NsZWFyJykKICAgIGFzY2lpX2FydCA9IHIiIiIKCiBfX18gICAgICBfX18gIF9fXyAgX19fICBfX18gIF9fXyAgX19fICAgICAgIAp8IiAgXCAgICAvIiAgfHwiICBcLyIgIHx8IiAgXC8iICB8fCIgIHwgICAgICAKIFwgICBcICAvLyAgIHwgXCAgIFwgIC8gIFwgICBcICAvIHx8ICB8ICAgICAgCiAvXFwgIFwvLiAgICB8ICBcXCAgXC8gICAgXFwgIFwvICB8OiAgfCAgICAgIAp8OiBcLiAgICAgICAgfCAgLyAgIC8gICAgIC9cLiAgXCAgIFwgIHxfX18gICAKfC4gIFwgICAgLzogIHwgLyAgIC8gICAgIC8gIFwgICBcICggXF98OiAgXCAgCnxfX198XF9fL3xfX198fF9fXy8gICAgIHxfX18vXF9fX3wgXF9fX19fX18pCgoiIiIKCiAgICB2ZXJzaW9uX3RleHQgPSBmIlt7Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X2JvZHknKX1dbXlYTCBDTEkgdjguOS4xIHN1bnNldFsve2dldF90aGVtZV9zdHlsZSgndGV4dF9ib2R5Jyl9XSIKICAgIAogICAgY29udGVudCA9IGYie2FzY2lpX2FydH1cbiAgICAgICAgICAgICAgICAgIHt2ZXJzaW9uX3RleHR9IgogICAgY29uc29sZS5wcmludCgKICAgICAgICBQYWRkaW5nKAogICAgICAgICAgICBBbGlnbi5jZW50ZXIoY29udGVudCksCiAgICAgICAgICAgICgxLCAwKQogICAgICAgICksCiAgICAgICAgc3R5bGU9Z2V0X3RoZW1lX3N0eWxlKCJ0ZXh0X3N1YiIpCiAgICApCgoKI2RlZiBwYXVzZSgpOgojICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoIuKPuO+4jyBQcmVzcyBFbnRlciB0byBjb250aW51ZS4uLiIsIGJvcmRlcl9zdHlsZT1nZXRfdGhlbWVfc3R5bGUoImJvcmRlcl9pbmZvIikpKQojICAgIGlucHV0KCkKCmRlZiBwYXVzZSgpOgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQogICAgY29uc29sZS5wcmludChmIlxuW2JvbGQge3RoZW1lWyd0ZXh0X3N1YiddfV3ij7jvuI8gVGVrYW4gRW50ZXIgYnVhdCBsYW5qdXQgYnJvIOKcjO+4j1svXSIpCiAgICBpbnB1dCgpCgpjbGFzcyBIVE1MVG9UZXh0KEhUTUxQYXJzZXIpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHdpZHRoPTgwLCBidWxsZXQ9IuKAoiIpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQogICAgICAgIHNlbGYud2lkdGggPSB3aWR0aAogICAgICAgIHNlbGYucmVzdWx0ID0gW10KICAgICAgICBzZWxmLmluX2xpID0gRmFsc2UKICAgICAgICBzZWxmLmJ1bGxldCA9IGJ1bGxldAoKICAgIGRlZiBoYW5kbGVfc3RhcnR0YWcoc2VsZiwgdGFnLCBhdHRycyk6CiAgICAgICAgaWYgdGFnID09ICJsaSI6CiAgICAgICAgICAgIHNlbGYuaW5fbGkgPSBUcnVlCiAgICAgICAgZWxpZiB0YWcgPT0gImJyIjoKICAgICAgICAgICAgc2VsZi5yZXN1bHQuYXBwZW5kKCJcbiIpCgogICAgZGVmIGhhbmRsZV9lbmR0YWcoc2VsZiwgdGFnKToKICAgICAgICBpZiB0YWcgPT0gImxpIjoKICAgICAgICAgICAgc2VsZi5pbl9saSA9IEZhbHNlCiAgICAgICAgICAgIHNlbGYucmVzdWx0LmFwcGVuZCgiXG4iKQoKICAgIGRlZiBoYW5kbGVfZGF0YShzZWxmLCBkYXRhKToKICAgICAgICB0ZXh0ID0gZGF0YS5zdHJpcCgpCiAgICAgICAgaWYgdGV4dDoKICAgICAgICAgICAgaWYgc2VsZi5pbl9saToKICAgICAgICAgICAgICAgIHNlbGYucmVzdWx0LmFwcGVuZChmIntzZWxmLmJ1bGxldH0ge3RleHR9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYucmVzdWx0LmFwcGVuZCh0ZXh0KQoKICAgIGRlZiBnZXRfdGV4dChzZWxmKToKICAgICAgICB0ZXh0ID0gIiIuam9pbihzZWxmLnJlc3VsdCkKICAgICAgICB0ZXh0ID0gcmUuc3ViKHIiXG5ccypcblxzKlxuKyIsICJcblxuIiwgdGV4dCkKICAgICAgICByZXR1cm4gIlxuIi5qb2luKHRleHR3cmFwLndyYXAodGV4dCwgd2lkdGg9c2VsZi53aWR0aCwgcmVwbGFjZV93aGl0ZXNwYWNlPUZhbHNlKSkKCgpkZWYgZGlzcGxheV9odG1sKGh0bWxfdGV4dCwgd2lkdGg9ODApOgogICAgcGFyc2VyID0gSFRNTFRvVGV4dCh3aWR0aD13aWR0aCkKICAgIHBhcnNlci5mZWVkKGh0bWxfdGV4dCkKICAgIHJldHVybiBwYXJzZXIuZ2V0X3RleHQoKQoKCmRlZiBmb3JtYXRfcXVvdGFfYnl0ZShxdW90YV9ieXRlOiBpbnQpIC0+IHN0cjoKICAgIEdCID0gMTAyNCoqMwogICAgTUIgPSAxMDI0KioyCiAgICBLQiA9IDEwMjQKICAgIGlmIHF1b3RhX2J5dGUgPj0gR0I6CiAgICAgICAgcmV0dXJuIGYie3F1b3RhX2J5dGUgLyBHQjouMmZ9IEdCIgogICAgZWxpZiBxdW90YV9ieXRlID49IE1COgogICAgICAgIHJldHVybiBmIntxdW90YV9ieXRlIC8gTUI6LjJmfSBNQiIKICAgIGVsaWYgcXVvdGFfYnl0ZSA+PSBLQjoKICAgICAgICByZXR1cm4gZiJ7cXVvdGFfYnl0ZSAvIEtCOi4yZn0gS0IiCiAgICByZXR1cm4gZiJ7cXVvdGFfYnl0ZX0gQiIKCgpkZWYgZ2V0X3J1cGlhaCh2YWx1ZSkgLT4gc3RyOgogICAgdmFsdWVfc3RyID0gc3RyKHZhbHVlKS5zdHJpcCgpCiAgICB2YWx1ZV9zdHIgPSByZS5zdWIociJeUnBccz8iLCAiIiwgdmFsdWVfc3RyKQogICAgbWF0Y2ggPSByZS5tYXRjaChyIihbXGQsXSspKC4qKSIsIHZhbHVlX3N0cikKICAgIGlmIG5vdCBtYXRjaDoKICAgICAgICByZXR1cm4gdmFsdWVfc3RyCiAgICByYXdfbnVtYmVyID0gbWF0Y2guZ3JvdXAoMSkucmVwbGFjZSgiLCIsICIiKQogICAgc3VmZml4ID0gbWF0Y2guZ3JvdXAoMikuc3RyaXAoKQogICAgdHJ5OgogICAgICAgIG51bWJlciA9IGludChyYXdfbnVtYmVyKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmV0dXJuIHZhbHVlX3N0cgogICAgZm9ybWF0dGVkX251bWJlciA9IGYie251bWJlcjosfSIucmVwbGFjZSgiLCIsICIuIikKICAgIGZvcm1hdHRlZCA9IGYie2Zvcm1hdHRlZF9udW1iZXJ9LC0iCiAgICByZXR1cm4gZiJ7Zm9ybWF0dGVkfSB7c3VmZml4fSIgaWYgc3VmZml4IGVsc2UgZm9ybWF0dGVkCgoKZGVmIG5hdl9yYW5nZShsYWJlbDogc3RyLCBjb3VudDogaW50KSAtPiBzdHI6CiAgICBpZiBjb3VudCA8PSAwOgogICAgICAgIHJldHVybiBmIntsYWJlbH0gKHRpZGFrIHRlcnNlZGlhKSIKICAgIGlmIGNvdW50ID09IDE6CiAgICAgICAgcmV0dXJuIGYie2xhYmVsfSAoMSkiCiAgICByZXR1cm4gZiJ7bGFiZWx9ICgx4oCTe2NvdW50fSkiCgoKZGVmIGxpdmVfbG9hZGluZyh0ZXh0OiBzdHIsIHRoZW1lOiBkaWN0KToKICAgIHJldHVybiBjb25zb2xlLnN0YXR1cyhmIlt7dGhlbWVbJ2JvcmRlcl9pbmZvJ119XXt0ZXh0fVsve3RoZW1lWydib3JkZXJfaW5mbyddfV0iLCBzcGlubmVyPSJkb3RzIikKCgpkZWYgcHJpbnRfcGFuZWwodGl0bGUsIGNvbnRlbnQsIGJvcmRlcl9zdHlsZT1Ob25lKToKICAgIHN0eWxlID0gYm9yZGVyX3N0eWxlIG9yIGdldF90aGVtZV9zdHlsZSgiYm9yZGVyX2luZm8iKQogICAgY29uc29sZS5wcmludChQYW5lbChjb250ZW50LCB0aXRsZT10aXRsZSwgdGl0bGVfYWxpZ249ImxlZnQiLCBib3JkZXJfc3R5bGU9c3R5bGUpKQoKCmRlZiBwcmludF9zdWNjZXNzKHRpdGxlLCBjb250ZW50KToKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoY29udGVudCwgdGl0bGU9dGl0bGUsIHRpdGxlX2FsaWduPSJsZWZ0IiwgYm9yZGVyX3N0eWxlPWdldF90aGVtZV9zdHlsZSgiYm9yZGVyX3N1Y2Nlc3MiKSkpCgoKZGVmIHByaW50X2Vycm9yKHRpdGxlLCBjb250ZW50KToKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoY29udGVudCwgdGl0bGU9dGl0bGUsIHRpdGxlX2FsaWduPSJsZWZ0IiwgYm9yZGVyX3N0eWxlPWdldF90aGVtZV9zdHlsZSgiYm9yZGVyX2Vycm9yIikpKQoKCmRlZiBwcmludF93YXJuaW5nKHRpdGxlLCBjb250ZW50KToKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoY29udGVudCwgdGl0bGU9dGl0bGUsIHRpdGxlX2FsaWduPSJsZWZ0IiwgYm9yZGVyX3N0eWxlPWdldF90aGVtZV9zdHlsZSgiYm9yZGVyX3dhcm5pbmciKSkpCgoKZGVmIHByaW50X3RpdGxlKHRleHQpOgogICAgY29uc29sZS5wcmludCgKICAgICAgICBQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKGYiW2JvbGQge2dldF90aGVtZV9zdHlsZSgndGV4dF90aXRsZScpfV17dGV4dH1bL3tnZXRfdGhlbWVfc3R5bGUoJ3RleHRfdGl0bGUnKX1dIiksCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT1nZXRfdGhlbWVfc3R5bGUoImJvcmRlcl9wcmltYXJ5IiksCiAgICAgICAgICAgIHBhZGRpbmc9KDAsIDEpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZSwKICAgICAgICApCiAgICApCgoKZGVmIHByaW50X2tleV92YWx1ZShsYWJlbCwgdmFsdWUpOgogICAgY29uc29sZS5wcmludChmIlt7Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X2tleScpfV17bGFiZWx9OlsvXSBbe2dldF90aGVtZV9zdHlsZSgndGV4dF92YWx1ZScpfV17dmFsdWV9Wy97Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X3ZhbHVlJyl9XSDinIUiKQoKCmRlZiBwcmludF9pbmZvKGxhYmVsLCB2YWx1ZSk6CiAgICBjb25zb2xlLnByaW50KGYiW3tnZXRfdGhlbWVfc3R5bGUoJ3RleHRfc3ViJyl9XXtsYWJlbH06Wy97Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X3N1YicpfV0gW3tnZXRfdGhlbWVfc3R5bGUoJ3RleHRfYm9keScpfV17dmFsdWV9Wy97Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X2JvZHknKX1dIikKCgpkZWYgcHJpbnRfbWVudSh0aXRsZSwgb3B0aW9ucywgaGlnaGxpZ2h0PU5vbmUpOgogICAgdGFibGUgPSBUYWJsZSh0aXRsZT10aXRsZSwgYm94PWJveC5TSU1QTEUsIHNob3dfaGVhZGVyPUZhbHNlKQogICAgZm9yIGtleSwgbGFiZWwgaW4gb3B0aW9ucy5pdGVtcygpOgogICAgICAgIHN0eWxlID0gZ2V0X3RoZW1lX3N0eWxlKCJ0ZXh0X3ZhbHVlIikKICAgICAgICBpZiBoaWdobGlnaHQgYW5kIGtleSA9PSBoaWdobGlnaHQ6CiAgICAgICAgICAgIHN0eWxlID0gZ2V0X3RoZW1lX3N0eWxlKCJ0ZXh0X3RpdGxlIikKICAgICAgICB0YWJsZS5hZGRfcm93KAogICAgICAgICAgICBmIlt7Z2V0X3RoZW1lX3N0eWxlKCd0ZXh0X2tleScpfV17a2V5fVsve2dldF90aGVtZV9zdHlsZSgndGV4dF9rZXknKX1dIiwKICAgICAgICAgICAgZiJbe3N0eWxlfV17bGFiZWx9Wy97c3R5bGV9XSIsCiAgICAgICAgKQogICAgY29uc29sZS5wcmludCh0YWJsZSkK').decode())
