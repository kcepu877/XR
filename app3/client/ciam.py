#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGJhc2U2NAppbXBvcnQgb3MKaW1wb3J0IGpzb24KaW1wb3J0IHV1aWQKaW1wb3J0IHJlcXVlc3RzCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxwYXJzZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSwgdGltZXpvbmUsIHRpbWVkZWx0YQoKZnJvbSBhcHAzLm1lbnVzLnV0aWwgaW1wb3J0IGxpdmVfbG9hZGluZywgcHJpbnRfcGFuZWwKZnJvbSBhcHAzLmNvbmZpZy50aGVtZV9jb25maWcgaW1wb3J0IGdldF90aGVtZQpmcm9tIGFwcDMuY2xpZW50LmVuY3J5cHQgaW1wb3J0ICgKICAgIGphdmFfbGlrZV90aW1lc3RhbXAsCiAgICB0c19nbXQ3X3dpdGhvdXRfY29sb24sCiAgICBheF9hcGlfc2lnbmF0dXJlLAogICAgbG9hZF9heF9mcCwKICAgIGF4X2RldmljZV9pZAopCgpCQVNFX0NJQU1fVVJMID0gb3MuZ2V0ZW52KCJCQVNFX0NJQU1fVVJMIikKaWYgbm90IEJBU0VfQ0lBTV9VUkw6CiAgICByYWlzZSBWYWx1ZUVycm9yKCJCQVNFX0NJQU1fVVJMIGVudmlyb25tZW50IHZhcmlhYmxlIG5vdCBzZXQiKQoKQkFTSUNfQVVUSCA9IG9zLmdldGVudigiQkFTSUNfQVVUSCIpCkFYX0RFVklDRV9JRCA9IGF4X2RldmljZV9pZCgpCkFYX0ZQID0gbG9hZF9heF9mcCgpClVBID0gb3MuZ2V0ZW52KCJVQSIpCgoKZGVmIHZhbGlkYXRlX2NvbnRhY3QoY29udGFjdDogc3RyKSAtPiBib29sOgogICAgcmV0dXJuIGNvbnRhY3Quc3RhcnRzd2l0aCgiNjI4IikgYW5kIGxlbihjb250YWN0KSA8PSAxNAoKCmRlZiBnZXRfb3RwKGNvbnRhY3Q6IHN0cikgLT4gc3RyIHwgTm9uZToKICAgIGlmIG5vdCB2YWxpZGF0ZV9jb250YWN0KGNvbnRhY3QpOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk5vbW9yIG5nZ2FrIHZhbGlkIGJybyDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHVybCA9IEJBU0VfQ0lBTV9VUkwgKyAiL3JlYWxtcy94bC1jaWFtL2F1dGgvb3RwIgogICAgcXVlcnlzdHJpbmcgPSB7ImNvbnRhY3QiOiBjb250YWN0LCAiY29udGFjdFR5cGUiOiAiU01TIiwgImFsdGVybmF0ZUNvbnRhY3QiOiAiZmFsc2UifQogICAgbm93ID0gZGF0ZXRpbWUubm93KHRpbWV6b25lKHRpbWVkZWx0YShob3Vycz03KSkpCiAgICBheF9yZXF1ZXN0X2F0ID0gamF2YV9saWtlX3RpbWVzdGFtcChub3cpCiAgICBheF9yZXF1ZXN0X2lkID0gc3RyKHV1aWQudXVpZDQoKSkKCiAgICBoZWFkZXJzID0gewogICAgICAgICJBdXRob3JpemF0aW9uIjogZiJCYXNpYyB7QkFTSUNfQVVUSH0iLAogICAgICAgICJBeC1EZXZpY2UtSWQiOiBBWF9ERVZJQ0VfSUQsCiAgICAgICAgIkF4LUZpbmdlcnByaW50IjogQVhfRlAsCiAgICAgICAgIkF4LVJlcXVlc3QtQXQiOiBheF9yZXF1ZXN0X2F0LAogICAgICAgICJBeC1SZXF1ZXN0LURldmljZSI6ICJzYW1zdW5nIiwKICAgICAgICAiQXgtUmVxdWVzdC1EZXZpY2UtTW9kZWwiOiAiU00tTjkzNUYiLAogICAgICAgICJBeC1SZXF1ZXN0LUlkIjogYXhfcmVxdWVzdF9pZCwKICAgICAgICAiQXgtU3Vic3R5cGUiOiAiUFJFUEFJRCIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiSG9zdCI6IEJBU0VfQ0lBTV9VUkwucmVwbGFjZSgiaHR0cHM6Ly8iLCAiIiksCiAgICAgICAgIlVzZXItQWdlbnQiOiBVQSwKICAgIH0KCiAgICB3aXRoIGxpdmVfbG9hZGluZyhmIvCfk7IgTGFnaSByZXF1ZXN0IE9UUCBidWF0IHtjb250YWN0fS4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBwYXJhbXM9cXVlcnlzdHJpbmcsIHRpbWVvdXQ9MzApCiAgICAgICAgICAgIGpzb25fYm9keSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBpZiAic3Vic2NyaWJlcl9pZCIgbm90IGluIGpzb25fYm9keToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIk9UUCBnYWdhbCBkaWFtYmlsIPCfmqgiKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCBmIk9UUCBiZXJoYXNpbCBkaWtpcmltIGtlIHtjb250YWN0fSDwn5qAIikKICAgICAgICAgICAgcmV0dXJuIGpzb25fYm9keVsic3Vic2NyaWJlcl9pZCJdCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiRXJyb3IgcGFzIHJlcXVlc3QgT1RQIPCfpK8iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKCmRlZiBleHRlbmRfc2Vzc2lvbihzdWJzY3JpYmVyX2lkOiBzdHIpIC0+IHN0ciB8IE5vbmU6CiAgICBiNjRfc3Vic2NyaWJlcl9pZCA9IGJhc2U2NC5iNjRlbmNvZGUoc3Vic2NyaWJlcl9pZC5lbmNvZGUoKSkuZGVjb2RlKCkKICAgIHVybCA9IGYie0JBU0VfQ0lBTV9VUkx9L3JlYWxtcy94bC1jaWFtL2F1dGgvZXh0ZW5kLXNlc3Npb24iCiAgICBxdWVyeXN0cmluZyA9IHsiY29udGFjdCI6IGI2NF9zdWJzY3JpYmVyX2lkLCAiY29udGFjdFR5cGUiOiAiREVWSUNFSUQifQogICAgbm93ID0gZGF0ZXRpbWUubm93KHRpbWV6b25lKHRpbWVkZWx0YShob3Vycz03KSkpCiAgICBheF9yZXF1ZXN0X2F0ID0gamF2YV9saWtlX3RpbWVzdGFtcChub3cpCiAgICBheF9yZXF1ZXN0X2lkID0gc3RyKHV1aWQudXVpZDQoKSkKCiAgICBoZWFkZXJzID0gewogICAgICAgICJBdXRob3JpemF0aW9uIjogZiJCYXNpYyB7QkFTSUNfQVVUSH0iLAogICAgICAgICJBeC1EZXZpY2UtSWQiOiBBWF9ERVZJQ0VfSUQsCiAgICAgICAgIkF4LUZpbmdlcnByaW50IjogQVhfRlAsCiAgICAgICAgIkF4LVJlcXVlc3QtQXQiOiBheF9yZXF1ZXN0X2F0LAogICAgICAgICJBeC1SZXF1ZXN0LURldmljZSI6ICJzYW1zdW5nIiwKICAgICAgICAiQXgtUmVxdWVzdC1EZXZpY2UtTW9kZWwiOiAiU00tTjkzNUYiLAogICAgICAgICJBeC1SZXF1ZXN0LUlkIjogYXhfcmVxdWVzdF9pZCwKICAgICAgICAiQXgtU3Vic3R5cGUiOiAiUFJFUEFJRCIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiSG9zdCI6IEJBU0VfQ0lBTV9VUkwucmVwbGFjZSgiaHR0cHM6Ly8iLCAiIiksCiAgICAgICAgIlVzZXItQWdlbnQiOiBVQSwKICAgIH0KCiAgICB3aXRoIGxpdmVfbG9hZGluZygi8J+UhCBFeHRlbmQgc2Vzc2lvbi4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBwYXJhbXM9cXVlcnlzdHJpbmcsIHRpbWVvdXQ9MzApCiAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkV4dGVuZCBzZXNzaW9uIGdhZ2FsIPCfmqgiKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICBwcmludF9wYW5lbCgi4pyFIE1hbnRhcCIsICJTZXNzaW9uIGJlcmhhc2lsIGRpLWV4dGVuZCDwn5qAIikKICAgICAgICAgICAgcmV0dXJuIGRhdGEuZ2V0KCJkYXRhIiwge30pLmdldCgiZXhjaGFuZ2VfY29kZSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiRXJyb3IgcGFzIGV4dGVuZCBzZXNzaW9uIPCfpK8iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKCmRlZiBzdWJtaXRfb3RwKGFwaV9rZXk6IHN0ciwgY29udGFjdF90eXBlOiBzdHIsIGNvbnRhY3Q6IHN0ciwgY29kZTogc3RyKSAtPiBkaWN0IHwgTm9uZToKICAgIGlmIGNvbnRhY3RfdHlwZSA9PSAiU01TIjoKICAgICAgICBpZiBub3QgdmFsaWRhdGVfY29udGFjdChjb250YWN0KToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiTm9tb3IgbmdnYWsgdmFsaWQgYnJvIPCfmqgiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGlmIG5vdCBjb2RlIG9yIGxlbihjb2RlKSAhPSA2OgogICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJLb2RlIE9UUCBuZ2dhayB2YWxpZCBicm8g8J+aqCIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZmluYWxfY29udGFjdCA9IGNvbnRhY3QKICAgICAgICBmaW5hbF9jb2RlID0gY29kZQogICAgZWxpZiBjb250YWN0X3R5cGUgPT0gIkRFVklDRUlEIjoKICAgICAgICBmaW5hbF9jb250YWN0ID0gYmFzZTY0LmI2NGVuY29kZShjb250YWN0LmVuY29kZSgpKS5kZWNvZGUoKQogICAgICAgIGZpbmFsX2NvZGUgPSBjb2RlCiAgICBlbHNlOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkNvbnRhY3QgdHlwZSBuZ2dhayB2YWxpZCDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHVybCA9IEJBU0VfQ0lBTV9VUkwgKyAiL3JlYWxtcy94bC1jaWFtL3Byb3RvY29sL29wZW5pZC1jb25uZWN0L3Rva2VuIgogICAgbm93X2dtdDcgPSBkYXRldGltZS5ub3codGltZXpvbmUodGltZWRlbHRhKGhvdXJzPTcpKSkKICAgIHRzX2Zvcl9zaWduID0gdHNfZ210N193aXRob3V0X2NvbG9uKG5vd19nbXQ3KQogICAgdHNfaGVhZGVyID0gdHNfZ210N193aXRob3V0X2NvbG9uKG5vd19nbXQ3IC0gdGltZWRlbHRhKG1pbnV0ZXM9NSkpCiAgICBzaWduYXR1cmUgPSBheF9hcGlfc2lnbmF0dXJlKGFwaV9rZXksIHRzX2Zvcl9zaWduLCBmaW5hbF9jb250YWN0LCBjb2RlLCBjb250YWN0X3R5cGUpCgogICAgcGF5bG9hZCA9IGYiY29udGFjdFR5cGU9e2NvbnRhY3RfdHlwZX0mY29kZT17ZmluYWxfY29kZX0mZ3JhbnRfdHlwZT1wYXNzd29yZCZjb250YWN0PXtmaW5hbF9jb250YWN0fSZzY29wZT1vcGVuaWQiCiAgICBoZWFkZXJzID0gewogICAgICAgICJBdXRob3JpemF0aW9uIjogZiJCYXNpYyB7QkFTSUNfQVVUSH0iLAogICAgICAgICJBeC1BcGktU2lnbmF0dXJlIjogc2lnbmF0dXJlLAogICAgICAgICJBeC1EZXZpY2UtSWQiOiBBWF9ERVZJQ0VfSUQsCiAgICAgICAgIkF4LUZpbmdlcnByaW50IjogQVhfRlAsCiAgICAgICAgIkF4LVJlcXVlc3QtQXQiOiB0c19oZWFkZXIsCiAgICAgICAgIkF4LVJlcXVlc3QtRGV2aWNlIjogInNhbXN1bmciLAogICAgICAgICJBeC1SZXF1ZXN0LURldmljZS1Nb2RlbCI6ICJTTS1OOTM1RiIsCiAgICAgICAgIkF4LVJlcXVlc3QtSWQiOiBzdHIodXVpZC51dWlkNCgpKSwKICAgICAgICAiQXgtU3Vic3R5cGUiOiAiUFJFUEFJRCIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICJVc2VyLUFnZW50IjogVUEsCiAgICB9CgogICAgd2l0aCBsaXZlX2xvYWRpbmcoIvCfk6kgU3VibWl0IE9UUC4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9cGF5bG9hZCwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICAgICAgICBqc29uX2JvZHkgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgaWYgImVycm9yIiBpbiBqc29uX2JvZHk6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJPVFAgZGl0b2xhayDwn5qoIikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIHByaW50X3BhbmVsKCLinIUgTWFudGFwIiwgIk9UUCBiZXJoYXNpbCBkaXZhbGlkYXNpIPCfmoAiKQogICAgICAgICAgICByZXR1cm4ganNvbl9ib2R5CiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkVycm9yIHBhcyBzdWJtaXQgT1RQIPCfpK8iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKCmRlZiBnZXRfbmV3X3Rva2VuKGFwaV9rZXk6IHN0ciwgcmVmcmVzaF90b2tlbjogc3RyLCBzdWJzY3JpYmVyX2lkOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgdXJsID0gQkFTRV9DSUFNX1VSTCArICIvcmVhbG1zL3hsLWNpYW0vcHJvdG9jb2wvb3BlbmlkLWNvbm5lY3QvdG9rZW4iCiAgICBub3cgPSBkYXRldGltZS5ub3codGltZXpvbmUodGltZWRlbHRhKGhvdXJzPTcpKSkKICAgIGF4X3JlcXVlc3RfYXQgPSBub3cuc3RyZnRpbWUoIiVZLSVtLSVkVCVIOiVNOiVTLiVmIilbOi0zXSArICIrMDcwMCIKICAgIGF4X3JlcXVlc3RfaWQgPSBzdHIodXVpZC51dWlkNCgpKQoKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkhvc3QiOiBCQVNFX0NJQU1fVVJMLnJlcGxhY2UoImh0dHBzOi8vIiwgIiIpLAogICAgICAgICJheC1yZXF1ZXN0LWF0IjogYXhfcmVxdWVzdF9hdCwKICAgICAgICAiYXgtZGV2aWNlLWlkIjogQVhfREVWSUNFX0lELAogICAgICAgICJheC1yZXF1ZXN0LWlkIjogYXhfcmVxdWVzdF9pZCwKICAgICAgICAiYXgtcmVxdWVzdC1kZXZpY2UiOiAic2Ftc3VuZyIsCiAgICAgICAgImF4LXJlcXVlc3QtZGV2aWNlLW1vZGVsIjogIlNNLU45MzVGIiwKICAgICAgICAiYXgtZmluZ2VycHJpbnQiOiBBWF9GUCwKICAgICAgICAiYXV0aG9yaXphdGlvbiI6IGYiQmFzaWMge0JBU0lDX0FVVEh9IiwKICAgICAgICAidXNlci1hZ2VudCI6IFVBLAogICAgICAgICJheC1zdWJzdHlwZSI6ICJQUkVQQUlEIiwKICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsCiAgICB9CiAgICBkYXRhID0geyJncmFudF90eXBlIjogInJlZnJlc2hfdG9rZW4iLCAicmVmcmVzaF90b2tlbiI6IHJlZnJlc2hfdG9rZW59CgogICAgd2l0aCBsaXZlX2xvYWRpbmcoIvCflIQgUmVmcmVzaCB0b2tlbi4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3AgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkVycm9yIHBhcyByZWZyZXNoIHRva2VuIPCfpK8iKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIGlmIHJlc3Auc3RhdHVzX2NvZGUgPT0gNDAwOgogICAgICAgIHRyeToKICAgICAgICAgICAgZXJyX2pzb24gPSByZXNwLmpzb24oKQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGlmIGVycl9qc29uLmdldCgiZXJyb3JfZGVzY3JpcHRpb24iKSAhPSAiU2Vzc2lvbiBub3QgYWN0aXZlIjoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBub3Qgc3Vic2NyaWJlcl9pZDoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBleGNoYW5nZV9jb2RlID0gZXh0ZW5kX3Nlc3Npb24oc3Vic2NyaWJlcl9pZCkKICAgICAgICBpZiBub3QgZXhjaGFuZ2VfY29kZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIuKaoO+4jyBVcHMiLCAiRXh0ZW5kIHNlc3Npb24gZ2FnYWwgYnJvIPCfmqgiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHByaW50X3BhbmVsKCLihLnvuI8gU2FudHV5IiwgIlNlc3Npb24gZXhwaXJlZCwgZ2FzIHN1Ym1pdCBPVFAgbGFnaSDinIzvuI8iKQogICAgICAgIHJldHVybiBzdWJtaXRfb3RwKGFwaV9rZXksICJERVZJQ0VJRCIsIHN1YnNjcmliZXJfaWQsIGV4Y2hhbmdlX2NvZGUpCgogICAgdHJ5OgogICAgICAgIHJlc3AucmFpc2VfZm9yX3N0YXR1cygpCiAgICBleGNlcHQgcmVxdWVzdHMuSFRUUEVycm9yOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkhUVFAgZXJyb3IgcGFzIHJlZnJlc2ggdG9rZW4g8J+aqCIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICB0cnk6CiAgICAgICAgYm9keSA9IHJlc3AuanNvbigpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJSZXNwb25zZSB0b2tlbiBuZ2FjbyBicm8g8J+aqCIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBpZiAiaWRfdG9rZW4iIG5vdCBpbiBib2R5IG9yICJlcnJvciIgaW4gYm9keToKICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJUb2tlbiBiYXJ1IGdhZ2FsIGRpYW1iaWwg8J+aqCIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAjcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCAiVG9rZW4gYmFydSBiZXJoYXNpbCBkaWFtYmlsIPCfmoAiKQogICAgcmV0dXJuIGJvZHkKCgpkZWYgZ2V0X2F1dGhfY29kZSh0b2tlbnM6IGRpY3QsIHBpbjogc3RyLCBtc2lzZG46IHN0cikgLT4gc3RyIHwgTm9uZToKICAgIHVybCA9IEJBU0VfQ0lBTV9VUkwgKyAiL2NpYW0vYXV0aC9hdXRob3JpemF0aW9uLXRva2VuL2dlbmVyYXRlIgoKICAgIHBhcnNlZCA9IHVybHBhcnNlKEJBU0VfQ0lBTV9VUkwpCiAgICBob3N0X2hlYWRlciA9IHBhcnNlZC5uZXRsb2Mgb3IgQkFTRV9DSUFNX1VSTC5yZXBsYWNlKCJodHRwczovLyIsICIiKQoKICAgIG5vdyA9IGRhdGV0aW1lLm5vdyh0aW1lem9uZSh0aW1lZGVsdGEoaG91cnM9NykpKQogICAgYXhfcmVxdWVzdF9hdCA9IG5vdy5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVMuJWYiKVs6LTNdICsgIiswNzAwIgogICAgYXhfcmVxdWVzdF9pZCA9IHN0cih1dWlkLnV1aWQ0KCkpCgogICAgaGVhZGVycyA9IHsKICAgICAgICAiSG9zdCI6IGhvc3RfaGVhZGVyLAogICAgICAgICJBeC1SZXF1ZXN0LUF0IjogYXhfcmVxdWVzdF9hdCwKICAgICAgICAiQXgtRGV2aWNlLUlkIjogQVhfREVWSUNFX0lELAogICAgICAgICJBeC1SZXF1ZXN0LUlkIjogYXhfcmVxdWVzdF9pZCwKICAgICAgICAiQXgtUmVxdWVzdC1EZXZpY2UiOiAic2Ftc3VuZyIsCiAgICAgICAgIkF4LVJlcXVlc3QtRGV2aWNlLU1vZGVsIjogIlNNLU45MzVGIiwKICAgICAgICAiQXgtRmluZ2VycHJpbnQiOiBBWF9GUCwKICAgICAgICAiQXV0aG9yaXphdGlvbiI6IGYiQmVhcmVyIHt0b2tlbnNbJ2FjY2Vzc190b2tlbiddfSIsCiAgICAgICAgIlVzZXItQWdlbnQiOiBVQSwKICAgICAgICAiQXgtU3Vic3R5cGUiOiAiUFJFUEFJRCIsCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgIH0KCiAgICBwaW5fYjY0ID0gYmFzZTY0LmI2NGVuY29kZShwaW4uZW5jb2RlKCJ1dGYtOCIpKS5kZWNvZGUoInV0Zi04IikKICAgIGJvZHkgPSB7CiAgICAgICAgInBpbiI6IHBpbl9iNjQsCiAgICAgICAgInRyYW5zYWN0aW9uX3R5cGUiOiAiU0hBUkVfQkFMQU5DRSIsCiAgICAgICAgInJlY2VpdmVyX21zaXNkbiI6IG1zaXNkbiwKICAgIH0KCiAgICB3aXRoIGxpdmVfbG9hZGluZyhmIvCflJAgTGFnaSByZXF1ZXN0IGF1dGggY29kZSBidWF0IHttc2lzZG59IGJyby4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3AgPSByZXF1ZXN0cy5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWJvZHksIHRpbWVvdXQ9MzApCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkVycm9yIHBhcyByZXF1ZXN0IGF1dGggY29kZSDwn6SvIikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBpZiByZXNwLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJBdXRoIGNvZGUgZ2FnYWwgZGlhbWJpbCDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHRyeToKICAgICAgICBkYXRhID0gcmVzcC5qc29uKCkKICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIlJlc3BvbnNlIGF1dGggY29kZSBuZ2dhayB2YWxpZCDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGlmIG5vdCBpc2luc3RhbmNlKGRhdGEsIGRpY3QpOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkZvcm1hdCBkYXRhIGF1dGggY29kZSBuZ2FjbyDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHN0YXR1cyA9IGRhdGEuZ2V0KCJzdGF0dXMiLCAiIikKICAgIG1lc3NhZ2UgPSBkYXRhLmdldCgibWVzc2FnZSIsICIiKQoKICAgIGlmIHN0YXR1cyA9PSAiU3VjY2VzcyI6CiAgICAgICAgY29sb3JlZF9zdGF0dXMgPSBmIuKchSB7c3RhdHVzfSIKICAgICAgICAjcHJpbnRfcGFuZWwoIuKchSBNYW50YXAiLCBmIkF1dGggY29kZSBiZXJoYXNpbCBkaWFtYmlsIPCfmoBcblBlc2FuOiB7bWVzc2FnZX0iKQogICAgZWxzZToKICAgICAgICBjb2xvcmVkX3N0YXR1cyA9IGYi4pqg77iPIHtzdGF0dXN9IgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgZiJBdXRoIGNvZGUgZ2FnYWwgYnJvIPCfmqhcblBlc2FuOiB7bWVzc2FnZX0iKQogICAgICAgIHJldHVybiBOb25lCgogICAgYXV0aG9yaXphdGlvbl9jb2RlID0gZGF0YS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJhdXRob3JpemF0aW9uX2NvZGUiKQogICAgaWYgbm90IGF1dGhvcml6YXRpb25fY29kZToKICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJBdXRoIGNvZGUga29zb25nIGJybyDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHJldHVybiBhdXRob3JpemF0aW9uX2NvZGUK').decode())
