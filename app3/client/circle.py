#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KZnJvbSBhcHAzLmNsaWVudC5lbmdzZWwgaW1wb3J0IHNlbmRfYXBpX3JlcXVlc3QKZnJvbSBhcHAzLmNsaWVudC5lbmNyeXB0IGltcG9ydCBlbmNyeXB0X2NpcmNsZV9tc2lzZG4KZnJvbSBhcHAzLm1lbnVzLnV0aWwgaW1wb3J0IGxpdmVfbG9hZGluZywgcHJpbnRfcGFuZWwKZnJvbSBhcHAzLmNvbmZpZy50aGVtZV9jb25maWcgaW1wb3J0IGdldF90aGVtZQoKCmRlZiBnZXRfZ3JvdXBfZGF0YShhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCkgLT4gZGljdCB8IE5vbmU6CiAgICBwYXRoID0gImZhbWlseS1odWIvYXBpL3Y4L2dyb3Vwcy9zdGF0dXMiCiAgICByYXdfcGF5bG9hZCA9IHsiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLCAibGFuZyI6ICJlbiJ9CiAgICB3aXRoIGxpdmVfbG9hZGluZygi8J+RpSBMYWdpIG5ndW1wdWxpbiBkZXRhaWwgQ2lyY2xlIGJyby4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgIGlmIG5vdCByZXMgb3IgcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIGFtYmlsIGRldGFpbCBDaXJjbGUg8J+aqCIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICNwcmludF9wYW5lbCgi4pyFIE1hbnRhcCIsICJEZXRhaWwgQ2lyY2xlIGJlcmhhc2lsIGRpYW1iaWwg8J+agCIpCiAgICByZXR1cm4gcmVzCgoKZGVmIGdldF9ncm91cF9tZW1iZXJzKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBncm91cF9pZDogc3RyKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiZmFtaWx5LWh1Yi9hcGkvdjgvbWVtYmVycy9pbmZvIgogICAgcmF3X3BheWxvYWQgPSB7Imdyb3VwX2lkIjogZ3JvdXBfaWQsICJpc19lbnRlcnByaXNlIjogRmFsc2UsICJsYW5nIjogImVuIn0KICAgIHdpdGggbGl2ZV9sb2FkaW5nKGYi8J+RpSBMYWdpIG5ndW1wdWxpbiBtZW1iZXIgYnVhdCBncm91cCB7Z3JvdXBfaWR9IGJyby4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgIHJldHVybiByZXMKCgpkZWYgdmFsaWRhdGVfY2lyY2xlX21lbWJlcihhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgbXNpc2RuOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJmYW1pbHktaHViL2FwaS92OC9tZW1iZXJzL3ZhbGlkYXRlIgogICAgZW5jcnlwdGVkX21zaXNkbiA9IGVuY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtc2lzZG4pCiAgICByYXdfcGF5bG9hZCA9IHsibXNpc2RuIjogZW5jcnlwdGVkX21zaXNkbiwgImlzX2VudGVycHJpc2UiOiBGYWxzZSwgImxhbmciOiAiZW4ifQogICAgd2l0aCBsaXZlX2xvYWRpbmcoZiLwn5SNIExhZ2kgbmdlY2VrIG1lbWJlciB7bXNpc2RufSBicm8uLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICByZXR1cm4gcmVzCgoKZGVmIGludml0ZV9jaXJjbGVfbWVtYmVyKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBtc2lzZG46IHN0ciwgbmFtZTogc3RyLAogICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHN0ciwgbWVtYmVyX2lkX3BhcmVudDogc3RyKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiZmFtaWx5LWh1Yi9hcGkvdjgvbWVtYmVycy9pbnZpdGUiCiAgICBlbmNyeXB0ZWRfbXNpc2RuID0gZW5jcnlwdF9jaXJjbGVfbXNpc2RuKGFwaV9rZXksIG1zaXNkbikKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJhY2Nlc3NfdG9rZW4iOiB0b2tlbnNbImFjY2Vzc190b2tlbiJdLAogICAgICAgICJncm91cF9pZCI6IGdyb3VwX2lkLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgIm1lbWJlcnMiOiBbeyJtc2lzZG4iOiBlbmNyeXB0ZWRfbXNpc2RuLCAibmFtZSI6IG5hbWV9XSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgIm1lbWJlcl9pZF9wYXJlbnQiOiBtZW1iZXJfaWRfcGFyZW50LAogICAgfQogICAgd2l0aCBsaXZlX2xvYWRpbmcoZiLwn5OpIExhZ2kgbmd1bmRhbmcge21zaXNkbn0ga2UgQ2lyY2xlIGJyby4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICBpZiBub3QgcmVzOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIG5ndW5kYW5nIG1lbWJlciBrZSBDaXJjbGUg8J+aqCIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBzdGF0dXMgPSByZXMuZ2V0KCJzdGF0dXMiLCAiVU5LTk9XTiIpCiAgICBtZXNzYWdlID0gcmVzLmdldCgibWVzc2FnZSIsICIiKQogICAgY29sb3JlZF9zdGF0dXMgPSBmIuKchSB7c3RhdHVzfSIgaWYgc3RhdHVzID09ICJTVUNDRVNTIiBlbHNlIGYi4pqg77iPIHtzdGF0dXN9IgogICAgcHJpbnRfcGFuZWwoIvCfk6kgSW52aXRlIFN0YXR1cyIsIGYiU3RhdHVzOiB7Y29sb3JlZF9zdGF0dXN9XG5QZXNhbjoge21lc3NhZ2V9IikKCiAgICByZXR1cm4geyJzdGF0dXMiOiBzdGF0dXMsICJtZXNzYWdlIjogbWVzc2FnZSwgImRhdGEiOiByZXN9CgoKZGVmIHJlbW92ZV9jaXJjbGVfbWVtYmVyKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBtZW1iZXJfaWQ6IHN0ciwKICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2lkOiBzdHIsIG1lbWJlcl9pZF9wYXJlbnQ6IHN0ciwKICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2xhc3RfbWVtYmVyOiBib29sID0gRmFsc2UpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJmYW1pbHktaHViL2FwaS92OC9tZW1iZXJzL3JlbW92ZSIKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJtZW1iZXJfaWQiOiBtZW1iZXJfaWQsCiAgICAgICAgImdyb3VwX2lkIjogZ3JvdXBfaWQsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAiaXNfbGFzdF9tZW1iZXIiOiBpc19sYXN0X21lbWJlciwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgIm1lbWJlcl9pZF9wYXJlbnQiOiBtZW1iZXJfaWRfcGFyZW50LAogICAgfQogICAgd2l0aCBsaXZlX2xvYWRpbmcoZiLwn5eR77iPIExhZ2kgbmVuZGFuZyBtZW1iZXIge21lbWJlcl9pZH0ga2VsdWFyIGJyby4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICBpZiBub3QgcmVzOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIGhhcHVzIG1lbWJlciBkYXJpIENpcmNsZSDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHN0YXR1cyA9IHJlcy5nZXQoInN0YXR1cyIsICJVTktOT1dOIikKICAgIG1lc3NhZ2UgPSByZXMuZ2V0KCJtZXNzYWdlIiwgIiIpCiAgICBjb2xvcmVkX3N0YXR1cyA9IGYi4pyFIHtzdGF0dXN9IiBpZiBzdGF0dXMgPT0gIlNVQ0NFU1MiIGVsc2UgZiLimqDvuI8ge3N0YXR1c30iCiAgICBwcmludF9wYW5lbCgi8J+Xke+4jyBSZW1vdmUgU3RhdHVzIiwgZiJTdGF0dXM6IHtjb2xvcmVkX3N0YXR1c31cblBlc2FuOiB7bWVzc2FnZX0iKQoKICAgIHJldHVybiB7InN0YXR1cyI6IHN0YXR1cywgIm1lc3NhZ2UiOiBtZXNzYWdlLCAiZGF0YSI6IHJlc30KCgpkZWYgYWNjZXB0X2NpcmNsZV9pbnZpdGF0aW9uKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBncm91cF9pZDogc3RyLCBtZW1iZXJfaWQ6IHN0cikgLT4gZGljdCB8IE5vbmU6CiAgICBwYXRoID0gImZhbWlseS1odWIvYXBpL3Y4L2dyb3Vwcy9hY2NlcHQtaW52aXRhdGlvbiIKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJhY2Nlc3NfdG9rZW4iOiB0b2tlbnNbImFjY2Vzc190b2tlbiJdLAogICAgICAgICJncm91cF9pZCI6IGdyb3VwX2lkLAogICAgICAgICJtZW1iZXJfaWQiOiBtZW1iZXJfaWQsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICB9CiAgICB3aXRoIGxpdmVfbG9hZGluZyhmIuKchSBMYWdpIG5lcmltYSB1bmRhbmdhbiBDaXJjbGUge2dyb3VwX2lkfSBicm8uLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgaWYgbm90IHJlczoKICAgICAgICBwcmludF9wYW5lbCgi4pqg77iPIFVwcyIsICJHYWdhbCBuZXJpbWEgdW5kYW5nYW4gQ2lyY2xlIPCfmqgiKQogICAgICAgIHJldHVybiBOb25lCgogICAgc3RhdHVzID0gcmVzLmdldCgic3RhdHVzIiwgIlVOS05PV04iKQogICAgbWVzc2FnZSA9IHJlcy5nZXQoIm1lc3NhZ2UiLCAiIikKICAgIGNvbG9yZWRfc3RhdHVzID0gZiLinIUge3N0YXR1c30iIGlmIHN0YXR1cyA9PSAiU1VDQ0VTUyIgZWxzZSBmIuKaoO+4jyB7c3RhdHVzfSIKICAgIHByaW50X3BhbmVsKCLinIUgQWNjZXB0IEludml0YXRpb24gU3RhdHVzIiwgZiJTdGF0dXM6IHtjb2xvcmVkX3N0YXR1c31cblBlc2FuOiB7bWVzc2FnZX0iKQoKICAgIHJldHVybiB7InN0YXR1cyI6IHN0YXR1cywgIm1lc3NhZ2UiOiBtZXNzYWdlLCAiZGF0YSI6IHJlc30KCgpkZWYgY3JlYXRlX2NpcmNsZShhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgcGFyZW50X25hbWU6IHN0ciwKICAgICAgICAgICAgICAgICAgZ3JvdXBfbmFtZTogc3RyLCBtZW1iZXJfbXNpc2RuOiBzdHIsIG1lbWJlcl9uYW1lOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJmYW1pbHktaHViL2FwaS92OC9ncm91cHMvY3JlYXRlIgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgImFjY2Vzc190b2tlbiI6IHRva2Vuc1siYWNjZXNzX3Rva2VuIl0sCiAgICAgICAgInBhcmVudF9uYW1lIjogcGFyZW50X25hbWUsCiAgICAgICAgImdyb3VwX25hbWUiOiBncm91cF9uYW1lLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgIm1lbWJlcnMiOiBbeyJtc2lzZG4iOiBlbmNyeXB0X2NpcmNsZV9tc2lzZG4oYXBpX2tleSwgbWVtYmVyX21zaXNkbiksICJuYW1lIjogbWVtYmVyX25hbWV9XSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICB9CiAgICB3aXRoIGxpdmVfbG9hZGluZyhmIuKelSBMYWdpIGJpa2luIENpcmNsZSBiYXJ1IGRlbmdhbiBtZW1iZXIge21lbWJlcl9tc2lzZG59IGJyby4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICBpZiBub3QgcmVzOgogICAgICAgIHByaW50X3BhbmVsKCLimqDvuI8gVXBzIiwgIkdhZ2FsIGJpa2luIENpcmNsZSDwn5qoIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHN0YXR1cyA9IHJlcy5nZXQoInN0YXR1cyIsICJVTktOT1dOIikKICAgIG1lc3NhZ2UgPSByZXMuZ2V0KCJtZXNzYWdlIiwgIiIpCiAgICBjb2xvcmVkX3N0YXR1cyA9IGYi4pyFIHtzdGF0dXN9IiBpZiBzdGF0dXMgPT0gIlNVQ0NFU1MiIGVsc2UgZiLimqDvuI8ge3N0YXR1c30iCiAgICBwcmludF9wYW5lbCgi4p6VIENyZWF0ZSBDaXJjbGUgU3RhdHVzIiwgZiJTdGF0dXM6IHtjb2xvcmVkX3N0YXR1c31cblBlc2FuOiB7bWVzc2FnZX0iKQoKICAgIHJldHVybiB7InN0YXR1cyI6IHN0YXR1cywgIm1lc3NhZ2UiOiBtZXNzYWdlLCAiZGF0YSI6IHJlc30KCgpkZWYgc3BlbmRpbmdfdHJhY2tlcihhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgcGFyZW50X3N1YnNfaWQ6IHN0ciwgZmFtaWx5X2lkOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJnYW1pZmljYXRpb24vYXBpL3Y4L2ZhbWlseS1odWIvc3BlbmRpbmctdHJhY2tlciIKICAgIHJhd19wYXlsb2FkID0geyJpc19lbnRlcnByaXNlIjogRmFsc2UsICJwYXJlbnRfc3Vic19pZCI6IHBhcmVudF9zdWJzX2lkLCAiZmFtaWx5X2lkIjogZmFtaWx5X2lkLCAibGFuZyI6ICJlbiJ9CiAgICB3aXRoIGxpdmVfbG9hZGluZygi8J+SuCBMYWdpIG5ndW1wdWxpbiBkYXRhIHNwZW5kaW5nIHRyYWNrZXIgYnJvLi4uIiwgZ2V0X3RoZW1lKCkpOgogICAgICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcwoKCmRlZiBnZXRfYm9udXNfZGF0YShhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgcGFyZW50X3N1YnNfaWQ6IHN0ciwgZmFtaWx5X2lkOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJnYW1pZmljYXRpb24vYXBpL3Y4L2ZhbWlseS1odWIvYm9udXMvbGlzdCIKICAgIHJhd19wYXlsb2FkID0geyJpc19lbnRlcnByaXNlIjogRmFsc2UsICJwYXJlbnRfc3Vic19pZCI6IHBhcmVudF9zdWJzX2lkLCAiZmFtaWx5X2lkIjogZmFtaWx5X2lkLCAibGFuZyI6ICJlbiJ9CiAgICB3aXRoIGxpdmVfbG9hZGluZygi8J+OgSBMYWdpIG5ndW1wdWxpbiBkYXRhIGJvbnVzIGJyby4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgIHJldHVybiByZXMK').decode())
