#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBhcHAyLmNvbmZpZy5pbXBvcnRzIGltcG9ydCAqCmZyb20gYXBwMi5tZW51cy51dGlsIGltcG9ydCBjbGVhcl9zY3JlZW4sIHNpbXBsZV9udW1iZXIsIHBhdXNlLCBwcmludF9wYW5lbApmcm9tIGFwcDIubWVudXMucGFja2FnZSBpbXBvcnQgc2hvd19wYWNrYWdlX2RldGFpbHMsIGdldF9wYWNrYWdlX2RldGFpbHMKCmNvbnNvbGUgPSBDb25zb2xlKCkKCgpkZWYgc2hvd19ib29rbWFya19tZW51KHJldHVybl9wYWNrYWdlX2RldGFpbDogYm9vbCA9IEZhbHNlKToKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZW5zdXJlX2dpdCgpCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKCJCb29rbWFyayBQYWtldCIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQogICAgICAgIHNpbXBsZV9udW1iZXIoKQoKICAgICAgICBib29rbWFya3MgPSBCb29rbWFya0luc3RhbmNlLmdldF9ib29rbWFya3MoKQogICAgICAgIGlmIG5vdCBib29rbWFya3M6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiQmVsdW0gYWRhIGJvb2ttYXJrIHRlcnNpbXBhbi4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAoTm9uZSwgTm9uZSkgaWYgcmV0dXJuX3BhY2thZ2VfZGV0YWlsIGVsc2UgTm9uZQoKICAgICAgICB0YWJsZSA9IFRhYmxlKGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJObyIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCBqdXN0aWZ5PSJyaWdodCIsIHdpZHRoPTQpCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTmFtYSBQYWtldCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKCiAgICAgICAgZm9yIGlkeCwgYm0gaW4gZW51bWVyYXRlKGJvb2ttYXJrcyk6CiAgICAgICAgICAgIGxhYmVsID0gZiJ7Ym1bJ2ZhbWlseV9uYW1lJ119IC0ge2JtWyd2YXJpYW50X25hbWUnXX0gLSB7Ym1bJ29wdGlvbl9uYW1lJ119IgogICAgICAgICAgICB0YWJsZS5hZGRfcm93KHN0cihpZHggKyAxKSwgbGFiZWwpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwodGFibGUsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgcGFkZGluZz0oMCwgMCksIGV4cGFuZD1UcnVlKSkKCiAgICAgICAgbmF2ID0gVGFibGUoc2hvd19oZWFkZXI9RmFsc2UsIGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBuYXYuYWRkX2NvbHVtbihqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD02KQogICAgICAgIG5hdi5hZGRfY29sdW1uKGp1c3RpZnk9ImxlZnQiLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2LmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1LZW1iYWxpIGtlIG1lbnUgdXRhbWFbL10iKQogICAgICAgIG5hdi5hZGRfcm93KCIwMDAiLCBmIlt7dGhlbWVbJ3RleHRfZXJyJ119XUhhcHVzIEJvb2ttYXJrWy9dIikKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbChuYXYsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF90aXRsZSddfV1QaWxpaCBib29rbWFyayAobm9tb3IpOiBbL3t0aGVtZVsndGV4dF90aXRsZSddfV0gIikuc3RyaXAoKQoKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgcmV0dXJuIChOb25lLCBOb25lKSBpZiByZXR1cm5fcGFja2FnZV9kZXRhaWwgZWxzZSBOb25lCgogICAgICAgIGVsaWYgY2hvaWNlID09ICIwMDAiOgogICAgICAgICAgICBkZWxfY2hvaWNlID0gY29uc29sZS5pbnB1dCgiTWFzdWtrYW4gbm9tb3IgYm9va21hcmsgeWFuZyBpbmdpbiBkaWhhcHVzOiAiKS5zdHJpcCgpCiAgICAgICAgICAgIGlmIGRlbF9jaG9pY2UuaXNkaWdpdCgpIGFuZCAxIDw9IGludChkZWxfY2hvaWNlKSA8PSBsZW4oYm9va21hcmtzKToKICAgICAgICAgICAgICAgIGRlbF9ibSA9IGJvb2ttYXJrc1tpbnQoZGVsX2Nob2ljZSkgLSAxXQogICAgICAgICAgICAgICAgQm9va21hcmtJbnN0YW5jZS5yZW1vdmVfYm9va21hcmsoCiAgICAgICAgICAgICAgICAgICAgZGVsX2JtWyJmYW1pbHlfY29kZSJdLAogICAgICAgICAgICAgICAgICAgIGRlbF9ibVsiaXNfZW50ZXJwcmlzZSJdLAogICAgICAgICAgICAgICAgICAgIGRlbF9ibVsidmFyaWFudF9uYW1lIl0sCiAgICAgICAgICAgICAgICAgICAgZGVsX2JtWyJvcmRlciJdLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkJlcmhhc2lsIiwgIkJvb2ttYXJrIHRlbGFoIGRpaGFwdXMuIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiSW5wdXQgdGlkYWsgdmFsaWQsIHNpbGFrYW4gY29iYSBsYWdpLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgZWxpZiBjaG9pY2UuaXNkaWdpdCgpIGFuZCAxIDw9IGludChjaG9pY2UpIDw9IGxlbihib29rbWFya3MpOgogICAgICAgICAgICBzZWxlY3RlZF9ibSA9IGJvb2ttYXJrc1tpbnQoY2hvaWNlKSAtIDFdCiAgICAgICAgICAgIGZhbWlseV9jb2RlID0gc2VsZWN0ZWRfYm1bImZhbWlseV9jb2RlIl0KICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSA9IHNlbGVjdGVkX2JtWyJpc19lbnRlcnByaXNlIl0KCiAgICAgICAgICAgIGZhbWlseV9kYXRhID0gZ2V0X2ZhbWlseShhcGlfa2V5LCB0b2tlbnMsIGZhbWlseV9jb2RlLCBpc19lbnRlcnByaXNlKQogICAgICAgICAgICBpZiBub3QgZmFtaWx5X2RhdGE6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIkdhZ2FsIG1lbmdhbWJpbCBkYXRhIGZhbWlseS4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIHZhcmlhbnRfY29kZSA9IE5vbmUKICAgICAgICAgICAgb3B0aW9uX2NvZGUgPSBOb25lCiAgICAgICAgICAgIGZvciB2YXJpYW50IGluIGZhbWlseV9kYXRhWyJwYWNrYWdlX3ZhcmlhbnRzIl06CiAgICAgICAgICAgICAgICBpZiB2YXJpYW50WyJuYW1lIl0gPT0gc2VsZWN0ZWRfYm1bInZhcmlhbnRfbmFtZSJdOgogICAgICAgICAgICAgICAgICAgIHZhcmlhbnRfY29kZSA9IHZhcmlhbnRbInBhY2thZ2VfdmFyaWFudF9jb2RlIl0KICAgICAgICAgICAgICAgICAgICBmb3Igb3B0aW9uIGluIHZhcmlhbnRbInBhY2thZ2Vfb3B0aW9ucyJdOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcHRpb25bIm9yZGVyIl0gPT0gc2VsZWN0ZWRfYm1bIm9yZGVyIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25fY29kZSA9IG9wdGlvblsicGFja2FnZV9vcHRpb25fY29kZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgaWYgbm90IG9wdGlvbl9jb2RlIG9yIG5vdCB2YXJpYW50X2NvZGU6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIlBha2V0IHRpZGFrIGRpdGVtdWthbi4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGlmIHJldHVybl9wYWNrYWdlX2RldGFpbDoKICAgICAgICAgICAgICAgIGRldGFpbCA9IGdldF9wYWNrYWdlX2RldGFpbHMoCiAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwgdG9rZW5zLAogICAgICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlLAogICAgICAgICAgICAgICAgICAgIHZhcmlhbnRfY29kZSwKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9ibVsib3JkZXIiXSwKICAgICAgICAgICAgICAgICAgICBpc19lbnRlcnByaXNlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBkZXRhaWw6CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGYie3NlbGVjdGVkX2JtWydmYW1pbHlfbmFtZSddfSAtIHtzZWxlY3RlZF9ibVsndmFyaWFudF9uYW1lJ119IC0ge3NlbGVjdGVkX2JtWydvcHRpb25fbmFtZSddfSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGV0YWlsLCBuYW1lCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiR2FnYWwgbWVuZ2FtYmlsIGRldGFpbCBwYWtldC4iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKE5vbmUsIE5vbmUpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzaG93X3BhY2thZ2VfZGV0YWlscyhhcGlfa2V5LCB0b2tlbnMsIG9wdGlvbl9jb2RlLCBpc19lbnRlcnByaXNlKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIklucHV0IHRpZGFrIHZhbGlkLCBzaWxha2FuIGNvYmEgbGFnaS4iKQogICAgICAgICAgICBwYXVzZSgpCg==').decode())
