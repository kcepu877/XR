#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBhcHAyLmNvbmZpZy5pbXBvcnRzIGltcG9ydCAqCmZyb20gYXBwMi5tZW51cy51dGlsIGltcG9ydCBjbGVhcl9zY3JlZW4sIHBhdXNlLCBwcmludF9wYW5lbCwgc2ltcGxlX251bWJlciwgbGl2ZV9sb2FkaW5nCmZyb20gYXBwMi5jbGllbnQuZW5nc2VsIGltcG9ydCBnZXRfbm90aWZpY2F0aW9uX2RldGFpbCwgZGFzaGJvYXJkX3NlZ21lbnRzCgpjb25zb2xlID0gQ29uc29sZSgpCgoKZGVmIHNob3dfbm90aWZpY2F0aW9uX21lbnUoKToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGluX25vdGlmaWNhdGlvbl9tZW51ID0gVHJ1ZQogICAgd2hpbGUgaW5fbm90aWZpY2F0aW9uX21lbnU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBBbGlnbi5jZW50ZXIoIk5vdGlmaWthc2kiLCB2ZXJ0aWNhbD0ibWlkZGxlIiksCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKICAgICAgICBzaW1wbGVfbnVtYmVyKCkKCiAgICAgICAgYXBpX2tleSA9IEF1dGhJbnN0YW5jZS5hcGlfa2V5CiAgICAgICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKCiAgICAgICAgbm90aWZpY2F0aW9uc19yZXMgPSBkYXNoYm9hcmRfc2VnbWVudHMoYXBpX2tleSwgdG9rZW5zKQoKICAgICAgICBpZiBub3Qgbm90aWZpY2F0aW9uc19yZXM6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiVGlkYWsgYWRhIG5vdGlmaWthc2kgbWFzdWsuIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgbm90aWZpY2F0aW9ucyA9IG5vdGlmaWNhdGlvbnNfcmVzLmdldCgiZGF0YSIsIHt9KS5nZXQoIm5vdGlmaWNhdGlvbiIsIHt9KS5nZXQoImRhdGEiLCBbXSkKICAgICAgICBpZiBub3Qgbm90aWZpY2F0aW9uczoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsICJUaWRhayBhZGEgbm90aWZpa2FzaSB0ZXJzZWRpYS4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBqdW1sYWhfYmVsdW1fZGliYWNhID0gMAogICAgICAgIGZvciBpZHgsIG5vdGlmaWNhdGlvbiBpbiBlbnVtZXJhdGUobm90aWZpY2F0aW9ucywgc3RhcnQ9MSk6CiAgICAgICAgICAgIHN1ZGFoX2RpYmFjYSA9IG5vdGlmaWNhdGlvbi5nZXQoImlzX3JlYWQiLCBGYWxzZSkKICAgICAgICAgICAgcGVzYW5fbGVuZ2thcCA9IG5vdGlmaWNhdGlvbi5nZXQoImZ1bGxfbWVzc2FnZSIsICIiKQogICAgICAgICAgICBwZXNhbl9zaW5na2F0ID0gbm90aWZpY2F0aW9uLmdldCgiYnJpZWZfbWVzc2FnZSIsICIiKQogICAgICAgICAgICB3YWt0dSA9IG5vdGlmaWNhdGlvbi5nZXQoInRpbWVzdGFtcCIsICIiKQoKICAgICAgICAgICAgc3RhdHVzID0gIlN1ZGFoIERpYmFjYSIgaWYgc3VkYWhfZGliYWNhIGVsc2UgIkJlbHVtIERpYmFjYSIKICAgICAgICAgICAgaWYgbm90IHN1ZGFoX2RpYmFjYToKICAgICAgICAgICAgICAgIGp1bWxhaF9iZWx1bV9kaWJhY2EgKz0gMQoKICAgICAgICAgICAgbm90aWZfdGV4dCA9IFRleHQoKQogICAgICAgICAgICBub3RpZl90ZXh0LmFwcGVuZChmIk5vdGlmaWthc2kge2lkeH1cbiIsIHN0eWxlPSJib2xkIikKICAgICAgICAgICAgbm90aWZfdGV4dC5hcHBlbmQoIlN0YXR1czogIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgICAgIG5vdGlmX3RleHQuYXBwZW5kKGYie3N0YXR1c31cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2VyciJdIGlmIHN0YXR1cy5zdGFydHN3aXRoKCJCZWx1bSIpIGVsc2UgdGhlbWVbInRleHRfb2siXSkKICAgICAgICAgICAgbm90aWZfdGV4dC5hcHBlbmQoIlBlc2FuIFNpbmdrYXQ6ICIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgICAgICBub3RpZl90ZXh0LmFwcGVuZChmIntwZXNhbl9zaW5na2F0fVxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICBub3RpZl90ZXh0LmFwcGVuZCgiV2FrdHU6ICIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgICAgICBub3RpZl90ZXh0LmFwcGVuZChmInt3YWt0dX1cbiIsIHN0eWxlPXRoZW1lWyJib3JkZXJfd2FybmluZyJdKQogICAgICAgICAgICBub3RpZl90ZXh0LmFwcGVuZCgiUGVzYW4gTGVuZ2thcDpcbiIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgICAgICBub3RpZl90ZXh0LmFwcGVuZChmIntwZXNhbl9sZW5na2FwfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQoKICAgICAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgICAgIG5vdGlmX3RleHQsCiAgICAgICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgICAgICkpCgogICAgICAgIGNvbnNvbGUucHJpbnQoCiAgICAgICAgICAgIGYiW3t0aGVtZVsndGV4dF90aXRsZSddfV1Ub3RhbDoge2xlbihub3RpZmljYXRpb25zKX1bL10gfCAiCiAgICAgICAgICAgIGYiW3t0aGVtZVsndGV4dF9lcnInXX1dQmVsdW0gRGliYWNhOiB7anVtbGFoX2JlbHVtX2RpYmFjYX1bL10iCiAgICAgICAgKQoKICAgICAgICBuYXZfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIG5hdl90YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCIxIiwgIlRhbmRhaSBTZW11YSBOb3RpZmlrYXNpIikKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiMiIsICJUYW5kYWkgU2F0dSBOb3RpZmlrYXNpIikKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUtlbWJhbGkga2UgTWVudSBVdGFtYVsvXSIpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIG5hdl90YWJsZSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAxKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgICAgICBwaWxpaGFuID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XVBpbGloYW46Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCiAgICAgICAgaWYgcGlsaWhhbiA9PSAiMSI6CiAgICAgICAgICAgIGZvciBub3RpZmljYXRpb24gaW4gbm90aWZpY2F0aW9uczoKICAgICAgICAgICAgICAgIGlmIG5vdGlmaWNhdGlvbi5nZXQoImlzX3JlYWQiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbl9pZCA9IG5vdGlmaWNhdGlvbi5nZXQoIm5vdGlmaWNhdGlvbl9pZCIpCiAgICAgICAgICAgICAgICBkZXRhaWwgPSBnZXRfbm90aWZpY2F0aW9uX2RldGFpbChhcGlfa2V5LCB0b2tlbnMsIG5vdGlmaWNhdGlvbl9pZCkKICAgICAgICAgICAgICAgIGlmIGRldGFpbDoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiQmVyaGFzaWwiLCBmIk5vdGlmaWthc2kgSUQge25vdGlmaWNhdGlvbl9pZH0gdGVsYWggZGl0YW5kYWkgc2ViYWdhaSBkaWJhY2EuIikKICAgICAgICAgICAgcGF1c2UoKQoKICAgICAgICBlbGlmIHBpbGloYW4gPT0gIjIiOgogICAgICAgICAgICBub21vciA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2thbiBub21vciBub3RpZmlrYXNpOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgICAgICAgICBpZiBub3Qgbm9tb3IuaXNkaWdpdCgpOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJOb21vciB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgbm9tb3IgPSBpbnQobm9tb3IpCiAgICAgICAgICAgIHNlbGVjdGVkID0gbmV4dCgobiBmb3IgaSwgbiBpbiBlbnVtZXJhdGUobm90aWZpY2F0aW9ucywgc3RhcnQ9MSkgaWYgaSA9PSBub21vciksIE5vbmUpCiAgICAgICAgICAgIGlmIG5vdCBzZWxlY3RlZDoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiTm9tb3Igbm90aWZpa2FzaSB0aWRhayBkaXRlbXVrYW4uIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIHNlbGVjdGVkLmdldCgiaXNfcmVhZCIsIEZhbHNlKToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiTm90aWZpa2FzaSBpbmkgc3VkYWggZGliYWNhIHNlYmVsdW1ueWEuIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIG5vdGlmaWNhdGlvbl9pZCA9IHNlbGVjdGVkLmdldCgibm90aWZpY2F0aW9uX2lkIikKICAgICAgICAgICAgZGV0YWlsID0gZ2V0X25vdGlmaWNhdGlvbl9kZXRhaWwoYXBpX2tleSwgdG9rZW5zLCBub3RpZmljYXRpb25faWQpCiAgICAgICAgICAgIGlmIGRldGFpbDoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJCZXJoYXNpbCIsIGYiTm90aWZpa2FzaSBJRCB7bm90aWZpY2F0aW9uX2lkfSB0ZWxhaCBkaXRhbmRhaSBzZWJhZ2FpIGRpYmFjYS4iKQogICAgICAgICAgICBwYXVzZSgpCgogICAgICAgIGVsaWYgcGlsaWhhbiA9PSAiMDAiOgogICAgICAgICAgICBpbl9ub3RpZmljYXRpb25fbWVudSA9IEZhbHNlCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiUGlsaWhhbiB0aWRhayB2YWxpZCwgc2lsYWthbiBjb2JhIGxhZ2kuIikKICAgICAgICAgICAgcGF1c2UoKQo=').decode())
