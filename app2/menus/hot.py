#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSBhcHAyLmNvbmZpZy5pbXBvcnRzIGltcG9ydCAqCmZyb20gYXBwLnR5cGVfZGljdCBpbXBvcnQgUGF5bWVudEl0ZW0KZnJvbSBhcHAyLmNsaWVudC5lbmdzZWwgaW1wb3J0IGdldF9wYWNrYWdlX2RldGFpbHMsIGdldF9mYW1pbHkKZnJvbSBhcHAyLm1lbnVzLnBhY2thZ2UgaW1wb3J0IHNob3dfcGFja2FnZV9kZXRhaWxzCmZyb20gYXBwMi5tZW51cy51dGlsIGltcG9ydCAoCiAgICBjbGVhcl9zY3JlZW4sIHBhdXNlLCBwcmludF9wYW5lbCwgZm9ybWF0X3F1b3RhX2J5dGUsCiAgICBkaXNwbGF5X2h0bWwsIHNpbXBsZV9udW1iZXIsIGdldF9ydXBpYWgsIGxpdmVfbG9hZGluZwopCmZyb20gYXBwMi5jbGllbnQucHVyY2hhc2UuZXdhbGxldCBpbXBvcnQgc2hvd19tdWx0aXBheW1lbnQKZnJvbSBhcHAyLmNsaWVudC5wdXJjaGFzZS5xcmlzIGltcG9ydCBzaG93X3FyaXNfcGF5bWVudApmcm9tIGFwcDIuY2xpZW50LnB1cmNoYXNlLmJhbGFuY2UgaW1wb3J0IHNldHRsZW1lbnRfYmFsYW5jZQpmcm9tIGFwcC51dGlsIGltcG9ydCBtZXJnZV9ob3QxLCBtZXJnZV9ob3QyCgpjb25zb2xlID0gQ29uc29sZSgpCgoKZGVmIHNob3dfaG90X21lbnUoKToKICAgICIiIk1lbmFtcGlsa2FuIG1lbnUgSG90IFByb21vICh2ZXJzaSAxKS4iIiIKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKICAgIAogICAgaW5faG90X21lbnUgPSBUcnVlCiAgICB3aGlsZSBpbl9ob3RfbWVudToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGVuc3VyZV9naXQoKQogICAgICAgIAogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIEFsaWduLmNlbnRlcigiUGFrZXQgSG90IFByb21vIiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDEsIDIpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCiAgICAgICAgc2ltcGxlX251bWJlcigpCgogICAgICAgIHdpdGggbGl2ZV9sb2FkaW5nKCJNZW11YXQgZGF0YS4uLiIsIHRoZW1lKToKICAgICAgICAgICAgaG90X3BhY2thZ2VzID0gbWVyZ2VfaG90MSgiaHR0cHM6Ly9tZS5tYXNodS5sb2wvcGctaG90Lmpzb24iKQoKICAgICAgICBpZiBub3QgaG90X3BhY2thZ2VzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oImhvdF9kYXRhL2hvdC5qc29uIiwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGhvdF9wYWNrYWdlcyA9IGpzb24ubG9hZChmKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgZiJHYWdhbCBtZW11YXQgaG90Lmpzb246IHtlfSIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYgbm90IGhvdF9wYWNrYWdlczoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsICJUaWRhayBhZGEgZGF0YSBIT1QgdGVyc2VkaWEuIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgdGFibGUgPSBUYWJsZShib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTm8iLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCwganVzdGlmeT0icmlnaHQiKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIkZhbWlseSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJWYXJpYW50Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIk9wdGlvbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJTb3VyY2UiLCBzdHlsZT10aGVtZVsidGV4dF9zdWIiXSwganVzdGlmeT0icmlnaHQiKQoKICAgICAgICBmb3IgaWR4LCBwIGluIGVudW1lcmF0ZShob3RfcGFja2FnZXMsIHN0YXJ0PTEpOgogICAgICAgICAgICB0YWJsZS5hZGRfcm93KAogICAgICAgICAgICAgICAgc3RyKGlkeCksCiAgICAgICAgICAgICAgICBwWyJmYW1pbHlfbmFtZSJdLAogICAgICAgICAgICAgICAgcFsidmFyaWFudF9uYW1lIl0sCiAgICAgICAgICAgICAgICBwWyJvcHRpb25fbmFtZSJdLAogICAgICAgICAgICAgICAgcC5nZXQoInNvdXJjZSIsICJsb2NhbCIpCiAgICAgICAgICAgICkKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCh0YWJsZSwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLCBwYWRkaW5nPSgwLCAwKSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBuYXZfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIG5hdl90YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCIwMCIsIGYiW3t0aGVtZVsndGV4dF9zdWInXX1dS2VtYmFsaSBrZSBtZW51IHV0YW1hWy9dIikKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKG5hdl90YWJsZSwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIGNob2ljZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1QaWxpaCBwYWtldDpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgaW5faG90X21lbnUgPSBGYWxzZQogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICBpZiBjaG9pY2UuaXNkaWdpdCgpIGFuZCAxIDw9IGludChjaG9pY2UpIDw9IGxlbihob3RfcGFja2FnZXMpOgogICAgICAgICAgICBzZWxlY3RlZF9ibSA9IGhvdF9wYWNrYWdlc1tpbnQoY2hvaWNlKSAtIDFdCiAgICAgICAgICAgIGZhbWlseV9jb2RlID0gc2VsZWN0ZWRfYm1bImZhbWlseV9jb2RlIl0KICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSA9IHNlbGVjdGVkX2JtLmdldCgiaXNfZW50ZXJwcmlzZSIsIEZhbHNlKQogICAgICAgICAgICAKICAgICAgICAgICAgZmFtaWx5X2RhdGEgPSBnZXRfZmFtaWx5KGFwaV9rZXksIHRva2VucywgZmFtaWx5X2NvZGUsIGlzX2VudGVycHJpc2UpCiAgICAgICAgICAgIGlmIG5vdCBmYW1pbHlfZGF0YToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCBmIkdhZ2FsIG1lbmdhbWJpbCBkYXRhIGZhbWlseSB7ZmFtaWx5X2NvZGV9LiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgb3B0aW9uX2NvZGUgPSBuZXh0KAogICAgICAgICAgICAgICAgKG9wdFsicGFja2FnZV9vcHRpb25fY29kZSJdIGZvciB2IGluIGZhbWlseV9kYXRhWyJwYWNrYWdlX3ZhcmlhbnRzIl0KICAgICAgICAgICAgICAgICBpZiB2WyJuYW1lIl0gPT0gc2VsZWN0ZWRfYm1bInZhcmlhbnRfbmFtZSJdCiAgICAgICAgICAgICAgICAgZm9yIG9wdCBpbiB2WyJwYWNrYWdlX29wdGlvbnMiXQogICAgICAgICAgICAgICAgIGlmIG9wdFsib3JkZXIiXSA9PSBzZWxlY3RlZF9ibVsib3JkZXIiXSksCiAgICAgICAgICAgICAgICBOb25lCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG9wdGlvbl9jb2RlOgogICAgICAgICAgICAgICAgc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBvcHRpb25fY29kZSwgaXNfZW50ZXJwcmlzZSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiT3B0aW9uIGNvZGUgdGlkYWsgZGl0ZW11a2FuLiIpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJJbnB1dCB0aWRhayB2YWxpZCwgc2lsYWthbiBjb2JhIGxhZ2kuIikKICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICBjb250aW51ZQoKCmRlZiBzaG93X2hvdF9tZW51MigpOgogICAgIiIiTWVuYW1waWxrYW4gbWVudSBIb3QgUHJvbW8gKHZlcnNpIDIpIGRlbmdhbiBkZXRhaWwgZGFuIG9wc2kgcGVtYmF5YXJhbi4iIiIKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKCiAgICBpbl9ob3RfbWVudTIgPSBUcnVlCiAgICB3aGlsZSBpbl9ob3RfbWVudTI6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKICAgICAgICBtYWluX3BhY2thZ2VfZGV0YWlsID0ge30KCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKCJQYWtldCBIb3QgUHJvbW8gMiIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQogICAgICAgIHNpbXBsZV9udW1iZXIoKQoKICAgICAgICB3aXRoIGxpdmVfbG9hZGluZygiTWVtdWF0IGRhdGEuLi4iLCB0aGVtZSk6CiAgICAgICAgICAgIGhvdF9wYWNrYWdlcyA9IG1lcmdlX2hvdDIoImh0dHBzOi8vbWUubWFzaHUubG9sL3BnLWhvdDIuanNvbiIpCgogICAgICAgIGlmIG5vdCBob3RfcGFja2FnZXM6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiVGlkYWsgYWRhIGRhdGEgSE9UMiB0ZXJzZWRpYS4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIHBrZ190YWJsZSA9IFRhYmxlKGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBwa2dfdGFibGUuYWRkX2NvbHVtbigiTm8iLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD00KQogICAgICAgIHBrZ190YWJsZS5hZGRfY29sdW1uKCJOYW1hIFBha2V0Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIHBrZ190YWJsZS5hZGRfY29sdW1uKCJIYXJnYSIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfbW9uZXkiXSwgd2lkdGg9MTYpCiAgICAgICAgcGtnX3RhYmxlLmFkZF9jb2x1bW4oIlNvdXJjZSIsIHN0eWxlPXRoZW1lWyJ0ZXh0X3N1YiJdLCBqdXN0aWZ5PSJyaWdodCIpCgogICAgICAgIGZvciBpZHgsIHAgaW4gZW51bWVyYXRlKGhvdF9wYWNrYWdlcywgc3RhcnQ9MSk6CiAgICAgICAgICAgIGZvcm1hdHRlZF9wcmljZSA9IGdldF9ydXBpYWgocFsicHJpY2UiXSkKICAgICAgICAgICAgcGtnX3RhYmxlLmFkZF9yb3coc3RyKGlkeCksIHBbIm5hbWUiXSwgZm9ybWF0dGVkX3ByaWNlLCBwLmdldCgic291cmNlIiwgImxvY2FsIikpCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwocGtnX3RhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sIHBhZGRpbmc9KDAsIDApLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCkKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1LZW1iYWxpIGtlIG1lbnUgdXRhbWFbL10iKQogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwobmF2X3RhYmxlLCBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sIHBhZGRpbmc9KDAsIDEpLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIGNob2ljZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1QaWxpaCBwYWtldDpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgaW5faG90X21lbnUyID0gRmFsc2UKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgaWYgY2hvaWNlLmlzZGlnaXQoKSBhbmQgMSA8PSBpbnQoY2hvaWNlKSA8PSBsZW4oaG90X3BhY2thZ2VzKToKICAgICAgICAgICAgc2VsZWN0ZWRfcGFja2FnZSA9IGhvdF9wYWNrYWdlc1tpbnQoY2hvaWNlKSAtIDFdCiAgICAgICAgICAgIHBhY2thZ2VzID0gc2VsZWN0ZWRfcGFja2FnZS5nZXQoInBhY2thZ2VzIiwgW10pCiAgICAgICAgICAgIGlmIGxlbihwYWNrYWdlcykgPT0gMDoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiUGFrZXQgdGlkYWsgdGVyc2VkaWEuIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBwYXltZW50X2l0ZW1zID0gW10KICAgICAgICAgICAgZm9yIHBrZ19pZHgsIHBhY2thZ2UgaW4gZW51bWVyYXRlKHBhY2thZ2VzKToKICAgICAgICAgICAgICAgIGRldGFpbCA9IGdldF9wYWNrYWdlX2RldGFpbHMoCiAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwKICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgcGFja2FnZVsiZmFtaWx5X2NvZGUiXSwKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlWyJ2YXJpYW50X2NvZGUiXSwKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlWyJvcmRlciJdLAogICAgICAgICAgICAgICAgICAgIHBhY2thZ2VbImlzX2VudGVycHJpc2UiXSwKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlWyJtaWdyYXRpb25fdHlwZSJdLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGlmIHBrZ19pZHggPT0gMDoKICAgICAgICAgICAgICAgICAgICBtYWluX3BhY2thZ2VfZGV0YWlsID0gZGV0YWlsCgogICAgICAgICAgICAgICAgaWYgbm90IGRldGFpbDoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgZiJHYWdhbCBtZW5nYW1iaWwgZGV0YWlsIHBha2V0IHVudHVrIHtwYWNrYWdlWydmYW1pbHlfY29kZSddfS4iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICAgICAgcGF5bWVudF9pdGVtcy5hcHBlbmQoUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICAgICAgaXRlbV9jb2RlPWRldGFpbFsicGFja2FnZV9vcHRpb24iXVsicGFja2FnZV9vcHRpb25fY29kZSJdLAogICAgICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgICAgICBpdGVtX3ByaWNlPWRldGFpbFsicGFja2FnZV9vcHRpb24iXVsicHJpY2UiXSwKICAgICAgICAgICAgICAgICAgICBpdGVtX25hbWU9ZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICAgICAgdGF4PTAsCiAgICAgICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0sCiAgICAgICAgICAgICAgICApKQoKICAgICAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICAgICAgZW5zdXJlX2dpdCgpCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgICAgICBBbGlnbi5jZW50ZXIoZiJ7c2VsZWN0ZWRfcGFja2FnZVsnbmFtZSddfSIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgICAgIHBhZGRpbmc9KDEsIDIpLAogICAgICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICAgICAgKSkKICAgICAgICAgICAgc2ltcGxlX251bWJlcigpCgogICAgICAgICAgICBpbmZvX3RleHQgPSBUZXh0KCkKICAgICAgICAgICAgaW5mb190ZXh0LmFwcGVuZChmIntzZWxlY3RlZF9wYWNrYWdlWyduYW1lJ119XG4iLCBzdHlsZT0iYm9sZCIpCiAgICAgICAgICAgIGluZm9fdGV4dC5hcHBlbmQoZiJIYXJnYTogUnAge2dldF9ydXBpYWgoc2VsZWN0ZWRfcGFja2FnZVsncHJpY2UnXSl9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9tb25leSJdKQogICAgICAgICAgICBpbmZvX3RleHQuYXBwZW5kKCJEZXRhaWw6XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgIGZvciBsaW5lIGluIHNlbGVjdGVkX3BhY2thZ2UuZ2V0KCJkZXRhaWwiLCAiIikuc3BsaXQoIlxuIik6CiAgICAgICAgICAgICAgICBjbGVhbmVkID0gbGluZS5zdHJpcCgpCiAgICAgICAgICAgICAgICBpZiBjbGVhbmVkOgogICAgICAgICAgICAgICAgICAgIGluZm9fdGV4dC5hcHBlbmQoZiItIHtjbGVhbmVkfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQoKICAgICAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgICAgIGluZm9fdGV4dCwKICAgICAgICAgICAgICAgIHRpdGxlPWYiW3t0aGVtZVsndGV4dF90aXRsZSddfV1EZXRhaWwgUGFrZXRbL10iLAogICAgICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICAgICApKQoKICAgICAgICAgICAgcGF5bWVudF9mb3IgPSBzZWxlY3RlZF9wYWNrYWdlLmdldCgicGF5bWVudF9mb3IiLCAiQlVZX1BBQ0tBR0UiKQogICAgICAgICAgICBhc2tfb3ZlcndyaXRlID0gc2VsZWN0ZWRfcGFja2FnZS5nZXQoImFza19vdmVyd3JpdGUiLCBGYWxzZSkKICAgICAgICAgICAgb3ZlcndyaXRlX2Ftb3VudCA9IHNlbGVjdGVkX3BhY2thZ2UuZ2V0KCJvdmVyd3JpdGVfYW1vdW50IiwgLTEpCiAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHggPSBzZWxlY3RlZF9wYWNrYWdlLmdldCgidG9rZW5fY29uZmlybWF0aW9uX2lkeCIsIDApCiAgICAgICAgICAgIGFtb3VudF9pZHggPSBzZWxlY3RlZF9wYWNrYWdlLmdldCgiYW1vdW50X2lkeCIsIC0xKQoKICAgICAgICAgICAgaW5fcGF5bWVudF9tZW51ID0gVHJ1ZQogICAgICAgICAgICB3aGlsZSBpbl9wYXltZW50X21lbnU6CiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NikKICAgICAgICAgICAgICAgIG1ldGhvZF90YWJsZS5hZGRfY29sdW1uKHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICAgICAgICAgIG1ldGhvZF90YWJsZS5hZGRfcm93KCIxIiwgIkJhbGFuY2UiKQogICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlLmFkZF9yb3coIjIiLCAiRS1XYWxsZXQiKQogICAgICAgICAgICAgICAgbWV0aG9kX3RhYmxlLmFkZF9yb3coIjMiLCAiUVJJUyIpCiAgICAgICAgICAgICAgICBtZXRob2RfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUtlbWJhbGkga2UgbWVudSBzZWJlbHVtbnlhWy9dIikKCiAgICAgICAgICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICAgICAgICAgIG1ldGhvZF90YWJsZSwKICAgICAgICAgICAgICAgICAgICB0aXRsZT1mIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1dUGlsaWggTWV0b2RlIFBlbWJlbGlhblsvXSIsCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLAogICAgICAgICAgICAgICAgICAgIHBhZGRpbmc9KDAsIDEpLAogICAgICAgICAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgICAgICAgICApKQoKICAgICAgICAgICAgICAgIGlucHV0X21ldGhvZCA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1QaWxpaCBtZXRvZGU6Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCgogICAgICAgICAgICAgICAgaWYgaW5wdXRfbWV0aG9kID09ICIxIjoKICAgICAgICAgICAgICAgICAgICBpZiBvdmVyd3JpdGVfYW1vdW50ID09IC0xOgogICAgICAgICAgICAgICAgICAgICAgICBsYXN0X3ByaWNlID0gcGF5bWVudF9pdGVtc1stMV0uaXRlbV9wcmljZSBpZiBoYXNhdHRyKHBheW1lbnRfaXRlbXNbLTFdLCAiaXRlbV9wcmljZSIpIGVsc2UgcGF5bWVudF9pdGVtc1stMV1bIml0ZW1fcHJpY2UiXQogICAgICAgICAgICAgICAgICAgICAgICB3YXJuX3ByaWNlX3N0ciA9IGdldF9ydXBpYWgobGFzdF9wcmljZSkgaWYgaXNpbnN0YW5jZShsYXN0X3ByaWNlLCAoaW50LCBmbG9hdCkpIGVsc2Ugc3RyKGxhc3RfcHJpY2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoZiJbe3RoZW1lWyd0ZXh0X3dhcm4nXX1dUGFzdGlrYW4gc2lzYSBiYWxhbmNlIGt1cmFuZyBkYXJpIFJwe3dhcm5fcHJpY2Vfc3RyfVsvXSIpCgogICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlX2Fuc3dlciA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1MYW5qdXRrYW4gcGVtYmVsaWFuPyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYmFsYW5jZV9hbnN3ZXIubG93ZXIoKSAhPSAieSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiSW5mb3JtYXNpIiwgIlBlbWJlbGlhbiBkaWJhdGFsa2FuLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbl9wYXltZW50X21lbnUgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgc2V0dGxlbWVudF9iYWxhbmNlKAogICAgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRfaXRlbXMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRfZm9yLAogICAgICAgICAgICAgICAgICAgICAgICBhc2tfb3ZlcndyaXRlLAogICAgICAgICAgICAgICAgICAgICAgICBvdmVyd3JpdGVfYW1vdW50PW92ZXJ3cml0ZV9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9dG9rZW5fY29uZmlybWF0aW9uX2lkeCwKICAgICAgICAgICAgICAgICAgICAgICAgYW1vdW50X2lkeD1hbW91bnRfaWR4LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGVtYmVsaWFuIHNlbGVzYWksIHRla2FuIEVudGVyLi4uWy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKQogICAgICAgICAgICAgICAgICAgIGluX3BheW1lbnRfbWVudSA9IEZhbHNlCgogICAgICAgICAgICAgICAgZWxpZiBpbnB1dF9tZXRob2QgPT0gIjIiOgogICAgICAgICAgICAgICAgICAgIHNob3dfbXVsdGlwYXltZW50KAogICAgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRfaXRlbXMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRfZm9yLAogICAgICAgICAgICAgICAgICAgICAgICBhc2tfb3ZlcndyaXRlLAogICAgICAgICAgICAgICAgICAgICAgICBvdmVyd3JpdGVfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb25faWR4LAogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnRfaWR4LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGVtYmVsaWFuIHNlbGVzYWksIHRla2FuIEVudGVyLi4uWy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKQogICAgICAgICAgICAgICAgICAgIGluX3BheW1lbnRfbWVudSA9IEZhbHNlCgogICAgICAgICAgICAgICAgZWxpZiBpbnB1dF9tZXRob2QgPT0gIjMiOgogICAgICAgICAgICAgICAgICAgIHNob3dfcXJpc19wYXltZW50KAogICAgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRfaXRlbXMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRfZm9yLAogICAgICAgICAgICAgICAgICAgICAgICBhc2tfb3ZlcndyaXRlLAogICAgICAgICAgICAgICAgICAgICAgICBvdmVyd3JpdGVfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb25faWR4LAogICAgICAgICAgICAgICAgICAgICAgICBhbW91bnRfaWR4LAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGVtYmVsaWFuIHNlbGVzYWksIHRla2FuIEVudGVyLi4uWy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKQogICAgICAgICAgICAgICAgICAgIGluX3BheW1lbnRfbWVudSA9IEZhbHNlCgogICAgICAgICAgICAgICAgZWxpZiBpbnB1dF9tZXRob2QgPT0gIjAwIjoKICAgICAgICAgICAgICAgICAgICBpbl9wYXltZW50X21lbnUgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIk1ldG9kZSB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIklucHV0IHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUK').decode())
