#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KaW1wb3J0IHN5cwppbXBvcnQgcmVxdWVzdHMKCmZyb20gYXBwMi5jb25maWcuaW1wb3J0cyBpbXBvcnQgKgpmcm9tIGFwcC50eXBlX2RpY3QgaW1wb3J0IFBheW1lbnRJdGVtCmZyb20gYXBwMi5tZW51cy51dGlsIGltcG9ydCBsaXZlX2xvYWRpbmcsIGRlbGF5X2lubGluZSwgY2xlYXJfc2NyZWVuLCBwYXVzZSwgZGlzcGxheV9odG1sLCBwcmludF9wYW5lbCwgZ2V0X3J1cGlhaCwgZm9ybWF0X3F1b3RhX2J5dGUsIG5hdl9yYW5nZSwgc2ltcGxlX251bWJlcgpmcm9tIGFwcDIuY2xpZW50LmVuZ3NlbCBpbXBvcnQgZ2V0X2FkZG9ucywgc2VuZF9hcGlfcmVxdWVzdCwgdW5zdWJzY3JpYmUKZnJvbSBhcHAyLmNsaWVudC5jaWFtIGltcG9ydCBnZXRfYXV0aF9jb2RlCmZyb20gYXBwMi5jbGllbnQucHVyY2hhc2UucmVkZWVtIGltcG9ydCBzZXR0bGVtZW50X2JvdW50eSwgc2V0dGxlbWVudF9sb3lhbHR5LCBib3VudHlfYWxsb3RtZW50CmZyb20gYXBwMi5jbGllbnQucHVyY2hhc2UucXJpcyBpbXBvcnQgc2hvd19xcmlzX3BheW1lbnQKZnJvbSBhcHAyLmNsaWVudC5wdXJjaGFzZS5ld2FsbGV0IGltcG9ydCBzaG93X211bHRpcGF5bWVudApmcm9tIGFwcDIuY2xpZW50LnB1cmNoYXNlLmJhbGFuY2UgaW1wb3J0IHNldHRsZW1lbnRfYmFsYW5jZQpmcm9tIGFwcDIubWVudXMucHVyY2hhc2UgaW1wb3J0IHB1cmNoYXNlX25fdGltZXMsIHB1cmNoYXNlX25fdGltZXNfYnlfb3B0aW9uX2NvZGUKCmNvbnNvbGUgPSBDb25zb2xlKCkKCgpkZWYgc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBwYWNrYWdlX29wdGlvbl9jb2RlLCBpc19lbnRlcnByaXNlLCBvcHRpb25fb3JkZXI9LTEpOgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQogICAgY2xlYXJfc2NyZWVuKCkKCiAgICBwYWNrYWdlID0gZ2V0X3BhY2thZ2UoYXBpX2tleSwgdG9rZW5zLCBwYWNrYWdlX29wdGlvbl9jb2RlKQogICAgaWYgbm90IHBhY2thZ2U6CiAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJHYWdhbCBtZW11YXQgZGV0YWlsIHBha2V0LiIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiAiQkFDSyIKCiAgICBvcHRpb24gPSBwYWNrYWdlLmdldCgicGFja2FnZV9vcHRpb24iLCB7fSkKICAgIGZhbWlseSA9IHBhY2thZ2UuZ2V0KCJwYWNrYWdlX2ZhbWlseSIsIHt9KQogICAgdmFyaWFudCA9IHBhY2thZ2UuZ2V0KCJwYWNrYWdlX2RldGFpbF92YXJpYW50Iiwge30pCgogICAgcHJpY2UgPSBvcHRpb24uZ2V0KCJwcmljZSIsIDApCiAgICBmb3JtYXR0ZWRfcHJpY2UgPSBnZXRfcnVwaWFoKHByaWNlKQogICAgdmFsaWRpdHkgPSBvcHRpb24uZ2V0KCJ2YWxpZGl0eSIsICItIikKICAgIHBvaW50ID0gb3B0aW9uLmdldCgicG9pbnQiLCAiLSIpCiAgICBwbGFuX3R5cGUgPSBmYW1pbHkuZ2V0KCJwbGFuX3R5cGUiLCAiLSIpCiAgICBwYXltZW50X2ZvciA9IGZhbWlseS5nZXQoInBheW1lbnRfZm9yIiwgIiIpIG9yICJCVVlfUEFDS0FHRSIKCiAgICB0b2tlbl9jb25maXJtYXRpb24gPSBwYWNrYWdlLmdldCgidG9rZW5fY29uZmlybWF0aW9uIiwgIiIpCiAgICB0c190b19zaWduID0gcGFja2FnZS5nZXQoInRpbWVzdGFtcCIsICIiKQogICAgZGV0YWlsID0gZGlzcGxheV9odG1sKG9wdGlvbi5nZXQoInRuYyIsICIiKSkKCiAgICBvcHRpb25fbmFtZSA9IG9wdGlvbi5nZXQoIm5hbWUiLCAiIikKICAgIGZhbWlseV9uYW1lID0gZmFtaWx5LmdldCgibmFtZSIsICIiKQogICAgdmFyaWFudF9uYW1lID0gdmFyaWFudC5nZXQoIm5hbWUiLCAiIikKICAgIHRpdGxlID0gZiJ7ZmFtaWx5X25hbWV9IC0ge3ZhcmlhbnRfbmFtZX0gLSB7b3B0aW9uX25hbWV9Ii5zdHJpcCgpCgogICAgZmFtaWx5X2NvZGUgPSBmYW1pbHkuZ2V0KCJwYWNrYWdlX2ZhbWlseV9jb2RlIiwgIiIpCiAgICBwYXJlbnRfY29kZSA9IHBhY2thZ2UuZ2V0KCJwYWNrYWdlX2FkZG9uIiwge30pLmdldCgicGFyZW50X2NvZGUiLCAiIikgb3IgIk4vQSIKCiAgICBwYXltZW50X2l0ZW1zID0gWwogICAgICAgIFBheW1lbnRJdGVtKAogICAgICAgICAgICBpdGVtX2NvZGU9cGFja2FnZV9vcHRpb25fY29kZSwKICAgICAgICAgICAgcHJvZHVjdF90eXBlPSIiLAogICAgICAgICAgICBpdGVtX3ByaWNlPXByaWNlLAogICAgICAgICAgICBpdGVtX25hbWU9ZiJ7dmFyaWFudF9uYW1lfSB7b3B0aW9uX25hbWV9Ii5zdHJpcCgpLAogICAgICAgICAgICB0YXg9MCwKICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPXRva2VuX2NvbmZpcm1hdGlvbiwKICAgICAgICApCiAgICBdCgogICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICBBbGlnbi5jZW50ZXIoZiJ7ZmFtaWx5X25hbWV9IiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICBleHBhbmQ9VHJ1ZQogICAgKSkKICAgIHNpbXBsZV9udW1iZXIoKQogICAgZW5zdXJlX2dpdCgpCgogICAgaW5mb190YWJsZSA9IFRhYmxlLmdyaWQocGFkZGluZz0oMCwgMSkpCiAgICBpbmZvX3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0ibGVmdCIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgaW5mb190YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9ImxlZnQiKQogICAgaW5mb190YWJsZS5hZGRfcm93KCJOYW1hIiwgZiI6IFtib2xkIHt0aGVtZVsndGV4dF9ib2R5J119XXt0aXRsZX1bL10iKQogICAgaW5mb190YWJsZS5hZGRfcm93KCJIYXJnYSIsIGYiOiBScCBbe3RoZW1lWyd0ZXh0X21vbmV5J119XXtmb3JtYXR0ZWRfcHJpY2V9Wy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiTWFzYSBBa3RpZiIsIGYiOiBbe3RoZW1lWyd0ZXh0X2RhdGUnXX1de3ZhbGlkaXR5fVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIlBvaW50IiwgZiI6IFt7dGhlbWVbJ3RleHRfYm9keSddfV17cG9pbnR9Wy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiUGxhbiBUeXBlIiwgZiI6IFt7dGhlbWVbJ3RleHRfYm9keSddfV17cGxhbl90eXBlfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIlBheW1lbnQgRm9yIiwgZiI6IFt7dGhlbWVbJ3RleHRfYm9keSddfV17cGF5bWVudF9mb3J9Wy9dIikKICAgIGluZm9fdGFibGUuYWRkX3JvdygiRmFtaWx5IENvZGUiLCBmIjogW3t0aGVtZVsnYm9yZGVyX3dhcm5pbmcnXX1de2ZhbWlseV9jb2RlfVsvXSIpCiAgICBpbmZvX3RhYmxlLmFkZF9yb3coIlBhcmVudCBDb2RlIiwgZiI6IFt7dGhlbWVbJ3RleHRfc3ViJ119XXtwYXJlbnRfY29kZX1bL10iKQoKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgaW5mb190YWJsZSwKICAgICAgICB0aXRsZT1mIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1dWyBEZXRhaWwgUGFrZXQgXVsvXSIsCiAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgIHBhZGRpbmc9KDAsIDEpLAogICAgICAgIGV4cGFuZD1UcnVlCiAgICApKQoKICAgIGJlbmVmaXRzID0gb3B0aW9uLmdldCgiYmVuZWZpdHMiLCBbXSkKICAgIGlmIGJlbmVmaXRzOgogICAgICAgIGJlbmVmaXRfdGFibGUgPSBUYWJsZShib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfY29sdW1uKCJOYW1hIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIGJlbmVmaXRfdGFibGUuYWRkX2NvbHVtbigiSmVuaXMiLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfY29sdW1uKCJVbmxpIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sIGp1c3RpZnk9ImNlbnRlciIpCiAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfY29sdW1uKCJUb3RhbCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSwganVzdGlmeT0icmlnaHQiKQoKICAgICAgICBmb3IgYiBpbiBiZW5lZml0czoKICAgICAgICAgICAgZHQgPSBiWyJkYXRhX3R5cGUiXQogICAgICAgICAgICB0b3RhbCA9IGJbInRvdGFsIl0KICAgICAgICAgICAgaXNfdW5saSA9IGJbImlzX3VubGltaXRlZCJdCgogICAgICAgICAgICBpZiBpc191bmxpOgogICAgICAgICAgICAgICAgdG90YWxfc3RyID0geyJWT0lDRSI6ICJtZW5pdCIsICJURVhUIjogIlNNUyIsICJEQVRBIjogImt1b3RhIn0uZ2V0KGR0LCBkdCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGR0ID09ICJWT0lDRSI6CiAgICAgICAgICAgICAgICAgICAgdG90YWxfc3RyID0gZiJ7dG90YWwgLyA2MDouMGZ9IG1lbml0IgogICAgICAgICAgICAgICAgZWxpZiBkdCA9PSAiVEVYVCI6CiAgICAgICAgICAgICAgICAgICAgdG90YWxfc3RyID0gZiJ7dG90YWx9IFNNUyIKICAgICAgICAgICAgICAgIGVsaWYgZHQgPT0gIkRBVEEiOgogICAgICAgICAgICAgICAgICAgIGlmIHRvdGFsID49IDFfMDAwXzAwMF8wMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N0ciA9IGYie3RvdGFsIC8gKDEwMjQgKiogMyk6LjJmfSBHQiIKICAgICAgICAgICAgICAgICAgICBlbGlmIHRvdGFsID49IDFfMDAwXzAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxfc3RyID0gZiJ7dG90YWwgLyAoMTAyNCAqKiAyKTouMmZ9IE1CIgogICAgICAgICAgICAgICAgICAgIGVsaWYgdG90YWwgPj0gMV8wMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N0ciA9IGYie3RvdGFsIC8gMTAyNDouMmZ9IEtCIgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3N0ciA9IGYie3RvdGFsfSBCIgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0b3RhbF9zdHIgPSBmInt0b3RhbH0gKHtkdH0pIgoKICAgICAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfcm93KGJbIm5hbWUiXSwgZHQsICJZRVMiIGlmIGlzX3VubGkgZWxzZSAiLSIsIHRvdGFsX3N0cikKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgYmVuZWZpdF90YWJsZSwKICAgICAgICAgICAgdGl0bGU9ZiJbe3RoZW1lWyd0ZXh0X3RpdGxlJ119XUJlbmVmaXQgUGFrZXRbL10iLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9zdWNjZXNzIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDAsIDApLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCgogICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICBkZXRhaWwsCiAgICAgICAgdGl0bGU9ZiJbe3RoZW1lWyd0ZXh0X3RpdGxlJ119XVN5YXJhdCAmIEtldGVudHVhblsvXSIsCiAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfd2FybmluZyJdLAogICAgICAgIGV4cGFuZD1UcnVlCiAgICApKQoKICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD02KQogICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjEiLCAiUGVtYmVsaWFuIHZpYSBQdWxzYSIpCiAgICBuYXZfdGFibGUuYWRkX3JvdygiMiIsICJQZW1iYXlhcmFuIHZpYSBFLVdhbGxldCIpCiAgICBuYXZfdGFibGUuYWRkX3JvdygiMyIsICJQZW1iYXlhcmFuIHZpYSBRUklTIikKICAgIG5hdl90YWJsZS5hZGRfcm93KCI0IiwgIlB1bHNhICsgRGVjb3kiKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjUiLCAiUHVsc2EgKyBEZWNveSBWMiIpCiAgICBuYXZfdGFibGUuYWRkX3JvdygiNiIsICJRUklTICsgRGVjb3kgKCsxSykiKQogICAgbmF2X3RhYmxlLmFkZF9yb3coIjciLCAiUVJJUyArIERlY295IFYyIikKICAgIG5hdl90YWJsZS5hZGRfcm93KCI4IiwgIlB1bHNhIE4ga2FsaSIpCiAgICBpZiBwYXltZW50X2ZvciA9PSAiUkVERUVNX1ZPVUNIRVIiOgogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCJCIiwgIkFtYmlsIEJvbnVzIikKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiQkEiLCAiS2lyaW0gQm9udXMga2UgTm9tb3IgVHVqdWFuIikKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiTCIsICJQZW1iZWxpYW4gdmlhIFBvaW4iKQogICAgaWYgb3B0aW9uX29yZGVyICE9IC0xOgogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCIwIiwgIlRhbWJhaGthbiBrZSBCb29rbWFyayIpCiAgICBuYXZfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUtlbWJhbGkga2UgZGFmdGFyIHBha2V0Wy9dIikKCiAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgIG5hdl90YWJsZSwKICAgICAgICB0aXRsZT1mIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1dWyBPcHNpIFBlbWJlbGlhbiBdWy9dIiwKICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sCiAgICAgICAgZXhwYW5kPVRydWUKICAgICkpCgogICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XVBpbGloYW46Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCgogICAgaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgIGVsaWYgY2hvaWNlID09ICIwIiBhbmQgb3B0aW9uX29yZGVyICE9IC0xOgogICAgICAgIHN1Y2Nlc3MgPSBCb29rbWFya0luc3RhbmNlLmFkZF9ib29rbWFyaygKICAgICAgICAgICAgZmFtaWx5X2NvZGU9cGFja2FnZS5nZXQoInBhY2thZ2VfZmFtaWx5Iiwge30pLmdldCgicGFja2FnZV9mYW1pbHlfY29kZSIsICIiKSwKICAgICAgICAgICAgZmFtaWx5X25hbWU9cGFja2FnZS5nZXQoInBhY2thZ2VfZmFtaWx5Iiwge30pLmdldCgibmFtZSIsICIiKSwKICAgICAgICAgICAgaXNfZW50ZXJwcmlzZT1pc19lbnRlcnByaXNlLAogICAgICAgICAgICB2YXJpYW50X25hbWU9dmFyaWFudF9uYW1lLAogICAgICAgICAgICBvcHRpb25fbmFtZT1vcHRpb25fbmFtZSwKICAgICAgICAgICAgb3JkZXI9b3B0aW9uX29yZGVyLAogICAgICAgICkKICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICBwcmludF9wYW5lbCgiQmVyaGFzaWwiLCAiUGFrZXQgYmVyaGFzaWwgZGl0YW1iYWhrYW4ga2UgYm9va21hcmsuIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludF9wYW5lbCgiSW5mb3JtYXNpIiwgIlBha2V0IHN1ZGFoIGFkYSBkaSBib29rbWFyay4iKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlID09ICIxIjoKICAgICAgICBzZXR0bGVtZW50X2JhbGFuY2UoYXBpX2tleSwgdG9rZW5zLCBwYXltZW50X2l0ZW1zLCBwYXltZW50X2ZvciwgVHJ1ZSkKICAgICAgICAjcHJpbnRfcGFuZWwoIkJlcmhhc2lsIiwgIlBlbWJlbGlhbiB2aWEgcHVsc2EgYmVyaGFzaWwuIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgc2hvd19tdWx0aXBheW1lbnQoYXBpX2tleSwgdG9rZW5zLCBwYXltZW50X2l0ZW1zLCBwYXltZW50X2ZvciwgVHJ1ZSkKICAgICAgICAjcHJpbnRfcGFuZWwoIkJlcmhhc2lsIiwgIlBlbWJheWFyYW4gdmlhIGUtd2FsbGV0IGJlcmhhc2lsLiIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UgPT0gIjMiOgogICAgICAgIHNob3dfcXJpc19wYXltZW50KGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgcGF5bWVudF9mb3IsIFRydWUpCiAgICAgICAgI3ByaW50X3BhbmVsKCJCZXJoYXNpbCIsICJQZW1iYXlhcmFuIHZpYSBRUklTIGJlcmhhc2lsLiIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UgPT0gIjQiOgogICAgICAgIGRlY295ID0gRGVjb3lJbnN0YW5jZS5nZXRfZGVjb3koImJhbGFuY2UiKQogICAgICAgIGRlY295X3BhY2thZ2VfZGV0YWlsID0gZ2V0X3BhY2thZ2UoYXBpX2tleSwgdG9rZW5zLCBkZWNveVsib3B0aW9uX2NvZGUiXSkKICAgICAgICBpZiBub3QgZGVjb3lfcGFja2FnZV9kZXRhaWw6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiRGV0YWlsIHBha2V0IGRlY295IHRpZGFrIGRpdGVtdWthbi4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgcGF5bWVudF9pdGVtcy5hcHBlbmQoCiAgICAgICAgICAgIFBheW1lbnRJdGVtKAogICAgICAgICAgICAgICAgaXRlbV9jb2RlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICBwcm9kdWN0X3R5cGU9IiIsCiAgICAgICAgICAgICAgICBpdGVtX3ByaWNlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgaXRlbV9uYW1lPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICB0YXg9MCwKICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbj1kZWNveV9wYWNrYWdlX2RldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0sCiAgICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIG92ZXJ3cml0ZV9hbW91bnQgPSBwcmljZSArIGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCiAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgcGF5bWVudF9mb3IsIEZhbHNlLCBvdmVyd3JpdGVfYW1vdW50PW92ZXJ3cml0ZV9hbW91bnQpCgogICAgICAgIGlmIHJlcyBhbmQgcmVzLmdldCgic3RhdHVzIiwgIiIpICE9ICJTVUNDRVNTIjoKICAgICAgICAgICAgZXJyb3JfbXNnID0gcmVzLmdldCgibWVzc2FnZSIsICJUZXJqYWRpIGtlc2FsYWhhbi4iKQogICAgICAgICAgICBpZiAiQml6ei1lcnIuQW1vdW50LlRvdGFsIiBpbiBlcnJvcl9tc2c6CiAgICAgICAgICAgICAgICB2YWxpZF9hbW91bnQgPSBpbnQoZXJyb3JfbXNnLnNwbGl0KCI9IilbMV0uc3RyaXAoKSkKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCBmIlRvdGFsIGRpc2VzdWFpa2FuIGtlOiB7dmFsaWRfYW1vdW50fSIpCiAgICAgICAgICAgICAgICByZXMgPSBzZXR0bGVtZW50X2JhbGFuY2UoYXBpX2tleSwgdG9rZW5zLCBwYXltZW50X2l0ZW1zLCBwYXltZW50X2ZvciwgRmFsc2UsIG92ZXJ3cml0ZV9hbW91bnQ9dmFsaWRfYW1vdW50KQogICAgICAgICAgICAgICAgaWYgcmVzIGFuZCByZXMuZ2V0KCJzdGF0dXMiLCAiIikgPT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJCZXJoYXNpbCIsICJQZW1iZWxpYW4gYmVyaGFzaWwuIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludF9wYW5lbCgiQmVyaGFzaWwiLCAiUGVtYmVsaWFuIGJlcmhhc2lsLiIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZWxpZiBjaG9pY2UgPT0gIjUiOgogICAgICAgIGRlY295ID0gRGVjb3lJbnN0YW5jZS5nZXRfZGVjb3koImJhbGFuY2UiKQogICAgICAgIGRlY295X3BhY2thZ2VfZGV0YWlsID0gZ2V0X3BhY2thZ2UoYXBpX2tleSwgdG9rZW5zLCBkZWNveVsib3B0aW9uX2NvZGUiXSkKICAgICAgICBpZiBub3QgZGVjb3lfcGFja2FnZV9kZXRhaWw6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiRGV0YWlsIHBha2V0IGRlY295IHRpZGFrIGRpdGVtdWthbi4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgcGF5bWVudF9pdGVtcy5hcHBlbmQoCiAgICAgICAgICAgIFBheW1lbnRJdGVtKAogICAgICAgICAgICAgICAgaXRlbV9jb2RlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwYWNrYWdlX29wdGlvbl9jb2RlIl0sCiAgICAgICAgICAgICAgICBwcm9kdWN0X3R5cGU9IiIsCiAgICAgICAgICAgICAgICBpdGVtX3ByaWNlPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdLAogICAgICAgICAgICAgICAgaXRlbV9uYW1lPWRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJuYW1lIl0sCiAgICAgICAgICAgICAgICB0YXg9MCwKICAgICAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbj1kZWNveV9wYWNrYWdlX2RldGFpbFsidG9rZW5fY29uZmlybWF0aW9uIl0sCiAgICAgICAgICAgICkKICAgICAgICApCgogICAgICAgIG92ZXJ3cml0ZV9hbW91bnQgPSBwcmljZSArIGRlY295X3BhY2thZ2VfZGV0YWlsWyJwYWNrYWdlX29wdGlvbiJdWyJwcmljZSJdCiAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKAogICAgICAgICAgICBhcGlfa2V5LCB0b2tlbnMsIHBheW1lbnRfaXRlbXMsICLwn6SrIiwgRmFsc2UsCiAgICAgICAgICAgIG92ZXJ3cml0ZV9hbW91bnQ9b3ZlcndyaXRlX2Ftb3VudCwgdG9rZW5fY29uZmlybWF0aW9uX2lkeD0xCiAgICAgICAgKQoKICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIGVycm9yX21zZyA9IHJlcy5nZXQoIm1lc3NhZ2UiLCAiVGVyamFkaSBrZXNhbGFoYW4uIikKICAgICAgICAgICAgaWYgIkJpenotZXJyLkFtb3VudC5Ub3RhbCIgaW4gZXJyb3JfbXNnOgogICAgICAgICAgICAgICAgdmFsaWRfYW1vdW50ID0gaW50KGVycm9yX21zZy5zcGxpdCgiPSIpWzFdLnN0cmlwKCkpCiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiSW5mb3JtYXNpIiwgZiJUb3RhbCBkaXNlc3VhaWthbiBrZToge3ZhbGlkX2Ftb3VudH0iKQogICAgICAgICAgICAgICAgcmVzID0gc2V0dGxlbWVudF9iYWxhbmNlKGFwaV9rZXksIHRva2VucywgcGF5bWVudF9pdGVtcywgIvCfpKsiLCBGYWxzZSwgb3ZlcndyaXRlX2Ftb3VudD12YWxpZF9hbW91bnQsIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9LTEpCiAgICAgICAgICAgICAgICBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIsICIiKSA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkJlcmhhc2lsIiwgIlBlbWJlbGlhbiBiZXJoYXNpbC4iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJCZXJoYXNpbCIsICJQZW1iZWxpYW4gYmVyaGFzaWwuIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBlbGlmIGNob2ljZSA9PSAiNiI6CiAgICAgICAgZGVjb3kgPSBEZWNveUluc3RhbmNlLmdldF9kZWNveSgicXJpcyIpCiAgICAgICAgZGVjb3lfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZShhcGlfa2V5LCB0b2tlbnMsIGRlY295WyJvcHRpb25fY29kZSJdKQogICAgICAgIGlmIG5vdCBkZWNveV9wYWNrYWdlX2RldGFpbDoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJEZXRhaWwgcGFrZXQgZGVjb3kgdGlkYWsgZGl0ZW11a2FuLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBwYXltZW50X2l0ZW1zLmFwcGVuZCgKICAgICAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICBpdGVtX2NvZGU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInByaWNlIl0sCiAgICAgICAgICAgICAgICBpdGVtX25hbWU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bIm5hbWUiXSwKICAgICAgICAgICAgICAgIHRheD0wLAogICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRlY295X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgY29uc29sZS5ydWxlKCkKICAgICAgICBjb25zb2xlLnByaW50KGYiSGFyZ2EgUGFrZXQgVXRhbWE6IFJwIHtwcmljZX0iKQogICAgICAgIGNvbnNvbGUucHJpbnQoZiJIYXJnYSBQYWtldCBEZWNveTogUnAge2RlY295X3BhY2thZ2VfZGV0YWlsWydwYWNrYWdlX29wdGlvbiddWydwcmljZSddfSIpCiAgICAgICAgY29uc29sZS5wcmludCgiU2lsYWthbiB1dGFrLWF0aWsgYW1vdW50ICh0cmlhbCAmIGVycm9yLCAwID0gdGlkYWsgdmFsaWQpIikKICAgICAgICBjb25zb2xlLnJ1bGUoKQoKICAgICAgICBzaG93X3FyaXNfcGF5bWVudChhcGlfa2V5LCB0b2tlbnMsIHBheW1lbnRfaXRlbXMsICJTSEFSRV9QQUNLQUdFIiwgVHJ1ZSwgdG9rZW5fY29uZmlybWF0aW9uX2lkeD0xKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlID09ICI3IjoKICAgICAgICBkZWNveSA9IERlY295SW5zdGFuY2UuZ2V0X2RlY295KCJxcmlzMCIpCiAgICAgICAgZGVjb3lfcGFja2FnZV9kZXRhaWwgPSBnZXRfcGFja2FnZShhcGlfa2V5LCB0b2tlbnMsIGRlY295WyJvcHRpb25fY29kZSJdKQogICAgICAgIGlmIG5vdCBkZWNveV9wYWNrYWdlX2RldGFpbDoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJEZXRhaWwgcGFrZXQgZGVjb3kgdGlkYWsgZGl0ZW11a2FuLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBwYXltZW50X2l0ZW1zLmFwcGVuZCgKICAgICAgICAgICAgUGF5bWVudEl0ZW0oCiAgICAgICAgICAgICAgICBpdGVtX2NvZGU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInBhY2thZ2Vfb3B0aW9uX2NvZGUiXSwKICAgICAgICAgICAgICAgIHByb2R1Y3RfdHlwZT0iIiwKICAgICAgICAgICAgICAgIGl0ZW1fcHJpY2U9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bInByaWNlIl0sCiAgICAgICAgICAgICAgICBpdGVtX25hbWU9ZGVjb3lfcGFja2FnZV9kZXRhaWxbInBhY2thZ2Vfb3B0aW9uIl1bIm5hbWUiXSwKICAgICAgICAgICAgICAgIHRheD0wLAogICAgICAgICAgICAgICAgdG9rZW5fY29uZmlybWF0aW9uPWRlY295X3BhY2thZ2VfZGV0YWlsWyJ0b2tlbl9jb25maXJtYXRpb24iXSwKICAgICAgICAgICAgKQogICAgICAgICkKCiAgICAgICAgY29uc29sZS5ydWxlKCkKICAgICAgICBjb25zb2xlLnByaW50KGYiSGFyZ2EgUGFrZXQgVXRhbWE6IFJwIHtwcmljZX0iKQogICAgICAgIGNvbnNvbGUucHJpbnQoZiJIYXJnYSBQYWtldCBEZWNveTogUnAge2RlY295X3BhY2thZ2VfZGV0YWlsWydwYWNrYWdlX29wdGlvbiddWydwcmljZSddfSIpCiAgICAgICAgY29uc29sZS5wcmludCgiU2lsYWthbiB1dGFrLWF0aWsgYW1vdW50ICh0cmlhbCAmIGVycm9yLCAwID0gdGlkYWsgdmFsaWQpIikKICAgICAgICBjb25zb2xlLnJ1bGUoKQoKICAgICAgICBzaG93X3FyaXNfcGF5bWVudChhcGlfa2V5LCB0b2tlbnMsIHBheW1lbnRfaXRlbXMsICJTSEFSRV9QQUNLQUdFIiwgVHJ1ZSwgdG9rZW5fY29uZmlybWF0aW9uX2lkeD0xKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlID09ICI4IjoKICAgICAgICB1c2VfZGVjb3lfZm9yX25fdGltZXMgPSBjb25zb2xlLmlucHV0KCJHdW5ha2FuIGRlY295IHBha2V0PyAoeS9uKTogIikuc3RyaXAoKS5sb3dlcigpID09ICd5JwogICAgICAgIG5fdGltZXNfc3RyID0gY29uc29sZS5pbnB1dCgiSnVtbGFoIHBlbWJlbGlhbiAoY29udG9oOiAzKTogIikuc3RyaXAoKQogICAgICAgIGRlbGF5X3NlY29uZHNfc3RyID0gY29uc29sZS5pbnB1dCgiRGVsYXkgYW50YXIgcGVtYmVsaWFuIChkZXRpaywgY29udG9oOiAyNSk6ICIpLnN0cmlwKCkKICAgICAgICBpZiBub3QgZGVsYXlfc2Vjb25kc19zdHIuaXNkaWdpdCgpOgogICAgICAgICAgICBkZWxheV9zZWNvbmRzX3N0ciA9ICIwIgoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG5fdGltZXMgPSBpbnQobl90aW1lc19zdHIpCiAgICAgICAgICAgIGlmIG5fdGltZXMgPCAxOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiTWluaW1hbCAxLiIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiSW5wdXQganVtbGFoIHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBwdXJjaGFzZV9uX3RpbWVzX2J5X29wdGlvbl9jb2RlKAogICAgICAgICAgICBuX3RpbWVzLAogICAgICAgICAgICBvcHRpb25fY29kZT1wYWNrYWdlX29wdGlvbl9jb2RlLAogICAgICAgICAgICB1c2VfZGVjb3k9dXNlX2RlY295X2Zvcl9uX3RpbWVzLAogICAgICAgICAgICBkZWxheV9zZWNvbmRzPWludChkZWxheV9zZWNvbmRzX3N0ciksCiAgICAgICAgICAgIHBhdXNlX29uX3N1Y2Nlc3M9RmFsc2UsCiAgICAgICAgICAgIHRva2VuX2NvbmZpcm1hdGlvbl9pZHg9MQogICAgICAgICkKICAgICAgICAjcHJpbnRfcGFuZWwoIkJlcmhhc2lsIiwgZiJQZW1iZWxpYW4ge25fdGltZXN9IGthbGkgYmVyaGFzaWwuIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBlbGlmIGNob2ljZS5sb3dlcigpID09ICJiIjoKICAgICAgICBzZXR0bGVtZW50X2JvdW50eSgKICAgICAgICAgICAgYXBpX2tleT1hcGlfa2V5LAogICAgICAgICAgICB0b2tlbnM9dG9rZW5zLAogICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb249dG9rZW5fY29uZmlybWF0aW9uLAogICAgICAgICAgICB0c190b19zaWduPXRzX3RvX3NpZ24sCiAgICAgICAgICAgIHBheW1lbnRfdGFyZ2V0PXBhY2thZ2Vfb3B0aW9uX2NvZGUsCiAgICAgICAgICAgIHByaWNlPXByaWNlLAogICAgICAgICAgICBpdGVtX25hbWU9dmFyaWFudF9uYW1lCiAgICAgICAgKQogICAgICAgICNwcmludF9wYW5lbCgiQmVyaGFzaWwiLCAiQm9udXMgYmVyaGFzaWwgZGlhbWJpbC4iKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gImJhIjoKICAgICAgICBkZXN0aW5hdGlvbl9tc2lzZG4gPSBjb25zb2xlLmlucHV0KCJOb21vciB0dWp1YW4gYm9udXMgKDYyeHh4KTogIikuc3RyaXAoKQogICAgICAgIGJvdW50eV9hbGxvdG1lbnQoCiAgICAgICAgICAgIGFwaV9rZXk9YXBpX2tleSwKICAgICAgICAgICAgdG9rZW5zPXRva2VucywKICAgICAgICAgICAgdHNfdG9fc2lnbj10c190b19zaWduLAogICAgICAgICAgICBkZXN0aW5hdGlvbl9tc2lzZG49ZGVzdGluYXRpb25fbXNpc2RuLAogICAgICAgICAgICBpdGVtX25hbWU9b3B0aW9uX25hbWUsCiAgICAgICAgICAgIGl0ZW1fY29kZT1wYWNrYWdlX29wdGlvbl9jb2RlLAogICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb249dG9rZW5fY29uZmlybWF0aW9uLAogICAgICAgICkKICAgICAgICBwcmludF9wYW5lbCgiQmVyaGFzaWwiLCAiQm9udXMgYmVyaGFzaWwgZGlraXJpbS4iKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGVsaWYgY2hvaWNlLmxvd2VyKCkgPT0gImwiOgogICAgICAgIHNldHRsZW1lbnRfbG95YWx0eSgKICAgICAgICAgICAgYXBpX2tleT1hcGlfa2V5LAogICAgICAgICAgICB0b2tlbnM9dG9rZW5zLAogICAgICAgICAgICB0b2tlbl9jb25maXJtYXRpb249dG9rZW5fY29uZmlybWF0aW9uLAogICAgICAgICAgICB0c190b19zaWduPXRzX3RvX3NpZ24sCiAgICAgICAgICAgIHBheW1lbnRfdGFyZ2V0PXBhY2thZ2Vfb3B0aW9uX2NvZGUsCiAgICAgICAgICAgIHByaWNlPXByaWNlLAogICAgICAgICkKICAgICAgICBwcmludF9wYW5lbCgiQmVyaGFzaWwiLCAiUGVtYmVsaWFuIG1lbmdndW5ha2FuIHBvaW4gYmVyaGFzaWwuIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBlbHNlOgogICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiUGVtYmVsaWFuIGRpYmF0YWxrYW4uIikKICAgICAgICBwYXVzZSgpCiAgICAgICAgcmV0dXJuICJCQUNLIgoKCmRlZiBnZXRfcGFja2FnZXNfYnlfZmFtaWx5KAogICAgZmFtaWx5X2NvZGU6IHN0ciwKICAgIGlzX2VudGVycHJpc2U6IGJvb2wgfCBOb25lID0gTm9uZSwKICAgIG1pZ3JhdGlvbl90eXBlOiBzdHIgfCBOb25lID0gTm9uZSwKICAgIHJldHVybl9wYWNrYWdlX2RldGFpbDogYm9vbCA9IEZhbHNlCik6CiAgICBhcGlfa2V5ID0gQXV0aEluc3RhbmNlLmFwaV9rZXkKICAgIHRva2VucyA9IEF1dGhJbnN0YW5jZS5nZXRfYWN0aXZlX3Rva2VucygpCiAgICB0aGVtZSA9IGdldF90aGVtZSgpCgogICAgaWYgbm90IHRva2VuczoKICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIlRva2VuIHVzZXIgYWt0aWYgdGlkYWsgZGl0ZW11a2FuLiIpCiAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgIGRhdGEgPSBnZXRfZmFtaWx5KGFwaV9rZXksIHRva2VucywgZmFtaWx5X2NvZGUsIGlzX2VudGVycHJpc2UsIG1pZ3JhdGlvbl90eXBlKQogICAgaWYgbm90IGRhdGE6CiAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJHYWdhbCBtZW11YXQgZGF0YSBwYWtldCBmYW1pbHkuIikKICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgcHJpY2VfY3VycmVuY3kgPSAiUnAiCiAgICBpZiBkYXRhWyJwYWNrYWdlX2ZhbWlseSJdLmdldCgicmNfYm9udXNfdHlwZSIpID09ICJNWVJFV0FSRFMiOgogICAgICAgIHByaWNlX2N1cnJlbmN5ID0gIlBvaW4iCgogICAgcGFja2FnZXMgPSBbXQogICAgZm9yIHZhcmlhbnQgaW4gZGF0YVsicGFja2FnZV92YXJpYW50cyJdOgogICAgICAgIGZvciBvcHRpb24gaW4gdmFyaWFudFsicGFja2FnZV9vcHRpb25zIl06CiAgICAgICAgICAgIHBhY2thZ2VzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAibnVtYmVyIjogbGVuKHBhY2thZ2VzKSArIDEsCiAgICAgICAgICAgICAgICAidmFyaWFudF9uYW1lIjogdmFyaWFudFsibmFtZSJdLAogICAgICAgICAgICAgICAgIm9wdGlvbl9uYW1lIjogb3B0aW9uWyJuYW1lIl0sCiAgICAgICAgICAgICAgICAicHJpY2UiOiBvcHRpb25bInByaWNlIl0sCiAgICAgICAgICAgICAgICAiY29kZSI6IG9wdGlvblsicGFja2FnZV9vcHRpb25fY29kZSJdLAogICAgICAgICAgICAgICAgIm9wdGlvbl9vcmRlciI6IG9wdGlvblsib3JkZXIiXQogICAgICAgICAgICB9KQoKICAgIHdoaWxlIFRydWU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBBbGlnbi5jZW50ZXIoZiJ7ZGF0YVsncGFja2FnZV9mYW1pbHknXVsnbmFtZSddfSIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQogICAgICAgIHNpbXBsZV9udW1iZXIoKQoKICAgICAgICBpbmZvX3RleHQgPSBUZXh0KCkKICAgICAgICBpbmZvX3RleHQuYXBwZW5kKCJOYW1hIEZhbWlseTogIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgaW5mb190ZXh0LmFwcGVuZChmIntkYXRhWydwYWNrYWdlX2ZhbWlseSddWyduYW1lJ119XG4iLCBzdHlsZT10aGVtZVsidGV4dF92YWx1ZSJdKQogICAgICAgIGluZm9fdGV4dC5hcHBlbmQoIktvZGUgRmFtaWx5OiAiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSkKICAgICAgICBpbmZvX3RleHQuYXBwZW5kKGYie2ZhbWlseV9jb2RlfVxuIiwgc3R5bGU9dGhlbWVbImJvcmRlcl93YXJuaW5nIl0pCiAgICAgICAgaW5mb190ZXh0LmFwcGVuZCgiVGlwZSBQYWtldDogIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgaW5mb190ZXh0LmFwcGVuZChmIntkYXRhWydwYWNrYWdlX2ZhbWlseSddWydwYWNrYWdlX2ZhbWlseV90eXBlJ119XG4iLCBzdHlsZT10aGVtZVsidGV4dF92YWx1ZSJdKQogICAgICAgIGluZm9fdGV4dC5hcHBlbmQoIkp1bWxhaCBWYXJpYW46ICIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgIGluZm9fdGV4dC5hcHBlbmQoZiJ7bGVuKGRhdGFbJ3BhY2thZ2VfdmFyaWFudHMnXSl9XG4iLCBzdHlsZT10aGVtZVsidGV4dF92YWx1ZSJdKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBpbmZvX3RleHQsCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgcGFkZGluZz0oMCwgMiksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKCiAgICAgICAgdGFibGUgPSBUYWJsZShib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTm8iLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD00KQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIlZhcmlhbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJOYW1hIFBha2V0Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIHRhYmxlLmFkZF9jb2x1bW4oIkhhcmdhIiwgc3R5bGU9dGhlbWVbInRleHRfbW9uZXkiXSwganVzdGlmeT0icmlnaHQiKQoKICAgICAgICBmb3IgcGtnIGluIHBhY2thZ2VzOgogICAgICAgICAgICBoYXJnYV9zdHIgPSBnZXRfcnVwaWFoKHBrZ1sicHJpY2UiXSkgaWYgcHJpY2VfY3VycmVuY3kgPT0gIlJwIiBlbHNlIGYie3BrZ1sncHJpY2UnXX0gUG9pbiIKICAgICAgICAgICAgdGFibGUuYWRkX3JvdygKICAgICAgICAgICAgICAgIHN0cihwa2dbIm51bWJlciJdKSwKICAgICAgICAgICAgICAgIHBrZ1sidmFyaWFudF9uYW1lIl0sCiAgICAgICAgICAgICAgICBwa2dbIm9wdGlvbl9uYW1lIl0sCiAgICAgICAgICAgICAgICBoYXJnYV9zdHIKICAgICAgICAgICAgKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICB0YWJsZSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgwLCAwKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgICAgICBuYXYgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIG5hdi5hZGRfY29sdW1uKGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgbmF2LmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIG5hdi5hZGRfcm93KCIwMCIsIGYiW3t0aGVtZVsndGV4dF9zdWInXX1dS2VtYmFsaSBrZSBtZW51IHNlYmVsdW1ueWFbL10iKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBuYXYsCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwKICAgICAgICAgICAgcGFkZGluZz0oMCwgMSksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKCiAgICAgICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfdGl0bGUnXX1dUGlsaWggKG5vbW9yKSBwYWtldDpbL3t0aGVtZVsndGV4dF90aXRsZSddfV0gIikuc3RyaXAoKQogICAgICAgIGlmIGNob2ljZSA9PSAiMDAiOgogICAgICAgICAgICByZXR1cm4gIkJBQ0siCiAgICAgICAgaWYgbm90IGNob2ljZS5pc2RpZ2l0KCk6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiSW5wdXQgdGlkYWsgdmFsaWQsIG1hc3Vra2FuIG5vbW9yIHBha2V0LiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgc2VsZWN0ZWQgPSBuZXh0KChwIGZvciBwIGluIHBhY2thZ2VzIGlmIHBbIm51bWJlciJdID09IGludChjaG9pY2UpKSwgTm9uZSkKICAgICAgICBpZiBub3Qgc2VsZWN0ZWQ6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiTm9tb3IgcGFrZXQgdGlkYWsgZGl0ZW11a2FuLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgaWYgcmV0dXJuX3BhY2thZ2VfZGV0YWlsOgogICAgICAgICAgICB2YXJpYW50X2NvZGUgPSBuZXh0KCh2WyJwYWNrYWdlX3ZhcmlhbnRfY29kZSJdIGZvciB2IGluIGRhdGFbInBhY2thZ2VfdmFyaWFudHMiXSBpZiB2WyJuYW1lIl0gPT0gc2VsZWN0ZWRbInZhcmlhbnRfbmFtZSJdKSwgTm9uZSkKICAgICAgICAgICAgZGV0YWlsID0gZ2V0X3BhY2thZ2VfZGV0YWlscygKICAgICAgICAgICAgICAgIGFwaV9rZXksIHRva2VucywKICAgICAgICAgICAgICAgIGZhbWlseV9jb2RlLAogICAgICAgICAgICAgICAgdmFyaWFudF9jb2RlLAogICAgICAgICAgICAgICAgc2VsZWN0ZWRbIm9wdGlvbl9vcmRlciJdLAogICAgICAgICAgICAgICAgaXNfZW50ZXJwcmlzZQogICAgICAgICAgICApCiAgICAgICAgICAgIGlmIGRldGFpbDoKICAgICAgICAgICAgICAgIGRpc3BsYXlfbmFtZSA9IGYie2RhdGFbJ3BhY2thZ2VfZmFtaWx5J11bJ25hbWUnXX0gLSB7c2VsZWN0ZWRbJ3ZhcmlhbnRfbmFtZSddfSAtIHtzZWxlY3RlZFsnb3B0aW9uX25hbWUnXX0iCiAgICAgICAgICAgICAgICByZXR1cm4gZGV0YWlsLCBkaXNwbGF5X25hbWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiR2FnYWwgbWVuZ2FtYmlsIGRldGFpbCBwYWtldC4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXN1bHQgPSBzaG93X3BhY2thZ2VfZGV0YWlscygKICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICB0b2tlbnMsCiAgICAgICAgICAgICAgICBzZWxlY3RlZFsiY29kZSJdLAogICAgICAgICAgICAgICAgaXNfZW50ZXJwcmlzZSwKICAgICAgICAgICAgICAgIG9wdGlvbl9vcmRlcj1zZWxlY3RlZFsib3B0aW9uX29yZGVyIl0KICAgICAgICAgICAgKQogICAgICAgICAgICBpZiByZXN1bHQgPT0gIk1BSU4iOgogICAgICAgICAgICAgICAgcmV0dXJuICJNQUlOIgogICAgICAgICAgICBlbGlmIHJlc3VsdCA9PSAiQkFDSyI6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbGlmIHJlc3VsdCBpcyBUcnVlOgogICAgICAgICAgICAgICAgY29udGludWUKCgpkZWYgZmV0Y2hfbXlfcGFja2FnZXMoKToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgdG9rZW5zID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdG9rZW5zKCkKICAgIGlmIG5vdCB0b2tlbnM6CiAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJUb2tlbiB1c2VyIGFrdGlmIHRpZGFrIGRpdGVtdWthbi4iKQogICAgICAgIHBhdXNlKCkKICAgICAgICByZXR1cm4gIkJBQ0siCgogICAgaWRfdG9rZW4gPSB0b2tlbnMuZ2V0KCJpZF90b2tlbiIpCiAgICBwYXRoID0gImFwaS92OC9wYWNrYWdlcy9xdW90YS1kZXRhaWxzIgogICAgcGF5bG9hZCA9IHsKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAiZmFtaWx5X21lbWJlcl9pZCI6ICIiCiAgICB9CgogICAgd2l0aCBsaXZlX2xvYWRpbmcoIk1lbmdhbWJpbCBwYWtldCBha3RpZi4uLiIsIHRoZW1lKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCgogICAgaWYgcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiR2FnYWwgbWVuZ2FtYmlsIHBha2V0IGFrdGlmLiIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiAiQkFDSyIKCiAgICBxdW90YXMgPSByZXNbImRhdGEiXVsicXVvdGFzIl0KICAgIGlmIG5vdCBxdW90YXM6CiAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsICJUaWRhayBhZGEgcGFrZXQgYWt0aWYgZGl0ZW11a2FuLiIpCiAgICAgICAgcGF1c2UoKQogICAgICAgIHJldHVybiAiQkFDSyIKCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZW5zdXJlX2dpdCgpCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgQWxpZ24uY2VudGVyKCJQYWtldCBBa3RpZiIsIHZlcnRpY2FsPSJtaWRkbGUiKSwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQogICAgICAgIHNpbXBsZV9udW1iZXIoKQoKICAgICAgICBteV9wYWNrYWdlcyA9IFtdCiAgICAgICAgZm9yIG51bSwgcXVvdGEgaW4gZW51bWVyYXRlKHF1b3Rhcywgc3RhcnQ9MSk6CiAgICAgICAgICAgIHF1b3RhX2NvZGUgPSBxdW90YVsicXVvdGFfY29kZSJdCiAgICAgICAgICAgIGdyb3VwX2NvZGUgPSBxdW90YVsiZ3JvdXBfY29kZSJdCiAgICAgICAgICAgIHF1b3RhX25hbWUgPSBxdW90YVsibmFtZSJdCiAgICAgICAgICAgIGZhbWlseV9jb2RlID0gIk4vQSIKCiAgICAgICAgICAgIHByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGUgPSBxdW90YS5nZXQoInByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGUiLCAiIikKICAgICAgICAgICAgcHJvZHVjdF9kb21haW4gPSBxdW90YS5nZXQoInByb2R1Y3RfZG9tYWluIiwgIiIpCgogICAgICAgICAgICBiZW5lZml0cyA9IHF1b3RhLmdldCgiYmVuZWZpdHMiLCBbXSkKICAgICAgICAgICAgYmVuZWZpdF90YWJsZSA9IE5vbmUKICAgICAgICAgICAgaWYgYmVuZWZpdHM6CiAgICAgICAgICAgICAgICBiZW5lZml0X3RhYmxlID0gVGFibGUoYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgICAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfY29sdW1uKCJOYW1hIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfY29sdW1uKCJKZW5pcyIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICAgICAgICAgIGJlbmVmaXRfdGFibGUuYWRkX2NvbHVtbigiS3VvdGEiLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0sIGp1c3RpZnk9InJpZ2h0IikKCiAgICAgICAgICAgICAgICBmb3IgYiBpbiBiZW5lZml0czoKICAgICAgICAgICAgICAgICAgICBuYW1lID0gYi5nZXQoIm5hbWUiLCAiIikKICAgICAgICAgICAgICAgICAgICBkdCA9IGIuZ2V0KCJkYXRhX3R5cGUiLCAiTi9BIikKICAgICAgICAgICAgICAgICAgICByID0gYi5nZXQoInJlbWFpbmluZyIsIDApCiAgICAgICAgICAgICAgICAgICAgdCA9IGIuZ2V0KCJ0b3RhbCIsIDApCgogICAgICAgICAgICAgICAgICAgIGlmIGR0ID09ICJEQVRBIjoKICAgICAgICAgICAgICAgICAgICAgICAgcl9zdHIgPSBmb3JtYXRfcXVvdGFfYnl0ZShyKQogICAgICAgICAgICAgICAgICAgICAgICB0X3N0ciA9IGZvcm1hdF9xdW90YV9ieXRlKHQpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBkdCA9PSAiVk9JQ0UiOgogICAgICAgICAgICAgICAgICAgICAgICByX3N0ciA9IGYie3IgLyA2MDouMmZ9IG1lbml0IgogICAgICAgICAgICAgICAgICAgICAgICB0X3N0ciA9IGYie3QgLyA2MDouMmZ9IG1lbml0IgogICAgICAgICAgICAgICAgICAgIGVsaWYgZHQgPT0gIlRFWFQiOgogICAgICAgICAgICAgICAgICAgICAgICByX3N0ciA9IGYie3J9IFNNUyIKICAgICAgICAgICAgICAgICAgICAgICAgdF9zdHIgPSBmInt0fSBTTVMiCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcl9zdHIgPSBzdHIocikKICAgICAgICAgICAgICAgICAgICAgICAgdF9zdHIgPSBzdHIodCkKCiAgICAgICAgICAgICAgICAgICAgYmVuZWZpdF90YWJsZS5hZGRfcm93KG5hbWUsIGR0LCBmIntyX3N0cn0gLyB7dF9zdHJ9IikKCiAgICAgICAgICAgIHBhY2thZ2VfZGV0YWlscyA9IGdldF9wYWNrYWdlKGFwaV9rZXksIHRva2VucywgcXVvdGFfY29kZSkKICAgICAgICAgICAgaWYgcGFja2FnZV9kZXRhaWxzOgogICAgICAgICAgICAgICAgZmFtaWx5X2NvZGUgPSBwYWNrYWdlX2RldGFpbHNbInBhY2thZ2VfZmFtaWx5Il1bInBhY2thZ2VfZmFtaWx5X2NvZGUiXQoKICAgICAgICAgICAgcGFja2FnZV90ZXh0ID0gVGV4dCgpCiAgICAgICAgICAgIHBhY2thZ2VfdGV4dC5hcHBlbmQoZiJQYWtldCB7bnVtfVxuIiwgc3R5bGU9ImJvbGQiKQogICAgICAgICAgICBwYWNrYWdlX3RleHQuYXBwZW5kKCJOYW1hOiAiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSkKICAgICAgICAgICAgcGFja2FnZV90ZXh0LmFwcGVuZChmIntxdW90YV9uYW1lfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfc3ViIl0pCiAgICAgICAgICAgIHBhY2thZ2VfdGV4dC5hcHBlbmQoIlF1b3RhIENvZGU6ICIsIHN0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdKQogICAgICAgICAgICBwYWNrYWdlX3RleHQuYXBwZW5kKGYie3F1b3RhX2NvZGV9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgIHBhY2thZ2VfdGV4dC5hcHBlbmQoIkZhbWlseSBDb2RlOiAiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSkKICAgICAgICAgICAgcGFja2FnZV90ZXh0LmFwcGVuZChmIntmYW1pbHlfY29kZX1cbiIsIHN0eWxlPXRoZW1lWyJib3JkZXJfd2FybmluZyJdKQogICAgICAgICAgICBwYWNrYWdlX3RleHQuYXBwZW5kKCJHcm91cCBDb2RlOiAiLCBzdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSkKICAgICAgICAgICAgcGFja2FnZV90ZXh0LmFwcGVuZChmIntncm91cF9jb2RlfVxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQoKICAgICAgICAgICAgcGFuZWxfY29udGVudCA9IFtwYWNrYWdlX3RleHRdCiAgICAgICAgICAgIGlmIGJlbmVmaXRfdGFibGU6CiAgICAgICAgICAgICAgICBwYW5lbF9jb250ZW50LmFwcGVuZChiZW5lZml0X3RhYmxlKQoKICAgICAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgICAgIEdyb3VwKCpwYW5lbF9jb250ZW50KSwKICAgICAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICAgICAgICAgIHBhZGRpbmc9KDAsIDEpLAogICAgICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICAgICAgKSkKCiAgICAgICAgICAgIG15X3BhY2thZ2VzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAibnVtYmVyIjogbnVtLAogICAgICAgICAgICAgICAgIm5hbWUiOiBxdW90YV9uYW1lLAogICAgICAgICAgICAgICAgInF1b3RhX2NvZGUiOiBxdW90YV9jb2RlLAogICAgICAgICAgICAgICAgInByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGUiOiBwcm9kdWN0X3N1YnNjcmlwdGlvbl90eXBlLAogICAgICAgICAgICAgICAgInByb2R1Y3RfZG9tYWluIjogcHJvZHVjdF9kb21haW4sCiAgICAgICAgICAgIH0pCgogICAgICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NikKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1LZW1iYWxpIGtlIG1lbnUgdXRhbWFbL10iKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KG5hdl9yYW5nZSgiIiwgbGVuKG15X3BhY2thZ2VzKSksICJMaWhhdCBkZXRhaWwgcGFrZXQiKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KG5hdl9yYW5nZSgiZGVsIiwgbGVuKG15X3BhY2thZ2VzKSksIGYiW3t0aGVtZVsndGV4dF9lcnInXX1dSGFwdXMgcGFrZXRbL10iKQoKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICBuYXZfdGFibGUsCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwKICAgICAgICAgICAgcGFkZGluZz0oMCwgMSksCiAgICAgICAgICAgIGV4cGFuZD1UcnVlCiAgICAgICAgKSkKCiAgICAgICAgY2hvaWNlID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XVBpbGloYW46Wy97dGhlbWVbJ3RleHRfc3ViJ119XSAiKS5zdHJpcCgpCiAgICAgICAgaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgaWYgY2hvaWNlLmlzZGlnaXQoKToKICAgICAgICAgICAgbm9tb3IgPSBpbnQoY2hvaWNlKQogICAgICAgICAgICBzZWxlY3RlZCA9IG5leHQoKHAgZm9yIHAgaW4gbXlfcGFja2FnZXMgaWYgcFsibnVtYmVyIl0gPT0gbm9tb3IpLCBOb25lKQogICAgICAgICAgICBpZiBub3Qgc2VsZWN0ZWQ6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIk5vbW9yIHBha2V0IHRpZGFrIGRpdGVtdWthbi4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBzZWxlY3RlZFsicXVvdGFfY29kZSJdLCBGYWxzZSkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgZWxpZiBjaG9pY2Uuc3RhcnRzd2l0aCgiZGVsICIpOgogICAgICAgICAgICBwYXJ0cyA9IGNob2ljZS5zcGxpdCgiICIpCiAgICAgICAgICAgIGlmIGxlbihwYXJ0cykgIT0gMiBvciBub3QgcGFydHNbMV0uaXNkaWdpdCgpOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJGb3JtYXQgaGFwdXMgcGFrZXQgdGlkYWsgdmFsaWQuIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBub21vciA9IGludChwYXJ0c1sxXSkKICAgICAgICAgICAgc2VsZWN0ZWQgPSBuZXh0KChwIGZvciBwIGluIG15X3BhY2thZ2VzIGlmIHBbIm51bWJlciJdID09IG5vbW9yKSwgTm9uZSkKICAgICAgICAgICAgaWYgbm90IHNlbGVjdGVkOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJOb21vciBwYWtldCB0aWRhayBkaXRlbXVrYW4uIikKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBjb25maXJtID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XVlha2luIGluZ2luIHVuc3Vic2NyaWJlIHBha2V0IHtub21vcn0gLSB7c2VsZWN0ZWRbJ25hbWUnXX0/ICh5L24pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKS5sb3dlcigpCiAgICAgICAgICAgIGlmIGNvbmZpcm0gPT0gInkiOgogICAgICAgICAgICAgICAgd2l0aCBsaXZlX2xvYWRpbmcoIk1lbmdoYXB1cyBwYWtldC4uLiIsIHRoZW1lKToKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gdW5zdWJzY3JpYmUoCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucywKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRbInF1b3RhX2NvZGUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRbInByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRbInByb2R1Y3RfZG9tYWluIl0KICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiQmVyaGFzaWwiIGlmIHN1Y2Nlc3MgZWxzZSAiS2VzYWxhaGFuIiwgIlVuc3Vic2NyaWJlIGJlcmhhc2lsLiIgaWYgc3VjY2VzcyBlbHNlICJHYWdhbCB1bnN1YnNjcmliZS4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsICJVbnN1YnNjcmliZSBkaWJhdGFsa2FuLiIpCiAgICAgICAgICAgIHBhdXNlKCkK').decode())
