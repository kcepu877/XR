#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCgpmcm9tIGFwcDIuY29uZmlnLmltcG9ydHMgaW1wb3J0ICoKZnJvbSBhcHAyLm1lbnVzLnV0aWwgaW1wb3J0IGNsZWFyX3NjcmVlbiwgcGF1c2UsIHByaW50X3BhbmVsLCBwcmludF9lcnJvcgpmcm9tIGFwcDIubWVudXMucGFja2FnZSBpbXBvcnQgc2hvd19wYWNrYWdlX2RldGFpbHMKZnJvbSBhcHAyLm1lbnVzLnV0aWwgaW1wb3J0IGdldF9ydXBpYWgKCmNvbnNvbGUgPSBDb25zb2xlKCkKCgpkZWYgZmV0Y2hfc3BlY2lhbF9mb3JfeW91KGFwaV9rZXk6IHN0ciwgaWRfdG9rZW46IHN0ciwgYWNjZXNzX3Rva2VuOiBzdHIsIGJhbGFuY2U6IGludCA9IDApIC0+IGxpc3Q6CiAgICAiIiJGZXRjaCBzcGVjaWFsIHBhY2thZ2VzIGF2YWlsYWJsZSBmb3IgdGhlIHVzZXIuIiIiCiAgICB0cnk6CiAgICAgICAgc2VnX2RhdGEgPSBkYXNoX3NlZ21lbnRzKGFwaV9rZXksIGlkX3Rva2VuLCBhY2Nlc3NfdG9rZW4sIGJhbGFuY2UpCiAgICAgICAgaWYgbm90IHNlZ19kYXRhOgogICAgICAgICAgICByZXR1cm4gW10KCiAgICAgICAgcGFja2FnZXMgPSBzZWdfZGF0YS5nZXQoInNwZWNpYWxfcGFja2FnZXMiLCBbXSkKICAgICAgICBzcGVjaWFsX3BhY2thZ2VzID0gW10KCiAgICAgICAgZm9yIHBrZyBpbiBwYWNrYWdlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IHBrZy5nZXQoIm5hbWUiLCAiVW5rbm93biBQYWNrYWdlIikKICAgICAgICAgICAgICAgIGtvZGVfcGFrZXQgPSBwa2cuZ2V0KCJrb2RlX3Bha2V0IiwgIi0iKQoKICAgICAgICAgICAgICAgIGlmIG5vdCBrb2RlX3Bha2V0IG9yIGtvZGVfcGFrZXQgPT0gIi0iOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgb3JpZ2luYWxfcHJpY2UgPSBpbnQocGtnLmdldCgib3JpZ2luYWxfcHJpY2UiLCAwKSkKICAgICAgICAgICAgICAgIGRpc2tvbl9wcmljZSA9IGludChwa2cuZ2V0KCJkaXNrb25fcHJpY2UiLCBvcmlnaW5hbF9wcmljZSkpCgogICAgICAgICAgICAgICAgZGlza29uX3BlcmNlbnQgPSAwCiAgICAgICAgICAgICAgICBpZiBvcmlnaW5hbF9wcmljZSA+IDAgYW5kIGRpc2tvbl9wcmljZSA8IG9yaWdpbmFsX3ByaWNlOgogICAgICAgICAgICAgICAgICAgIGRpc2tvbl9wZXJjZW50ID0gaW50KHJvdW5kKChvcmlnaW5hbF9wcmljZSAtIGRpc2tvbl9wcmljZSkgLyBvcmlnaW5hbF9wcmljZSAqIDEwMCkpCgogICAgICAgICAgICAgICAgc3BlY2lhbF9wYWNrYWdlcy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogbmFtZSwKICAgICAgICAgICAgICAgICAgICAia29kZV9wYWtldCI6IGtvZGVfcGFrZXQsCiAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsX3ByaWNlIjogb3JpZ2luYWxfcHJpY2UsCiAgICAgICAgICAgICAgICAgICAgImRpc2tvbl9wcmljZSI6IGRpc2tvbl9wcmljZSwKICAgICAgICAgICAgICAgICAgICAiZGlza29uX3BlcmNlbnQiOiBkaXNrb25fcGVyY2VudCwKICAgICAgICAgICAgICAgICAgICAia3VvdGFfZ2IiOiBwa2cuZ2V0KCJrdW90YV9nYiIsIDApLAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsIGYiR2FnYWwgbWVtcHJvc2VzIHBha2V0OiB7ZX0iKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgc3BlY2lhbF9wYWNrYWdlcy5zb3J0KGtleT1sYW1iZGEgeDogeFsiZGlza29uX3BlcmNlbnQiXSwgcmV2ZXJzZT1UcnVlKQogICAgICAgIHJldHVybiBzcGVjaWFsX3BhY2thZ2VzCgogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCBmIkdhZ2FsIG1lbmdhbWJpbCBkYXRhIFNwZWNpYWwgRm9yIFlvdToge2V9IikKICAgICAgICByZXR1cm4gW10KCgpkZWYgc2hvd19zcGVjaWFsX2Zvcl95b3VfbWVudSh0b2tlbnM6IGRpY3QpOgogICAgIiIiRGlzcGxheSB0aGUgU3BlY2lhbCBGb3IgWW91IG1lbnUgYW5kIGFsbG93IHVzZXIgdG8gc2VsZWN0IHBhY2thZ2VzLiIiIgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQoKICAgIGFwaV9rZXkgPSBBdXRoSW5zdGFuY2UuYXBpX2tleQogICAgaWRfdG9rZW4gPSB0b2tlbnMuZ2V0KCJpZF90b2tlbiIsICIiKQogICAgYWNjZXNzX3Rva2VuID0gdG9rZW5zLmdldCgiYWNjZXNzX3Rva2VuIiwgIiIpCiAgICBiYWxhbmNlID0gMAoKICAgIHNwZWNpYWxfcGFja2FnZXMgPSBmZXRjaF9zcGVjaWFsX2Zvcl95b3UoYXBpX2tleSwgaWRfdG9rZW4sIGFjY2Vzc190b2tlbiwgYmFsYW5jZSkKCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZW5zdXJlX2dpdCgpCgogICAgICAgIGlmIG5vdCBzcGVjaWFsX3BhY2thZ2VzOgogICAgICAgICAgICBwcmludF9wYW5lbCgiSW5mb3JtYXNpIiwgIlRpZGFrIGFkYSBwYWtldCBzcGVzaWFsIHRlcnNlZGlhLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGluZm9fdGV4dCA9IEFsaWduLmNlbnRlcigKICAgICAgICAgICAgZiJbe3RoZW1lWyd0ZXh0X2JvZHknXX1dUGFrZXQgU3BlY2lhbCBGb3IgWW91Wy97dGhlbWVbJ3RleHRfYm9keSddfV0iCiAgICAgICAgKQogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIGluZm9fdGV4dCwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICAgICAgZXhwYW5kPVRydWUKICAgICAgICApKQoKICAgICAgICB0YWJsZSA9IFRhYmxlKGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJObyIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTQpCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTmFtYSBQYWtldCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJEaXNrb24iLCBqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X21vbmV5Il0pCiAgICAgICAgdGFibGUuYWRkX2NvbHVtbigiTm9ybWFsIiwganVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9lcnIiXSkKICAgICAgICB0YWJsZS5hZGRfY29sdW1uKCJIYXJnYSIsIGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfbW9uZXkiXSkKCiAgICAgICAgZm9yIGlkeCwgcGtnIGluIGVudW1lcmF0ZShzcGVjaWFsX3BhY2thZ2VzLCAxKToKICAgICAgICAgICAgb3JpZ2luYWxfcHJpY2UgPSBnZXRfcnVwaWFoKHBrZy5nZXQoIm9yaWdpbmFsX3ByaWNlIiwgMCkpCiAgICAgICAgICAgIGRpc2tvbl9wcmljZSA9IGdldF9ydXBpYWgocGtnLmdldCgiZGlza29uX3ByaWNlIiwgMCkpCgogICAgICAgICAgICB0YWJsZS5hZGRfcm93KAogICAgICAgICAgICAgICAgc3RyKGlkeCksCiAgICAgICAgICAgICAgICBwa2cuZ2V0KCduYW1lJywgJy0nKSwKICAgICAgICAgICAgICAgIGYie3BrZy5nZXQoJ2Rpc2tvbl9wZXJjZW50JywgMCl9JSIsCiAgICAgICAgICAgICAgICBmIlt7dGhlbWVbJ3RleHRfZXJyJ119XVtzdHJpa2Vde29yaWdpbmFsX3ByaWNlfVsvc3RyaWtlXVsve3RoZW1lWyd0ZXh0X2VyciddfV0iLAogICAgICAgICAgICAgICAgZiJbe3RoZW1lWyd0ZXh0X21vbmV5J119XXtkaXNrb25fcHJpY2V9Wy97dGhlbWVbJ3RleHRfbW9uZXknXX1dIgogICAgICAgICAgICApCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwodGFibGUsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgcGFkZGluZz0oMCwgMCksIGV4cGFuZD1UcnVlKSkKCiAgICAgICAgbmF2X3RhYmxlID0gVGFibGUoc2hvd19oZWFkZXI9RmFsc2UsIGJveD1NSU5JTUFMX0RPVUJMRV9IRUFELCBleHBhbmQ9VHJ1ZSkKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihqdXN0aWZ5PSJyaWdodCIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2tleSJdLCB3aWR0aD02KQogICAgICAgIG5hdl90YWJsZS5hZGRfY29sdW1uKHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiMDAiLCBmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUtlbWJhbGkga2UgbWVudSBzZWJlbHVtbnlhWy9dIikKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbCgKICAgICAgICAgICAgbmF2X3RhYmxlLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9wcmltYXJ5Il0sCiAgICAgICAgICAgIHBhZGRpbmc9KDAsIDEpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCgogICAgICAgIGNob2ljZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3RpdGxlJ119XVBpbGloIHBha2V0IChub21vcik6Wy97dGhlbWVbJ3RleHRfdGl0bGUnXX1dICIpLnN0cmlwKCkKCiAgICAgICAgaWYgY2hvaWNlID09ICIwMCI6CiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgaWYgbm90IGNob2ljZS5pc2RpZ2l0KCk6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiSW5wdXQgdGlkYWsgdmFsaWQsIG1hc3Vra2FuIGFuZ2thLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgY2hvaWNlX2lkeCA9IGludChjaG9pY2UpIC0gMQogICAgICAgIGlmIDAgPD0gY2hvaWNlX2lkeCA8IGxlbihzcGVjaWFsX3BhY2thZ2VzKToKICAgICAgICAgICAgc2VsZWN0ZWRfcGtnID0gc3BlY2lhbF9wYWNrYWdlc1tjaG9pY2VfaWR4XQogICAgICAgICAgICBhcGlfa2V5ID0gQXV0aEluc3RhbmNlLmFwaV9rZXkKICAgICAgICAgICAgcmVzdWx0ID0gc2hvd19wYWNrYWdlX2RldGFpbHMoYXBpX2tleSwgdG9rZW5zLCBzZWxlY3RlZF9wa2dbImtvZGVfcGFrZXQiXSwgaXNfZW50ZXJwcmlzZT1GYWxzZSkKCiAgICAgICAgICAgIGlmIHJlc3VsdCA9PSAiTUFJTiI6CiAgICAgICAgICAgICAgICByZXR1cm4gIk1BSU4iCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJOb21vciBwYWtldCB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICBwYXVzZSgpCg==').decode())
