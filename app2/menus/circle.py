#!/usr/bin/env python3
import base64
exec(base64.b64decode('ZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IGpzb24KZnJvbSBhcHAyLmNvbmZpZy5pbXBvcnRzIGltcG9ydCAqCmZyb20gYXBwMi5tZW51cy5wYWNrYWdlIGltcG9ydCBnZXRfcGFja2FnZXNfYnlfZmFtaWx5LCBzaG93X3BhY2thZ2VfZGV0YWlscwpmcm9tIGFwcDIubWVudXMudXRpbCBpbXBvcnQgcGF1c2UsIGNsZWFyX3NjcmVlbiwgZm9ybWF0X3F1b3RhX2J5dGUsIGxpdmVfbG9hZGluZywgZ2V0X3J1cGlhaCAscHJpbnRfcGFuZWwKZnJvbSBhcHAyLmNsaWVudC5jaXJjbGUgaW1wb3J0ICgKICAgIGdldF9ncm91cF9kYXRhLAogICAgZ2V0X2dyb3VwX21lbWJlcnMsCiAgICBjcmVhdGVfY2lyY2xlLAogICAgdmFsaWRhdGVfY2lyY2xlX21lbWJlciwKICAgIGludml0ZV9jaXJjbGVfbWVtYmVyLAogICAgcmVtb3ZlX2NpcmNsZV9tZW1iZXIsCiAgICBhY2NlcHRfY2lyY2xlX2ludml0YXRpb24sCiAgICBzcGVuZGluZ190cmFja2VyLAogICAgZ2V0X2JvbnVzX2RhdGEsCikKZnJvbSBhcHAyLmNsaWVudC5lbmNyeXB0IGltcG9ydCBkZWNyeXB0X2NpcmNsZV9tc2lzZG4KCmNvbnNvbGUgPSBDb25zb2xlKCkKCgpkZWYgc2hvd19jaXJjbGVfY3JlYXRpb24oYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QpOgogICAgY2xlYXJfc2NyZWVuKCkKICAgIGVuc3VyZV9naXQoKQogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQoKICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgQWxpZ24uY2VudGVyKCJCdWF0IENpcmNsZSBCYXJ1IiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwKICAgICAgICBwYWRkaW5nPSgxLCAyKSwKICAgICAgICBleHBhbmQ9VHJ1ZQogICAgKSkKCiAgICBwYXJlbnRfbmFtZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2thbiBuYW1hIChQYXJlbnQpOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgZ3JvdXBfbmFtZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1NYXN1a2thbiBuYW1hIENpcmNsZTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgIG1lbWJlcl9tc2lzZG4gPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTm9tb3IgbWVtYmVyIHBlcnRhbWEgKGNvbnRvaCA2MjgxMjMuLi4pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgbWVtYmVyX25hbWUgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTmFtYSBtZW1iZXIgcGVydGFtYTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKCiAgICB3aXRoIGxpdmVfbG9hZGluZygiTWVtYnVhdCBDaXJjbGUuLi4iLCB0aGVtZSk6CiAgICAgICAgY3JlYXRlX3JlcyA9IGNyZWF0ZV9jaXJjbGUoYXBpX2tleSwgdG9rZW5zLCBwYXJlbnRfbmFtZSwgZ3JvdXBfbmFtZSwgbWVtYmVyX21zaXNkbiwgbWVtYmVyX25hbWUpCgogICAgcmVzX3RleHQgPSBUZXh0KCkKICAgIHJlc190ZXh0LmFwcGVuZCgiUmVzcG9uIFNlcnZlcjpcbiIsIHN0eWxlPSJib2xkIikKICAgIHJlc190ZXh0LmFwcGVuZChqc29uLmR1bXBzKGNyZWF0ZV9yZXMsIGluZGVudD0yKSwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgY29uc29sZS5wcmludChQYW5lbChyZXNfdGV4dCwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLCBleHBhbmQ9VHJ1ZSkpCiAgICBwYXVzZSgpCgoKZGVmIHNob3dfYm9udXNfbGlzdChhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgcGFyZW50X3N1YnNfaWQ6IHN0ciwgZmFtaWx5X2lkOiBzdHIpOgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQogICAgaW5fY2lyY2xlX2JvbnVzX21lbnUgPSBUcnVlCgogICAgd2hpbGUgaW5fY2lyY2xlX2JvbnVzX21lbnU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKCiAgICAgICAgYm9udXNfZGF0YSA9IGdldF9ib251c19kYXRhKGFwaV9rZXksIHRva2VucywgcGFyZW50X3N1YnNfaWQsIGZhbWlseV9pZCkKCiAgICAgICAgaWYgYm9udXNfZGF0YS5nZXQoInN0YXR1cyIpICE9ICJTVUNDRVNTIjoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJHYWdhbCBtZW5nYW1iaWwgZGF0YSBib251cy4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBib251c19saXN0ID0gYm9udXNfZGF0YS5nZXQoImRhdGEiLCB7fSkuZ2V0KCJib251c2VzIiwgW10pCiAgICAgICAgaWYgbm90IGJvbnVzX2xpc3Q6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiVGlkYWsgYWRhIGJvbnVzIHRlcnNlZGlhLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoCiAgICAgICAgICAgIEFsaWduLmNlbnRlcigiQm9udXMgQ2lyY2xlIiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0sCiAgICAgICAgICAgIHBhZGRpbmc9KDEsIDEpLAogICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICkpCgogICAgICAgIGZvciBpZHgsIGJvbnVzIGluIGVudW1lcmF0ZShib251c19saXN0LCBzdGFydD0xKToKICAgICAgICAgICAgYm9udXNfbmFtZSA9IGJvbnVzLmdldCgibmFtZSIsICJOL0EiKQogICAgICAgICAgICBib251c190eXBlID0gYm9udXMuZ2V0KCJib251c190eXBlIiwgIk4vQSIpCiAgICAgICAgICAgIGFjdGlvbl90eXBlID0gYm9udXMuZ2V0KCJhY3Rpb25fdHlwZSIsICJOL0EiKQogICAgICAgICAgICBhY3Rpb25fcGFyYW0gPSBib251cy5nZXQoImFjdGlvbl9wYXJhbSIsICJOL0EiKQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGFjdGlvbl9wYXJhbSwgKGludCwgZmxvYXQpKToKICAgICAgICAgICAgICAgIGFjdGlvbl9wYXJhbSA9IGdldF9ydXBpYWgoYWN0aW9uX3BhcmFtKQoKICAgICAgICAgICAgYm9udXNfdGV4dCA9IFRleHQoKQogICAgICAgICAgICBib251c190ZXh0LmFwcGVuZChmIntpZHh9LiB7Ym9udXNfbmFtZX1cbiIsIHN0eWxlPSJib2xkIikKICAgICAgICAgICAgYm9udXNfdGV4dC5hcHBlbmQoZiJUaXBlOiB7Ym9udXNfdHlwZX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKICAgICAgICAgICAgYm9udXNfdGV4dC5hcHBlbmQoZiJBa3NpOiB7YWN0aW9uX3R5cGV9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgIGJvbnVzX3RleHQuYXBwZW5kKGYiUGFyYW06IHthY3Rpb25fcGFyYW19XG4iLCBzdHlsZT10aGVtZVsidGV4dF9zdWIiXSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoYm9udXNfdGV4dCwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfcHJpbWFyeSJdLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIG5hdl90YWJsZSA9IFRhYmxlKHNob3dfaGVhZGVyPUZhbHNlLCBib3g9TUlOSU1BTF9ET1VCTEVfSEVBRCwgZXhwYW5kPVRydWUpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oanVzdGlmeT0icmlnaHQiLCBzdHlsZT10aGVtZVsidGV4dF9rZXkiXSwgd2lkdGg9NCkKICAgICAgICBuYXZfdGFibGUuYWRkX2NvbHVtbihzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgbmF2X3RhYmxlLmFkZF9yb3coIjAwIiwgZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1LZW1iYWxpWy9dIikKICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKG5hdl90YWJsZSwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLCBleHBhbmQ9VHJ1ZSkpCgogICAgICAgIGNob2ljZSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1QaWxpaCBib251czpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgaW5fY2lyY2xlX2JvbnVzX21lbnUgPSBGYWxzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIG5vdCBjaG9pY2UuaXNkaWdpdCgpOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJOb21vciBib251cyB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGJvbnVzX251bWJlciA9IGludChjaG9pY2UpCiAgICAgICAgICAgIGlmIGJvbnVzX251bWJlciA8IDEgb3IgYm9udXNfbnVtYmVyID4gbGVuKGJvbnVzX2xpc3QpOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJOb21vciBib251cyB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIHNlbGVjdGVkX2JvbnVzID0gYm9udXNfbGlzdFtib251c19udW1iZXIgLSAxXQogICAgICAgICAgICBhY3Rpb25fdHlwZSA9IHNlbGVjdGVkX2JvbnVzLmdldCgiYWN0aW9uX3R5cGUiLCAiTi9BIikKICAgICAgICAgICAgYWN0aW9uX3BhcmFtID0gc2VsZWN0ZWRfYm9udXMuZ2V0KCJhY3Rpb25fcGFyYW0iLCAiTi9BIikKCiAgICAgICAgICAgIGlmIGFjdGlvbl90eXBlID09ICJQTFAiOgogICAgICAgICAgICAgICAgZ2V0X3BhY2thZ2VzX2J5X2ZhbWlseShhY3Rpb25fcGFyYW0pCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIGVsaWYgYWN0aW9uX3R5cGUgPT0gIlBEUCI6CiAgICAgICAgICAgICAgICBzaG93X3BhY2thZ2VfZGV0YWlscyhhcGlfa2V5LCB0b2tlbnMsIGFjdGlvbl9wYXJhbSwgRmFsc2UpCiAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBkZXRhaWxfdGV4dCA9IFRleHQoKQogICAgICAgICAgICAgICAgZGV0YWlsX3RleHQuYXBwZW5kKCJCZWx1bSBhZGEgYWtzaSB1bnR1ayB0aXBlIGluaVxuIiwgc3R5bGU9ImJvbGQiKQogICAgICAgICAgICAgICAgZGV0YWlsX3RleHQuYXBwZW5kKGYiQWtzaToge2FjdGlvbl90eXBlfVxuUGFyYW06IHthY3Rpb25fcGFyYW19Iiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICAgICAgY29uc29sZS5wcmludChQYW5lbChkZXRhaWxfdGV4dCwgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLCBleHBhbmQ9VHJ1ZSkpCiAgICAgICAgICAgICAgICBwYXVzZSgpCgoKZGVmIHNob3dfY2lyY2xlX2luZm8oYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QpOgogICAgdGhlbWUgPSBnZXRfdGhlbWUoKQogICAgaW5fY2lyY2xlX21lbnUgPSBUcnVlCiAgICB1c2VyOiBkaWN0ID0gQXV0aEluc3RhbmNlLmdldF9hY3RpdmVfdXNlcigpCiAgICBteV9tc2lzZG4gPSB1c2VyLmdldCgibnVtYmVyIiwgIiIpCgogICAgd2hpbGUgaW5fY2lyY2xlX21lbnU6CiAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICBlbnN1cmVfZ2l0KCkKCiAgICAgICAgZ3JvdXBfcmVzID0gZ2V0X2dyb3VwX2RhdGEoYXBpX2tleSwgdG9rZW5zKQoKICAgICAgICBpZiBncm91cF9yZXMuZ2V0KCJzdGF0dXMiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiR2FnYWwgbWVuZ2FtYmlsIGRhdGEgQ2lyY2xlLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBncm91cF9kYXRhID0gZ3JvdXBfcmVzLmdldCgiZGF0YSIsIHt9KQogICAgICAgIGdyb3VwX2lkID0gZ3JvdXBfZGF0YS5nZXQoImdyb3VwX2lkIiwgIiIpCgogICAgICAgIGlmIGdyb3VwX2lkID09ICIiOgogICAgICAgICAgICBjb25zb2xlLnByaW50KFBhbmVsKAogICAgICAgICAgICAgICAgQWxpZ24uY2VudGVyKCJBbmRhIGJlbHVtIGJlcmdhYnVuZyBkZW5nYW4gQ2lyY2xlIG1hbmFwdW4uIiwgdmVydGljYWw9Im1pZGRsZSIpLAogICAgICAgICAgICAgICAgYm9yZGVyX3N0eWxlPXRoZW1lWyJib3JkZXJfaW5mbyJdLAogICAgICAgICAgICAgICAgcGFkZGluZz0oMSwgMiksCiAgICAgICAgICAgICAgICBleHBhbmQ9VHJ1ZQogICAgICAgICAgICApKQogICAgICAgICAgICBjcmVhdGVfbmV3ID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XUJ1YXQgQ2lyY2xlIGJhcnU/ICh5L24pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKS5sb3dlcigpCiAgICAgICAgICAgIGlmIGNyZWF0ZV9uZXcgPT0gInkiOgogICAgICAgICAgICAgICAgc2hvd19jaXJjbGVfY3JlYXRpb24oYXBpX2tleSwgdG9rZW5zKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgaWYgZ3JvdXBfZGF0YS5nZXQoImdyb3VwX3N0YXR1cyIpID09ICJCTE9DS0VEIjoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsICJDaXJjbGUgaW5pIHNlZGFuZyBkaWJsb2tpci4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgZ3JvdXBfbmFtZSA9IGdyb3VwX2RhdGEuZ2V0KCJncm91cF9uYW1lIiwgIk4vQSIpCiAgICAgICAgb3duZXJfbmFtZSA9IGdyb3VwX2RhdGEuZ2V0KCJvd25lcl9uYW1lIiwgIk4vQSIpCgogICAgICAgIG1lbWJlcnNfcmVzID0gZ2V0X2dyb3VwX21lbWJlcnMoYXBpX2tleSwgdG9rZW5zLCBncm91cF9pZCkKCiAgICAgICAgaWYgbWVtYmVyc19yZXMuZ2V0KCJzdGF0dXMiKSAhPSAiU1VDQ0VTUyI6CiAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiR2FnYWwgbWVuZ2FtYmlsIGRhdGEgbWVtYmVyIENpcmNsZS4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgbWVtYmVyc19kYXRhID0gbWVtYmVyc19yZXMuZ2V0KCJkYXRhIiwge30pCiAgICAgICAgbWVtYmVycyA9IG1lbWJlcnNfZGF0YS5nZXQoIm1lbWJlcnMiLCBbXSkKICAgICAgICBpZiBub3QgbWVtYmVyczoKICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsICJUaWRhayBhZGEgbWVtYmVyIGRhbGFtIENpcmNsZS4iKQogICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgIHJldHVybiAiQkFDSyIKCiAgICAgICAgcGFyZW50X21lbWJlcl9pZCA9ICIiCiAgICAgICAgcGFyZW50X3N1YnNfaWQgPSAiIgogICAgICAgIHBhcmVudF9tc2lzZG4gPSAiIgogICAgICAgIGZvciBtZW1iZXIgaW4gbWVtYmVyczoKICAgICAgICAgICAgaWYgbWVtYmVyLmdldCgibWVtYmVyX3JvbGUiKSA9PSAiUEFSRU5UIjoKICAgICAgICAgICAgICAgIHBhcmVudF9tZW1iZXJfaWQgPSBtZW1iZXIuZ2V0KCJtZW1iZXJfaWQiLCAiIikKICAgICAgICAgICAgICAgIHBhcmVudF9zdWJzX2lkID0gbWVtYmVyLmdldCgic3Vic2NyaWJlcl9udW1iZXIiLCAiIikKICAgICAgICAgICAgICAgIHBhcmVudF9tc2lzZG4gPSBkZWNyeXB0X2NpcmNsZV9tc2lzZG4oYXBpX2tleSwgbWVtYmVyLmdldCgibXNpc2RuIiwgIiIpKQoKICAgICAgICBwYWNrYWdlID0gbWVtYmVyc19kYXRhLmdldCgicGFja2FnZSIsIHt9KQogICAgICAgIHBhY2thZ2VfbmFtZSA9IHBhY2thZ2UuZ2V0KCJuYW1lIiwgIk4vQSIpCiAgICAgICAgYmVuZWZpdCA9IHBhY2thZ2UuZ2V0KCJiZW5lZml0Iiwge30pCiAgICAgICAgYWxsb2NhdGlvbl9ieXRlID0gYmVuZWZpdC5nZXQoImFsbG9jYXRpb24iLCAwKQogICAgICAgIHJlbWFpbmluZ19ieXRlID0gYmVuZWZpdC5nZXQoInJlbWFpbmluZyIsIDApCgogICAgICAgIGZvcm1hdHRlZF9hbGxvY2F0aW9uID0gZm9ybWF0X3F1b3RhX2J5dGUoYWxsb2NhdGlvbl9ieXRlKQogICAgICAgIGZvcm1hdHRlZF9yZW1haW5pbmcgPSBmb3JtYXRfcXVvdGFfYnl0ZShyZW1haW5pbmdfYnl0ZSkKCiAgICAgICAgc3BlbmRpbmdfcmVzID0gc3BlbmRpbmdfdHJhY2tlcihhcGlfa2V5LCB0b2tlbnMsIHBhcmVudF9zdWJzX2lkLCBncm91cF9pZCkKCiAgICAgICAgaWYgc3BlbmRpbmdfcmVzLmdldCgic3RhdHVzIikgIT0gIlNVQ0NFU1MiOgogICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIkdhZ2FsIG1lbmdhbWJpbCBkYXRhIHNwZW5kaW5nLiIpCiAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBzcGVuZGluZ19kYXRhID0gc3BlbmRpbmdfcmVzLmdldCgiZGF0YSIsIHt9KQogICAgICAgIHNwZW5kID0gc3BlbmRpbmdfZGF0YS5nZXQoInNwZW5kIiwgMCkKICAgICAgICB0YXJnZXQgPSBzcGVuZGluZ19kYXRhLmdldCgidGFyZ2V0IiwgMCkKCiAgICAgICAgaGVhZGVyX3RleHQgPSBUZXh0KCkKICAgICAgICBoZWFkZXJfdGV4dC5hcHBlbmQoZiJDaXJjbGU6IHtncm91cF9uYW1lfVxuIiwgc3R5bGU9ImJvbGQiKQogICAgICAgIGhlYWRlcl90ZXh0LmFwcGVuZChmIk93bmVyOiB7b3duZXJfbmFtZX0ge3BhcmVudF9tc2lzZG59XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgaGVhZGVyX3RleHQuYXBwZW5kKGYiUGFrZXQ6IHtwYWNrYWdlX25hbWV9IHwge2Zvcm1hdHRlZF9yZW1haW5pbmd9IC8ge2Zvcm1hdHRlZF9hbGxvY2F0aW9ufVxuIiwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIGhlYWRlcl90ZXh0LmFwcGVuZChmIlNwZW5kaW5nOiB7Z2V0X3J1cGlhaChzcGVuZCl9IC8ge2dldF9ydXBpYWgodGFyZ2V0KX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X21vbmV5Il0pCgogICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwoaGVhZGVyX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBmb3IgaWR4LCBtIGluIGVudW1lcmF0ZShtZW1iZXJzLCBzdGFydD0xKToKICAgICAgICAgICAgbXNpc2RuID0gZGVjcnlwdF9jaXJjbGVfbXNpc2RuKGFwaV9rZXksIG0uZ2V0KCJtc2lzZG4iLCAiIikpIG9yICI8Tm8gTnVtYmVyPiIKICAgICAgICAgICAgbWVfbWFyayA9ICIgKEFuZGEpIiBpZiBzdHIobXNpc2RuKSA9PSBzdHIobXlfbXNpc2RuKSBlbHNlICIiCiAgICAgICAgICAgIHJvbGUgPSAiUGFyZW50IiBpZiBtLmdldCgibWVtYmVyX3JvbGUiKSA9PSAiUEFSRU5UIiBlbHNlICJNZW1iZXIiCiAgICAgICAgICAgIGpvaW5lZF9zdHIgPSBkYXRldGltZS5mcm9tdGltZXN0YW1wKG0uZ2V0KCJqb2luX2RhdGUiLCAwKSkuc3RyZnRpbWUoJyVZLSVtLSVkJykgaWYgbS5nZXQoImpvaW5fZGF0ZSIpIGVsc2UgIk4vQSIKICAgICAgICAgICAgYWxsb2MgPSBmb3JtYXRfcXVvdGFfYnl0ZShtLmdldCgiYWxsb2NhdGlvbiIsIDApKQogICAgICAgICAgICB1c2VkID0gZm9ybWF0X3F1b3RhX2J5dGUobWF4KG0uZ2V0KCJhbGxvY2F0aW9uIiwgMCkgLSBtLmdldCgicmVtYWluaW5nIiwgMCksIDApKQogICAgICAgICAgICB1c2FnZV9zdHIgPSBmInt1c2VkfSAvIHthbGxvY30iCgogICAgICAgICAgICBtZW1iZXJfdGV4dCA9IFRleHQoKQogICAgICAgICAgICBtZW1iZXJfdGV4dC5hcHBlbmQoZiJ7aWR4fS4ge20uZ2V0KCdtZW1iZXJfbmFtZScsJ04vQScpfSB7bWVfbWFya31cbiIsIHN0eWxlPSJib2xkIikKICAgICAgICAgICAgbWVtYmVyX3RleHQuYXBwZW5kKGYiTm9tb3I6IHttc2lzZG59XG4iLCBzdHlsZT10aGVtZVsiYm9yZGVyX3dhcm5pbmciXSkKICAgICAgICAgICAgbWVtYmVyX3RleHQuYXBwZW5kKGYiUm9sZToge3JvbGV9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgIG1lbWJlcl90ZXh0LmFwcGVuZChmIkpvaW46IHtqb2luZWRfc3RyfVxuIiwgc3R5bGU9dGhlbWVbImJvcmRlcl9pbmZvIl0pCiAgICAgICAgICAgIG1lbWJlcl90ZXh0LmFwcGVuZChmIlNsb3Q6IHttLmdldCgnc2xvdF90eXBlJywnTi9BJyl9XG4iLCBzdHlsZT10aGVtZVsidGV4dF9ib2R5Il0pCiAgICAgICAgICAgIG1lbWJlcl90ZXh0LmFwcGVuZChmIlN0YXR1czoge20uZ2V0KCdzdGF0dXMnLCdOL0EnKX1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X3N1YiJdKQogICAgICAgICAgICBtZW1iZXJfdGV4dC5hcHBlbmQoZiJVc2FnZToge3VzYWdlX3N0cn1cbiIsIHN0eWxlPXRoZW1lWyJ0ZXh0X2JvZHkiXSkKCiAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwobWVtYmVyX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBuYXZfdGFibGUgPSBUYWJsZShzaG93X2hlYWRlcj1GYWxzZSwgYm94PU1JTklNQUxfRE9VQkxFX0hFQUQsIGV4cGFuZD1UcnVlKQogICAgICAgIG5hdl90YWJsZS5hZGRfY29sdW1uKGp1c3RpZnk9InJpZ2h0Iiwgc3R5bGU9dGhlbWVbInRleHRfa2V5Il0sIHdpZHRoPTYpCiAgICAgICAgbmF2X3RhYmxlLmFkZF9jb2x1bW4oc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCIxIiwgIlVuZGFuZyBNZW1iZXIga2UgQ2lyY2xlIikKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiZGVsIDxudW0+IiwgZiJbe3RoZW1lWyd0ZXh0X2VyciddfV1IYXB1cyBNZW1iZXJbL10iKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCJhY2MgPG51bT4iLCAiVGVyaW1hIFVuZGFuZ2FuIikKICAgICAgICBuYXZfdGFibGUuYWRkX3JvdygiMiIsICJMaWhhdCBCb251cyBDaXJjbGUiKQogICAgICAgIG5hdl90YWJsZS5hZGRfcm93KCIwMCIsIGYiW3t0aGVtZVsndGV4dF9zdWInXX1dS2VtYmFsaSBrZSBtZW51IHV0YW1hWy9dIikKCiAgICAgICAgY29uc29sZS5wcmludChQYW5lbChuYXZfdGFibGUsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX3ByaW1hcnkiXSwgZXhwYW5kPVRydWUpKQoKICAgICAgICBjaG9pY2UgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dUGlsaWhhbjpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICBpZiBjaG9pY2UgPT0gIjAwIjoKICAgICAgICAgICAgcmV0dXJuICJCQUNLIgoKICAgICAgICBlbGlmIGNob2ljZSA9PSAiMSI6CiAgICAgICAgICAgIG1zaXNkbl90b19pbnZpdGUgPSBjb25zb2xlLmlucHV0KGYiW3t0aGVtZVsndGV4dF9zdWInXX1dTm9tb3IgbWVtYmVyIHlhbmcgYWthbiBkaXVuZGFuZzpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkKICAgICAgICAgICAgdmFsaWRhdGVfcmVzID0gdmFsaWRhdGVfY2lyY2xlX21lbWJlcihhcGlfa2V5LCB0b2tlbnMsIG1zaXNkbl90b19pbnZpdGUpCiAgICAgICAgICAgIGlmIHZhbGlkYXRlX3Jlcy5nZXQoInN0YXR1cyIpID09ICJTVUNDRVNTIjoKICAgICAgICAgICAgICAgIGlmIHZhbGlkYXRlX3Jlcy5nZXQoImRhdGEiLCB7fSkuZ2V0KCJyZXNwb25zZV9jb2RlIiwgIiIpICE9ICIyMDAtMjAwMSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsIGYiVGlkYWsgZGFwYXQgbWVuZ3VuZGFuZyB7bXNpc2RuX3RvX2ludml0ZX06IHt2YWxpZGF0ZV9yZXMuZ2V0KCdkYXRhJywge30pLmdldCgnbWVzc2FnZScsICdFcnJvcicpfSIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIG1lbWJlcl9uYW1lID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XU5hbWEgbWVtYmVyOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKQogICAgICAgICAgICB3aXRoIGxpdmVfbG9hZGluZygiTWVuZ2lyaW0gdW5kYW5nYW4uLi4iLCB0aGVtZSk6CiAgICAgICAgICAgICAgICBpbnZpdGVfcmVzID0gaW52aXRlX2NpcmNsZV9tZW1iZXIoYXBpX2tleSwgdG9rZW5zLCBtc2lzZG5fdG9faW52aXRlLCBtZW1iZXJfbmFtZSwgZ3JvdXBfaWQsIHBhcmVudF9tZW1iZXJfaWQpCiAgICAgICAgICAgIGlmIGludml0ZV9yZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyIgYW5kIGludml0ZV9yZXMuZ2V0KCJkYXRhIiwge30pLmdldCgicmVzcG9uc2VfY29kZSIpID09ICIyMDAtMDAiOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkJlcmhhc2lsIiwgZiJVbmRhbmdhbiBiZXJoYXNpbCBkaWtpcmltIGtlIHttc2lzZG5fdG9faW52aXRlfS4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsIGYiR2FnYWwgbWVuZ3VuZGFuZyB7bXNpc2RuX3RvX2ludml0ZX0uIikKICAgICAgICAgICAgcGF1c2UoKQoKICAgICAgICBlbGlmIGNob2ljZS5zdGFydHN3aXRoKCJkZWwgIik6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG1lbWJlcl9udW1iZXIgPSBpbnQoY2hvaWNlLnNwbGl0KCIgIilbMV0pCiAgICAgICAgICAgICAgICBpZiBtZW1iZXJfbnVtYmVyIDwgMSBvciBtZW1iZXJfbnVtYmVyID4gbGVuKG1lbWJlcnMpOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiTm9tb3IgbWVtYmVyIHRpZGFrIHZhbGlkLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBtZW1iZXJfdG9fcmVtb3ZlID0gbWVtYmVyc1ttZW1iZXJfbnVtYmVyIC0gMV0KICAgICAgICAgICAgICAgIGlmIG1lbWJlcl90b19yZW1vdmUuZ2V0KCJtZW1iZXJfcm9sZSIpID09ICJQQVJFTlQiOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiUGFyZW50IHRpZGFrIGRhcGF0IGRpaGFwdXMuIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGlzX2xhc3RfbWVtYmVyID0gbGVuKG1lbWJlcnMpID09IDIKICAgICAgICAgICAgICAgIGlmIGlzX2xhc3RfbWVtYmVyOgogICAgICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJJbmZvcm1hc2kiLCAiVGlkYWsgZGFwYXQgbWVuZ2hhcHVzIG1lbWJlciB0ZXJha2hpci4iKQogICAgICAgICAgICAgICAgICAgIHBhdXNlKCkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgbXNpc2RuX3RvX3JlbW92ZSA9IGRlY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtZW1iZXJfdG9fcmVtb3ZlLmdldCgibXNpc2RuIiwgIiIpKQogICAgICAgICAgICAgICAgY29uZmlybSA9IGNvbnNvbGUuaW5wdXQoZiJbe3RoZW1lWyd0ZXh0X3N1YiddfV1ZYWtpbiBpbmdpbiBtZW5naGFwdXMge21zaXNkbl90b19yZW1vdmV9PyAoeS9uKTpbL3t0aGVtZVsndGV4dF9zdWInXX1dICIpLnN0cmlwKCkubG93ZXIoKQogICAgICAgICAgICAgICAgaWYgY29uZmlybSAhPSAieSI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIkluZm9ybWFzaSIsICJQZW5naGFwdXNhbiBkaWJhdGFsa2FuLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB3aXRoIGxpdmVfbG9hZGluZygiTWVuZ2hhcHVzIG1lbWJlci4uLiIsIHRoZW1lKToKICAgICAgICAgICAgICAgICAgICByZW1vdmVfcmVzID0gcmVtb3ZlX2NpcmNsZV9tZW1iZXIoYXBpX2tleSwgdG9rZW5zLCBtZW1iZXJfdG9fcmVtb3ZlLmdldCgibWVtYmVyX2lkIiwgIiIpLCBncm91cF9pZCwgcGFyZW50X21lbWJlcl9pZCwgaXNfbGFzdF9tZW1iZXIpCiAgICAgICAgICAgICAgICBpZiByZW1vdmVfcmVzLmdldCgic3RhdHVzIikgPT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgICAgIHJlc190ZXh0ID0gVGV4dCgpCiAgICAgICAgICAgICAgICAgICAgcmVzX3RleHQuYXBwZW5kKGYiTWVtYmVyIHttc2lzZG5fdG9fcmVtb3ZlfSB0ZWxhaCBkaWhhcHVzLlxuIiwgc3R5bGU9ImJvbGQiKQogICAgICAgICAgICAgICAgICAgIHJlc190ZXh0LmFwcGVuZChqc29uLmR1bXBzKHJlbW92ZV9yZXMsIGluZGVudD0yKSwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwocmVzX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgZXhwYW5kPVRydWUpKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgZiJHYWdhbCBtZW5naGFwdXMgbWVtYmVyOiB7cmVtb3ZlX3Jlc30iKQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiRm9ybWF0IGlucHV0IHVudHVrIGhhcHVzIG1lbWJlciB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICBwYXVzZSgpCgogICAgICAgIGVsaWYgY2hvaWNlLnN0YXJ0c3dpdGgoImFjYyAiKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbWVtYmVyX251bWJlciA9IGludChjaG9pY2Uuc3BsaXQoIiAiKVsxXSkKICAgICAgICAgICAgICAgIGlmIG1lbWJlcl9udW1iZXIgPCAxIG9yIG1lbWJlcl9udW1iZXIgPiBsZW4obWVtYmVycyk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJOb21vciBtZW1iZXIgdGlkYWsgdmFsaWQuIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIG1lbWJlcl90b19hY2NlcHQgPSBtZW1iZXJzW21lbWJlcl9udW1iZXIgLSAxXQogICAgICAgICAgICAgICAgaWYgbWVtYmVyX3RvX2FjY2VwdC5nZXQoInN0YXR1cyIpICE9ICJJTlZJVEVEIjoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiSW5mb3JtYXNpIiwgIk1lbWJlciBpbmkgdGlkYWsgZGFsYW0gc3RhdHVzIHVuZGFuZ2FuLiIpCiAgICAgICAgICAgICAgICAgICAgcGF1c2UoKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBtc2lzZG5fdG9fYWNjZXB0ID0gZGVjcnlwdF9jaXJjbGVfbXNpc2RuKGFwaV9rZXksIG1lbWJlcl90b19hY2NlcHQuZ2V0KCJtc2lzZG4iLCAiIikpCiAgICAgICAgICAgICAgICBjb25maXJtID0gY29uc29sZS5pbnB1dChmIlt7dGhlbWVbJ3RleHRfc3ViJ119XVRlcmltYSB1bmRhbmdhbiB1bnR1ayB7bXNpc2RuX3RvX2FjY2VwdH0/ICh5L24pOlsve3RoZW1lWyd0ZXh0X3N1YiddfV0gIikuc3RyaXAoKS5sb3dlcigpCiAgICAgICAgICAgICAgICBpZiBjb25maXJtICE9ICJ5IjoKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiSW5mb3JtYXNpIiwgIlVuZGFuZ2FuIHRpZGFrIGphZGkgZGl0ZXJpbWEuIikKICAgICAgICAgICAgICAgICAgICBwYXVzZSgpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHdpdGggbGl2ZV9sb2FkaW5nKCJNZW5lcmltYSB1bmRhbmdhbi4uLiIsIHRoZW1lKToKICAgICAgICAgICAgICAgICAgICBhY2NlcHRfcmVzID0gYWNjZXB0X2NpcmNsZV9pbnZpdGF0aW9uKGFwaV9rZXksIHRva2VucywgZ3JvdXBfaWQsIG1lbWJlcl90b19hY2NlcHQuZ2V0KCJtZW1iZXJfaWQiLCAiIikpCiAgICAgICAgICAgICAgICBpZiBhY2NlcHRfcmVzLmdldCgic3RhdHVzIikgPT0gIlNVQ0NFU1MiOgogICAgICAgICAgICAgICAgICAgIHJlc190ZXh0ID0gVGV4dCgpCiAgICAgICAgICAgICAgICAgICAgcmVzX3RleHQuYXBwZW5kKGYiVW5kYW5nYW4gdW50dWsge21zaXNkbl90b19hY2NlcHR9IGJlcmhhc2lsIGRpdGVyaW1hLlxuIiwgc3R5bGU9ImJvbGQiKQogICAgICAgICAgICAgICAgICAgIHJlc190ZXh0LmFwcGVuZChqc29uLmR1bXBzKGFjY2VwdF9yZXMsIGluZGVudD0yKSwgc3R5bGU9dGhlbWVbInRleHRfYm9keSJdKQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUucHJpbnQoUGFuZWwocmVzX3RleHQsIGJvcmRlcl9zdHlsZT10aGVtZVsiYm9yZGVyX2luZm8iXSwgZXhwYW5kPVRydWUpKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgZiJHYWdhbCBtZW5lcmltYSB1bmRhbmdhbjoge2FjY2VwdF9yZXN9IikKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIkZvcm1hdCBpbnB1dCB1bnR1ayBtZW5lcmltYSB1bmRhbmdhbiB0aWRhayB2YWxpZC4iKQogICAgICAgICAgICBwYXVzZSgpCgogICAgICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAgICAgc2hvd19ib251c19saXN0KGFwaV9rZXksIHRva2VucywgcGFyZW50X3N1YnNfaWQsIGdyb3VwX2lkKQo=').decode())
