#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IGpzb24KZnJvbSBhcHAyLmNsaWVudC5lbmdzZWwgaW1wb3J0IHNlbmRfYXBpX3JlcXVlc3QKZnJvbSBhcHAyLmNsaWVudC5lbmNyeXB0IGltcG9ydCBlbmNyeXB0X2NpcmNsZV9tc2lzZG4KZnJvbSBhcHAyLm1lbnVzLnV0aWwgaW1wb3J0IGxpdmVfbG9hZGluZywgcHJpbnRfcGFuZWwKZnJvbSBhcHAyLmNvbmZpZy50aGVtZV9jb25maWcgaW1wb3J0IGdldF90aGVtZQoKCmRlZiBnZXRfZ3JvdXBfZGF0YShhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCkgLT4gZGljdCB8IE5vbmU6CiAgICBwYXRoID0gImZhbWlseS1odWIvYXBpL3Y4L2dyb3Vwcy9zdGF0dXMiCiAgICByYXdfcGF5bG9hZCA9IHsiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLCAibGFuZyI6ICJlbiJ9CiAgICB3aXRoIGxpdmVfbG9hZGluZygiTWVuZ2FtYmlsIGRldGFpbCBDaXJjbGUuLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICBpZiBub3QgcmVzIG9yIHJlcy5nZXQoInN0YXR1cyIpICE9ICJTVUNDRVNTIjoKICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIkdhZ2FsIG1lbmdhbWJpbCBkZXRhaWwgQ2lyY2xlLiIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIHJldHVybiByZXMKCgpkZWYgZ2V0X2dyb3VwX21lbWJlcnMoYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QsIGdyb3VwX2lkOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJmYW1pbHktaHViL2FwaS92OC9tZW1iZXJzL2luZm8iCiAgICByYXdfcGF5bG9hZCA9IHsiZ3JvdXBfaWQiOiBncm91cF9pZCwgImlzX2VudGVycHJpc2UiOiBGYWxzZSwgImxhbmciOiAiZW4ifQogICAgd2l0aCBsaXZlX2xvYWRpbmcoZiJNZW5nYW1iaWwgbWVtYmVyIHVudHVrIGdyb3VwIHtncm91cF9pZH0uLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICByZXR1cm4gcmVzCgoKZGVmIHZhbGlkYXRlX2NpcmNsZV9tZW1iZXIoYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QsIG1zaXNkbjogc3RyKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiZmFtaWx5LWh1Yi9hcGkvdjgvbWVtYmVycy92YWxpZGF0ZSIKICAgIGVuY3J5cHRlZF9tc2lzZG4gPSBlbmNyeXB0X2NpcmNsZV9tc2lzZG4oYXBpX2tleSwgbXNpc2RuKQogICAgcmF3X3BheWxvYWQgPSB7Im1zaXNkbiI6IGVuY3J5cHRlZF9tc2lzZG4sICJpc19lbnRlcnByaXNlIjogRmFsc2UsICJsYW5nIjogImVuIn0KICAgIHdpdGggbGl2ZV9sb2FkaW5nKGYiTWVtdmFsaWRhc2kgbWVtYmVyIHttc2lzZG59Li4uIiwgZ2V0X3RoZW1lKCkpOgogICAgICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcwoKCmRlZiBpbnZpdGVfY2lyY2xlX21lbWJlcihhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgbXNpc2RuOiBzdHIsIG5hbWU6IHN0ciwKICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwX2lkOiBzdHIsIG1lbWJlcl9pZF9wYXJlbnQ6IHN0cikgLT4gZGljdCB8IE5vbmU6CiAgICBwYXRoID0gImZhbWlseS1odWIvYXBpL3Y4L21lbWJlcnMvaW52aXRlIgogICAgZW5jcnlwdGVkX21zaXNkbiA9IGVuY3J5cHRfY2lyY2xlX21zaXNkbihhcGlfa2V5LCBtc2lzZG4pCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiYWNjZXNzX3Rva2VuIjogdG9rZW5zWyJhY2Nlc3NfdG9rZW4iXSwKICAgICAgICAiZ3JvdXBfaWQiOiBncm91cF9pZCwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJtZW1iZXJzIjogW3sibXNpc2RuIjogZW5jcnlwdGVkX21zaXNkbiwgIm5hbWUiOiBuYW1lfV0sCiAgICAgICAgImxhbmciOiAiZW4iLAogICAgICAgICJtZW1iZXJfaWRfcGFyZW50IjogbWVtYmVyX2lkX3BhcmVudCwKICAgIH0KICAgIHdpdGggbGl2ZV9sb2FkaW5nKGYiTWVuZ3VuZGFuZyB7bXNpc2RufSBrZSBDaXJjbGUuLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgaWYgbm90IHJlczoKICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIkdhZ2FsIG1lbmd1bmRhbmcgbWVtYmVyIGtlIENpcmNsZS4iKQogICAgICAgIHJldHVybiBOb25lCgogICAgc3RhdHVzID0gcmVzLmdldCgic3RhdHVzIiwgIlVOS05PV04iKQogICAgbWVzc2FnZSA9IHJlcy5nZXQoIm1lc3NhZ2UiLCAiIikKICAgIHByaW50X3BhbmVsKCJTdGF0dXMgVW5kYW5nYW4iLCBmIlN0YXR1czoge3N0YXR1c31cblBlc2FuOiB7bWVzc2FnZX0iKQoKICAgIHJldHVybiB7InN0YXR1cyI6IHN0YXR1cywgIm1lc3NhZ2UiOiBtZXNzYWdlLCAiZGF0YSI6IHJlc30KCgpkZWYgcmVtb3ZlX2NpcmNsZV9tZW1iZXIoYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QsIG1lbWJlcl9pZDogc3RyLAogICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHN0ciwgbWVtYmVyX2lkX3BhcmVudDogc3RyLAogICAgICAgICAgICAgICAgICAgICAgICAgaXNfbGFzdF9tZW1iZXI6IGJvb2wgPSBGYWxzZSkgLT4gZGljdCB8IE5vbmU6CiAgICBwYXRoID0gImZhbWlseS1odWIvYXBpL3Y4L21lbWJlcnMvcmVtb3ZlIgogICAgcmF3X3BheWxvYWQgPSB7CiAgICAgICAgIm1lbWJlcl9pZCI6IG1lbWJlcl9pZCwKICAgICAgICAiZ3JvdXBfaWQiOiBncm91cF9pZCwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJpc19sYXN0X21lbWJlciI6IGlzX2xhc3RfbWVtYmVyLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAibWVtYmVyX2lkX3BhcmVudCI6IG1lbWJlcl9pZF9wYXJlbnQsCiAgICB9CiAgICB3aXRoIGxpdmVfbG9hZGluZyhmIk1lbmdoYXB1cyBtZW1iZXIge21lbWJlcl9pZH0gZGFyaSBDaXJjbGUuLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgogICAgaWYgbm90IHJlczoKICAgICAgICBwcmludF9wYW5lbCgiS2VzYWxhaGFuIiwgIkdhZ2FsIG1lbmdoYXB1cyBtZW1iZXIgZGFyaSBDaXJjbGUuIikKICAgICAgICByZXR1cm4gTm9uZQoKICAgIHN0YXR1cyA9IHJlcy5nZXQoInN0YXR1cyIsICJVTktOT1dOIikKICAgIG1lc3NhZ2UgPSByZXMuZ2V0KCJtZXNzYWdlIiwgIiIpCiAgICBwcmludF9wYW5lbCgiU3RhdHVzIFBlbmdoYXB1c2FuIiwgZiJTdGF0dXM6IHtzdGF0dXN9XG5QZXNhbjoge21lc3NhZ2V9IikKCiAgICByZXR1cm4geyJzdGF0dXMiOiBzdGF0dXMsICJtZXNzYWdlIjogbWVzc2FnZSwgImRhdGEiOiByZXN9CgoKZGVmIGFjY2VwdF9jaXJjbGVfaW52aXRhdGlvbihhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgZ3JvdXBfaWQ6IHN0ciwgbWVtYmVyX2lkOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJmYW1pbHktaHViL2FwaS92OC9ncm91cHMvYWNjZXB0LWludml0YXRpb24iCiAgICByYXdfcGF5bG9hZCA9IHsKICAgICAgICAiYWNjZXNzX3Rva2VuIjogdG9rZW5zWyJhY2Nlc3NfdG9rZW4iXSwKICAgICAgICAiZ3JvdXBfaWQiOiBncm91cF9pZCwKICAgICAgICAibWVtYmVyX2lkIjogbWVtYmVyX2lkLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgImxhbmciOiAiZW4iLAogICAgfQogICAgd2l0aCBsaXZlX2xvYWRpbmcoZiJNZW5lcmltYSB1bmRhbmdhbiBDaXJjbGUge2dyb3VwX2lkfS4uLiIsIGdldF90aGVtZSgpKToKICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHJhd19wYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKCiAgICBpZiBub3QgcmVzOgogICAgICAgIHByaW50X3BhbmVsKCJLZXNhbGFoYW4iLCAiR2FnYWwgbWVuZXJpbWEgdW5kYW5nYW4gQ2lyY2xlLiIpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBzdGF0dXMgPSByZXMuZ2V0KCJzdGF0dXMiLCAiVU5LTk9XTiIpCiAgICBtZXNzYWdlID0gcmVzLmdldCgibWVzc2FnZSIsICIiKQogICAgcHJpbnRfcGFuZWwoIlN0YXR1cyBQZW5lcmltYWFuIFVuZGFuZ2FuIiwgZiJTdGF0dXM6IHtzdGF0dXN9XG5QZXNhbjoge21lc3NhZ2V9IikKCiAgICByZXR1cm4geyJzdGF0dXMiOiBzdGF0dXMsICJtZXNzYWdlIjogbWVzc2FnZSwgImRhdGEiOiByZXN9CgoKZGVmIGNyZWF0ZV9jaXJjbGUoYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QsIHBhcmVudF9uYW1lOiBzdHIsCiAgICAgICAgICAgICAgICAgIGdyb3VwX25hbWU6IHN0ciwgbWVtYmVyX21zaXNkbjogc3RyLCBtZW1iZXJfbmFtZTogc3RyKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiZmFtaWx5LWh1Yi9hcGkvdjgvZ3JvdXBzL2NyZWF0ZSIKICAgIHJhd19wYXlsb2FkID0gewogICAgICAgICJhY2Nlc3NfdG9rZW4iOiB0b2tlbnNbImFjY2Vzc190b2tlbiJdLAogICAgICAgICJwYXJlbnRfbmFtZSI6IHBhcmVudF9uYW1lLAogICAgICAgICJncm91cF9uYW1lIjogZ3JvdXBfbmFtZSwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJtZW1iZXJzIjogW3sibXNpc2RuIjogZW5jcnlwdF9jaXJjbGVfbXNpc2RuKGFwaV9rZXksIG1lbWJlcl9tc2lzZG4pLCAibmFtZSI6IG1lbWJlcl9uYW1lfV0sCiAgICAgICAgImxhbmciOiAiZW4iLAogICAgfQogICAgd2l0aCBsaXZlX2xvYWRpbmcoZiJNZW1idWF0IENpcmNsZSBiYXJ1IGRlbmdhbiBtZW1iZXIge21lbWJlcl9tc2lzZG59Li4uIiwgZ2V0X3RoZW1lKCkpOgogICAgICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQoKICAgIGlmIG5vdCByZXM6CiAgICAgICAgcHJpbnRfcGFuZWwoIktlc2FsYWhhbiIsICJHYWdhbCBtZW1idWF0IENpcmNsZS4iKQogICAgICAgIHJldHVybiBOb25lCgogICAgc3RhdHVzID0gcmVzLmdldCgic3RhdHVzIiwgIlVOS05PV04iKQogICAgbWVzc2FnZSA9IHJlcy5nZXQoIm1lc3NhZ2UiLCAiIikKICAgIHByaW50X3BhbmVsKCJTdGF0dXMgUGVtYnVhdGFuIENpcmNsZSIsIGYiU3RhdHVzOiB7c3RhdHVzfVxuUGVzYW46IHttZXNzYWdlfSIpCgogICAgcmV0dXJuIHsic3RhdHVzIjogc3RhdHVzLCAibWVzc2FnZSI6IG1lc3NhZ2UsICJkYXRhIjogcmVzfQoKCmRlZiBzcGVuZGluZ190cmFja2VyKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBwYXJlbnRfc3Vic19pZDogc3RyLCBmYW1pbHlfaWQ6IHN0cikgLT4gZGljdCB8IE5vbmU6CiAgICBwYXRoID0gImdhbWlmaWNhdGlvbi9hcGkvdjgvZmFtaWx5LWh1Yi9zcGVuZGluZy10cmFja2VyIgogICAgcmF3X3BheWxvYWQgPSB7ImlzX2VudGVycHJpc2UiOiBGYWxzZSwgInBhcmVudF9zdWJzX2lkIjogcGFyZW50X3N1YnNfaWQsICJmYW1pbHlfaWQiOiBmYW1pbHlfaWQsICJsYW5nIjogImVuIn0KICAgIHdpdGggbGl2ZV9sb2FkaW5nKCJNZW5nYW1iaWwgZGF0YSBzcGVuZGluZyB0cmFja2VyLi4uIiwgZ2V0X3RoZW1lKCkpOgogICAgICAgIHJlcyA9IHNlbmRfYXBpX3JlcXVlc3QoYXBpX2tleSwgcGF0aCwgcmF3X3BheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcwoKCmRlZiBnZXRfYm9udXNfZGF0YShhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgcGFyZW50X3N1YnNfaWQ6IHN0ciwgZmFtaWx5X2lkOiBzdHIpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJnYW1pZmljYXRpb24vYXBpL3Y4L2ZhbWlseS1odWIvYm9udXMvbGlzdCIKICAgIHJhd19wYXlsb2FkID0geyJpc19lbnRlcnByaXNlIjogRmFsc2UsICJwYXJlbnRfc3Vic19pZCI6IHBhcmVudF9zdWJzX2lkLCAiZmFtaWx5X2lkIjogZmFtaWx5X2lkLCAibGFuZyI6ICJlbiJ9CiAgICB3aXRoIGxpdmVfbG9hZGluZygiTWVuZ2FtYmlsIGRhdGEgYm9udXMuLi4iLCBnZXRfdGhlbWUoKSk6CiAgICAgICAgcmVzID0gc2VuZF9hcGlfcmVxdWVzdChhcGlfa2V5LCBwYXRoLCByYXdfcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICByZXR1cm4gcmVzCg==').decode())
