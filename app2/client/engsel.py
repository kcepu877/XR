#!/usr/bin/env python3
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCB1dWlkCmltcG9ydCByZXF1ZXN0cwpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSwgdGltZXpvbmUKCmZyb20gYXBwMi5tZW51cy51dGlsIGltcG9ydCBsaXZlX2xvYWRpbmcKZnJvbSBhcHAyLmNvbmZpZy50aGVtZV9jb25maWcgaW1wb3J0IGdldF90aGVtZQpmcm9tIGFwcDIuY2xpZW50LmVuY3J5cHQgaW1wb3J0ICgKICAgIGVuY3J5cHRzaWduX3hkYXRhLAogICAgamF2YV9saWtlX3RpbWVzdGFtcCwKICAgIGRlY3J5cHRfeGRhdGEsCiAgICBBUElfS0VZLAopCgpCQVNFX0FQSV9VUkwgPSBvcy5nZXRlbnYoIkJBU0VfQVBJX1VSTCIpCmlmIG5vdCBCQVNFX0FQSV9VUkw6CiAgICByYWlzZSBWYWx1ZUVycm9yKCJCQVNFX0FQSV9VUkwgZW52aXJvbm1lbnQgdmFyaWFibGUgdGlkYWsgZGlzZXQiKQpVQSA9IG9zLmdldGVudigiVUEiKQoKCmRlZiBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXk6IHN0ciwgcGF0aDogc3RyLCBwYXlsb2FkX2RpY3Q6IGRpY3QsIGlkX3Rva2VuOiBzdHIsIG1ldGhvZDogc3RyID0gIlBPU1QiKToKICAgIGVuY3J5cHRlZF9wYXlsb2FkID0gZW5jcnlwdHNpZ25feGRhdGEoCiAgICAgICAgYXBpX2tleT1hcGlfa2V5LAogICAgICAgIG1ldGhvZD1tZXRob2QsCiAgICAgICAgcGF0aD1wYXRoLAogICAgICAgIGlkX3Rva2VuPWlkX3Rva2VuLAogICAgICAgIHBheWxvYWQ9cGF5bG9hZF9kaWN0LAogICAgKQoKICAgIHh0aW1lID0gaW50KGVuY3J5cHRlZF9wYXlsb2FkWyJlbmNyeXB0ZWRfYm9keSJdWyJ4dGltZSJdKQogICAgbm93ID0gZGF0ZXRpbWUubm93KHRpbWV6b25lLnV0YykuYXN0aW1lem9uZSgpCiAgICBzaWdfdGltZV9zZWMgPSB4dGltZSAvLyAxMDAwCgogICAgYm9keSA9IGVuY3J5cHRlZF9wYXlsb2FkWyJlbmNyeXB0ZWRfYm9keSJdCiAgICB4X3NpZyA9IGVuY3J5cHRlZF9wYXlsb2FkWyJ4X3NpZ25hdHVyZSJdCgogICAgaGVhZGVycyA9IHsKICAgICAgICAiaG9zdCI6IEJBU0VfQVBJX1VSTC5yZXBsYWNlKCJodHRwczovLyIsICIiKSwKICAgICAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiLAogICAgICAgICJ1c2VyLWFnZW50IjogVUEsCiAgICAgICAgIngtYXBpLWtleSI6IEFQSV9LRVksCiAgICAgICAgImF1dGhvcml6YXRpb24iOiBmIkJlYXJlciB7aWRfdG9rZW59IiwKICAgICAgICAieC1odiI6ICJ2MyIsCiAgICAgICAgIngtc2lnbmF0dXJlLXRpbWUiOiBzdHIoc2lnX3RpbWVfc2VjKSwKICAgICAgICAieC1zaWduYXR1cmUiOiB4X3NpZywKICAgICAgICAieC1yZXF1ZXN0LWlkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgIngtcmVxdWVzdC1hdCI6IGphdmFfbGlrZV90aW1lc3RhbXAobm93KSwKICAgICAgICAieC12ZXJzaW9uLWFwcCI6ICI4LjkuMSIsCiAgICB9CgogICAgdXJsID0gZiJ7QkFTRV9BUElfVVJMfS97cGF0aH0iCiAgICByZXNwID0gcmVxdWVzdHMucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1qc29uLmR1bXBzKGJvZHkpLCB0aW1lb3V0PTMwKQoKICAgIHRyeToKICAgICAgICByZXR1cm4gZGVjcnlwdF94ZGF0YShhcGlfa2V5LCBqc29uLmxvYWRzKHJlc3AudGV4dCkpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcmV0dXJuIHsiZXJyb3IiOiBmIkdhZ2FsIGRlY3J5cHQgcmVzcG9uc2U6IHtlfSIsICJyYXciOiByZXNwLnRleHR9CgoKZGVmIF93aXRoX2xvYWRpbmcobWVzc2FnZTogc3RyLCBmdW5jLCB1c2VfbG9hZGluZzogYm9vbCwgdGhlbWUsICphcmdzLCAqKmt3YXJncyk6CiAgICBpZiB1c2VfbG9hZGluZzoKICAgICAgICB3aXRoIGxpdmVfbG9hZGluZyhtZXNzYWdlLCB0aGVtZSk6CiAgICAgICAgICAgIHJldHVybiBmdW5jKCphcmdzLCAqKmt3YXJncykKICAgIHJldHVybiBmdW5jKCphcmdzLCAqKmt3YXJncykKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBBUEkgV3JhcHBlciBGdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpkZWYgZ2V0X3Byb2ZpbGUoYXBpX2tleTogc3RyLCBhY2Nlc3NfdG9rZW46IHN0ciwgaWRfdG9rZW46IHN0ciwgdXNlX2xvYWRpbmc6IGJvb2wgPSBUcnVlKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiYXBpL3Y4L3Byb2ZpbGUiCiAgICBwYXlsb2FkID0gewogICAgICAgICJhY2Nlc3NfdG9rZW4iOiBhY2Nlc3NfdG9rZW4sCiAgICAgICAgImFwcF92ZXJzaW9uIjogIjguOS4xIiwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIiwKICAgIH0KICAgICNyZXR1cm4gX3dpdGhfbG9hZGluZygiTWVuZ2FtYmlsIHByb2ZpbC4uLiIsIHNlbmRfYXBpX3JlcXVlc3QsIHVzZV9sb2FkaW5nLCBnZXRfdGhlbWUoKSwKICAgICMgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LCBwYXRoLCBwYXlsb2FkLCBpZF90b2tlbiwgIlBPU1QiKS5nZXQoImRhdGEiKQogICAgcmVzcG9uc2UgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCiAgICBpZiByZXNwb25zZToKICAgICAgICByZXR1cm4gcmVzcG9uc2UuZ2V0KCJkYXRhIikKICAgIHJldHVybiBOb25lCgpkZWYgZ2V0X2JhbGFuY2UoYXBpX2tleTogc3RyLCBpZF90b2tlbjogc3RyLCB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJhcGkvdjgvcGFja2FnZXMvYmFsYW5jZS1hbmQtY3JlZGl0IgogICAgcGF5bG9hZCA9IHsiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLCAibGFuZyI6ICJlbiJ9CiAgICByZXMgPSBfd2l0aF9sb2FkaW5nKCJNZW5nYW1iaWwgc2FsZG8uLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCiAgICByZXR1cm4gcmVzLmdldCgiZGF0YSIsIHt9KS5nZXQoImJhbGFuY2UiKQoKCmRlZiBnZXRfZmFtaWx5KGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBmYW1pbHlfY29kZTogc3RyLAogICAgICAgICAgICAgICBpc19lbnRlcnByaXNlOiBib29sIHwgTm9uZSA9IE5vbmUsCiAgICAgICAgICAgICAgIG1pZ3JhdGlvbl90eXBlOiBzdHIgfCBOb25lID0gTm9uZSwKICAgICAgICAgICAgICAgdXNlX2xvYWRpbmc6IGJvb2wgPSBUcnVlKSAtPiBkaWN0IHwgTm9uZToKICAgIHRoZW1lID0gZ2V0X3RoZW1lKCkKICAgIGlzX2VudGVycHJpc2VfbGlzdCA9IFtGYWxzZSwgVHJ1ZV0gaWYgaXNfZW50ZXJwcmlzZSBpcyBOb25lIGVsc2UgW2lzX2VudGVycHJpc2VdCiAgICBtaWdyYXRpb25fdHlwZV9saXN0ID0gWyJOT05FIiwgIlBSRV9UT19QUklPSCIsICJQUklPSF9UT19QUklPIiwgIlBSSU9fVE9fUFJJT0giXSBpZiBtaWdyYXRpb25fdHlwZSBpcyBOb25lIGVsc2UgW21pZ3JhdGlvbl90eXBlXQogICAgcGF0aCA9ICJhcGkvdjgveGwtc3RvcmVzL29wdGlvbnMvbGlzdCIKICAgIGlkX3Rva2VuID0gdG9rZW5zLmdldCgiaWRfdG9rZW4iKQoKICAgIGRlZiBfZmV0Y2hfZmFtaWx5KCk6CiAgICAgICAgZm9yIG10IGluIG1pZ3JhdGlvbl90eXBlX2xpc3Q6CiAgICAgICAgICAgIGZvciBpZSBpbiBpc19lbnRlcnByaXNlX2xpc3Q6CiAgICAgICAgICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAgICAgICAgICJpc19zaG93X3RhZ2dpbmdfdGFiIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAiaXNfZGVkaWNhdGVkX2V2ZW50IjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAiaXNfdHJhbnNhY3Rpb25fcm91dGluZSI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJtaWdyYXRpb25fdHlwZSI6IG10LAogICAgICAgICAgICAgICAgICAgICJwYWNrYWdlX2ZhbWlseV9jb2RlIjogZmFtaWx5X2NvZGUsCiAgICAgICAgICAgICAgICAgICAgImlzX2F1dG9idXkiOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IGllLAogICAgICAgICAgICAgICAgICAgICJpc19wZGxwIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAicmVmZXJyYWxfY29kZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJpc19taWdyYXRpb24iOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXMgPSBzZW5kX2FwaV9yZXF1ZXN0KGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCiAgICAgICAgICAgICAgICBpZiByZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyI6CiAgICAgICAgICAgICAgICAgICAgZmFtaWx5X25hbWUgPSByZXNbImRhdGEiXVsicGFja2FnZV9mYW1pbHkiXS5nZXQoIm5hbWUiLCAiIikKICAgICAgICAgICAgICAgICAgICBpZiBmYW1pbHlfbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc1siZGF0YSJdCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICByZXR1cm4gX3dpdGhfbG9hZGluZyhmIk1lbmdhbWJpbCBmYW1pbHkgcGFrZXQge2ZhbWlseV9jb2RlfS4uLiIsIF9mZXRjaF9mYW1pbHksIHVzZV9sb2FkaW5nLCB0aGVtZSkKCgpkZWYgZ2V0X2ZhbWlsaWVzKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBwYWNrYWdlX2NhdGVnb3J5X2NvZGU6IHN0ciwgdXNlX2xvYWRpbmc6IGJvb2wgPSBUcnVlKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiYXBpL3Y4L3hsLXN0b3Jlcy9mYW1pbGllcyIKICAgIHBheWxvYWQgPSB7CiAgICAgICAgIm1pZ3JhdGlvbl90eXBlIjogIiIsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAiaXNfc2hhcmVhYmxlIjogRmFsc2UsCiAgICAgICAgInBhY2thZ2VfY2F0ZWdvcnlfY29kZSI6IHBhY2thZ2VfY2F0ZWdvcnlfY29kZSwKICAgICAgICAid2l0aF9pY29uX3VybCI6IFRydWUsCiAgICAgICAgImlzX21pZ3JhdGlvbiI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImVuIiwKICAgIH0KICAgIHJlcyA9IF93aXRoX2xvYWRpbmcoZiJNZW5nYW1iaWwgZmFtaWxpZXMga2F0ZWdvcmkge3BhY2thZ2VfY2F0ZWdvcnlfY29kZX0uLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcy5nZXQoImRhdGEiKSBpZiByZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyIgZWxzZSBOb25lCgoKZGVmIGdldF9wYWNrYWdlKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LAogICAgICAgICAgICAgICAgcGFja2FnZV9vcHRpb25fY29kZTogc3RyLAogICAgICAgICAgICAgICAgcGFja2FnZV9mYW1pbHlfY29kZTogc3RyID0gIiIsCiAgICAgICAgICAgICAgICBwYWNrYWdlX3ZhcmlhbnRfY29kZTogc3RyID0gIiIsCiAgICAgICAgICAgICAgICB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJhcGkvdjgveGwtc3RvcmVzL29wdGlvbnMvZGV0YWlsIgogICAgcGF5bG9hZCA9IHsKICAgICAgICAiaXNfdHJhbnNhY3Rpb25fcm91dGluZSI6IEZhbHNlLAogICAgICAgICJtaWdyYXRpb25fdHlwZSI6ICJOT05FIiwKICAgICAgICAicGFja2FnZV9mYW1pbHlfY29kZSI6IHBhY2thZ2VfZmFtaWx5X2NvZGUsCiAgICAgICAgImZhbWlseV9yb2xlX2h1YiI6ICIiLAogICAgICAgICJpc19hdXRvYnV5IjogRmFsc2UsCiAgICAgICAgImlzX2VudGVycHJpc2UiOiBGYWxzZSwKICAgICAgICAiaXNfc2hhcmVhYmxlIjogRmFsc2UsCiAgICAgICAgImlzX21pZ3JhdGlvbiI6IEZhbHNlLAogICAgICAgICJsYW5nIjogImlkIiwKICAgICAgICAicGFja2FnZV9vcHRpb25fY29kZSI6IHBhY2thZ2Vfb3B0aW9uX2NvZGUsCiAgICAgICAgImlzX3Vwc2VsbF9wZHAiOiBGYWxzZSwKICAgICAgICAicGFja2FnZV92YXJpYW50X2NvZGUiOiBwYWNrYWdlX3ZhcmlhbnRfY29kZSwKICAgIH0KICAgIHJlcyA9IF93aXRoX2xvYWRpbmcoIk1lbmdhbWJpbCBkZXRhaWwgcGFrZXQuLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcy5nZXQoImRhdGEiKQoKCmRlZiBnZXRfcGFja2FnZV9kZXRhaWxzKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LAogICAgICAgICAgICAgICAgICAgICAgICBmYW1pbHlfY29kZTogc3RyLCB2YXJpYW50X2NvZGU6IHN0ciwgb3B0aW9uX29yZGVyOiBpbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzX2VudGVycHJpc2U6IGJvb2wgfCBOb25lID0gTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgbWlncmF0aW9uX3R5cGU6IHN0ciB8IE5vbmUgPSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3QgfCBOb25lOgogICAgZmFtaWx5X2RhdGEgPSBnZXRfZmFtaWx5KGFwaV9rZXksIHRva2VucywgZmFtaWx5X2NvZGUsIGlzX2VudGVycHJpc2UsIG1pZ3JhdGlvbl90eXBlLCB1c2VfbG9hZGluZykKICAgIGlmIG5vdCBmYW1pbHlfZGF0YToKICAgICAgICByZXR1cm4gTm9uZQoKICAgIG9wdGlvbl9jb2RlID0gTm9uZQogICAgZm9yIHZhcmlhbnQgaW4gZmFtaWx5X2RhdGEuZ2V0KCJwYWNrYWdlX3ZhcmlhbnRzIiwgW10pOgogICAgICAgIGlmIHZhcmlhbnQuZ2V0KCJwYWNrYWdlX3ZhcmlhbnRfY29kZSIpID09IHZhcmlhbnRfY29kZToKICAgICAgICAgICAgZm9yIG9wdGlvbiBpbiB2YXJpYW50LmdldCgicGFja2FnZV9vcHRpb25zIiwgW10pOgogICAgICAgICAgICAgICAgaWYgb3B0aW9uLmdldCgib3JkZXIiKSA9PSBvcHRpb25fb3JkZXI6CiAgICAgICAgICAgICAgICAgICAgb3B0aW9uX2NvZGUgPSBvcHRpb24uZ2V0KCJwYWNrYWdlX29wdGlvbl9jb2RlIikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgaWYgbm90IG9wdGlvbl9jb2RlOgogICAgICAgIHJldHVybiBOb25lCgogICAgcmV0dXJuIGdldF9wYWNrYWdlKGFwaV9rZXksIHRva2Vucywgb3B0aW9uX2NvZGUsIHVzZV9sb2FkaW5nPXVzZV9sb2FkaW5nKQoKCmRlZiBnZXRfYWRkb25zKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBwYWNrYWdlX29wdGlvbl9jb2RlOiBzdHIsIHVzZV9sb2FkaW5nOiBib29sID0gVHJ1ZSkgLT4gZGljdCB8IE5vbmU6CiAgICBwYXRoID0gImFwaS92OC94bC1zdG9yZXMvb3B0aW9ucy9hZGRvbnMtcGlua3ktYm94IgogICAgcGF5bG9hZCA9IHsiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLCAibGFuZyI6ICJlbiIsICJwYWNrYWdlX29wdGlvbl9jb2RlIjogcGFja2FnZV9vcHRpb25fY29kZX0KICAgIHJlcyA9IF93aXRoX2xvYWRpbmcoIk1lbmdhbWJpbCBhZGRvbnMuLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcy5nZXQoImRhdGEiKQoKCmRlZiBpbnRlcmNlcHRfcGFnZShhcGlfa2V5OiBzdHIsIHRva2VuczogZGljdCwgb3B0aW9uX2NvZGU6IHN0ciwgaXNfZW50ZXJwcmlzZTogYm9vbCA9IEZhbHNlLCB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJtaXNjL2FwaS92OC91dGlsaXR5L2ludGVyY2VwdC1wYWdlIgogICAgcGF5bG9hZCA9IHsiaXNfZW50ZXJwcmlzZSI6IGlzX2VudGVycHJpc2UsICJsYW5nIjogImVuIiwgInBhY2thZ2Vfb3B0aW9uX2NvZGUiOiBvcHRpb25fY29kZX0KICAgIHJldHVybiBfd2l0aF9sb2FkaW5nKCJNZW5nYW1iaWwgaW50ZXJjZXB0Li4uIiwgc2VuZF9hcGlfcmVxdWVzdCwgdXNlX2xvYWRpbmcsIGdldF90aGVtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwgcGF0aCwgcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgoKZGVmIGxvZ2luX2luZm8oYXBpX2tleTogc3RyLCB0b2tlbnM6IGRpY3QsIGlzX2VudGVycHJpc2U6IGJvb2wgPSBGYWxzZSwgdXNlX2xvYWRpbmc6IGJvb2wgPSBUcnVlKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiYXBpL3Y4L2F1dGgvbG9naW4iCiAgICBwYXlsb2FkID0gewogICAgICAgICJhY2Nlc3NfdG9rZW4iOiB0b2tlbnNbImFjY2Vzc190b2tlbiJdLAogICAgICAgICJpc19lbnRlcnByaXNlIjogaXNfZW50ZXJwcmlzZSwKICAgICAgICAibGFuZyI6ICJlbiIsCiAgICB9CiAgICByZXMgPSBfd2l0aF9sb2FkaW5nKCJNZW5nYW1iaWwgaW5mbyBsb2dpbi4uLiIsIHNlbmRfYXBpX3JlcXVlc3QsIHVzZV9sb2FkaW5nLCBnZXRfdGhlbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwgcGF0aCwgcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICByZXR1cm4gcmVzLmdldCgiZGF0YSIpCgoKZGVmIGdldF9ub3RpZmljYXRpb25zKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJhcGkvdjgvbm90aWZpY2F0aW9uLW5vbi1ncm91cGluZyIKICAgIHBheWxvYWQgPSB7ImlzX2VudGVycHJpc2UiOiBGYWxzZSwgImxhbmciOiAiZW4ifQogICAgcmVzID0gX3dpdGhfbG9hZGluZygiTWVuZ2FtYmlsIG5vdGlmaWthc2kuLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcyBpZiByZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyIgZWxzZSBOb25lCgoKZGVmIGdldF9ub3RpZmljYXRpb25fZGV0YWlsKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCBub3RpZmljYXRpb25faWQ6IHN0ciwgdXNlX2xvYWRpbmc6IGJvb2wgPSBUcnVlKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiYXBpL3Y4L25vdGlmaWNhdGlvbi9kZXRhaWwiCiAgICBwYXlsb2FkID0geyJpc19lbnRlcnByaXNlIjogRmFsc2UsICJsYW5nIjogImVuIiwgIm5vdGlmaWNhdGlvbl9pZCI6IG5vdGlmaWNhdGlvbl9pZH0KICAgIHJlcyA9IF93aXRoX2xvYWRpbmcoZiJNZW5nYW1iaWwgZGV0YWlsIG5vdGlmaWthc2kge25vdGlmaWNhdGlvbl9pZH0uLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIHRva2Vuc1siaWRfdG9rZW4iXSwgIlBPU1QiKQogICAgcmV0dXJuIHJlcyBpZiByZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyIgZWxzZSBOb25lCgoKZGVmIGdldF9wZW5kaW5nX3RyYW5zYWN0aW9uKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJhcGkvdjgvcHJvZmlsZSIKICAgIHBheWxvYWQgPSB7ImlzX2VudGVycHJpc2UiOiBGYWxzZSwgImxhbmciOiAiZW4ifQogICAgcmVzID0gX3dpdGhfbG9hZGluZygiTWVuZ2FtYmlsIHRyYW5zYWtzaSBwZW5kaW5nLi4uIiwgc2VuZF9hcGlfcmVxdWVzdCwgdXNlX2xvYWRpbmcsIGdldF90aGVtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LCBwYXRoLCBwYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgIGRhdGEgPSByZXMuZ2V0KCJkYXRhIiwge30pCiAgICByZXR1cm4gZGF0YSBpZiByZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyIgYW5kICJwZW5kaW5nX3BheW1lbnQiIGluIGRhdGEgZWxzZSBOb25lCgoKZGVmIGdldF90cmFuc2FjdGlvbl9oaXN0b3J5KGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3QgfCBOb25lOgogICAgcGF0aCA9ICJwYXltZW50cy9hcGkvdjgvdHJhbnNhY3Rpb24taGlzdG9yeSIKICAgIHBheWxvYWQgPSB7ImlzX2VudGVycHJpc2UiOiBGYWxzZSwgImxhbmciOiAiZW4ifQogICAgcmVzID0gX3dpdGhfbG9hZGluZygiTWVuZ2FtYmlsIHJpd2F5YXQgdHJhbnNha3NpLi4uIiwgc2VuZF9hcGlfcmVxdWVzdCwgdXNlX2xvYWRpbmcsIGdldF90aGVtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBhcGlfa2V5LCBwYXRoLCBwYXlsb2FkLCB0b2tlbnNbImlkX3Rva2VuIl0sICJQT1NUIikKICAgIGRhdGEgPSByZXMuZ2V0KCJkYXRhIiwge30pCiAgICByZXR1cm4gZGF0YSBpZiByZXMuZ2V0KCJzdGF0dXMiKSA9PSAiU1VDQ0VTUyIgYW5kICJsaXN0IiBpbiBkYXRhIGVsc2UgTm9uZQoKCmRlZiBnZXRfdGllcmluZ19pbmZvKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3Q6CiAgICBwYXRoID0gImdhbWlmaWNhdGlvbi9hcGkvdjgvbG95YWx0aWVzL3RpZXJpbmcvaW5mbyIKICAgIHBheWxvYWQgPSB7ImlzX2VudGVycHJpc2UiOiBGYWxzZSwgImxhbmciOiAiZW4ifQogICAgcmVzID0gX3dpdGhfbG9hZGluZygiTWVuZ2FtYmlsIGluZm8gdGllcmluZy4uLiIsIHNlbmRfYXBpX3JlcXVlc3QsIHVzZV9sb2FkaW5nLCBnZXRfdGhlbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwgcGF0aCwgcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICByZXR1cm4gcmVzLmdldCgiZGF0YSIsIHt9KSBpZiByZXMgYW5kIHJlcy5nZXQoInN0YXR1cyIpID09ICJTVUNDRVNTIiBlbHNlIHt9CgoKZGVmIHVuc3Vic2NyaWJlKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LAogICAgICAgICAgICAgICAgcXVvdGFfY29kZTogc3RyLCBwcm9kdWN0X2RvbWFpbjogc3RyLCBwcm9kdWN0X3N1YnNjcmlwdGlvbl90eXBlOiBzdHIsCiAgICAgICAgICAgICAgICB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGJvb2w6CiAgICBwYXRoID0gImFwaS92OC9wYWNrYWdlcy91bnN1YnNjcmliZSIKICAgIHBheWxvYWQgPSB7CiAgICAgICAgInByb2R1Y3Rfc3Vic2NyaXB0aW9uX3R5cGUiOiBwcm9kdWN0X3N1YnNjcmlwdGlvbl90eXBlLAogICAgICAgICJxdW90YV9jb2RlIjogcXVvdGFfY29kZSwKICAgICAgICAicHJvZHVjdF9kb21haW4iOiBwcm9kdWN0X2RvbWFpbiwKICAgICAgICAiaXNfZW50ZXJwcmlzZSI6IEZhbHNlLAogICAgICAgICJ1bnN1YnNjcmliZV9yZWFzb25fY29kZSI6ICIiLAogICAgICAgICJsYW5nIjogImVuIiwKICAgICAgICAiZmFtaWx5X21lbWJlcl9pZCI6ICIiLAogICAgfQogICAgcmVzID0gX3dpdGhfbG9hZGluZyhmIlVuc3Vic2NyaWJlIGt1b3RhIHtxdW90YV9jb2RlfS4uLiIsIHNlbmRfYXBpX3JlcXVlc3QsIHVzZV9sb2FkaW5nLCBnZXRfdGhlbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwgcGF0aCwgcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCiAgICByZXR1cm4gYm9vbChyZXMgYW5kIHJlcy5nZXQoImNvZGUiKSA9PSAiMDAwIikKCgpkZWYgZGFzaGJvYXJkX3NlZ21lbnRzKGFwaV9rZXk6IHN0ciwgdG9rZW5zOiBkaWN0LCB1c2VfbG9hZGluZzogYm9vbCA9IFRydWUpIC0+IGRpY3Q6CiAgICBwYXRoID0gImRhc2hib2FyZC9hcGkvdjgvc2VnbWVudHMiCiAgICBwYXlsb2FkID0geyJhY2Nlc3NfdG9rZW4iOiB0b2tlbnNbImFjY2Vzc190b2tlbiJdfQogICAgcmV0dXJuIF93aXRoX2xvYWRpbmcoIk1lbmdhbWJpbCBzZWdtZW4gZGFzaGJvYXJkLi4uIiwgc2VuZF9hcGlfcmVxdWVzdCwgdXNlX2xvYWRpbmcsIGdldF90aGVtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgYXBpX2tleSwgcGF0aCwgcGF5bG9hZCwgdG9rZW5zWyJpZF90b2tlbiJdLCAiUE9TVCIpCgoKZGVmIGRhc2hfc2VnbWVudHMoYXBpX2tleTogc3RyLCBpZF90b2tlbjogc3RyLCBhY2Nlc3NfdG9rZW46IHN0ciwgYmFsYW5jZTogaW50ID0gMCwgdXNlX2xvYWRpbmc6IGJvb2wgPSBUcnVlKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiZGFzaGJvYXJkL2FwaS92OC9zZWdtZW50cyIKICAgIHBheWxvYWQgPSB7CiAgICAgICAgImFjY2Vzc190b2tlbiI6IGFjY2Vzc190b2tlbiwKICAgICAgICAiYXBwX3ZlcnNpb24iOiAiOC45LjEiLAogICAgICAgICJjdXJyZW50X2JhbGFuY2UiOiBiYWxhbmNlLAogICAgICAgICJmYW1pbHlfcGxhbl9yb2xlIjogIk5PX1JPTEUiLAogICAgICAgICJpc19lbnRlcnByaXNlIjogRmFsc2UsCiAgICAgICAgImxhbmciOiAiaWQiLAogICAgICAgICJtYW51ZmFjdHVyZXJfbmFtZSI6ICJzYW1zdW5nIiwKICAgICAgICAibW9kZWxfbmFtZSI6ICJTTS1OOTM1RiIsCiAgICB9CiAgICByZXMgPSBfd2l0aF9sb2FkaW5nKCJNZW5nYW1iaWwgZGF0YSBzZWdtZW4gcGVuZ2d1bmEuLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCiAgICBpZiBub3QgKGlzaW5zdGFuY2UocmVzLCBkaWN0KSBhbmQgImRhdGEiIGluIHJlcyk6CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkYXRhID0gcmVzWyJkYXRhIl0KICAgIGxveWFsdHlfZGF0YSA9IGRhdGEuZ2V0KCJsb3lhbHR5Iiwge30pLmdldCgiZGF0YSIsIHt9KQogICAgbG95YWx0eV9pbmZvID0gewogICAgICAgICJjdXJyZW50X3BvaW50IjogbG95YWx0eV9kYXRhLmdldCgiY3VycmVudF9wb2ludCIsIDApLAogICAgICAgICJ0aWVyX25hbWUiOiBsb3lhbHR5X2RhdGEuZ2V0KCJkZXRhaWxfdGllciIsIHt9KS5nZXQoIm5hbWUiLCAiIiksCiAgICB9CiAgICBub3RpZmljYXRpb25zID0gZGF0YS5nZXQoIm5vdGlmaWNhdGlvbiIsIHt9KS5nZXQoImRhdGEiLCBbXSkKICAgIHNmeV9kYXRhID0gZGF0YS5nZXQoInNwZWNpYWxfZm9yX3lvdSIsIHt9KS5nZXQoImRhdGEiLCB7fSkKICAgIHNmeV9iYW5uZXJzID0gc2Z5X2RhdGEuZ2V0KCJiYW5uZXJzIiwgW10pCiAgICBzcGVjaWFsX3BhY2thZ2VzID0gW10KCiAgICBmb3IgcGtnIGluIHNmeV9iYW5uZXJzOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHBrZy5nZXQoImFjdGlvbl9wYXJhbSIpOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAga3VvdGFfdG90YWwgPSBzdW0oCiAgICAgICAgICAgICAgICBpbnQoYmVuZWZpdC5nZXQoInRvdGFsIiwgMCkpCiAgICAgICAgICAgICAgICBmb3IgYmVuZWZpdCBpbiBwa2cuZ2V0KCJiZW5lZml0cyIsIFtdKQogICAgICAgICAgICAgICAgaWYgYmVuZWZpdC5nZXQoImRhdGFfdHlwZSIpID09ICJEQVRBIgogICAgICAgICAgICApCiAgICAgICAgICAgIGt1b3RhX2diID0ga3VvdGFfdG90YWwgLyAoMTAyNCAqKiAzKQogICAgICAgICAgICBvcmlnaW5hbF9wcmljZSA9IGludChwa2cuZ2V0KCJvcmlnaW5hbF9wcmljZSIsIDApKQogICAgICAgICAgICBkaXNjb3VudGVkX3ByaWNlID0gaW50KHBrZy5nZXQoImRpc2NvdW50ZWRfcHJpY2UiLCBvcmlnaW5hbF9wcmljZSkpCiAgICAgICAgICAgIGRpc2tvbl9wZXJjZW50ID0gaW50KHJvdW5kKChvcmlnaW5hbF9wcmljZSAtIGRpc2NvdW50ZWRfcHJpY2UpIC8gb3JpZ2luYWxfcHJpY2UgKiAxMDApKSBpZiBvcmlnaW5hbF9wcmljZSBlbHNlIDAKCiAgICAgICAgICAgIHNwZWNpYWxfcGFja2FnZXMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICJuYW1lIjogZiJ7cGtnLmdldCgnZmFtaWx5X25hbWUnLCAnJyl9ICh7cGtnLmdldCgndGl0bGUnLCAnJyl9KSB7cGtnLmdldCgndmFsaWRpdHknLCAnJyl9IiwKICAgICAgICAgICAgICAgICJrb2RlX3Bha2V0IjogcGtnLmdldCgiYWN0aW9uX3BhcmFtIiwgIiIpLAogICAgICAgICAgICAgICAgIm9yaWdpbmFsX3ByaWNlIjogb3JpZ2luYWxfcHJpY2UsCiAgICAgICAgICAgICAgICAiZGlza29uX3ByaWNlIjogZGlzY291bnRlZF9wcmljZSwKICAgICAgICAgICAgICAgICJkaXNrb25fcGVyY2VudCI6IGRpc2tvbl9wZXJjZW50LAogICAgICAgICAgICAgICAgImt1b3RhX2diIjoga3VvdGFfZ2IsCiAgICAgICAgICAgIH0pCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgY29udGludWUKCiAgICByZXR1cm4gewogICAgICAgICJsb3lhbHR5IjogbG95YWx0eV9pbmZvLAogICAgICAgICJub3RpZmljYXRpb24iOiBub3RpZmljYXRpb25zLAogICAgICAgICJzcGVjaWFsX3BhY2thZ2VzIjogc3BlY2lhbF9wYWNrYWdlcywKICAgIH0KCgpkZWYgZ2V0X3F1b3RhKGFwaV9rZXk6IHN0ciwgaWRfdG9rZW46IHN0ciwgdXNlX2xvYWRpbmc6IGJvb2wgPSBUcnVlKSAtPiBkaWN0IHwgTm9uZToKICAgIHBhdGggPSAiYXBpL3Y4L3BhY2thZ2VzL3F1b3RhLXN1bW1hcnkiCiAgICBwYXlsb2FkID0geyJpc19lbnRlcnByaXNlIjogRmFsc2UsICJsYW5nIjogImVuIn0KICAgIHJlcyA9IF93aXRoX2xvYWRpbmcoIk1lbmdhbWJpbCByaW5na2FzYW4ga3VvdGEuLi4iLCBzZW5kX2FwaV9yZXF1ZXN0LCB1c2VfbG9hZGluZywgZ2V0X3RoZW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFwaV9rZXksIHBhdGgsIHBheWxvYWQsIGlkX3Rva2VuLCAiUE9TVCIpCiAgICBxdW90YSA9IHJlcy5nZXQoImRhdGEiLCB7fSkuZ2V0KCJxdW90YSIsIHt9KS5nZXQoImRhdGEiKQogICAgaWYgcXVvdGE6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInJlbWFpbmluZyI6IHF1b3RhLmdldCgicmVtYWluaW5nIiwgMCksCiAgICAgICAgICAgICJ0b3RhbCI6IHF1b3RhLmdldCgidG90YWwiLCAwKSwKICAgICAgICAgICAgImhhc191bmxpbWl0ZWQiOiBxdW90YS5nZXQoImhhc191bmxpbWl0ZWQiLCBGYWxzZSksCiAgICAgICAgfQogICAgcmV0dXJuIE5vbmUK').decode())
